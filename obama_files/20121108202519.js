/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.manager"]){dojo._hasResource["dijit._base.manager"]=true;dojo.provide("dijit._base.manager");dojo.declare("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0},add:function(b){if(this._hash[b.id])throw Error("Tried to register widget with id=="+b.id+" but that id is already registered");this._hash[b.id]=b;this.length++},remove:function(b){if(this._hash[b]){delete this._hash[b];this.length--}},forEach:function(b,c){c=c||dojo.global;var f=0,e;
for(e in this._hash)b.call(c,this._hash[e],f++,this._hash);return this},filter:function(b,c){c=c||dojo.global;var f=new dijit.WidgetSet,e=0,m;for(m in this._hash){var n=this._hash[m];b.call(c,n,e++,this._hash)&&f.add(n)}return f},byId:function(b){return this._hash[b]},byClass:function(b){var c=new dijit.WidgetSet,f,e;for(f in this._hash){e=this._hash[f];e.declaredClass==b&&c.add(e)}return c},toArray:function(){var b=[],c;for(c in this._hash)b.push(this._hash[c]);return b},map:function(b,c){return dojo.map(this.toArray(),
b,c)},every:function(b,c){c=c||dojo.global;var f=0,e;for(e in this._hash)if(!b.call(c,this._hash[e],f++,this._hash))return false;return true},some:function(b,c){c=c||dojo.global;var f=0,e;for(e in this._hash)if(b.call(c,this._hash[e],f++,this._hash))return true;return false}});(function(){dijit.registry=new dijit.WidgetSet;var b=dijit.registry._hash,c=dojo.attr,f=dojo.hasAttr,e=dojo.style;dijit.byId=function(a){return typeof a=="string"?b[a]:a};var m={};dijit.getUniqueId=function(a){var d;do d=a+
"_"+(a in m?++m[a]:m[a]=0);while(b[d]);return dijit._scopeName=="dijit"?d:dijit._scopeName+"_"+d};dijit.findWidgets=function(a){function d(h){for(h=h.firstChild;h;h=h.nextSibling)if(h.nodeType==1){var j=h.getAttribute("widgetId");if(j)(j=b[j])&&i.push(j);else d(h)}}var i=[];d(a);return i};dijit._destroyAll=function(){dijit._curFocus=null;dijit._prevFocus=null;dijit._activeStack=[];dojo.forEach(dijit.findWidgets(dojo.body()),function(a){if(!a._destroyed)if(a.destroyRecursive)a.destroyRecursive();else a.destroy&&
a.destroy()})};dojo.isIE&&dojo.addOnWindowUnload(function(){dijit._destroyAll()});dijit.byNode=function(a){return b[a.getAttribute("widgetId")]};dijit.getEnclosingWidget=function(a){for(;a;){var d=a.getAttribute&&a.getAttribute("widgetId");if(d)return b[d];a=a.parentNode}return null};var n=dijit._isElementShown=function(a){var d=e(a);return d.visibility!="hidden"&&d.visibility!="collapsed"&&d.display!="none"&&c(a,"type")!="hidden"};dijit.hasDefaultTabStop=function(a){switch(a.nodeName.toLowerCase()){case "a":return f(a,
"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return true;case "iframe":var d;try{var i=a.contentDocument;if("designMode"in i&&i.designMode=="on")return true;d=i.body}catch(h){try{d=a.contentWindow.document.body}catch(j){return false}}return d.contentEditable=="true"||d.firstChild&&d.firstChild.contentEditable=="true";default:return a.contentEditable=="true"}};var t=dijit.isTabNavigable=function(a){return c(a,"disabled")?false:f(a,"tabIndex")?c(a,"tabIndex")>=
0:dijit.hasDefaultTabStop(a)};dijit._getTabNavigable=function(a){function d(l){return l&&l.tagName.toLowerCase()=="input"&&l.type&&l.type.toLowerCase()=="radio"&&l.name&&l.name.toLowerCase()}var i,h,j,q,p,r,o={},s=function(l){dojo.query("> *",l).forEach(function(g){if(!(dojo.isIE&&g.scopeName!=="HTML"||!n(g))){if(t(g)){var k=c(g,"tabIndex");if(!f(g,"tabIndex")||k==0){i||(i=g);h=g}else if(k>0){if(!j||k<q){q=k;j=g}if(!p||k>=r){r=k;p=g}}k=d(g);if(dojo.attr(g,"checked")&&k)o[k]=g}g.nodeName.toUpperCase()!=
"SELECT"&&s(g)}})};n(a)&&s(a);return{first:o[d(i)]||i,last:o[d(h)]||h,lowest:o[d(j)]||j,highest:o[d(p)]||p}};dijit.getFirstInTabbingOrder=function(a){a=dijit._getTabNavigable(dojo.byId(a));return a.lowest?a.lowest:a.first};dijit.getLastInTabbingOrder=function(a){a=dijit._getTabNavigable(dojo.byId(a));return a.last?a.last:a.highest};dijit.defaultDuration=dojo.config.defaultDuration||200})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.typematic"]){dojo._hasResource["dijit._base.typematic"]=true;dojo.provide("dijit._base.typematic");dijit.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(this._currentTimeout<0?this._initialDelay:this._subsequentDelay>1?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(dojo.hitch(this,"_fireEventAndReload"),
this._currentTimeout)},trigger:function(c,a,h,f,e,g,d,b){if(e!=this._obj){this.stop();this._initialDelay=d||500;this._subsequentDelay=g||0.9;this._minDelay=b||10;this._obj=e;this._evt=c;this._node=h;this._count=this._currentTimeout=-1;this._callback=dojo.hitch(a,f);this._fireEventAndReload();this._evt=dojo.mixin({faux:true},c)}},stop:function(){if(this._timer){clearTimeout(this._timer);this._timer=null}if(this._obj){this._callback(-1,this._node,this._evt);this._obj=null}},addKeyListener:function(c,
a,h,f,e,g,d){if(a.keyCode){a.charOrCode=a.keyCode;dojo.deprecated("keyCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0")}else if(a.charCode){a.charOrCode=String.fromCharCode(a.charCode);dojo.deprecated("charCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0")}return[dojo.connect(c,"onkeypress",this,function(b){if(b.charOrCode==a.charOrCode&&(a.ctrlKey===undefined||a.ctrlKey==b.ctrlKey)&&
(a.altKey===undefined||a.altKey==b.altKey)&&(a.metaKey===undefined||a.metaKey==(b.metaKey||false))&&(a.shiftKey===undefined||a.shiftKey==b.shiftKey)){dojo.stopEvent(b);dijit.typematic.trigger(b,h,c,f,a,e,g,d)}else dijit.typematic._obj==a&&dijit.typematic.stop()}),dojo.connect(c,"onkeyup",this,function(){dijit.typematic._obj==a&&dijit.typematic.stop()})]},addMouseListener:function(c,a,h,f,e,g){var d=dojo.connect;return[d(c,"mousedown",this,function(b){dojo.stopEvent(b);dijit.typematic.trigger(b,a,
c,h,c,f,e,g)}),d(c,"mouseup",this,function(b){dojo.stopEvent(b);dijit.typematic.stop()}),d(c,"mouseout",this,function(b){dojo.stopEvent(b);dijit.typematic.stop()}),d(c,"mousemove",this,function(b){b.preventDefault()}),d(c,"dblclick",this,function(b){dojo.stopEvent(b);if(dojo.isIE){dijit.typematic.trigger(b,a,c,h,c,f,e,g);setTimeout(dojo.hitch(this,dijit.typematic.stop),50)}})]},addListener:function(c,a,h,f,e,g,d,b){return this.addKeyListener(a,h,f,e,g,d,b).concat(this.addMouseListener(c,f,e,g,d,b))}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.wai"]){dojo._hasResource["dijit._base.wai"]=true;dojo.provide("dijit._base.wai");dijit.wai={onload:function(){var a=dojo.create("div",{id:"a11yTestNode",style:{cssText:'border: 1px solid;border-color:red green;position: absolute;height: 5px;top: -999px;background-image: url("'+(dojo.config.blankGif||dojo.moduleUrl("dojo","resources/blank.gif"))+'");'}},dojo.body()),b=dojo.getComputedStyle(a);if(b){var c=b.backgroundImage;dojo[b.borderTopColor==b.borderRightColor||
c!=null&&(c=="none"||c=="url(invalid-url:)")?"addClass":"removeClass"](dojo.body(),"dijit_a11y");if(dojo.isIE)a.outerHTML="";else dojo.body().removeChild(a)}}};if(dojo.isIE||dojo.isMoz)dojo._loaders.unshift(dijit.wai.onload);dojo.mixin(dijit,{hasWaiRole:function(a,b){var c=this.getWaiRole(a);return b?c.indexOf(b)>-1:c.length>0},getWaiRole:function(a){return dojo.trim((dojo.attr(a,"role")||"").replace("wairole:",""))},setWaiRole:function(a,b){dojo.attr(a,"role",b)},removeWaiRole:function(a,b){var c=
dojo.attr(a,"role");if(c)if(b){c=dojo.trim((" "+c+" ").replace(" "+b+" "," "));dojo.attr(a,"role",c)}else a.removeAttribute("role")},hasWaiState:function(a,b){return a.hasAttribute?a.hasAttribute("aria-"+b):!!a.getAttribute("aria-"+b)},getWaiState:function(a,b){return a.getAttribute("aria-"+b)||""},setWaiState:function(a,b,c){a.setAttribute("aria-"+b,c)},removeWaiState:function(a,b){a.removeAttribute("aria-"+b)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Contained"]){dojo._hasResource["dijit._Contained"]=true;dojo.provide("dijit._Contained");dojo.declare("dijit._Contained",null,{getParent:function(){var a=dijit.getEnclosingWidget(this.domNode.parentNode);return a&&a.isContainer?a:null},_getSibling:function(a){var b=this.domNode;do b=b[a+"Sibling"];while(b&&b.nodeType!=1);return b&&dijit.byNode(b)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var a=this.getParent();if(!a||!a.getIndexOfChild)return-1;return a.getIndexOfChild(this)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Container"]){dojo._hasResource["dijit._Container"]=true;dojo.provide("dijit._Container");dojo.declare("dijit._Container",null,{isContainer:true,buildRendering:function(){this.inherited(arguments);if(!this.containerNode)this.containerNode=this.domNode},addChild:function(a,b){var c=this.containerNode;if(b&&typeof b=="number"){var d=this.getChildren();if(d&&d.length>=b){c=d[b-1].domNode;b="after"}}dojo.place(a.domNode,c,b);this._started&&!a._started&&a.startup()},removeChild:function(a){if(typeof a==
"number")a=this.getChildren()[a];if(a)(a=a.domNode)&&a.parentNode&&a.parentNode.removeChild(a)},hasChildren:function(){return this.getChildren().length>0},destroyDescendants:function(a){dojo.forEach(this.getChildren(),function(b){b.destroyRecursive(a)})},_getSiblingOfChild:function(a,b){var c=a.domNode,d=b>0?"nextSibling":"previousSibling";do c=c[d];while(c&&(c.nodeType!=1||!dijit.byNode(c)));return c&&dijit.byNode(c)},getIndexOfChild:function(a){return dojo.indexOf(this.getChildren(),a)},startup:function(){if(!this._started){dojo.forEach(this.getChildren(),
function(a){a.startup()});this.inherited(arguments)}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._CssStateMixin"]){dojo._hasResource["dijit._CssStateMixin"]=true;dojo.provide("dijit._CssStateMixin");dojo.declare("dijit._CssStateMixin",[],{cssStateNodes:{},hovering:false,active:false,_applyAttributes:function(){this.inherited(arguments);dojo.forEach(["onmouseenter","onmouseleave","onmousedown"],function(b){this.connect(this.domNode,b,"_cssMouseEvent")},this);dojo.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active"],function(b){this.watch(b,
dojo.hitch(this,"_setStateClass"))},this);for(var a in this.cssStateNodes)this._trackMouseState(this[a],this.cssStateNodes[a]);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseenter":case "mouseover":this._set("hovering",true);this._set("active",this._mouseDown);break;case "mouseleave":case "mouseout":this._set("hovering",false);this._set("active",false);break;case "mousedown":this._set("active",true);this._mouseDown=true;var b=this.connect(dojo.body(),
"onmouseup",function(){this._mouseDown=false;this._set("active",false);this.disconnect(b)})}},_setStateClass:function(){function a(c){b=b.concat(dojo.map(b,function(e){return e+c}),"dijit"+c)}var b=this.baseClass.split(" ");this.isLeftToRight()||a("Rtl");this.checked&&a("Checked");this.state&&a(this.state);this.selected&&a("Selected");if(this.disabled)a("Disabled");else if(this.readOnly)a("ReadOnly");else if(this.active)a("Active");else this.hovering&&a("Hover");this._focused&&a("Focused");var d=
this.stateNode||this.domNode,f={};dojo.forEach(d.className.split(" "),function(c){f[c]=true});"_stateClasses"in this&&dojo.forEach(this._stateClasses,function(c){delete f[c]});dojo.forEach(b,function(c){f[c]=true});var g=[],h;for(h in f)g.push(h);d.className=g.join(" ");this._stateClasses=b},_trackMouseState:function(a,b){function d(){var i="disabled"in c&&c.disabled||"readonly"in c&&c.readonly;dojo.toggleClass(a,b+"Hover",f&&!g&&!i);dojo.toggleClass(a,b+"Active",g&&!i);dojo.toggleClass(a,b+"Focused",
h&&!i)}var f=false,g=false,h=false,c=this,e=dojo.hitch(this,"connect",a);e("onmouseenter",function(){f=true;d()});e("onmouseleave",function(){g=f=false;d()});e("onmousedown",function(){g=true;d()});e("onmouseup",function(){g=false;d()});e("onfocus",function(){h=true;d()});e("onblur",function(){h=false;d()});this.watch("disabled",d);this.watch("readOnly",d)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(b){this.pairs=[];this.returnWrappers=b||false};dojo.extend(dojo.AdapterRegistry,{register:function(b,a,c,d,e){this.pairs[e?"unshift":"push"]([b,a,c,d])},match:function(){for(var b=0;b<this.pairs.length;b++){var a=this.pairs[b];if(a[1].apply(this,arguments))return a[3]||this.returnWrappers?a[2]:a[2].apply(this,arguments)}throw Error("No match found");
},unregister:function(b){for(var a=0;a<this.pairs.length;a++)if(this.pairs[a][0]==b){this.pairs.splice(a,1);return true}return false}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.back"]){dojo._hasResource["dojo.back"]=true;dojo.provide("dojo.back");dojo.getObject("back",true,dojo);(function(){function h(){var a=c.pop();if(a){var b=c[c.length-1];if(!b&&c.length==0)b=j;if(b)if(b.kwArgs.back)b.kwArgs.back();else if(b.kwArgs.backButton)b.kwArgs.backButton();else b.kwArgs.handle&&b.kwArgs.handle("back");e.push(a)}}function m(){var a=e.pop();if(a){if(a.kwArgs.forward)a.kwArgs.forward();else if(a.kwArgs.forwardButton)a.kwArgs.forwardButton();else a.kwArgs.handle&&
a.kwArgs.handle("forward");c.push(a)}}function k(a,b,d){return{url:a,kwArgs:b,urlHash:d}}function n(a){a=a.split("?");return a.length<2?null:a[1]}function t(){var a=(dojo.config.dojoIframeHistoryUrl||dojo.moduleUrl("dojo","resources/iframe_history.html"))+"?"+(new Date).getTime();o=true;if(i)dojo.isWebKit?i.location=a:window.frames[i.name].location=a;return a}function y(){if(!p){var a=c.length,b=l();if((b===u||window.location.href==v)&&a==1)h();else{if(e.length>0)if(e[e.length-1].urlHash===b){m();
return}a>=2&&c[a-2]&&c[a-2].urlHash===b&&h()}}}var f=dojo.back,l=f.getHash=function(){var a=window.location.hash;if(a.charAt(0)=="#")a=a.substring(1);return dojo.isMozilla?a:decodeURIComponent(a)},q=f.setHash=function(a){a||(a="");window.location.hash=encodeURIComponent(a)},v=typeof window!=="undefined"?window.location.href:"",u=typeof window!=="undefined"?l():"",j=null,w=null,r=null,i=null,e=[],c=[],o=false,p=false;f.goBack=h;f.goForward=m;f.init=function(){if(!dojo.byId("dj_history")){var a=dojo.config.dojoIframeHistoryUrl||
dojo.moduleUrl("dojo","resources/iframe_history.html");dojo._postLoad?console.error("dojo.back.init() must be called before the DOM has loaded. If using xdomain loading or djConfig.debugAtAllCosts, include dojo.back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+a+'"></iframe>')}};f.setInitialState=function(a){j=k(v,a,u)};f.addToHistory=function(a){e=[];var b=null,d=null;
if(!i){dojo.config.useXDomain&&!dojo.config.dojoIframeHistoryUrl&&console.warn("dojo.back: When using cross-domain Dojo builds, please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl to the path on your domain to iframe_history.html");i=window.frames.dj_history}r||(r=dojo.create("a",{style:{display:"none"}},dojo.body()));if(a.changeUrl){b=""+(a.changeUrl!==true?a.changeUrl:(new Date).getTime());if(c.length==0&&j.urlHash==b){j=k(d,a,b);return}else if(c.length>0&&c[c.length-
1].urlHash==b){c[c.length-1]=k(d,a,b);return}p=true;setTimeout(function(){q(b);p=false},1);r.href=b;if(dojo.isIE){d=t();var z=a.back||a.backButton||a.handle,g=function(s){l()!=""&&setTimeout(function(){q(b)},1);z.apply(this,[s])};if(a.back)a.back=g;else if(a.backButton)a.backButton=g;else if(a.handle)a.handle=g;var x=a.forward||a.forwardButton||a.handle;g=function(s){l()!=""&&q(b);x&&x.apply(this,[s])};if(a.forward)a.forward=g;else if(a.forwardButton)a.forwardButton=g;else if(a.handle)a.handle=g}else dojo.isIE||
w||(w=setInterval(y,200))}else d=t();c.push(k(d,a,b))};f._iframeLoaded=function(a,b){var d=n(b.href);if(d==null)c.length==1&&h();else if(o)o=false;else if(c.length>=2&&d==n(c[c.length-2].url))h();else e.length>0&&d==n(e[e.length-1].url)&&m()}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.behavior"]){dojo._hasResource["dojo.behavior"]=true;dojo.provide("dojo.behavior");dojo.behavior=new function(){function i(b,a){b[a]||(b[a]=[]);return b[a]}function f(b,a,c){var e={},d;for(d in b)if(typeof e[d]=="undefined")c?c.call(a,b[d],d):a(b[d],d)}var j=0;this._behaviors={};this.add=function(b){f(b,this,function(a,c){var e=i(this._behaviors,c);if(typeof e.id!="number")e.id=j++;var d=[];e.push(d);if(dojo.isString(a)||dojo.isFunction(a))a={found:a};f(a,function(g,h){i(d,
h).push(g)})})};var k=function(b,a,c){if(dojo.isString(a))c=="found"?dojo.publish(a,[b]):dojo.connect(b,c,function(){dojo.publish(a,arguments)});else if(dojo.isFunction(a))c=="found"?a(b):dojo.connect(b,c,a)};this.apply=function(){f(this._behaviors,function(b,a){dojo.query(a).forEach(function(c){var e=0,d="_dj_behavior_"+b.id;if(typeof c[d]=="number"){e=c[d];if(e==b.length)return}e=e;for(var g;g=b[e];e++)f(g,function(h,l){dojo.isArray(h)&&dojo.forEach(h,function(m){k(c,m,l)})});c[d]=b.length})})}};
dojo.addOnLoad(dojo.behavior,"apply")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cache"]){dojo._hasResource["dojo.cache"]=true;dojo.provide("dojo.cache");var cache={};dojo.cache=function(a,b,c){if(typeof a=="string")a=dojo.moduleUrl(a,b);else{a=a;c=b}b=a.toString();a=c;if(c!=undefined&&!dojo.isString(c))a="value"in c?c.value:undefined;c=c&&c.sanitize?true:false;if(typeof a=="string")a=cache[b]=c?dojo.cache._sanitize(a):a;else if(a===null)delete cache[b];else{if(!(b in cache)){a=dojo._getText(b);cache[b]=c?dojo.cache._sanitize(a):a}a=cache[b]}return a};
dojo.cache._sanitize=function(a){if(a){a=a.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(b)a=b[1]}else a="";return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date"]){dojo._hasResource["dojo.date"]=true;dojo.provide("dojo.date");dojo.getObject("date",true,dojo);dojo.date.getDaysInMonth=function(b){var a=b.getMonth();if(a==1&&dojo.date.isLeapYear(b))return 29;return[31,28,31,30,31,30,31,31,30,31,30,31][a]};dojo.date.isLeapYear=function(b){b=b.getFullYear();return!(b%400)||!(b%4)&&!!(b%100)};dojo.date.getTimezoneName=function(b){var a=b.toString(),c="",d=a.indexOf("(");if(d>-1)c=a.substring(++d,a.indexOf(")"));else{d=/([A-Z\/]+) \d{4}$/;
if(a=a.match(d))c=a[1];else{a=b.toLocaleString();d=/ ([A-Z\/]+)$/;if(a=a.match(d))c=a[1]}}return c=="AM"||c=="PM"?"":c};dojo.date.compare=function(b,a,c){b=new Date(+b);a=new Date(+(a||new Date));if(c=="date"){b.setHours(0,0,0,0);a.setHours(0,0,0,0)}else if(c=="time"){b.setFullYear(0,0,0);a.setFullYear(0,0,0)}if(b>a)return 1;if(b<a)return-1;return 0};dojo.date.add=function(b,a,c){var d=new Date(+b),e=false,f="Date";switch(a){case "day":break;case "weekday":var g;if(a=c%5){a=a;g=parseInt(c/5)}else{a=
c>0?5:-5;g=c>0?(c-5)/5:(c+5)/5}var h=b.getDay(),i=0;if(h==6&&c>0)i=1;else if(h==0&&c<0)i=-1;h=h+a;if(h==0||h==6)i=c>0?2:-2;c=7*g+a+i;break;case "year":f="FullYear";e=true;break;case "week":c*=7;break;case "quarter":c*=3;case "month":e=true;f="Month";break;default:f="UTC"+a.charAt(0).toUpperCase()+a.substring(1)+"s"}f&&d["set"+f](d["get"+f]()+c);e&&d.getDate()<b.getDate()&&d.setDate(0);return d};dojo.date.difference=function(b,a,c){a=a||new Date;c=c||"day";var d=a.getFullYear()-b.getFullYear(),e=1;
switch(c){case "quarter":b=b.getMonth();a=a.getMonth();b=Math.floor(b/3)+1;a=Math.floor(a/3)+1;a+=d*4;e=a-b;break;case "weekday":d=Math.round(dojo.date.difference(b,a,"day"));c=parseInt(dojo.date.difference(b,a,"week"));e=d%7;if(e==0)d=c*5;else{var f=0,g=b.getDay();a=a.getDay();c=parseInt(d/7);e=d%7;b=new Date(b);b.setDate(b.getDate()+c*7);b=b.getDay();if(d>0)switch(true){case g==6:f=-1;break;case g==0:f=0;break;case a==6:f=-1;break;case a==0:f=-2;break;case b+e>5:f=-2}else if(d<0)switch(true){case g==
6:f=0;break;case g==0:f=1;break;case a==6:f=2;break;case a==0:f=1;break;case b+e<0:f=2}d+=f;d-=c*2}e=d;break;case "year":e=d;break;case "month":e=a.getMonth()-b.getMonth()+d*12;break;case "week":e=parseInt(dojo.date.difference(b,a,"day")/7);break;case "day":e/=24;case "hour":e/=60;case "minute":e/=60;case "second":e/=1E3;case "millisecond":e*=a.getTime()-b.getTime()}return Math.round(e)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date.stamp"]){dojo._hasResource["dojo.date.stamp"]=true;dojo.provide("dojo.date.stamp");dojo.getObject("date.stamp",true,dojo);dojo.date.stamp.fromISOString=function(e,d){if(!dojo.date.stamp._isoRegExp)dojo.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;var a=dojo.date.stamp._isoRegExp.exec(e),f=null;if(a){a.shift();a[1]&&a[1]--;if(a[6])a[6]*=1E3;if(d){d=new Date(d);dojo.forEach(dojo.map(["FullYear",
"Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(g){return d["get"+g]()}),function(g,h){a[h]=a[h]||g})}f=new Date(a[0]||1970,a[1]||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0);if(a[0]<100)f.setFullYear(a[0]||1970);var b=0,c=a[7]&&a[7].charAt(0);if(c!="Z"){b=(a[8]||0)*60+(Number(a[9])||0);if(c!="-")b*=-1}if(c)b-=f.getTimezoneOffset();b&&f.setTime(f.getTime()+b*6E4)}return f};dojo.date.stamp.toISOString=function(e,d){var a=function(h){return h<10?"0"+h:h};d=d||{};var f=[],b=d.zulu?
"getUTC":"get",c="";if(d.selector!="time"){c=e[b+"FullYear"]();c=["0000".substr((c+"").length)+c,a(e[b+"Month"]()+1),a(e[b+"Date"]())].join("-")}f.push(c);if(d.selector!="date"){c=[a(e[b+"Hours"]()),a(e[b+"Minutes"]()),a(e[b+"Seconds"]())].join(":");b=e[b+"Milliseconds"]();if(d.milliseconds)c+="."+(b<100?"0":"")+a(b);if(d.zulu)c+="Z";else if(d.selector!="time"){b=e.getTimezoneOffset();var g=Math.abs(b);c+=(b>0?"-":"+")+a(Math.floor(g/60))+":"+a(g%60)}f.push(c)}return f.join("T")}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.hash"]){dojo._hasResource["dojo.hash"]=true;dojo.provide("dojo.hash");(function(){function m(a,b){var e=a.indexOf(b);return e>=0?a.substring(e+1):""}function d(){return m(location.href,"#")}function i(){dojo.publish("/dojo/hashchange",[d()])}function o(){if(d()!==c){c=d();i()}}function p(a){if(g)if(g.isTransitioning())setTimeout(dojo.hitch(null,p,a),j);else{var b=g.iframe.location.href,e=b.indexOf("?");g.iframe.location.replace(b.substring(0,e)+"?"+a)}else{location.replace("#"+
a);!q&&o()}}function u(){function a(){c=d();r=f?c:m(n.href,"?");k=false;l=null}var b=document.createElement("iframe"),e=dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html");dojo.config.useXDomain&&!dojo.config.dojoBlankHtmlUrl&&console.warn("dojo.hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html");b.id="dojo-hash-iframe";b.src=e+"?"+d();b.style.display="none";
document.body.appendChild(b);this.iframe=dojo.global["dojo-hash-iframe"];var r,k,l,s,f,n=this.iframe.location;this.isTransitioning=function(){return k};this.pollLocation=function(){if(!f)try{var t=m(n.href,"?");if(document.title!=s)s=this.iframe.document.title=document.title}catch(v){f=true;console.error("dojo.hash: Error adding history entry. Server unreachable.")}var h=d();if(k&&c===h)if(f||t===l){a();i()}else{setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!(c===h&&(f||r===t)))if(c!==
h){c=h;k=true;l=h;b.src=e+"?"+l;f=false;setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!f){location.href="#"+n.search.substring(1);a();i()}setTimeout(dojo.hitch(this,this.pollLocation),j)};a();setTimeout(dojo.hitch(this,this.pollLocation),j)}dojo.hash=function(a,b){if(!arguments.length)return d();if(a.charAt(0)=="#")a=a.substring(1);if(b)p(a);else location.href="#"+a;return a};var c,g,q,j=dojo.config.hashPollFrequency||100;dojo.addOnLoad(function(){if("onhashchange"in dojo.global&&
(!dojo.isIE||dojo.isIE>=8&&document.compatMode!="BackCompat"))q=dojo.connect(dojo.global,"onhashchange",i);else if(document.addEventListener){c=d();setInterval(o,j)}else if(document.attachEvent)g=new u})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.i18n"]){dojo._hasResource["dojo.i18n"]=true;dojo.provide("dojo.i18n");dojo.getObject("i18n",true,dojo);dojo.i18n.getLocalization=dojo.i18n.getLocalization||function(a,f,d){d=dojo.i18n.normalizeLocale(d);var e=d.split("-"),b=[a,"nls",f].join(".");if(b=dojo._loadedModules[b]){for(var c,h=e.length;h>0;h--){var g=e.slice(0,h).join("_");if(b[g]){c=b[g];break}}if(!c)c=b.ROOT;if(c){a=function(){};a.prototype=c;return new a}}throw Error("Bundle not found: "+f+" in "+a+" , locale="+
d);};dojo.i18n.normalizeLocale=function(a){a=a?a.toLowerCase():dojo.locale;if(a=="root")a="ROOT";return a};dojo.i18n._requireLocalization=function(a,f,d,e){d=dojo.i18n.normalizeLocale(d);var b=[a,"nls",f].join("."),c="";if(e){for(var h=e.split(","),g=0;g<h.length;g++)if(d.indexOf(h[g])==0)if(h[g].length>c.length)c=h[g];c||(c="ROOT")}h=e?c:d;var i=dojo._loadedModules[b];g=null;if(i){if(dojo.config.localizationComplete&&i._built)return;g=h.replace(/-/g,"_");g=dojo._loadedModules[b+"."+g]}if(!g){i=dojo.provide(b);
var r=dojo._getModuleSymbols(a).concat("nls").join("/"),n;dojo.i18n._searchLocalePath(h,e,function(l){var j=l.replace(/-/g,"_"),k=b+"."+j,o=false;if(dojo._loadedModules[k])o=true;else{dojo.provide(k);k=[r];l!="ROOT"&&k.push(l);k.push(f);l=k.join("/")+".js";o=dojo._loadPath(l,null,function(m){m=m.root||m;var p=function(){};p.prototype=n;i[j]=new p;for(var q in m)i[j][q]=m[q]})}if(o&&i[j])n=i[j];else i[j]=n;if(e)return true})}if(e&&d!=c)i[d.replace(/-/g,"_")]=i[c.replace(/-/g,"_")]};(function(){var a=
dojo.config.extraLocale;if(a){if(!a instanceof Array)a=[a];var f=dojo.i18n._requireLocalization;dojo.i18n._requireLocalization=function(d,e,b,c){f(d,e,b,c);if(!b)for(b=0;b<a.length;b++)f(d,e,a[b],c)}}})();dojo.i18n._searchLocalePath=function(a,f,d){a=dojo.i18n.normalizeLocale(a);var e=a.split("-");a=[];for(var b=e.length;b>0;b--)a.push(e.slice(0,b).join("-"));a.push(false);f&&a.reverse();for(f=a.length-1;f>=0;f--)if(d(a[f]||"ROOT"))break};dojo.i18n._preloadLocalizations=function(a,f){function d(c){c=
dojo.i18n.normalizeLocale(c);dojo.i18n._searchLocalePath(c,true,function(h){for(var g=0;g<f.length;g++)if(f[g]==h){dojo.require(a+"_"+h);return true}return false})}d();for(var e=dojo.config.extraLocale||[],b=0;b<e.length;b++)d(e[b])}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.getObject("regexp",true,dojo);dojo.regexp.escapeString=function(a,b){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(c){if(b&&b.indexOf(c)!=-1)return c;return"\\"+c})};dojo.regexp.buildGroupRE=function(a,b,c){if(!(a instanceof Array))return b(a);for(var e=[],d=0;d<a.length;d++)e.push(b(a[d]));return dojo.regexp.group(e.join("|"),c)};dojo.regexp.group=function(a,b){return"("+(b?"?:":
"")+a+")"}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.Stateful"]){dojo._hasResource["dojo.Stateful"]=true;dojo.provide("dojo.Stateful");dojo.declare("dojo.Stateful",null,{postscript:function(a){a&&dojo.mixin(this,a)},get:function(a){return this[a]},set:function(a,c){if(typeof a==="object"){for(var b in a)this.set(b,a[b]);return this}b=this[a];this[a]=c;this._watchCallbacks&&this._watchCallbacks(a,b,c);return this},watch:function(a,c){var b=this._watchCallbacks;if(!b){var i=this;b=this._watchCallbacks=function(g,j,k,l){var h=
function(d){if(d){d=d.slice();for(var f=0,m=d.length;f<m;f++)try{d[f].call(i,g,j,k)}catch(n){console.error(n)}}};h(b["_"+g]);l||h(b["*"])}}if(!c&&typeof a==="function"){c=a;a="*"}else a="_"+a;var e=b[a];if(typeof e!=="object")e=b[a]=[];e.push(c);return{unwatch:function(){e.splice(dojo.indexOf(e,c),1)}}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.string"]){dojo._hasResource["dojo.string"]=true;dojo.provide("dojo.string");dojo.getObject("string",true,dojo);dojo.string.rep=function(a,b){if(b<=0||!a)return"";for(var c=[];;){b&1&&c.push(a);if(!(b>>=1))break;a+=a}return c.join("")};dojo.string.pad=function(a,b,c,d){c||(c="0");a=String(a);b=dojo.string.rep(c,Math.ceil((b-a.length)/c.length));return d?a+b:b+a};dojo.string.substitute=function(a,b,c,d){d=d||dojo.global;c=c?dojo.hitch(d,c):function(e){return e};return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,
function(e,f,g){e=dojo.getObject(f,false,b);if(g)e=dojo.getObject(g,false,d).call(d,e,f);return c(e,f).toString()})};dojo.string.trim=String.prototype.trim?dojo.trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;b>=0;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.uacss"]){dojo._hasResource["dojo.uacss"]=true;dojo.provide("dojo.uacss");(function(){var a=dojo,d=a.doc.documentElement,b=a.isIE,g=a.isOpera,c=Math.floor,h=a.isFF,i=a.boxModel.replace(/-/,"");b={dj_ie:b,dj_ie6:c(b)==6,dj_ie7:c(b)==7,dj_ie8:c(b)==8,dj_ie9:c(b)==9,dj_quirks:a.isQuirks,dj_iequirks:b&&a.isQuirks,dj_opera:g,dj_khtml:a.isKhtml,dj_webkit:a.isWebKit,dj_safari:a.isSafari,dj_chrome:a.isChrome,dj_gecko:a.isMozilla,dj_ff3:c(h)==3};b["dj_"+i]=true;var e="",f;for(f in b)if(b[f])e+=
f+" ";d.className=a.trim(d.className+" "+e);dojo._loaders.unshift(function(){if(!dojo._isBodyLtr()){var j="dj_rtl dijitRtl "+e.replace(/ /g,"-rtl ");d.className=a.trim(d.className+" "+j)}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.window"]){dojo._hasResource["dojo.window"]=true;dojo.provide("dojo.window");dojo.getObject("window",true,dojo);dojo.window.getBox=function(){var b=dojo.doc.compatMode=="BackCompat"?dojo.body():dojo.doc.documentElement,i=dojo._docScroll();return{w:b.clientWidth,h:b.clientHeight,l:i.x,t:i.y}};dojo.window.get=function(b){if(dojo.isIE&&window!==document.parentWindow){b.parentWindow.execScript("document._parentWindow = window;","Javascript");var i=b._parentWindow;b._parentWindow=
null;return i}return b.parentWindow||b.defaultView};dojo.window.scrollIntoView=function(b,i){try{b=dojo.byId(b);var d=b.ownerDocument||dojo.doc,j=d.body||dojo.body(),o=d.documentElement||j.parentNode,f=dojo.isIE,e=dojo.isWebKit;if((!(dojo.isMoz||f||e||dojo.isOpera)||b==j||b==o)&&typeof b.scrollIntoView!="undefined")b.scrollIntoView(false);else{var p=d.compatMode=="BackCompat";d=p?j:o;e=e?j:d;var q=d.clientWidth,r=d.clientHeight,s=!dojo._isBodyLtr(),g=i||dojo.position(b),c=b.parentNode;d=function(x){return f<=
6||f&&p?false:dojo.style(x,"position").toLowerCase()=="fixed"};if(!d(b))for(;c;){if(c==j)c=e;var a=dojo.position(c),t=d(c);if(c==e){a.w=q;a.h=r;if(e==o&&f&&s)a.x+=e.offsetWidth-a.w;if(a.x<0||!f)a.x=0;if(a.y<0||!f)a.y=0}else{var k=dojo._getPadBorderExtents(c);a.w-=k.w;a.h-=k.h;a.x+=k.l;a.y+=k.t}if(c!=e){var h=c.clientWidth,l=a.w-h;if(h>0&&l>0){a.w=h;if(f&&s)a.x+=l}h=c.clientHeight;l=a.h-h;if(h>0&&l>0)a.h=h}if(t){if(a.y<0){a.h+=a.y;a.y=0}if(a.x<0){a.w+=a.x;a.x=0}if(a.y+a.h>r)a.h=r-a.y;if(a.x+a.w>q)a.w=
q-a.x}var m=g.x-a.x,n=g.y-Math.max(a.y,0),u=m+g.w-a.w,v=n+g.h-a.h;if(u*m>0){var w=Math[m<0?"max":"min"](m,u);g.x+=c.scrollLeft;c.scrollLeft+=f>=8&&!p&&s?-w:w;g.x-=c.scrollLeft}if(v*n>0){g.y+=c.scrollTop;c.scrollTop+=Math[n<0?"max":"min"](n,v);g.y-=c.scrollTop}c=c!=e&&!t&&c.parentNode}}}catch(y){console.error("scrollIntoView: "+y);b.scrollIntoView(false)}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.base64"]){dojo._hasResource["dojox.encoding.base64"]=true;dojo.provide("dojox.encoding.base64");dojo.getObject("encoding.base64",true,dojox);(function(){var g=dojox.encoding;g.base64.encode=function(b){var a=[],f=b.length,d=f%3;f=f-d;for(var c=0;c<f;){var e=b[c++]<<16|b[c++]<<8|b[c++];a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>18&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>
12&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e&63))}switch(d){case 2:e=b[c++]<<16|b[c++]<<8;a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>18&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>12&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6&
63));a.push("=");break;case 1:e=b[c++]<<16;a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>18&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>12&63));a.push("=");a.push("=")}return a.join("")};g.base64.decode=function(b){b=b.split("");for(var a=[],f=b.length;b[--f]=="=";);for(var d=0;d<f;){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++])<<18;if(d<=f)c|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++])<<
12;if(d<=f)c|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++])<<6;if(d<=f)c|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++]);a.push(c>>>16&255);a.push(c>>>8&255);a.push(c&255)}for(;a[a.length-1]==0;)a.pop();return a}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.crypto._base"]){dojo._hasResource["dojox.encoding.crypto._base"]=true;dojo.provide("dojox.encoding.crypto._base");dojo.getObject("encoding.crypto",true,dojox);(function(){var a=dojox.encoding.crypto;a.cipherModes={ECB:0,CBC:1,PCBC:2,CFB:3,OFB:4,CTR:5};a.outputTypes={Base64:0,Hex:1,String:2,Raw:3}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.digests._base"]){dojo._hasResource["dojox.encoding.digests._base"]=true;dojo.provide("dojox.encoding.digests._base");dojo.getObject("encodoing.digests",true,dojox);(function(){var e=dojox.encoding.digests;e.outputTypes={Base64:0,Hex:1,String:2,Raw:3};e.addWords=function(b,c){var a=(b&65535)+(c&65535);return(b>>16)+(c>>16)+(a>>16)<<16|a&65535};e.stringToWord=function(b){for(var c=[],a=0,d=b.length*8;a<d;a+=8)c[a>>5]|=(b.charCodeAt(a/8)&255)<<a%32;return c};e.wordToString=
function(b){for(var c=[],a=0,d=b.length*32;a<d;a+=8)c.push(String.fromCharCode(b[a>>5]>>>a%32&255));return c.join("")};e.wordToHex=function(b){for(var c=[],a=0,d=b.length*4;a<d;a++)c.push("0123456789abcdef".charAt(b[a>>2]>>a%4*8+4&15)+"0123456789abcdef".charAt(b[a>>2]>>a%4*8&15));return c.join("")};e.wordToBase64=function(b){for(var c=[],a=0,d=b.length*4;a<d;a+=3)for(var g=(b[a>>2]>>8*(a%4)&255)<<16|(b[a+1>>2]>>8*((a+1)%4)&255)<<8|b[a+2>>2]>>8*((a+2)%4)&255,f=0;f<4;f++)a*8+f*6>b.length*32?c.push("="):
c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>6*(3-f)&63));return c.join("")}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.scroll"]){dojo._hasResource["dijit._base.scroll"]=true;dojo.provide("dijit._base.scroll");dojo.require("dojo.window");dijit.scrollIntoView=function(a,b){dojo.window.scrollIntoView(a,b)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.sniff"]){dojo._hasResource["dijit._base.sniff"]=true;dojo.provide("dijit._base.sniff");dojo.require("dojo.uacss")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.window"]){dojo._hasResource["dijit._base.window"]=true;dojo.provide("dijit._base.window");dojo.require("dojo.window");dijit.getDocumentWindow=function(a){return dojo.window.get(a)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._KeyNavContainer"]){dojo._hasResource["dijit._KeyNavContainer"]=true;dojo.provide("dijit._KeyNavContainer");dojo.require("dijit._Container");dojo.declare("dijit._KeyNavContainer",dijit._Container,{tabIndex:"0",_keyNavCodes:{},connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},d=dojo.hitch(this,this.focusPrev),f=dojo.hitch(this,this.focusNext);dojo.forEach(a,function(e){c[e]=d});dojo.forEach(b,function(e){c[e]=f});c[dojo.keys.HOME]=dojo.hitch(this,"focusFirstChild");
c[dojo.keys.END]=dojo.hitch(this,"focusLastChild");this.connect(this.domNode,"onkeypress","_onContainerKeypress");this.connect(this.domNode,"onfocus","_onContainerFocus")},startupKeyNavChildren:function(){dojo.forEach(this.getChildren(),dojo.hitch(this,"_startupChild"))},addChild:function(a){dijit._KeyNavContainer.superclass.addChild.apply(this,arguments);this._startupChild(a)},focus:function(){this.focusFirstChild()},focusFirstChild:function(){var a=this._getFirstFocusableChild();a&&this.focusChild(a)},
focusLastChild:function(){var a=this._getLastFocusableChild();a&&this.focusChild(a)},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),true)},focusChild:function(a,b){this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild);a.focus(b?"end":"start");this._set("focusedChild",a)},_startupChild:function(a){a.set("tabIndex","-1");this.connect(a,"_onFocus",function(){a.set("tabIndex",
this.tabIndex)});this.connect(a,"_onBlur",function(){a.set("tabIndex","-1")})},_onContainerFocus:function(a){if(a.target===this.domNode){this.focusFirstChild();dojo.attr(this.domNode,"tabIndex","-1")}},_onBlur:function(){this.tabIndex&&dojo.attr(this.domNode,"tabIndex",this.tabIndex);this.inherited(arguments)},_onContainerKeypress:function(a){if(!(a.ctrlKey||a.altKey)){var b=this._keyNavCodes[a.charOrCode];if(b){b();dojo.stopEvent(a)}}},_onChildBlur:function(){},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,
1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},_getNextFocusableChild:function(a,b){if(a)a=this._getSiblingOfChild(a,b);for(var c=this.getChildren(),d=0;d<c.length;d++){a||(a=c[b>0?0:c.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form._FormMixin"]){dojo._hasResource["dijit.form._FormMixin"]=true;dojo.provide("dijit.form._FormMixin");dojo.require("dojo.window");dojo.declare("dijit.form._FormMixin",null,{state:"",reset:function(){dojo.forEach(this.getDescendants(),function(b){b.reset&&b.reset()})},validate:function(){var b=false;return dojo.every(dojo.map(this.getDescendants(),function(a){a._hasBeenBlurred=true;var c=a.disabled||!a.validate||a.validate();if(!c&&!b){dojo.window.scrollIntoView(a.containerNode||
a.domNode);a.focus();b=true}return c}),function(a){return a})},setValues:function(b){dojo.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",b)},_setValueAttr:function(b){var a={};dojo.forEach(this.getDescendants(),function(d){if(d.name)(a[d.name]||(a[d.name]=[])).push(d)});for(var c in a)if(a.hasOwnProperty(c)){var e=a[c],f=dojo.getObject(c,false,b);if(f!==undefined){dojo.isArray(f)||(f=[f]);if(typeof e[0].checked=="boolean")dojo.forEach(e,
function(d){d.set("value",dojo.indexOf(f,d.value)!=-1)});else e[0].multiple?e[0].set("value",f):dojo.forEach(e,function(d,g){d.set("value",f[g])})}}},getValues:function(){dojo.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var b={};dojo.forEach(this.getDescendants(),function(a){var c=a.name;if(!(!c||a.disabled)){var e=a.get("value");if(typeof a.checked=="boolean")if(/Radio/.test(a.declaredClass))if(e!==
false)dojo.setObject(c,e,b);else{e=dojo.getObject(c,false,b);e===undefined&&dojo.setObject(c,null,b)}else{a=dojo.getObject(c,false,b);if(!a){a=[];dojo.setObject(c,a,b)}e!==false&&a.push(e)}else{a=dojo.getObject(c,false,b);if(typeof a!="undefined")dojo.isArray(a)?a.push(e):dojo.setObject(c,[a,e],b);else dojo.setObject(c,e,b)}}});return b},isValid:function(){return this.state==""},onValidStateChange:function(){},_getState:function(){var b=dojo.map(this._descendants,function(a){return a.get("state")||
""});return dojo.indexOf(b,"Error")>=0?"Error":dojo.indexOf(b,"Incomplete")>=0?"Incomplete":""},disconnectChildren:function(){dojo.forEach(this._childConnections||[],dojo.hitch(this,"disconnect"));dojo.forEach(this._childWatches||[],function(b){b.unwatch()})},connectChildren:function(b){var a=this;this.disconnectChildren();this._descendants=this.getDescendants();b=b?function(d,g){a[d]=g}:dojo.hitch(this,"_set");b("value",this.get("value"));b("state",this._getState());var c=this._childConnections=
[],e=this._childWatches=[];dojo.forEach(dojo.filter(this._descendants,function(d){return d.validate}),function(d){dojo.forEach(["state","disabled"],function(g){e.push(d.watch(g,function(){a.set("state",a._getState())}))})});var f=function(){a._onChangeDelayTimer&&clearTimeout(a._onChangeDelayTimer);a._onChangeDelayTimer=setTimeout(function(){delete a._onChangeDelayTimer;a._set("value",a.get("value"))},10)};dojo.forEach(dojo.filter(this._descendants,function(d){return d.onChange}),function(d){c.push(a.connect(d,
"onChange",f));e.push(d.watch("disabled",f))})},startup:function(){this.inherited(arguments);this.connectChildren(true);this.watch("state",function(b,a,c){this.onValidStateChange(c=="")})},destroy:function(){this.disconnectChildren();this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout._ContentPaneResizeMixin"]){dojo._hasResource["dijit.layout._ContentPaneResizeMixin"]=true;dojo.provide("dijit.layout._ContentPaneResizeMixin");dojo.require("dijit._Contained");dojo.declare("dijit.layout._ContentPaneResizeMixin",null,{doLayout:true,isContainer:true,isLayoutContainer:true,_startChildren:function(){dojo.forEach(this.getChildren(),function(a){a.startup();a._started=true})},startup:function(){if(!this._started){var a=dijit._Contained.prototype.getParent.call(this);
this._childOfLayoutWidget=a&&a.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._startChildren()}},_checkIfSingleChild:function(){var a=dojo.query("> *",this.containerNode).filter(function(b){return b.tagName!=="SCRIPT"}),c=a.filter(function(b){return dojo.hasAttr(b,"data-dojo-type")||dojo.hasAttr(b,"dojoType")||dojo.hasAttr(b,"widgetId")}),d=dojo.filter(c.map(dijit.byNode),function(b){return b&&b.domNode&&b.resize});if(a.length==c.length&&d.length==1)this._singleChild=
d[0];else delete this._singleChild;dojo.toggleClass(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)},resize:function(a,c){this._layout(a,c)},_layout:function(a,c){a&&dojo.marginBox(this.domNode,a);var d=this.containerNode;if(d===this.domNode){var b=c||{};dojo.mixin(b,a||{});if(!("h"in b)||!("w"in b))b=dojo.mixin(dojo.marginBox(d),b);this._contentBox=dijit.layout.marginBox2contentBox(d,b)}else this._contentBox=dojo.contentBox(d);this._layoutChildren();delete this._needLayout},
_layoutChildren:function(){this.doLayout&&this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var a=this._contentBox||dojo.contentBox(this.containerNode);this._singleChild.resize({w:a.w,h:a.h})}else dojo.forEach(this.getChildren(),function(c){c.resize&&c.resize()})}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cldr.supplemental"]){dojo._hasResource["dojo.cldr.supplemental"]=true;dojo.provide("dojo.cldr.supplemental");dojo.require("dojo.i18n");dojo.getObject("cldr.supplemental",true,dojo);dojo.cldr.supplemental.getFirstDayOfWeek=function(a){a={mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,er:6,et:6,iq:6,ir:6,jo:6,ke:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,so:6,sy:6,tn:6,ye:6,ar:0,as:0,az:0,bw:0,ca:0,cn:0,fo:0,ge:0,gl:0,gu:0,hk:0,il:0,"in":0,jm:0,jp:0,kg:0,kr:0,la:0,mh:0,mn:0,mo:0,mp:0,mt:0,
nz:0,ph:0,pk:0,sg:0,th:0,tt:0,tw:0,um:0,us:0,uz:0,vi:0,zw:0}[dojo.cldr.supplemental._region(a)];return a===undefined?1:a};dojo.cldr.supplemental._region=function(a){a=dojo.i18n.normalizeLocale(a);a=a.split("-");var b=a[1];if(b){if(b.length==4)b=a[2]}else b={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[a[0]];return b};dojo.cldr.supplemental.getWeekend=function(a){var b=dojo.cldr.supplemental._region(a);a={"in":0,af:4,dz:4,ir:4,om:4,
sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[b];b={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[b];if(a===undefined)a=6;if(b===undefined)b=0;return{start:a,end:b}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cookie"]){dojo._hasResource["dojo.cookie"]=true;dojo.provide("dojo.cookie");dojo.require("dojo.regexp");dojo.cookie=function(f,e,b){var a=document.cookie;if(arguments.length==1){var d=a.match(RegExp("(?:^|; )"+dojo.regexp.escapeString(f)+"=([^;]*)"));return d?decodeURIComponent(d[1]):undefined}else{b=b||{};a=b.expires;if(typeof a=="number"){var c=new Date;c.setTime(c.getTime()+a*24*60*60*1E3);a=b.expires=c}if(a&&a.toUTCString)b.expires=a.toUTCString();e=encodeURIComponent(e);
a=f+"="+e;for(d in b){a+="; "+d;c=b[d];if(c!==true)a+="="+c}document.cookie=a}};dojo.cookie.isSupported=function(){if(!("cookieEnabled"in navigator)){this("__djCookieTest__","CookiesAllowed");navigator.cookieEnabled=this("__djCookieTest__")=="CookiesAllowed";navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1})}return navigator.cookieEnabled}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.parser"]){dojo._hasResource["dojo.parser"]=true;dojo.provide("dojo.parser");dojo.require("dojo.date.stamp");dojo.parser=new function(){function s(a){if(d.isString(a))return"string";if(typeof a=="number")return"number";if(typeof a=="boolean")return"boolean";if(d.isFunction(a))return"function";if(d.isArray(a))return"array";if(a instanceof Date)return"date";if(a instanceof d._Url)return"url";return"object"}function B(a,b){switch(b){case "string":return a;case "number":return a.length?
Number(a):NaN;case "boolean":return typeof a=="boolean"?a:a.toLowerCase()!="false";case "function":if(d.isFunction(a)){a=a.toString();a=d.trim(a.substring(a.indexOf("{")+1,a.length-1))}try{return a===""||a.search(/[^\w\.]+/i)!=-1?new Function(a):d.getObject(a,false)||new Function(a)}catch(c){return new Function}case "array":return a?a.split(/\s*,\s*/):[];case "date":switch(a){case "":return new Date("");case "now":return new Date;default:return d.date.stamp.fromISOString(a)}case "url":return d.baseUrl+
a;default:return d.fromJson(a)}}function x(a,b){for(var c in a)if(c.charAt(0)!="_")c in C||(b[c]=s(a[c]));return b}function v(a,b){var c=y[a];if(c){if(!b&&!c.params)c.params=x(c.cls.prototype,{})}else{c=d.getObject(a);var k=null;if(!c)return null;b||(k=x(c.prototype,{}));c={cls:c,params:k}}return c}var d=dojo,C={},y={};d.connect(d,"extend",function(){y={}});this._functionFromScript=function(a,b){var c="",k="",o=a.getAttribute(b+"args")||a.getAttribute("args");o&&d.forEach(o.split(/\s*,\s*/),function(n,
f){c+="var "+n+" = arguments["+f+"]; "});(o=a.getAttribute("with"))&&o.length&&d.forEach(o.split(/\s*,\s*/),function(n){c+="with("+n+"){";k+="}"});return new Function(c+a.innerHTML+k)};this.instantiate=function(a,b,c){var k=[];b=b||{};c=c||{};var o=(c.scope||d._scopeName)+"Type",n="data-"+(c.scope||d._scopeName)+"-";d.forEach(a,function(f){if(f){var e,i,g,l,q,j;if(f.node){e=f.node;i=f.type;j=f.fastpath;l=(g=f.clsInfo||i&&v(i,j))&&g.cls;q=f.scripts}else{e=f;q=(l=(g=(i=o in b?b[o]:e.getAttribute(o))&&
v(i))&&g.cls)&&(l._noScript||l.prototype._noScript)?[]:d.query("> script[type^='dojo/']",e)}if(!g)throw Error("Could not load class '"+i);var h={};c.defaults&&d._mixin(h,c.defaults);f.inherited&&d._mixin(h,f.inherited);if(j){if((g=e.getAttribute(n+"props"))&&g.length)try{g=d.fromJson.call(c.propsThis,"{"+g+"}");d._mixin(h,g)}catch(r){throw Error(r.toString()+" in data-dojo-props='"+g+"'");}if(g=e.getAttribute(n+"attach-point"))h.dojoAttachPoint=g;if(g=e.getAttribute(n+"attach-event"))h.dojoAttachEvent=
g;dojo.mixin(h,b)}else{f=e.attributes;for(var p in g.params){i=p in b?{value:b[p],specified:true}:f.getNamedItem(p);if(!(!i||!i.specified&&(!dojo.isIE||p.toLowerCase()!="value"))){i=i.value;switch(p){case "class":i="className"in b?b.className:e.className;break;case "style":i="style"in b?b.style:e.style&&e.style.cssText}var t=g.params[p];h[p]=typeof i=="string"?B(i,t):i}}}var z=[],A=[];d.forEach(q,function(m){e.removeChild(m);var w=m.getAttribute(n+"event")||m.getAttribute("event"),D=m.getAttribute("type");
m=d.parser._functionFromScript(m,n);if(w)if(D=="dojo/connect")z.push({event:w,func:m});else h[w]=m;else A.push(m)});var u=(q=l.markupFactory||l.prototype&&l.prototype.markupFactory)?q(h,e,l):new l(h,e);k.push(u);(l=e.getAttribute(n+"id")||e.getAttribute("jsId"))&&d.setObject(l,u);d.forEach(z,function(m){d.connect(u,m.event,null,m.func)});d.forEach(A,function(m){m.call(u)})}});b._started||d.forEach(k,function(f){if(!c.noStart&&f&&dojo.isFunction(f.startup)&&!f._started&&(!f.getParent||!f.getParent()))f.startup()});
return k};this.parse=function(a,b){function c(e,i){var g=dojo.clone(e.inherited);dojo.forEach(["dir","lang"],function(p){var t=e.node.getAttribute(p);if(t)g[p]=t});for(var l=e.clsInfo&&!e.clsInfo.cls.prototype._noScript?e.scripts:null,q=!e.clsInfo||!e.clsInfo.cls.prototype.stopParser||b&&b.template,j=e.node.firstChild;j;j=j.nextSibling)if(j.nodeType==1){var h,r=q&&j.getAttribute(n+"type");h=r?r:q&&j.getAttribute(o);r=r==h;if(h){h={type:h,fastpath:r,clsInfo:v(h,r),node:j,scripts:[],inherited:g};i.push(h);
c(h,i)}else if(l&&j.nodeName.toLowerCase()=="script")(h=j.getAttribute("type"))&&/^dojo\/\w/i.test(h)&&l.push(j);else q&&c({node:j,inherited:g},i)}}var k;if(!b&&a&&a.rootNode){b=a;k=b.rootNode}else k=a;b=b||{};var o=(b.scope||d._scopeName)+"Type",n="data-"+(b.scope||d._scopeName)+"-",f=[];c({node:k?dojo.byId(k):dojo.body(),inherited:b&&b.inherited||{dir:dojo._isBodyLtr()?"ltr":"rtl"}},f);return this.instantiate(f,b&&b.template?{template:true}:null,b)}};(function(){var s=function(){dojo.config.parseOnLoad&&
dojo.parser.parse()};dojo.getObject("dijit.wai.onload")===dojo._loaders[0]?dojo._loaders.splice(1,0,s):dojo._loaders.unshift(s)})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.digests.MD5"]){dojo._hasResource["dojox.encoding.digests.MD5"]=true;dojo.provide("dojox.encoding.digests.MD5");dojo.require("dojox.encoding.digests._base");(function(){function n(e,g){return e<<g|e>>>32-g}function i(e,g,c,a,d,b){return h.addWords(n(h.addWords(h.addWords(g,e),h.addWords(a,b)),d),c)}function j(e,g,c,a,d,b,f){return i(g&c|~g&a,e,g,d,b,f)}function k(e,g,c,a,d,b,f){return i(g&a|c&~a,e,g,d,b,f)}function l(e,g,c,a,d,b,f){return i(c^(g|~a),e,g,d,b,f)}
function m(e,g){e[g>>5]|=128<<g%32;e[(g+64>>>9<<4)+14]=g;for(var c=1732584193,a=-271733879,d=-1732584194,b=271733878,f=0;f<e.length;f+=16){var o=c,p=a,q=d,r=b;c=j(c,a,d,b,e[f+0],7,-680876936);b=j(b,c,a,d,e[f+1],12,-389564586);d=j(d,b,c,a,e[f+2],17,606105819);a=j(a,d,b,c,e[f+3],22,-1044525330);c=j(c,a,d,b,e[f+4],7,-176418897);b=j(b,c,a,d,e[f+5],12,1200080426);d=j(d,b,c,a,e[f+6],17,-1473231341);a=j(a,d,b,c,e[f+7],22,-45705983);c=j(c,a,d,b,e[f+8],7,1770035416);b=j(b,c,a,d,e[f+9],12,-1958414417);d=j(d,
b,c,a,e[f+10],17,-42063);a=j(a,d,b,c,e[f+11],22,-1990404162);c=j(c,a,d,b,e[f+12],7,1804603682);b=j(b,c,a,d,e[f+13],12,-40341101);d=j(d,b,c,a,e[f+14],17,-1502002290);a=j(a,d,b,c,e[f+15],22,1236535329);c=k(c,a,d,b,e[f+1],5,-165796510);b=k(b,c,a,d,e[f+6],9,-1069501632);d=k(d,b,c,a,e[f+11],14,643717713);a=k(a,d,b,c,e[f+0],20,-373897302);c=k(c,a,d,b,e[f+5],5,-701558691);b=k(b,c,a,d,e[f+10],9,38016083);d=k(d,b,c,a,e[f+15],14,-660478335);a=k(a,d,b,c,e[f+4],20,-405537848);c=k(c,a,d,b,e[f+9],5,568446438);
b=k(b,c,a,d,e[f+14],9,-1019803690);d=k(d,b,c,a,e[f+3],14,-187363961);a=k(a,d,b,c,e[f+8],20,1163531501);c=k(c,a,d,b,e[f+13],5,-1444681467);b=k(b,c,a,d,e[f+2],9,-51403784);d=k(d,b,c,a,e[f+7],14,1735328473);a=k(a,d,b,c,e[f+12],20,-1926607734);c=i(a^d^b,c,a,e[f+5],4,-378558);b=i(c^a^d,b,c,e[f+8],11,-2022574463);d=i(b^c^a,d,b,e[f+11],16,1839030562);a=i(d^b^c,a,d,e[f+14],23,-35309556);c=i(a^d^b,c,a,e[f+1],4,-1530992060);b=i(c^a^d,b,c,e[f+4],11,1272893353);d=i(b^c^a,d,b,e[f+7],16,-155497632);a=i(d^b^c,a,
d,e[f+10],23,-1094730640);c=i(a^d^b,c,a,e[f+13],4,681279174);b=i(c^a^d,b,c,e[f+0],11,-358537222);d=i(b^c^a,d,b,e[f+3],16,-722521979);a=i(d^b^c,a,d,e[f+6],23,76029189);c=i(a^d^b,c,a,e[f+9],4,-640364487);b=i(c^a^d,b,c,e[f+12],11,-421815835);d=i(b^c^a,d,b,e[f+15],16,530742520);a=i(d^b^c,a,d,e[f+2],23,-995338651);c=l(c,a,d,b,e[f+0],6,-198630844);b=l(b,c,a,d,e[f+7],10,1126891415);d=l(d,b,c,a,e[f+14],15,-1416354905);a=l(a,d,b,c,e[f+5],21,-57434055);c=l(c,a,d,b,e[f+12],6,1700485571);b=l(b,c,a,d,e[f+3],10,
-1894986606);d=l(d,b,c,a,e[f+10],15,-1051523);a=l(a,d,b,c,e[f+1],21,-2054922799);c=l(c,a,d,b,e[f+8],6,1873313359);b=l(b,c,a,d,e[f+15],10,-30611744);d=l(d,b,c,a,e[f+6],15,-1560198380);a=l(a,d,b,c,e[f+13],21,1309151649);c=l(c,a,d,b,e[f+4],6,-145523070);b=l(b,c,a,d,e[f+11],10,-1120210379);d=l(d,b,c,a,e[f+2],15,718787259);a=l(a,d,b,c,e[f+9],21,-343485551);c=h.addWords(c,o);a=h.addWords(a,p);d=h.addWords(d,q);b=h.addWords(b,r)}return[c,a,d,b]}var h=dojox.encoding.digests;h.MD5=function(e,g){var c=g||h.outputTypes.Base64,
a=m(h.stringToWord(e),e.length*8);switch(c){case h.outputTypes.Raw:return a;case h.outputTypes.Hex:return h.wordToHex(a);case h.outputTypes.String:return h.wordToString(a);default:return h.wordToBase64(a)}};h.MD5._hmac=function(e,g,c){c=c||h.outputTypes.Base64;var a=h.stringToWord(g);if(a.length>16)a=m(a,g.length*8);var d=[];g=[];for(var b=0;b<16;b++){d[b]=a[b]^909522486;g[b]=a[b]^1549556828}e=m(d.concat(h.stringToWord(e)),512+e.length*8);e=m(g.concat(e),640);switch(c){case h.outputTypes.Raw:return e;
case h.outputTypes.Hex:return h.wordToHex(e);case h.outputTypes.String:return h.wordToString(e);default:return h.wordToBase64(e)}}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.html"]){dojo._hasResource["dojo.html"]=true;dojo.provide("dojo.html");dojo.require("dojo.parser");dojo.getObject("html",true,dojo);(function(){var f=0,e=dojo;dojo.html._secureForInnerHtml=function(a){return a.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"")};dojo.html._emptyNode=dojo.empty;dojo.html._setNodeContent=function(a,b){e.empty(a);if(b){if(typeof b=="string")b=e._toDom(b,a.ownerDocument);if(!b.nodeType&&e.isArrayLike(b))for(var c=b.length,
d=0;d<b.length;d=c==b.length?d+1:0)e.place(b[d],a,"last");else e.place(b,a,"last")}return a};dojo.declare("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:false,extractContent:false,parseContent:false,parserScope:dojo._scopeName,startup:true,constructor:function(a,b){dojo.mixin(this,a||{});b=this.node=dojo.byId(this.node||b);if(!this.id)this.id=["Setter",b?b.id||b.tagName:"",f++].join("_")},set:function(a,b){if(undefined!==a)this.content=a;b&&this._mixin(b);this.onBegin();this.setContent();
this.onEnd();return this.node},setContent:function(){var a=this.node;if(!a)throw Error(this.declaredClass+": setContent given no node");try{a=dojo.html._setNodeContent(a,this.content)}catch(b){var c=this.onContentError(b);try{a.innerHTML=c}catch(d){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+d.message,d)}}this.node=a},empty:function(){if(this.parseResults&&this.parseResults.length){dojo.forEach(this.parseResults,function(a){a.destroy&&a.destroy()});delete this.parseResults}dojo.html._emptyNode(this.node)},
onBegin:function(){var a=this.content;if(dojo.isString(a)){if(this.cleanContent)a=dojo.html._secureForInnerHtml(a);if(this.extractContent){var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(b)a=b[1]}}this.empty();this.content=a;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.node;delete this.content},onContentError:function(a){return"Error occured setting content: "+a},_mixin:function(a){var b={},
c;for(c in a)c in b||(this[c]=a[c])},_parse:function(){var a=this.node;try{this.parseResults=dojo.parser.parse({rootNode:a,noStart:!this.startup,inherited:{dir:this.dir,lang:this.lang},scope:this.parserScope})}catch(b){this._onError("Content",b,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(a,b,c){a=this["on"+a+"Error"].call(this,b);if(c)console.error(c,b);else a&&dojo.html._setNodeContent(this.node,a,true)}});dojo.html.set=function(a,b,c){if(undefined==b){console.warn("dojo.html.set: no cont argument provided, using empty string");
b=""}return c?(new dojo.html._ContentSetter(dojo.mixin(c,{content:b,node:a}))).set():dojo.html._setNodeContent(a,b,true)}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.focus"]){dojo._hasResource["dijit._base.focus"]=true;dojo.provide("dijit._base.focus");dojo.require("dojo.window");dojo.require("dijit._base.manager");dojo.mixin(dijit,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return dijit.getBookmark().isCollapsed},getBookmark:function(){var a,d,b=dojo.doc.selection,c=dijit._curFocus;if(dojo.global.getSelection){if(b=dojo.global.getSelection())if(b.isCollapsed){if(a=c?c.tagName:""){a=a.toLowerCase();if(a=="textarea"||
a=="input"&&(!c.type||c.type.toLowerCase()=="text")){b={start:c.selectionStart,end:c.selectionEnd,node:c,pRange:true};return{isCollapsed:b.end<=b.start,mark:b}}}a={isCollapsed:true}}else{d=b.getRangeAt(0);a={isCollapsed:false,mark:d.cloneRange()}}}else if(b){a=c?c.tagName:"";a=a.toLowerCase();if(c&&a&&(a=="button"||a=="textarea"||a=="input"))if(b.type&&b.type.toLowerCase()=="none")return{isCollapsed:true,mark:null};else{d=b.createRange();return{isCollapsed:d.text&&d.text.length?false:true,mark:{range:d,
pRange:true}}}a={};try{d=b.createRange();a.isCollapsed=!(b.type=="Text"?d.htmlText.length:d.length)}catch(e){a.isCollapsed=true;return a}if(b.type.toUpperCase()=="CONTROL")if(d.length){a.mark=[];b=0;for(c=d.length;b<c;)a.mark.push(d.item(b++))}else{a.isCollapsed=true;a.mark=null}else a.mark=d.getBookmark()}else console.warn("No idea how to store the current selection for this browser!");return a},moveToBookmark:function(a){var d=dojo.doc;if(a=a.mark)if(dojo.global.getSelection){var b=dojo.global.getSelection();
if(b&&b.removeAllRanges)if(a.pRange){b=a.node;b.selectionStart=a.start;b.selectionEnd=a.end}else{b.removeAllRanges();b.addRange(a)}else console.warn("No idea how to restore selection for this browser!")}else if(d.selection&&a){var c;if(a.pRange)c=a.range;else if(dojo.isArray(a)){c=d.body.createControlRange();dojo.forEach(a,function(e){c.addElement(e)})}else{c=d.body.createTextRange();c.moveToBookmark(a)}c.select()}},getFocus:function(a,d){var b=!dijit._curFocus||a&&dojo.isDescendant(dijit._curFocus,
a.domNode)?dijit._prevFocus:dijit._curFocus;return{node:b,bookmark:b==dijit._curFocus&&dojo.withGlobal(d||dojo.global,dijit.getBookmark),openedForWindow:d}},focus:function(a){if(a){var d="node"in a?a.node:a,b=a.bookmark;a=a.openedForWindow;var c=b?b.isCollapsed:false;if(d){var e=d.tagName.toLowerCase()=="iframe"?d.contentWindow:d;if(e&&e.focus)try{e.focus()}catch(g){}dijit._onFocusNode(d)}if(b&&dojo.withGlobal(a||dojo.global,dijit.isCollapsed)&&!c){a&&a.focus();try{dojo.withGlobal(a||dojo.global,
dijit.moveToBookmark,null,[b])}catch(h){}}}},_activeStack:[],registerIframe:function(a){return dijit.registerWin(a.contentWindow,a)},unregisterIframe:function(a){dijit.unregisterWin(a)},registerWin:function(a,d){var b=function(f){dijit._justMouseDowned=true;setTimeout(function(){dijit._justMouseDowned=false},0);dojo.isIE&&f&&f.srcElement&&f.srcElement.parentNode==null||dijit._onTouchNode(d||f.target||f.srcElement,"mouse")},c=dojo.isIE?a.document.documentElement:a.document;if(c)if(dojo.isIE){a.document.body.attachEvent("onmousedown",
b);var e=function(f){f.srcElement.tagName.toLowerCase()!="#document"&&dijit.isTabNavigable(f.srcElement)?dijit._onFocusNode(d||f.srcElement):dijit._onTouchNode(d||f.srcElement)};c.attachEvent("onactivate",e);var g=function(f){dijit._onBlurNode(d||f.srcElement)};c.attachEvent("ondeactivate",g);return function(){a.document.detachEvent("onmousedown",b);c.detachEvent("onactivate",e);c.detachEvent("ondeactivate",g);c=null}}else{c.body.addEventListener("mousedown",b,true);var h=function(f){dijit._onFocusNode(d||
f.target)};c.addEventListener("focus",h,true);var i=function(f){dijit._onBlurNode(d||f.target)};c.addEventListener("blur",i,true);return function(){c.body.removeEventListener("mousedown",b,true);c.removeEventListener("focus",h,true);c.removeEventListener("blur",i,true);c=null}}},unregisterWin:function(a){a&&a()},_onBlurNode:function(){dijit._prevFocus=dijit._curFocus;dijit._curFocus=null;if(!dijit._justMouseDowned){dijit._clearActiveWidgetsTimer&&clearTimeout(dijit._clearActiveWidgetsTimer);dijit._clearActiveWidgetsTimer=
setTimeout(function(){delete dijit._clearActiveWidgetsTimer;dijit._setStack([]);dijit._prevFocus=null},100)}},_onTouchNode:function(a,d){if(dijit._clearActiveWidgetsTimer){clearTimeout(dijit._clearActiveWidgetsTimer);delete dijit._clearActiveWidgetsTimer}var b=[];try{for(;a;){var c=dojo.attr(a,"dijitPopupParent");if(c)a=dijit.byId(c).domNode;else if(a.tagName&&a.tagName.toLowerCase()=="body"){if(a===dojo.body())break;a=dojo.window.get(a.ownerDocument).frameElement}else{var e=a.getAttribute&&a.getAttribute("widgetId"),
g=e&&dijit.byId(e);g&&!(d=="mouse"&&g.get("disabled"))&&b.unshift(e);a=a.parentNode}}}catch(h){}dijit._setStack(b,d)},_onFocusNode:function(a){if(a)if(a.nodeType!=9){dijit._onTouchNode(a);if(a!=dijit._curFocus){if(dijit._curFocus)dijit._prevFocus=dijit._curFocus;dijit._curFocus=a;dojo.publish("focusNode",[a])}}},_setStack:function(a,d){var b=dijit._activeStack;dijit._activeStack=a;for(var c=0;c<Math.min(b.length,a.length);c++)if(b[c]!=a[c])break;for(var e,g=b.length-1;g>=c;g--)if(e=dijit.byId(b[g])){e._focused=
false;e.set("focused",false);e._hasBeenBlurred=true;e._onBlur&&e._onBlur(d);dojo.publish("widgetBlur",[e,d])}for(g=c;g<a.length;g++)if(e=dijit.byId(a[g])){e._focused=true;e.set("focused",true);e._onFocus&&e._onFocus(d);dojo.publish("widgetFocus",[e,d])}}});dojo.addOnLoad(function(){var a=dijit.registerWin(window);dojo.isIE&&dojo.addOnWindowUnload(function(){dijit.unregisterWin(a);a=null})})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.place"]){dojo._hasResource["dijit._base.place"]=true;dojo.provide("dijit._base.place");dojo.require("dojo.window");dojo.require("dojo.AdapterRegistry");dijit.getViewport=function(){return dojo.window.getBox()};dijit.placeOnScreen=function(c,a,b,f){b=dojo.map(b,function(d){var e={corner:d,pos:{x:a.x,y:a.y}};if(f){e.pos.x+=d.charAt(1)=="L"?f.x:-f.x;e.pos.y+=d.charAt(0)=="T"?f.y:-f.y}return e});return dijit._place(c,b)};dijit._place=function(c,a,b,f){var d=dojo.window.getBox();
if(!c.parentNode||String(c.parentNode.tagName).toLowerCase()!="body")dojo.body().appendChild(c);var e=null;dojo.some(a,function(k){var h=k.corner,g=k.pos,j=0,p={w:h.charAt(1)=="L"?d.l+d.w-g.x:g.x-d.l,h:h.charAt(1)=="T"?d.t+d.h-g.y:g.y-d.t};if(b){j=b(c,k.aroundCorner,h,p,f);j=typeof j=="undefined"?0:j}var i=c.style,n=i.display,l=i.visibility;i.visibility="hidden";i.display="";var m=dojo.marginBox(c);i.display=n;i.visibility=l;i=Math.max(d.l,h.charAt(1)=="L"?g.x:g.x-m.w);n=Math.max(d.t,h.charAt(0)==
"T"?g.y:g.y-m.h);l=Math.min(d.l+d.w,h.charAt(1)=="L"?i+m.w:g.x);g=Math.min(d.t+d.h,h.charAt(0)=="T"?n+m.h:g.y);l=l-i;g=g-n;j+=m.w-l+(m.h-g);if(e==null||j<e.overflow)e={corner:h,aroundCorner:k.aroundCorner,x:i,y:n,w:l,h:g,overflow:j,spaceAvailable:p};return!j});e.overflow&&b&&b(c,e.aroundCorner,e.corner,e.spaceAvailable,f);a=dojo._isBodyLtr();var o=c.style;o.top=e.y+"px";o[a?"left":"right"]=(a?e.x:d.w-e.x-e.w)+"px";return e};dijit.placeOnScreenAroundNode=function(c,a,b,f){a=dojo.byId(a);a=dojo.position(a,
true);return dijit._placeOnScreenAroundRect(c,a.x,a.y,a.w,a.h,b,f)};dijit.placeOnScreenAroundRectangle=function(c,a,b,f){return dijit._placeOnScreenAroundRect(c,a.x,a.y,a.width,a.height,b,f)};dijit._placeOnScreenAroundRect=function(c,a,b,f,d,e,o){var k=[],h;for(h in e)k.push({aroundCorner:h,corner:e[h],pos:{x:a+(h.charAt(1)=="L"?0:f),y:b+(h.charAt(0)=="T"?0:d)}});return dijit._place(c,k,o,{w:f,h:d})};dijit.placementRegistry=new dojo.AdapterRegistry;dijit.placementRegistry.register("node",function(c,
a){return typeof a=="object"&&typeof a.offsetWidth!="undefined"&&typeof a.offsetHeight!="undefined"},dijit.placeOnScreenAroundNode);dijit.placementRegistry.register("rect",function(c,a){return typeof a=="object"&&"x"in a&&"y"in a&&"width"in a&&"height"in a},dijit.placeOnScreenAroundRectangle);dijit.placeOnScreenAroundElement=function(){return dijit.placementRegistry.match.apply(dijit.placementRegistry,arguments)};dijit.getPopupAroundAlignment=function(c,a){var b={};dojo.forEach(c,function(f){switch(f){case "after":b[a?
"BR":"BL"]=a?"BL":"BR";break;case "before":b[a?"BL":"BR"]=a?"BR":"BL";break;case "below-alt":a=!a;case "below":b[a?"BL":"BR"]=a?"TL":"TR";b[a?"BR":"BL"]=a?"TR":"TL";break;case "above-alt":a=!a;default:b[a?"TL":"TR"]=a?"BL":"BR";b[a?"TR":"TL"]=a?"BR":"BL"}});return b}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._WidgetBase"]){dojo._hasResource["dijit._WidgetBase"]=true;dojo.provide("dijit._WidgetBase");dojo.require("dijit._base.manager");dojo.require("dojo.Stateful");(function(){dojo.declare("dijit._WidgetBase",dojo.Stateful,{id:"",lang:"",dir:"","class":"",style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,attributeMap:{id:"",dir:"",lang:"","class":"",style:"",title:""},_blankGif:(dojo.config.blankGif||dojo.moduleUrl("dojo","resources/blank.gif")).toString(),
postscript:function(a,b){this.create(a,b)},create:function(a,b){this.srcNodeRef=dojo.byId(b);this._connects=[];this._subscribes=[];if(this.srcNodeRef&&typeof this.srcNodeRef.id=="string")this.id=this.srcNodeRef.id;if(a){this.params=a;dojo._mixin(this,a)}this.postMixInProperties();if(!this.id)this.id=dijit.getUniqueId(this.declaredClass.replace(/\./g,"_"));dijit.registry.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&c.parentNode&&this.domNode!==c&&
c.parentNode.replaceChild(this.domNode,c)}this.domNode&&this.domNode.setAttribute("widgetId",this.id);this.postCreate();this.srcNodeRef&&!this.srcNodeRef.parentNode&&delete this.srcNodeRef;this._created=true},_applyAttributes:function(){var a=function(c,d){if(d.params&&c in d.params||d[c])d.set(c,d[c])},b;for(b in this.attributeMap)a(b,this);dojo.forEach(this._getSetterAttributes(),function(c){c in this.attributeMap||a(c,this)},this)},_getSetterAttributes:function(){var a=this.constructor;if(!a._setterAttrs){var b=
a._setterAttrs=[],c,d=a.prototype,e;for(e in d)if(dojo.isFunction(d[e])&&(c=e.match(/^_set([a-zA-Z]*)Attr$/))&&c[1])b.push(c[1].charAt(0).toLowerCase()+c[1].substr(1))}return a._setterAttrs},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode)this.domNode=this.srcNodeRef||dojo.create("div");if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(dojo.map(a,function(b){return b+"Rtl"})));dojo.addClass(this.domNode,a)}},postCreate:function(){},startup:function(){this._started=
true},destroyRecursive:function(a){this._beingDestroyed=true;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){this._beingDestroyed=true;this.uninitialize();var b=dojo,c=b.forEach,d=b.unsubscribe;c(this._connects,function(e){c(e,b.disconnect)});c(this._subscribes,function(e){d(e)});c(this._supportingWidgets||[],function(e){if(e.destroyRecursive)e.destroyRecursive();else e.destroy&&e.destroy()});this.destroyRendering(a);dijit.registry.remove(this.id);this._destroyed=true},destroyRendering:function(a){if(this.bgIframe){this.bgIframe.destroy(a);
delete this.bgIframe}if(this.domNode){a?dojo.removeAttr(this.domNode,"widgetId"):dojo.destroy(this.domNode);delete this.domNode}if(this.srcNodeRef){a||dojo.destroy(this.srcNodeRef);delete this.srcNodeRef}},destroyDescendants:function(a){dojo.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return false},_setClassAttr:function(a){dojo.replaceClass(this[this.attributeMap["class"]||"domNode"],a,this["class"]);this._set("class",a)},_setStyleAttr:function(a){var b=
this[this.attributeMap.style||"domNode"];if(dojo.isObject(a))dojo.style(b,a);else if(b.style.cssText)b.style.cssText+="; "+a;else b.style.cssText=a;this._set("style",a)},_attrToDom:function(a,b){var c=this.attributeMap[a];dojo.forEach(dojo.isArray(c)?c:[c],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":if(dojo.isFunction(b))b=dojo.hitch(this,b);d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;dojo.attr(e,d,b);break;case "innerText":e.innerHTML=
"";e.appendChild(dojo.doc.createTextNode(b));break;case "innerHTML":e.innerHTML=b;break;case "class":dojo.replaceClass(e,b,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this[a]},set:function(a,b){if(typeof a==="object"){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);if(this[c.s])var d=this[c.s].apply(this,Array.prototype.slice.call(arguments,1));else{a in this.attributeMap&&this._attrToDom(a,b);this._set(a,b)}return d||this},_attrPairNames:{},
_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.charAt(0).toUpperCase()+a.substr(1);return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr"}},_set:function(a,b){var c=this[a];this[a]=b;this._watchCallbacks&&this._created&&b!==c&&this._watchCallbacks(a,c,b)},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getDescendants:function(){return this.containerNode?dojo.query("[widgetId]",this.containerNode).map(dijit.byNode):[]},getChildren:function(){return this.containerNode?
dijit.findWidgets(this.containerNode):[]},connect:function(a,b,c){a=[dojo._connect(a,b,this,c)];this._connects.push(a);return a},disconnect:function(a){for(var b=0;b<this._connects.length;b++)if(this._connects[b]==a){dojo.forEach(a,dojo.disconnect);this._connects.splice(b,1);break}},subscribe:function(a,b){var c=dojo.subscribe(a,this,b);this._subscribes.push(c);return c},unsubscribe:function(a){for(var b=0;b<this._subscribes.length;b++)if(this._subscribes[b]==a){dojo.unsubscribe(a);this._subscribes.splice(b,
1);break}},isLeftToRight:function(){return this.dir?this.dir=="ltr":dojo._isBodyLtr()},placeAt:function(a,b){a.declaredClass&&a.addChild?a.addChild(this,b):dojo.place(this.domNode,a,b);return this}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.crypto.SimpleAES"]){dojo._hasResource["dojox.encoding.crypto.SimpleAES"]=true;dojo.provide("dojox.encoding.crypto.SimpleAES");dojo.require("dojox.encoding.base64");dojo.require("dojox.encoding.crypto._base");dojo.getObject("encoding.crypto.SimpleAES",true,dojox);(function(){function k(d,f){for(var b=f.length/4-1,c=[[],[],[],[]],a=0;a<16;a++)c[a%4][Math.floor(a/4)]=d[a];c=n(c,f,0,4);for(a=1;a<b;a++){c=o(c,4);c=c=p(c,4);for(var e=0;e<4;e++){for(var h=Array(4),g=
Array(4),i=0;i<4;i++){h[i]=c[i][e];g[i]=c[i][e]&128?c[i][e]<<1^283:c[i][e]<<1}c[0][e]=g[0]^h[1]^g[1]^h[2]^h[3];c[1][e]=h[0]^g[1]^h[2]^g[2]^h[3];c[2][e]=h[0]^h[1]^g[2]^h[3]^g[3];c[3][e]=h[0]^g[0]^h[1]^h[2]^g[3]}c=c;c=n(c,f,a,4)}c=o(c,4);c=p(c,4);c=n(c,f,b,4);b=Array(16);for(a=0;a<16;a++)b[a]=c[a%4][Math.floor(a/4)];return b}function o(d,f){for(var b=0;b<4;b++)for(var c=0;c<f;c++)d[b][c]=q[d[b][c]];return d}function p(d,f){for(var b=Array(4),c=1;c<4;c++){for(var a=0;a<4;a++)b[a]=d[c][(a+c)%f];for(a=
0;a<4;a++)d[c][a]=b[a]}return d}function n(d,f,b,c){for(var a=0;a<4;a++)for(var e=0;e<c;e++)d[a][e]^=f[b*4+e][a];return d}function l(d){for(var f=d.length/4,b=f+6,c=Array(4*(b+1)),a=Array(4),e=0;e<f;e++)c[e]=[d[4*e],d[4*e+1],d[4*e+2],d[4*e+3]];for(e=f;e<4*(b+1);e++){c[e]=Array(4);for(d=0;d<4;d++)a[d]=c[e-1][d];if(e%f==0){a=a;a[4]=a[0];for(d=0;d<4;d++)a[d]=a[d+1];a=r(a);for(d=0;d<4;d++)a[d]^=u[e/f][d]}else if(f>6&&e%f==4)a=r(a);for(d=0;d<4;d++)c[e][d]=c[e-f][d]^a[d]}return c}function r(d){for(var f=
0;f<4;f++)d[f]=q[d[f]];return d}function s(d){var f=[];d.replace(/(..)/g,function(b){f.push(parseInt(b,16))});return f}var q=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,
2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,
66,104,65,153,45,15,176,84,187,22],u=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];dojox.encoding.crypto.SimpleAES=new function(){this.encrypt=function(d,f){var b;var c=Array(32);for(b=0;b<32;b++)c[b]=f.charCodeAt(b)&255;var a=k(c,l(c));a=a.concat(a.slice(0,16));c=Array(16);var e=(new Date).getTime();for(b=0;b<4;b++)c[b]=e>>>b*8&255;for(b=0;b<4;b++)c[b+4]=e/4294967296>>>b*8&255;e=l(a);var h=Math.ceil(d.length/16);a=Array(h);
for(var g=0;g<h;g++){for(b=0;b<4;b++)c[15-b]=g>>>b*8&255;for(b=0;b<4;b++)c[15-b-4]=g/4294967296>>>b*8;var i=k(c,e),m=g<h-1?16:(d.length-1)%16+1,j="";for(b=0;b<m;b++){var t=d.charCodeAt(g*16+b)^i[b];j+=(t<16?"0":"")+t.toString(16)}a[g]=j}e="";for(b=0;b<8;b++)e+=(c[b]<16?"0":"")+c[b].toString(16);b=e+" "+a.join(" ");return b};this.decrypt=function(d,f){var b;b=d;for(var c=Array(32),a=0;a<32;a++)c[a]=f.charCodeAt(a)&255;a=l(c);a=k(c,a);a=a.concat(a.slice(0,16));c=l(a);b=b.split(" ");var e=Array(16);
e=s(b[0]);for(var h=Array(b.length-1),g=1;g<b.length;g++){for(a=0;a<4;a++)e[15-a]=g-1>>>a*8&255;for(a=0;a<4;a++)e[15-a-4]=g/4294967296-1>>>a*8&255;var i=k(e,c),m="",j=s(b[g]);for(a=0;a<j.length;a++){b[g].charCodeAt(a);m+=String.fromCharCode(j[a]^i[a])}h[g-1]=m}b=h.join("");return b}}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.number"]){dojo._hasResource["dojo.number"]=true;dojo.provide("dojo.number");dojo.require("dojo.i18n");dojo.requireLocalization("dojo.cldr","number",null,"ROOT,ar,ca,cs,da,de,el,en,en-au,en-gb,es,fi,fr,fr-ch,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-hant,zh-hk");dojo.require("dojo.string");dojo.require("dojo.regexp");dojo.getObject("number",true,dojo);dojo.number.format=function(a,b){b=dojo.mixin({},b||{});var c=dojo.i18n.normalizeLocale(b.locale);c=dojo.i18n.getLocalization("dojo.cldr",
"number",c);b.customs=c;c=b.pattern||c[(b.type||"decimal")+"Format"];if(isNaN(a)||Math.abs(a)==Infinity)return null;return dojo.number._applyPattern(a,c,b)};dojo.number._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;dojo.number._applyPattern=function(a,b,c){c=c||{};var d=c.customs.group,e=c.customs.decimal;b=b.split(";");var f=b[0];b=b[a<0?1:0]||"-"+f;if(b.indexOf("%")!=-1)a*=100;else if(b.indexOf("\u2030")!=-1)a*=1E3;else if(b.indexOf("\u00a4")!=-1){d=c.customs.currencyGroup||d;e=c.customs.currencyDecimal||
e;b=b.replace(/\u00a4{1,3}/,function(h){return c[["symbol","currency","displayName"][h.length-1]]||c.currency||""})}else if(b.indexOf("E")!=-1)throw Error("exponential notation not supported");var j=dojo.number._numberPatternRE;f=f.match(j);if(!f)throw Error("unable to find a number expression in pattern: "+b);if(c.fractional===false)c.places=0;return b.replace(j,dojo.number._formatAbsolute(a,f[0],{decimal:e,group:d,places:c.places,round:c.round}))};dojo.number.round=function(a,b,c){c=10/(c||10);
return(c*+a).toFixed(b)/c};(0.9).toFixed()==0&&function(){var a=dojo.number.round;dojo.number.round=function(b,c,d){var e=Math.pow(10,-c||0),f=Math.abs(b);if(!b||f>=e||f*Math.pow(10,c+1)<5)e=0;return a(b,c,d)+(b>0?e:-e)}}();dojo.number._formatAbsolute=function(a,b,c){c=c||{};if(c.places===true)c.places=0;if(c.places===Infinity)c.places=6;b=b.split(".");var d=typeof c.places=="string"&&c.places.indexOf(","),e=c.places;if(d)e=c.places.substring(d+1);else if(!(e>=0))e=(b[1]||[]).length;c.round<0||(a=
dojo.number.round(a,e,c.round));a=String(Math.abs(a)).split(".");var f=a[1]||"";if(b[1]||c.places){if(d)c.places=c.places.substring(0,d);d=c.places!==undefined?c.places:b[1]&&b[1].lastIndexOf("0")+1;if(d>f.length)a[1]=dojo.string.pad(f,d,"0",true);if(e<f.length)a[1]=f.substr(0,e)}else a[1]&&a.pop();e=b[0].replace(",","");d=e.indexOf("0");if(d!=-1){d=e.length-d;if(d>a[0].length)a[0]=dojo.string.pad(a[0],d);if(e.indexOf("#")==-1)a[0]=a[0].substr(a[0].length-d)}e=b[0].lastIndexOf(",");var j,h;if(e!=
-1){j=b[0].length-e-1;b=b[0].substr(0,e);e=b.lastIndexOf(",");if(e!=-1)h=b.length-e-1}b=[];for(e=a[0];e;){d=e.length-j;b.push(d>0?e.substr(d):e);e=d>0?e.slice(0,d):"";if(h){j=h;delete h}}a[0]=b.reverse().join(c.group||",");return a.join(c.decimal||".")};dojo.number.regexp=function(a){return dojo.number._parseInfo(a).regexp};dojo.number._parseInfo=function(a){a=a||{};var b=dojo.i18n.normalizeLocale(a.locale);b=dojo.i18n.getLocalization("dojo.cldr","number",b);var c=a.pattern||b[(a.type||"decimal")+
"Format"],d=b.group,e=b.decimal,f=1;if(c.indexOf("%")!=-1)f/=100;else if(c.indexOf("\u2030")!=-1)f/=1E3;else{var j=c.indexOf("\u00a4")!=-1;if(j){d=b.currencyGroup||d;e=b.currencyDecimal||e}}b=c.split(";");b.length==1&&b.push("-"+b[0]);b=dojo.regexp.buildGroupRE(b,function(h){h="(?:"+dojo.regexp.escapeString(h,".")+")";return h.replace(dojo.number._numberPatternRE,function(g){var k={signed:false,separator:a.strict?d:[d,""],fractional:a.fractional,decimal:e,exponent:false};g=g.split(".");var i=a.places;
if(g.length==1&&f!=1)g[1]="###";if(g.length==1||i===0)k.fractional=false;else{if(i===undefined)i=a.pattern?g[1].lastIndexOf("0")+1:Infinity;if(i&&a.fractional==undefined)k.fractional=true;if(!a.places&&i<g[1].length)i+=","+g[1].length;k.places=i}g=g[0].split(",");if(g.length>1){k.groupSize=g.pop().length;if(g.length>1)k.groupSize2=g.pop().length}return"("+dojo.number._realNumberRegexp(k)+")"})},true);if(j)b=b.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(h,g,k,i){h=dojo.regexp.escapeString(a[["symbol",
"currency","displayName"][k.length-1]]||a.currency||"");g=g?"[\\s\\xa0]":"";i=i?"[\\s\\xa0]":"";if(!a.strict){if(g)g+="*";if(i)i+="*";return"(?:"+g+h+i+")?"}return g+h+i});return{regexp:b.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:d,decimal:e,factor:f}};dojo.number.parse=function(a,b){var c=dojo.number._parseInfo(b),d=RegExp("^"+c.regexp+"$").exec(a);if(!d)return NaN;var e=d[1];if(!d[1]){if(!d[2])return NaN;e=d[2];c.factor*=-1}e=e.replace(RegExp("["+c.group+"\\s\\xa0]","g"),"").replace(c.decimal,".");
return e*c.factor};dojo.number._realNumberRegexp=function(a){a=a||{};if(!("places"in a))a.places=Infinity;if(typeof a.decimal!="string")a.decimal=".";if(!("fractional"in a)||/^0/.test(a.places))a.fractional=[true,false];if(!("exponent"in a))a.exponent=[true,false];if(!("eSigned"in a))a.eSigned=[true,false];var b=dojo.number._integerRegexp(a),c=dojo.regexp.buildGroupRE(a.fractional,function(e){var f="";if(e&&a.places!==0){f="\\"+a.decimal;if(a.places==Infinity)f="(?:"+f+"\\d+)?";else f+="\\d{"+a.places+
"}"}return f},true),d=dojo.regexp.buildGroupRE(a.exponent,function(e){if(e)return"([eE]"+dojo.number._integerRegexp({signed:a.eSigned})+")";return""});b=b+c;if(c)b="(?:(?:"+b+")|(?:"+c+"))";return b+d};dojo.number._integerRegexp=function(a){a=a||{};if(!("signed"in a))a.signed=[true,false];if("separator"in a){if(!("groupSize"in a))a.groupSize=3}else a.separator="";var b=dojo.regexp.buildGroupRE(a.signed,function(d){return d?"[-+]":""},true),c=dojo.regexp.buildGroupRE(a.separator,function(d){if(!d)return"(?:\\d+)";
d=dojo.regexp.escapeString(d);if(d==" ")d="\\s";else if(d=="\u00a0")d="\\s\\xa0";var e=a.groupSize,f=a.groupSize2;if(f){d="(?:0|[1-9]\\d{0,"+(f-1)+"}(?:["+d+"]\\d{"+f+"})*["+d+"]\\d{"+e+"})";return e-f>0?"(?:"+d+"|(?:0|[1-9]\\d{0,"+(e-1)+"}))":d}return"(?:0|[1-9]\\d{0,"+(e-1)+"}(?:["+d+"]\\d{"+e+"})*)"},true);return b+c}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date.locale"]){dojo._hasResource["dojo.date.locale"]=true;dojo.provide("dojo.date.locale");dojo.require("dojo.date");dojo.require("dojo.cldr.supplemental");dojo.require("dojo.regexp");dojo.require("dojo.string");dojo.require("dojo.i18n");dojo.requireLocalization("dojo.cldr","gregorian",null,"ROOT,ar,ca,cs,da,de,el,en,en-au,en-ca,en-gb,es,fi,fr,fr-ch,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-hant,zh-hk,zh-tw");dojo.getObject("date.locale",true,dojo);(function(){function k(b,
d,g,f){return f.replace(/([a-z])\1*/ig,function(i){var a,e,c=i.charAt(0);i=i.length;var n=["abbr","wide","narrow"];switch(c){case "G":a=d[i<4?"eraAbbr":"eraNames"][b.getFullYear()<0?0:1];break;case "y":a=b.getFullYear();switch(i){case 1:break;case 2:if(!g.fullYear){a=String(a);a=a.substr(a.length-2);break}default:e=true}break;case "Q":case "q":a=Math.ceil((b.getMonth()+1)/3);e=true;break;case "M":a=b.getMonth();if(i<3){a=a+1;e=true}else{c=["months-format",n[i-3]].join("-");a=d[c][a]}break;case "w":a=
dojo.date.locale._getWeekOfYear(b,0);e=true;break;case "d":a=b.getDate();e=true;break;case "D":a=dojo.date.locale._getDayOfYear(b);e=true;break;case "E":a=b.getDay();if(i<3){a=a+1;e=true}else{c=["days-format",n[i-3]].join("-");a=d[c][a]}break;case "a":a=b.getHours()<12?"am":"pm";a=g[a]||d["dayPeriods-format-wide-"+a];break;case "h":case "H":case "K":case "k":e=b.getHours();switch(c){case "h":a=e%12||12;break;case "H":a=e;break;case "K":a=e%12;break;case "k":a=e||24}e=true;break;case "m":a=b.getMinutes();
e=true;break;case "s":a=b.getSeconds();e=true;break;case "S":a=Math.round(b.getMilliseconds()*Math.pow(10,i-3));e=true;break;case "v":case "z":if(a=dojo.date.locale._getZone(b,true,g))break;i=4;case "Z":a=dojo.date.locale._getZone(b,false,g);a=[a<=0?"+":"-",dojo.string.pad(Math.floor(Math.abs(a)/60),2),dojo.string.pad(Math.abs(a)%60,2)];if(i==4){a.splice(0,0,"GMT");a.splice(3,0,":")}a=a.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+f);}if(e)a=dojo.string.pad(a,
i);return a})}function m(b,d,g,f){var i=function(c){return c};d=d||i;g=g||i;f=f||i;var a=b.match(/(''|[^'])+/g),e=b.charAt(0)=="'";dojo.forEach(a,function(c,n){if(c){a[n]=(e?g:d)(c.replace(/''/g,"'"));e=!e}else a[n]=""});return f(a.join(""))}function j(b,d,g,f){f=dojo.regexp.escapeString(f);g.strict||(f=f.replace(" a"," ?a"));return f.replace(/([a-z])\1*/ig,function(i){var a;a=i.charAt(0);var e=i.length,c="",n="";if(g.strict){if(e>1)c="0{"+(e-1)+"}";if(e>2)n="0{"+(e-2)+"}"}else{c="0?";n="0{0,2}"}switch(a){case "y":a=
"\\d{2,4}";break;case "M":a=e>2?"\\S+?":c+"[1-9]|1[0-2]";break;case "D":a=c+"[1-9]|"+n+"[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6]";break;case "d":a="3[01]|[12]\\d|"+c+"[1-9]";break;case "w":a=c+"[1-9]|[1-4][0-9]|5[0-3]";break;case "E":a="\\S+";break;case "h":a=c+"[1-9]|1[0-2]";break;case "k":a=c+"\\d|1[01]";break;case "H":a=c+"\\d|1\\d|2[0-3]";break;case "K":a=c+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":a="[0-5]\\d";break;case "S":a="\\d{"+e+"}";break;case "a":e=g.am||d["dayPeriods-format-wide-am"];
c=g.pm||d["dayPeriods-format-wide-pm"];if(g.strict)a=e+"|"+c;else{a=e+"|"+c;if(e!=e.toLowerCase())a+="|"+e.toLowerCase();if(c!=c.toLowerCase())a+="|"+c.toLowerCase();if(a.indexOf(".")!=-1)a+="|"+a.replace(/\./g,"")}a=a.replace(/\./g,"\\.");break;default:a=".*"}b&&b.push(i);return"("+a+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}dojo.date.locale._getZone=function(b,d){return d?dojo.date.getTimezoneName(b):b.getTimezoneOffset()};dojo.date.locale.format=function(b,d){d=d||{};var g=dojo.i18n.normalizeLocale(d.locale),
f=d.formatLength||"short";g=dojo.date.locale._getGregorianBundle(g);var i=[],a=dojo.hitch(this,k,b,g,d);if(d.selector=="year")return m(g["dateFormatItem-yyyy"]||"yyyy",a);var e;if(d.selector!="date")(e=d.timePattern||g["timeFormat-"+f])&&i.push(m(e,a));if(d.selector!="time")(e=d.datePattern||g["dateFormat-"+f])&&i.push(m(e,a));return i.length==1?i[0]:g["dateTimeFormat-"+f].replace(/\{(\d+)\}/g,function(c,n){return i[n]})};dojo.date.locale.regexp=function(b){return dojo.date.locale._parseInfo(b).regexp};
dojo.date.locale._parseInfo=function(b){b=b||{};var d=dojo.i18n.normalizeLocale(b.locale);d=dojo.date.locale._getGregorianBundle(d);var g=b.formatLength||"short",f=b.datePattern||d["dateFormat-"+g],i=b.timePattern||d["timeFormat-"+g];g=b.selector=="date"?f:b.selector=="time"?i:d["dateTimeFormat-"+g].replace(/\{(\d+)\}/g,function(e,c){return[i,f][c]});var a=[];return{regexp:m(g,dojo.hitch(this,j,a,d,b)),tokens:a,bundle:d}};dojo.date.locale.parse=function(b,d){var g=/[\u200E\u200F\u202A\u202E]/g,f=
dojo.date.locale._parseInfo(d),i=f.tokens,a=f.bundle;g=RegExp("^"+f.regexp.replace(g,"")+"$",f.strict?"":"i").exec(b&&b.replace(g,""));if(!g)return null;var e=["abbr","wide","narrow"],c=[1970,0,1,0,0,0,0],n="";g=dojo.every(g,function(h,s){if(!s)return true;var l=i[s-1],o=l.length;switch(l.charAt(0)){case "y":if(o!=2&&d.strict)c[0]=h;else if(h<100){h=Number(h);o=""+(new Date).getFullYear();l=o.substring(0,2)*100;o=Math.min(Number(o.substring(2,4))+20,99);c[0]=h<o?l+h:l-100+h}else{if(d.strict)return false;
c[0]=h}break;case "M":if(o>2){l=a["months-format-"+e[o-3]].concat();if(!d.strict){h=h.replace(".","").toLowerCase();l=dojo.map(l,function(q){return q.replace(".","").toLowerCase()})}h=dojo.indexOf(l,h);if(h==-1)return false}else h--;c[1]=h;break;case "E":case "e":l=a["days-format-"+e[o-3]].concat();if(!d.strict){h=h.toLowerCase();l=dojo.map(l,function(q){return q.toLowerCase()})}h=dojo.indexOf(l,h);if(h==-1)return false;break;case "D":c[1]=0;case "d":c[2]=h;break;case "a":l=d.am||a["dayPeriods-format-wide-am"];
o=d.pm||a["dayPeriods-format-wide-pm"];if(!d.strict){var r=/\./g;h=h.replace(r,"").toLowerCase();l=l.replace(r,"").toLowerCase();o=o.replace(r,"").toLowerCase()}if(d.strict&&h!=l&&h!=o)return false;n=h==o?"p":h==l?"a":"";break;case "K":if(h==24)h=0;case "h":case "H":case "k":if(h>23)return false;c[3]=h;break;case "m":c[4]=h;break;case "s":c[5]=h;break;case "S":c[6]=h}return true});f=+c[3];if(n==="p"&&f<12)c[3]=f+12;else if(n==="a"&&f==12)c[3]=0;f=new Date(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);d.strict&&
f.setFullYear(c[0]);var p=i.join(""),t=p.indexOf("d")!=-1;p=p.indexOf("M")!=-1;if(!g||p&&f.getMonth()>c[1]||t&&f.getDate()>c[2])return null;if(p&&f.getMonth()<c[1]||t&&f.getDate()<c[2])f=dojo.date.add(f,"hour",1);return f}})();(function(){var k=[];dojo.date.locale.addCustomFormats=function(m,j){k.push({pkg:m,name:j})};dojo.date.locale._getGregorianBundle=function(m){var j={};dojo.forEach(k,function(b){b=dojo.i18n.getLocalization(b.pkg,b.name,m);j=dojo.mixin(j,b)},this);return j}})();dojo.date.locale.addCustomFormats("dojo.cldr",
"gregorian");dojo.date.locale.getNames=function(k,m,j,b){var d;b=dojo.date.locale._getGregorianBundle(b);k=[k,j,m];if(j=="standAlone"){j=k.join("-");d=b[j];if(d[0]==1)d=undefined}k[1]="format";return(d||b[k.join("-")]).concat()};dojo.date.locale.isWeekend=function(k,m){var j=dojo.cldr.supplemental.getWeekend(m),b=(k||new Date).getDay();if(j.end<j.start){j.end+=7;if(b<j.start)b+=7}return b>=j.start&&b<=j.end};dojo.date.locale._getDayOfYear=function(k){return dojo.date.difference(new Date(k.getFullYear(),
0,1,k.getHours()),k)+1};dojo.date.locale._getWeekOfYear=function(k,m){if(arguments.length==1)m=0;var j=(new Date(k.getFullYear(),0,1)).getDay(),b=(j-m+7)%7;b=Math.floor((dojo.date.locale._getDayOfYear(k)+b-1)/7);j==m&&b++;return b}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.popup"]){dojo._hasResource["dijit._base.popup"]=true;dojo.provide("dijit._base.popup");dojo.require("dijit._base.focus");dojo.require("dijit._base.place");dojo.require("dijit._base.window");dijit.popup={_stack:[],_beginZIndex:1E3,_idGen:1,_createWrapper:function(a){var b=a.declaredClass?a._popupWrapper:dojo.hasClass(a.parentNode,"dijitPopup")&&a.parentNode,c=a.domNode||a;if(!b){b=dojo.create("div",{"class":"dijitPopup",style:{display:"none"},role:"presentation"},
dojo.body());b.appendChild(c);c=c.style;c.display="";c.visibility="";c.position="";c.top="0px";if(a.declaredClass){a._popupWrapper=b;dojo.connect(a,"destroy",function(){dojo.destroy(b);delete a._popupWrapper})}}return b},moveOffScreen:function(a){a=this._createWrapper(a);dojo.style(a,{visibility:"hidden",top:"-9999px",display:""})},hide:function(a){a=this._createWrapper(a);dojo.style(a,"display","none")},getTopPopup:function(){for(var a=this._stack,b=a.length-1;b>0&&a[b].parent===a[b-1].widget;b--);
return a[b]},open:function(a){for(var b=this._stack,c=a.popup,d=a.orient||((a.parent?a.parent.isLeftToRight():dojo._isBodyLtr())?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"}),f=a.around,h=a.around&&a.around.id?a.around.id+"_dropdown":"popup_"+this._idGen++;b.length&&(!a.parent||!dojo.isDescendant(a.parent.domNode,b[b.length-1].widget.domNode));)dijit.popup.close(b[b.length-1].widget);var g=this._createWrapper(c);dojo.attr(g,{id:h,style:{zIndex:this._beginZIndex+b.length},"class":"dijitPopup "+
(c.baseClass||c["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:a.parent?a.parent.id:""});if(dojo.isIE||dojo.isMoz)if(!c.bgIframe)c.bgIframe=new dijit.BackgroundIframe(g);d=f?dijit.placeOnScreenAroundElement(g,f,d,c.orient?dojo.hitch(c,"orient"):null):dijit.placeOnScreen(g,a,d=="R"?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],a.padding);g.style.display="";g.style.visibility="visible";c.domNode.style.visibility="visible";f=[];f.push(dojo.connect(g,"onkeypress",this,function(e){if(e.charOrCode==
dojo.keys.ESCAPE&&a.onCancel){dojo.stopEvent(e);a.onCancel()}else if(e.charOrCode===dojo.keys.TAB){dojo.stopEvent(e);(e=this.getTopPopup())&&e.onCancel&&e.onCancel()}}));c.onCancel&&f.push(dojo.connect(c,"onCancel",a.onCancel));f.push(dojo.connect(c,c.onExecute?"onExecute":"onChange",this,function(){var e=this.getTopPopup();e&&e.onExecute&&e.onExecute()}));b.push({widget:c,parent:a.parent,onExecute:a.onExecute,onCancel:a.onCancel,onClose:a.onClose,handlers:f});c.onOpen&&c.onOpen(d);return d},close:function(a){for(var b=
this._stack;a&&dojo.some(b,function(h){return h.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,f=c.onClose;d.onClose&&d.onClose();dojo.forEach(c.handlers,dojo.disconnect);d&&d.domNode&&this.hide(d);f&&f()}}};dijit._frames=new function(){var a=[];this.pop=function(){var b;if(a.length){b=a.pop();b.style.display=""}else{if(dojo.isIE<9){b="<iframe src='"+(dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html")+""||'javascript:""')+"' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>";
b=dojo.doc.createElement(b)}else{b=dojo.create("iframe");b.src='javascript:""';b.className="dijitBackgroundIframe";dojo.style(b,"opacity",0.1)}b.tabIndex=-1;dijit.setWaiRole(b,"presentation")}return b};this.push=function(b){b.style.display="none";a.push(b)}};dijit.BackgroundIframe=function(a){if(!a.id)throw Error("no id");if(dojo.isIE||dojo.isMoz){var b=this.iframe=dijit._frames.pop();a.appendChild(b);if(dojo.isIE<7||dojo.isQuirks){this.resize(a);this._conn=dojo.connect(a,"onresize",this,function(){this.resize(a)})}else dojo.style(b,
{width:"100%",height:"100%"})}};dojo.extend(dijit.BackgroundIframe,{resize:function(a){this.iframe&&dojo.style(this.iframe,{width:a.offsetWidth+"px",height:a.offsetHeight+"px"})},destroy:function(){if(this._conn){dojo.disconnect(this._conn);this._conn=null}if(this.iframe){dijit._frames.push(this.iframe);delete this.iframe}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base"]){dojo._hasResource["dijit._base"]=true;dojo.provide("dijit._base");dojo.require("dijit._base.focus");dojo.require("dijit._base.manager");dojo.require("dijit._base.place");dojo.require("dijit._base.popup");dojo.require("dijit._base.scroll");dojo.require("dijit._base.sniff");dojo.require("dijit._base.typematic");dojo.require("dijit._base.wai");dojo.require("dijit._base.window")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Widget"]){dojo._hasResource["dijit._Widget"]=true;dojo.provide("dijit._Widget");dojo.require("dijit._WidgetBase");dojo.require("dijit._base");dojo.connect(dojo,"_connect",function(a,c){a&&dojo.isFunction(a._onConnect)&&a._onConnect(c)});dijit._connectOnUseEventHandler=function(){};dijit._lastKeyDownNode=null;dojo.isIE?function(){var a=function(c){dijit._lastKeyDownNode=c.srcElement};dojo.doc.attachEvent("onkeydown",a);dojo.addOnWindowUnload(function(){dojo.doc.detachEvent("onkeydown",
a)})}():dojo.doc.addEventListener("keydown",function(a){dijit._lastKeyDownNode=a.target},true);(function(){dojo.declare("dijit._Widget",dijit._WidgetBase,{_deferredConnects:{onClick:"",onDblClick:"",onKeyDown:"",onKeyPress:"",onKeyUp:"",onMouseMove:"",onMouseDown:"",onMouseOut:"",onMouseOver:"",onMouseLeave:"",onMouseEnter:"",onMouseUp:""},onClick:dijit._connectOnUseEventHandler,onDblClick:dijit._connectOnUseEventHandler,onKeyDown:dijit._connectOnUseEventHandler,onKeyPress:dijit._connectOnUseEventHandler,
onKeyUp:dijit._connectOnUseEventHandler,onMouseDown:dijit._connectOnUseEventHandler,onMouseMove:dijit._connectOnUseEventHandler,onMouseOut:dijit._connectOnUseEventHandler,onMouseOver:dijit._connectOnUseEventHandler,onMouseLeave:dijit._connectOnUseEventHandler,onMouseEnter:dijit._connectOnUseEventHandler,onMouseUp:dijit._connectOnUseEventHandler,create:function(){this._deferredConnects=dojo.clone(this._deferredConnects);for(var a in this.attributeMap)delete this._deferredConnects[a];for(a in this._deferredConnects)this[a]!==
dijit._connectOnUseEventHandler&&delete this._deferredConnects[a];this.inherited(arguments);if(this.domNode)for(a in this.params)this._onConnect(a)},_onConnect:function(a){if(a in this._deferredConnects){this.connect(this[this._deferredConnects[a]||"domNode"],a.toLowerCase(),a);delete this._deferredConnects[a]}},focused:false,isFocusable:function(){return this.focus&&dojo.style(this.domNode,"display")!="none"},onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()},
setAttribute:function(a,c){dojo.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,c)},attr:function(a){if(dojo.config.isDebug){var c=arguments.callee._ach||(arguments.callee._ach={}),e=(arguments.callee.caller||"unknown caller").toString();if(!c[e]){dojo.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+e,"","2.0");c[e]=true}}return arguments.length>=2||typeof a==="object"?this.set.apply(this,
arguments):this.get(a)},nodesWithKeyClick:["input","button"],connect:function(a,c,e){var d=dojo,f=d._connect,g=this.inherited(arguments,[a,c=="ondijitclick"?"onclick":c,e]);if(c=="ondijitclick")if(d.indexOf(this.nodesWithKeyClick,a.nodeName.toLowerCase())==-1){var h=d.hitch(this,e);g.push(f(a,"onkeydown",this,function(b){if((b.keyCode==d.keys.ENTER||b.keyCode==d.keys.SPACE)&&!b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey){dijit._lastKeyDownNode=b.target;"openDropDown"in this&&a==this._buttonNode||
b.preventDefault()}}),f(a,"onkeyup",this,function(b){if((b.keyCode==d.keys.ENTER||b.keyCode==d.keys.SPACE)&&b.target==dijit._lastKeyDownNode&&!b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey){dijit._lastKeyDownNode=null;return h(b)}}))}return g},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return true}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._DialogMixin"]){dojo._hasResource["dijit._DialogMixin"]=true;dojo.provide("dijit._DialogMixin");dojo.require("dijit._Widget");dojo.declare("dijit._DialogMixin",null,{attributeMap:dijit._Widget.prototype.attributeMap,execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var a=dijit._getTabNavigable(this.containerNode);this._firstFocusItem=a.lowest||a.first||this.closeButtonNode||
this.domNode;this._lastFocusItem=a.last||a.highest||this._firstFocusItem}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._HasDropDown"]){dojo._hasResource["dijit._HasDropDown"]=true;dojo.provide("dijit._HasDropDown");dojo.require("dijit._Widget");dojo.declare("dijit._HasDropDown",null,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:true,forceWidth:false,maxHeight:0,dropDownPosition:["below","above"],_stopClickEvents:true,_onDropDownMouseDown:function(){if(!(this.disabled||this.readOnly)){this._docHandler=this.connect(dojo.doc,"onmouseup",
"_onDropDownMouseUp");this.toggleDropDown()}},_onDropDownMouseUp:function(a){a&&this._docHandler&&this.disconnect(this._docHandler);var c=this.dropDown,f=false;if(a&&this._opened){var b=dojo.position(this._buttonNode,true);if(!(a.pageX>=b.x&&a.pageX<=b.x+b.w)||!(a.pageY>=b.y&&a.pageY<=b.y+b.h)){for(b=a.target;b&&!f;)if(dojo.hasClass(b,"dijitPopup"))f=true;else b=b.parentNode;if(f){b=a.target;if(c.onItemClick){for(var d;b&&!(d=dijit.byNode(b));)b=b.parentNode;d&&d.onClick&&d.getParent&&d.getParent().onItemClick(d,
a)}return}}}this._opened&&c.focus&&c.autoFocus!==false&&window.setTimeout(dojo.hitch(c,"focus"),1)},_onDropDownClick:function(a){this._stopClickEvents&&dojo.stopEvent(a)},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";dojo.addClass(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);this.connect(this._buttonNode,"onmousedown","_onDropDownMouseDown");this.connect(this._buttonNode,"onclick","_onDropDownClick");this.connect(this.focusNode,"onkeypress","_onKey")},destroy:function(){if(this.dropDown){this.dropDown._destroyed||this.dropDown.destroyRecursive();delete this.dropDown}this.inherited(arguments)},_onKey:function(a){if(!(this.disabled||
this.readOnly)){var c=this.dropDown,f=a.target;if(c&&this._opened&&c.handleKey)if(c.handleKey(a)===false){dojo.stopEvent(a);return}if(c&&this._opened&&a.charOrCode==dojo.keys.ESCAPE){this.closeDropDown();dojo.stopEvent(a)}else if(!this._opened&&(a.charOrCode==dojo.keys.DOWN_ARROW||(a.charOrCode==dojo.keys.ENTER||a.charOrCode==" ")&&((f.tagName||"").toLowerCase()!=="input"||f.type&&f.type.toLowerCase()!=="text"))){this.toggleDropDown();(c=this.dropDown)&&c.focus&&setTimeout(dojo.hitch(c,"focus"),1);
dojo.stopEvent(a)}}},_onBlur:function(){this.closeDropDown(dijit._curFocus&&this.dropDown&&dojo.isDescendant(dijit._curFocus,this.dropDown.domNode));this.inherited(arguments)},isLoaded:function(){return true},loadDropDown:function(a){a()},toggleDropDown:function(){if(!(this.disabled||this.readOnly))if(this._opened)this.closeDropDown();else this.isLoaded()?this.openDropDown():this.loadDropDown(dojo.hitch(this,"openDropDown"))},openDropDown:function(){var a=this.dropDown,c=a.domNode,f=this._aroundNode||
this.domNode,b=this;if(!this._preparedNode){this._preparedNode=true;if(c.style.width)this._explicitDDWidth=true;if(c.style.height)this._explicitDDHeight=true}if(this.maxHeight||this.forceWidth||this.autoWidth){var d={display:"",visibility:"hidden"};if(!this._explicitDDWidth)d.width="";if(!this._explicitDDHeight)d.height="";dojo.style(c,d);d=this.maxHeight;if(d==-1){d=dojo.window.getBox();var e=dojo.position(f,false);d=Math.floor(Math.max(e.y,d.h-(e.y+e.h)))}a.startup&&!a._started&&a.startup();dijit.popup.moveOffScreen(a);
e=dojo._getMarginSize(c);var g=d&&e.h>d;dojo.style(c,{overflowX:"hidden",overflowY:g?"auto":"hidden"});if(g){e.h=d;if("w"in e)e.w+=16}else delete e.h;if(this.forceWidth)e.w=f.offsetWidth;else if(this.autoWidth)e.w=Math.max(e.w,f.offsetWidth);else delete e.w;dojo.isFunction(a.resize)?a.resize(e):dojo.marginBox(c,e)}a=dijit.popup.open({parent:this,popup:a,around:f,orient:dijit.getPopupAroundAlignment(this.dropDownPosition&&this.dropDownPosition.length?this.dropDownPosition:["below"],this.isLeftToRight()),
onExecute:function(){b.closeDropDown(true)},onCancel:function(){b.closeDropDown(true)},onClose:function(){dojo.attr(b._popupStateNode,"popupActive",false);dojo.removeClass(b._popupStateNode,"dijitHasDropDownOpen");b._opened=false}});dojo.attr(this._popupStateNode,"popupActive","true");dojo.addClass(b._popupStateNode,"dijitHasDropDownOpen");this._opened=true;return a},closeDropDown:function(a){if(this._opened){a&&this.focus();dijit.popup.close(this.dropDown);this._opened=false}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout._LayoutWidget"]){dojo._hasResource["dijit.layout._LayoutWidget"]=true;dojo.provide("dijit.layout._LayoutWidget");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.require("dijit._Contained");dojo.declare("dijit.layout._LayoutWidget",[dijit._Widget,dijit._Container,dijit._Contained],{baseClass:"dijitLayoutContainer",isLayoutContainer:true,buildRendering:function(){this.inherited(arguments);dojo.addClass(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var b=this.getParent&&this.getParent();if(!(b&&b.isLayoutContainer)){this.resize();this.connect(dojo.isIE?this.domNode:dojo.global,"onresize",function(){this.resize()})}}},resize:function(b,e){var a=this.domNode;if(b){dojo.marginBox(a,b);if(b.t)a.style.top=b.t+"px";if(b.l)a.style.left=b.l+"px"}var d=e||{};dojo.mixin(d,b||{});if(!("h"in d)||!("w"in d))d=dojo.mixin(dojo.marginBox(a),d);var f=dojo.getComputedStyle(a),i=dojo._getMarginExtents(a,f),c=dojo._getBorderExtents(a,f);d=this._borderBox={w:d.w-
(i.w+c.w),h:d.h-(i.h+c.h)};i=dojo._getPadExtents(a,f);this._contentBox={l:dojo._toPixelValue(a,f.paddingLeft),t:dojo._toPixelValue(a,f.paddingTop),w:d.w-i.w,h:d.h-i.h};this.layout()},layout:function(){},_setupChild:function(b){dojo.addClass(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b){this.inherited(arguments);this._started&&this._setupChild(b)},removeChild:function(b){dojo.removeClass(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+
this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}});dijit.layout.marginBox2contentBox=function(b,e){var a=dojo.getComputedStyle(b),d=dojo._getMarginExtents(b,a),f=dojo._getPadBorderExtents(b,a);return{l:dojo._toPixelValue(b,a.paddingLeft),t:dojo._toPixelValue(b,a.paddingTop),w:e.w-(d.w+f.w),h:e.h-(d.h+f.h)}};(function(){var b=function(e,a){e.resize?e.resize(a):dojo.marginBox(e.domNode,a);dojo.mixin(e,dojo.marginBox(e.domNode));dojo.mixin(e,a)};dijit.layout.layoutChildren=function(e,a,
d,f,i){a=dojo.mixin({},a);dojo.addClass(e,"dijitLayoutContainer");d=dojo.filter(d,function(c){return c.region!="center"&&c.layoutAlign!="client"}).concat(dojo.filter(d,function(c){return c.region=="center"||c.layoutAlign=="client"}));dojo.forEach(d,function(c){var h=c.domNode,g=c.region||c.layoutAlign,j=h.style;j.left=a.l+"px";j.top=a.t+"px";j.bottom=j.right="auto";dojo.addClass(h,"dijitAlign"+(g.substring(0,1).toUpperCase()+g.substring(1)));h={};if(f&&f==c.id)h[c.region=="top"||c.region=="bottom"?
"h":"w"]=i;if(g=="top"||g=="bottom"){h.w=a.w;b(c,h);a.h-=c.h;if(g=="top")a.t+=c.h;else j.top=a.t+a.h+"px"}else if(g=="left"||g=="right"){h.h=a.h;b(c,h);a.w-=c.w;if(g=="left")a.l+=c.w;else j.left=a.l+a.w+"px"}else if(g=="client"||g=="center")b(c,a)})}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Templated"]){dojo._hasResource["dijit._Templated"]=true;dojo.provide("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dojo.string");dojo.require("dojo.parser");dojo.require("dojo.cache");dojo.declare("dijit._Templated",null,{templateString:null,templatePath:null,widgetsInTemplate:false,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[]},_stringRepl:function(b){var a=this.declaredClass,f=
this;return dojo.string.substitute(b,this,function(e,d){if(d.charAt(0)=="!")e=dojo.getObject(d.substr(1),false,f);if(typeof e=="undefined")throw Error(a+" template:"+d);if(e==null)return"";return d.charAt(0)=="!"?e:e.toString().replace(/"/g,"&quot;")},this)},buildRendering:function(){var b=dijit._Templated.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache),a;if(dojo.isString(b)){a=dojo._toDom(this._stringRepl(b));if(a.nodeType!=1)throw Error("Invalid template: "+b);}else a=
b.cloneNode(true);this.domNode=a;this.inherited(arguments);this._attachTemplateNodes(a);if(this.widgetsInTemplate){b=this._startupWidgets=dojo.parser.parse(a,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang},propsThis:this,scope:"dojo"});this._supportingWidgets=dijit.findWidgets(a);this._attachTemplateNodes(b,function(f,e){return f[e]})}this._fillContent(this.srcNodeRef)},_fillContent:function(b){var a=this.containerNode;if(b&&a)for(;b.hasChildNodes();)a.appendChild(b.firstChild)},
_attachTemplateNodes:function(b,a){a=a||function(g,k){return g.getAttribute(k)};for(var f=dojo.isArray(b)?b:b.all||b.getElementsByTagName("*"),e=dojo.isArray(b)?0:-1;e<f.length;e++){var d=e==-1?b:f[e];if(!(this.widgetsInTemplate&&(a(d,"dojoType")||a(d,"data-dojo-type")))){var c=a(d,"dojoAttachPoint")||a(d,"data-dojo-attach-point");if(c)for(var i=c.split(/\s*,\s*/);c=i.shift();){if(dojo.isArray(this[c]))this[c].push(d);else this[c]=d;this._attachPoints.push(c)}if(c=a(d,"dojoAttachEvent")||a(d,"data-dojo-attach-event")){i=
c.split(/\s*,\s*/);for(var j=dojo.trim;c=i.shift();)if(c){var h=null;if(c.indexOf(":")!=-1){h=c.split(":");c=j(h[0]);h=j(h[1])}else c=j(c);h||(h=c);this._attachEvents.push(this.connect(d,c,h))}}(c=a(d,"waiRole"))&&dijit.setWaiRole(d,c);(c=a(d,"waiState"))&&dojo.forEach(c.split(/\s*,\s*/),function(g){if(g.indexOf("-")!=-1){g=g.split("-");dijit.setWaiState(d,g[0],g[1])}})}}},startup:function(){dojo.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&b.startup()});this.inherited(arguments)},
destroyRendering:function(){dojo.forEach(this._attachPoints,function(b){delete this[b]},this);this._attachPoints=[];dojo.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments)}});dijit._Templated._templateCache={};dijit._Templated.getCachedTemplate=function(b,a,f){var e=dijit._Templated._templateCache,d=a||b,c=e[d];if(c){try{if(!c.ownerDocument||c.ownerDocument==dojo.doc)return c}catch(i){}dojo.destroy(c)}a||(a=dojo.cache(b,{sanitize:true}));a=dojo.string.trim(a);
if(f||a.match(/\$\{([^\}]+)\}/g))return e[d]=a;else{b=dojo._toDom(a);if(b.nodeType!=1)throw Error("Invalid template: "+a);return e[d]=b}};dojo.isIE&&dojo.addOnWindowUnload(function(){var b=dijit._Templated._templateCache,a;for(a in b){var f=b[a];typeof f=="object"&&dojo.destroy(f);delete b[a]}});dojo.extend(dijit._Widget,{dojoAttachEvent:"",dojoAttachPoint:"",waiRole:"",waiState:""})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.MenuSeparator"]){dojo._hasResource["dijit.MenuSeparator"]=true;dojo.provide("dijit.MenuSeparator");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Contained");dojo.declare("dijit.MenuSeparator",[dijit._Widget,dijit._Templated,dijit._Contained],{templateString:dojo.cache("dijit","templates/MenuSeparator.html",'<tr class="dijitMenuSeparator">\n\t<td class="dijitMenuSeparatorIconCell">\n\t\t<div class="dijitMenuSeparatorTop"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n\t<td colspan="3" class="dijitMenuSeparatorLabelCell">\n\t\t<div class="dijitMenuSeparatorTop dijitMenuSeparatorLabel"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n</tr>\n'),
buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.domNode,false)},isFocusable:function(){return false}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form._FormWidget"]){dojo._hasResource["dijit.form._FormWidget"]=true;dojo.provide("dijit.form._FormWidget");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._CssStateMixin");dojo.declare("dijit.form._FormWidget",[dijit._Widget,dijit._Templated,dijit._CssStateMixin],{name:"",alt:"",value:"",type:"text",tabIndex:"0",disabled:false,intermediateChanges:false,scrollOnFocus:true,attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,
{value:"focusNode",id:"focusNode",tabIndex:"focusNode",alt:"focusNode",title:"focusNode"}),postMixInProperties:function(){this.nameAttrSetting=this.name?'name="'+this.name.replace(/'/g,"&quot;")+'"':"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onmousedown","_onMouseDown")},_setDisabledAttr:function(a){this._set("disabled",a);dojo.attr(this.focusNode,"disabled",a);this.valueNode&&dojo.attr(this.valueNode,"disabled",a);dijit.setWaiState(this.focusNode,
"disabled",a);if(a){this._set("hovering",false);this._set("active",false);a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"focusNode";dojo.forEach(dojo.isArray(a)?a:[a],function(b){b=this[b];dojo.isWebKit||dijit.hasDefaultTabStop(b)?b.setAttribute("tabIndex","-1"):b.removeAttribute("tabIndex")},this)}else this.tabIndex!=""&&this.focusNode.setAttribute("tabIndex",this.tabIndex)},setDisabled:function(a){dojo.deprecated("setDisabled("+a+") is deprecated. Use set('disabled',"+a+") instead.",
"","2.0");this.set("disabled",a)},_onFocus:function(){this.scrollOnFocus&&dojo.window.scrollIntoView(this.domNode);this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&dojo.style(this.domNode,"display")!="none"},focus:function(){this.disabled||dijit.focus(this.focusNode)},compare:function(a,b){return typeof a=="number"&&typeof b=="number"?isNaN(a)&&isNaN(b)?0:a-b:a>b?1:a<b?-1:0},onChange:function(){},_onChangeActive:false,_handleOnChange:function(a,b){if(this._lastValueReported==
undefined&&(b===null||!this._onChangeActive))this._resetValue=this._lastValueReported=a;this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||this.compare(a,this._lastValueReported)!=0;if((this.intermediateChanges||b||b===undefined)&&this._pendingOnChange){this._lastValueReported=a;this._pendingOnChange=false;if(this._onChangeActive){this._onChangeHandle&&clearTimeout(this._onChangeHandle);this._onChangeHandle=setTimeout(dojo.hitch(this,function(){this._onChangeHandle=
null;this.onChange(a)}),0)}}},create:function(){this.inherited(arguments);this._onChangeActive=true},destroy:function(){if(this._onChangeHandle){clearTimeout(this._onChangeHandle);this.onChange(this._lastValueReported)}this.inherited(arguments)},setValue:function(a){dojo.deprecated("dijit.form._FormWidget:setValue("+a+") is deprecated.  Use set('value',"+a+") instead.","","2.0");this.set("value",a)},getValue:function(){dojo.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.",
"","2.0");return this.get("value")},_onMouseDown:function(a){if(!a.ctrlKey&&dojo.mouseButtons.isLeft(a)&&this.isFocusable())var b=this.connect(dojo.body(),"onmouseup",function(){this.isFocusable()&&this.focus();this.disconnect(b)})}});dojo.declare("dijit.form._FormValueWidget",dijit.form._FormWidget,{readOnly:false,attributeMap:dojo.delegate(dijit.form._FormWidget.prototype.attributeMap,{value:"",readOnly:"focusNode"}),_setReadOnlyAttr:function(a){dojo.attr(this.focusNode,"readOnly",a);dijit.setWaiState(this.focusNode,
"readonly",a);this._set("readOnly",a)},postCreate:function(){this.inherited(arguments);if(dojo.isIE)this.connect(this.focusNode||this.domNode,"onkeydown",this._onKeyDown);if(this._resetValue===undefined)this._lastValueReported=this._resetValue=this.value},_setValueAttr:function(a,b){this._handleOnChange(a,b)},_handleOnChange:function(a){this._set("value",a);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,false)},reset:function(){this._hasBeenBlurred=false;this._setValueAttr(this._resetValue,
true)},_onKeyDown:function(a){if(a.keyCode==dojo.keys.ESCAPE&&!(a.ctrlKey||a.altKey||a.metaKey)){var b;if(dojo.isIE){a.preventDefault();b=document.createEventObject();b.keyCode=dojo.keys.ESCAPE;b.shiftKey=a.shiftKey;a.srcElement.fireEvent("onkeypress",b)}}},_layoutHackIE7:function(){if(dojo.isIE==7)for(var a=this.domNode,b=a.parentNode,c=a.firstChild||a,e=c.style.filter,d=this;b&&b.clientHeight==0;){(function(){var f=d.connect(b,"onscroll",function(){d.disconnect(f);c.style.filter=(new Date).getMilliseconds();
setTimeout(function(){c.style.filter=e},0)})})();b=b.parentNode}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.MenuItem"]){dojo._hasResource["dijit.MenuItem"]=true;dojo.provide("dijit.MenuItem");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Contained");dojo.require("dijit._CssStateMixin");dojo.declare("dijit.MenuItem",[dijit._Widget,dijit._Templated,dijit._Contained,dijit._CssStateMixin],{templateString:dojo.cache("dijit","templates/MenuItem.html",'<tr class="dijitReset dijitMenuItem" dojoAttachPoint="focusNode" role="menuitem" tabIndex="-1"\n\t\tdojoAttachEvent="onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" dojoAttachPoint="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" dojoAttachPoint="containerNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" dojoAttachPoint="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div dojoAttachPoint="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'),
attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{label:{node:"containerNode",type:"innerHTML"},iconClass:{node:"iconNode",type:"class"}}),baseClass:"dijitMenuItem",label:"",iconClass:"",accelKey:"",disabled:false,_fillContent:function(a){a&&!("label"in this.params)&&this.set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);var a=this.id+"_text";dojo.attr(this.containerNode,"id",a);if(this.accelKeyNode){dojo.attr(this.accelKeyNode,"id",this.id+"_accel");a+=
" "+this.id+"_accel"}dijit.setWaiState(this.domNode,"labelledby",a);dojo.setSelectable(this.domNode,false)},_onHover:function(){this.getParent().onItemHover(this)},_onUnhover:function(){this.getParent().onItemUnhover(this);this._set("hovering",false)},_onClick:function(a){this.getParent().onItemClick(this,a);dojo.stopEvent(a)},onClick:function(){},focus:function(){try{dojo.isIE==8&&this.containerNode.focus();dijit.focus(this.focusNode)}catch(a){}},_onFocus:function(){this._setSelected(true);this.getParent()._onItemFocus(this);
this.inherited(arguments)},_setSelected:function(a){dojo.toggleClass(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){dojo.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){dojo.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){dijit.setWaiState(this.focusNode,"disabled",a?"true":"false");this._set("disabled",
a)},_setAccelKeyAttr:function(a){this.accelKeyNode.style.display=a?"":"none";this.accelKeyNode.innerHTML=a;dojo.attr(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.CheckedMenuItem"]){dojo._hasResource["dijit.CheckedMenuItem"]=true;dojo.provide("dijit.CheckedMenuItem");dojo.require("dijit.MenuItem");dojo.declare("dijit.CheckedMenuItem",dijit.MenuItem,{templateString:dojo.cache("dijit","templates/CheckedMenuItem.html",'<tr class="dijitReset dijitMenuItem" dojoAttachPoint="focusNode" role="menuitemcheckbox" tabIndex="-1"\n\t\tdojoAttachEvent="onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitMenuItemIcon dijitCheckedMenuItemIcon" dojoAttachPoint="iconNode"/>\n\t\t<span class="dijitCheckedMenuItemIconChar">&#10003;</span>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" dojoAttachPoint="containerNode,labelNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" dojoAttachPoint="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">&nbsp;</td>\n</tr>\n'),
checked:false,_setCheckedAttr:function(a){dojo.toggleClass(this.domNode,"dijitCheckedMenuItemChecked",a);dijit.setWaiState(this.domNode,"checked",a);this._set("checked",a)},onChange:function(){},_onClick:function(){if(!this.disabled){this.set("checked",!this.checked);this.onChange(this.checked)}this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.PopupMenuItem"]){dojo._hasResource["dijit.PopupMenuItem"]=true;dojo.provide("dijit.PopupMenuItem");dojo.require("dijit.MenuItem");dojo.declare("dijit.PopupMenuItem",dijit.MenuItem,{_fillContent:function(){if(this.srcNodeRef){var a=dojo.query("*",this.srcNodeRef);dijit.PopupMenuItem.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var a=dojo.query("[widgetId]",
this.dropDownContainer)[0];this.popup=dijit.byNode(a)}dojo.body().appendChild(this.popup.domNode);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&dojo.style(this.arrowWrapper,"visibility","");dijit.setWaiState(this.focusNode,"haspopup","true")}},destroyDescendants:function(){if(this.popup){this.popup._destroyed||this.popup.destroyRecursive();delete this.popup}this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout.ContentPane"]){dojo._hasResource["dijit.layout.ContentPane"]=true;dojo.provide("dijit.layout.ContentPane");dojo.require("dijit._Widget");dojo.require("dijit.layout._LayoutWidget");dojo.require("dijit.layout._ContentPaneResizeMixin");dojo.require("dojo.string");dojo.require("dojo.html");dojo.requireLocalization("dijit","loading",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.declare("dijit.layout.ContentPane",
[dijit._Widget,dijit.layout._ContentPaneResizeMixin],{href:"",extractContent:false,parseOnLoad:true,parserScope:dojo._scopeName,preventCache:false,preload:false,refreshOnShow:false,loadingMessage:"<span class='dijitContentPaneLoading'>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'>${errorState}</span>",isLoaded:false,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{title:[]}),stopParser:true,template:false,
create:function(a,b){if((!a||!a.template)&&b&&!("href"in a)&&!("content"in a)){var c=dojo.doc.createDocumentFragment();for(b=dojo.byId(b);b.firstChild;)c.appendChild(b.firstChild);a=dojo.delegate(a,{content:c})}this.inherited(arguments,[a,b])},postMixInProperties:function(){this.inherited(arguments);var a=dojo.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=dojo.string.substitute(this.loadingMessage,a);this.errorMessage=dojo.string.substitute(this.errorMessage,a)},buildRendering:function(){this.inherited(arguments);
if(!this.containerNode)this.containerNode=this.domNode;this.domNode.title="";dojo.attr(this.domNode,"role")||dijit.setWaiRole(this.domNode,"group")},_startChildren:function(){this.inherited(arguments);this._contentSetter&&dojo.forEach(this._contentSetter.parseResults,function(a){if(!a._started&&!a._destroyed&&dojo.isFunction(a.startup)){a.startup();a._started=true}},this)},startup:function(){if(!this._started){this.inherited(arguments);this._isShown()&&this._onShow()}},setHref:function(a){dojo.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.",
"","2.0");return this.set("href",a)},_setHrefAttr:function(a){this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._set("href",a);if(this.preload||this._created&&this._isShown())this._load();else this._hrefChanged=true;return this.onLoadDeferred},setContent:function(a){dojo.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",a)},_setContentAttr:function(a){this._set("href",
"");this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this._created&&this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._setContent(a||"");this._isDownloaded=false;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&this._xhrDfd.fired==-1&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},uninitialize:function(){this._beingDestroyed&&this.cancel();this.inherited(arguments)},
destroyRecursive:function(){this._beingDestroyed||this.inherited(arguments)},resize:function(a,b){!this._wasShown&&this.open!==false&&this._onShow();this._resizeCalled=true;this._scheduleLayout(a,b)},_isShown:function(){if(this._childOfLayoutWidget){if(this._resizeCalled&&"open"in this)return this.open;return this._resizeCalled}else if("open"in this)return this.open;else{var a=this.domNode,b=this.domNode.parentNode;return a.style.display!="none"&&a.style.visibility!="hidden"&&!dojo.hasClass(a,"dijitHidden")&&
b&&b.style&&b.style.display!="none"}},_onShow:function(){if(this.href){if(!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))var a=this.refresh()}else this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments);this._wasShown=true;return a},refresh:function(){this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),
true);var a=this,b={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};dojo.isObject(this.ioArgs)&&dojo.mixin(b,this.ioArgs);var c=this._xhrDfd=(this.ioMethod||dojo.xhrGet)(b);c.addCallback(function(d){try{a._isDownloaded=true;a._setContent(d,false);a.onDownloadEnd()}catch(e){a._onError("Content",e)}delete a._xhrDfd;return d});c.addErrback(function(d){c.canceled||a._onError("Download",d);delete a._xhrDfd;return d});delete this._hrefChanged},_onLoadHandler:function(a){this._set("isLoaded",
true);try{this.onLoadDeferred.callback(a)}catch(b){console.error("Error "+this.widgetId+" running custom onLoad code: "+b.message)}},_onUnloadHandler:function(){this._set("isLoaded",false);try{this.onUnload()}catch(a){console.error("Error "+this.widgetId+" running custom onUnload code: "+a.message)}},destroyDescendants:function(){this.isLoaded&&this._onUnloadHandler();var a=this._contentSetter;dojo.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive()});if(a){dojo.forEach(a.parseResults,
function(b){b.destroyRecursive&&b.domNode&&b.domNode.parentNode==dojo.body()&&b.destroyRecursive()});delete a.parseResults}dojo.html._emptyNode(this.containerNode);delete this._singleChild},_setContent:function(a,b){this.destroyDescendants();var c=this._contentSetter;if(!(c&&c instanceof dojo.html._ContentSetter))c=this._contentSetter=new dojo.html._ContentSetter({node:this.containerNode,_onError:dojo.hitch(this,this._onError),onContentError:dojo.hitch(this,function(e){e=this.onContentError(e);try{this.containerNode.innerHTML=
e}catch(f){console.error("Fatal "+this.id+" could not change content due to "+f.message,f)}})});var d=dojo.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:this.parseOnLoad,parserScope:this.parserScope,startup:false,dir:this.dir,lang:this.lang},this._contentSetterParams||{});c.set(dojo.isObject(a)&&a.domNode?a.domNode:a,d);delete this._contentSetterParams;this.doLayout&&this._checkIfSingleChild();if(!b){if(this._started){this._startChildren();this._scheduleLayout()}this._onLoadHandler(a)}},
_onError:function(a,b,c){this.onLoadDeferred.errback(b);a=this["on"+a+"Error"].call(this,b);if(c)console.error(c,b);else a&&this._setContent(a,true)},_scheduleLayout:function(a,b){if(this._isShown())this._layout(a,b);else{this._needLayout=true;this._changeSize=a;this._resultSize=b}},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.Button"]){dojo._hasResource["dijit.form.Button"]=true;dojo.provide("dijit.form.Button");dojo.require("dijit.form._FormWidget");dojo.require("dijit._Container");dojo.require("dijit._HasDropDown");dojo.declare("dijit.form.Button",dijit.form._FormWidget,{label:"",showLabel:true,iconClass:"",type:"button",baseClass:"dijitButton",templateString:dojo.cache("dijit.form","templates/Button.html",'<span class="dijit dijitReset dijitInline"\n\t><span class="dijitReset dijitInline dijitButtonNode"\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdojoAttachPoint="titleNode,focusNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode"></span\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;</span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tid="${id}_label"\n\t\t\t\tdojoAttachPoint="containerNode"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdojoAttachPoint="valueNode"\n/></span>\n'),
attributeMap:dojo.delegate(dijit.form._FormWidget.prototype.attributeMap,{value:"valueNode"}),_onClick:function(a){if(this.disabled)return false;this._clicked();return this.onClick(a)},_onButtonClick:function(a){if(this._onClick(a)===false)a.preventDefault();else if(this.type=="submit"&&!(this.valueNode||this.focusNode).form)for(var b=this.domNode;b.parentNode;b=b.parentNode){var c=dijit.byNode(b);if(c&&typeof c._onSubmit=="function"){c._onSubmit(a);break}}else if(this.valueNode){this.valueNode.click();
a.preventDefault()}},buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.focusNode,false)},_fillContent:function(a){if(a&&(!this.params||!("label"in this.params)))this.set("label",a.innerHTML)},_setShowLabelAttr:function(a){this.containerNode&&dojo.toggleClass(this.containerNode,"dijitDisplayNone",!a);this._set("showLabel",a)},onClick:function(){return true},_clicked:function(){},setLabel:function(a){dojo.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",a)},_setLabelAttr:function(a){this._set("label",a);this.containerNode.innerHTML=a;if(this.showLabel==false&&!this.params.title)this.titleNode.title=dojo.trim(this.containerNode.innerText||this.containerNode.textContent||"")},_setIconClassAttr:function(a){dojo.replaceClass(this.iconNode,a||"dijitNoIcon",this.iconClass||"dijitNoIcon");this._set("iconClass",a)}});dojo.declare("dijit.form.DropDownButton",[dijit.form.Button,dijit._Container,dijit._HasDropDown],{baseClass:"dijitDropDownButton",
templateString:dojo.cache("dijit.form","templates/DropDownButton.html",'<span class="dijit dijitReset dijitInline"\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick" dojoAttachPoint="_buttonNode"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdojoAttachPoint="focusNode,titleNode,_arrowWrapperNode"\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\n\t\t\t\tdojoAttachPoint="iconNode"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tdojoAttachPoint="containerNode,_popupStateNode"\n\t\t\t\tid="${id}_label"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdojoAttachPoint="valueNode"\n/></span>\n'),
_fillContent:function(){if(this.srcNodeRef){var a=dojo.query("*",this.srcNodeRef);dijit.form.DropDownButton.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){if(!this.dropDown&&this.dropDownContainer){var a=dojo.query("[widgetId]",this.dropDownContainer)[0];this.dropDown=dijit.byNode(a);delete this.dropDownContainer}this.dropDown&&dijit.popup.hide(this.dropDown);this.inherited(arguments)}},isLoaded:function(){var a=this.dropDown;
return!!a&&(!a.href||a.isLoaded)},loadDropDown:function(){var a=this.dropDown;if(a)if(this.isLoaded())this.openDropDown();else{var b=dojo.connect(a,"onLoad",this,function(){dojo.disconnect(b);this.openDropDown()});a.refresh()}},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}});dojo.declare("dijit.form.ComboButton",dijit.form.DropDownButton,{templateString:dojo.cache("dijit.form","templates/ComboButton.html",'<table class="dijit dijitReset dijitInline dijitLeft"\n\tcellspacing=\'0\' cellpadding=\'0\' role="presentation"\n\t><tbody role="presentation"><tr role="presentation"\n\t\t><td class="dijitReset dijitStretch dijitButtonNode" dojoAttachPoint="buttonNode" dojoAttachEvent="ondijitclick:_onButtonClick,onkeypress:_onButtonKeyPress"\n\t\t><div id="${id}_button" class="dijitReset dijitButtonContents"\n\t\t\tdojoAttachPoint="titleNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><div class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode" role="presentation"></div\n\t\t\t><div class="dijitReset dijitInline dijitButtonText" id="${id}_label" dojoAttachPoint="containerNode" role="presentation"></div\n\t\t></div\n\t\t></td\n\t\t><td id="${id}_arrow" class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\n\t\t\tdojoAttachPoint="_popupStateNode,focusNode,_buttonNode"\n\t\t\tdojoAttachEvent="onkeypress:_onArrowKeyPress"\n\t\t\ttitle="${optionsTitle}"\n\t\t\trole="button" aria-haspopup="true"\n\t\t\t><div class="dijitReset dijitArrowButtonInner" role="presentation"></div\n\t\t\t><div class="dijitReset dijitArrowButtonChar" role="presentation">&#9660;</div\n\t\t></td\n\t\t><td style="display:none !important;"\n\t\t\t><input ${!nameAttrSetting} type="${type}" value="${value}" dojoAttachPoint="valueNode"\n\t\t/></td></tr></tbody\n></table>\n'),
attributeMap:dojo.mixin(dojo.clone(dijit.form.Button.prototype.attributeMap),{id:"",tabIndex:["focusNode","titleNode"],title:"titleNode"}),optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyPress:function(a){if(a.charOrCode==dojo.keys[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]){dijit.focus(this._popupStateNode);dojo.stopEvent(a)}},_onArrowKeyPress:function(a){if(a.charOrCode==
dojo.keys[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]){dijit.focus(this.titleNode);dojo.stopEvent(a)}},focus:function(a){this.disabled||dijit.focus(a=="start"?this.titleNode:this._popupStateNode)}});dojo.declare("dijit.form.ToggleButton",dijit.form.Button,{baseClass:"dijitToggleButton",checked:false,attributeMap:dojo.mixin(dojo.clone(dijit.form.Button.prototype.attributeMap),{checked:"focusNode"}),_clicked:function(){this.set("checked",!this.checked)},_setCheckedAttr:function(a,b){this._set("checked",
a);dojo.attr(this.focusNode||this.domNode,"checked",a);dijit.setWaiState(this.focusNode||this.domNode,"pressed",a);this._handleOnChange(a,b)},setChecked:function(a){dojo.deprecated("setChecked("+a+") is deprecated. Use set('checked',"+a+") instead.","","2.0");this.set("checked",a)},reset:function(){this._hasBeenBlurred=false;this.set("checked",this.params.checked||false)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.DropDownButton"]){dojo._hasResource["dijit.form.DropDownButton"]=true;dojo.provide("dijit.form.DropDownButton");dojo.require("dijit.form.Button")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.ToggleButton"]){dojo._hasResource["dijit.form.ToggleButton"]=true;dojo.provide("dijit.form.ToggleButton");dojo.require("dijit.form.Button")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.TooltipDialog"]){dojo._hasResource["dijit.TooltipDialog"]=true;dojo.provide("dijit.TooltipDialog");dojo.require("dijit.layout.ContentPane");dojo.require("dijit._Templated");dojo.require("dijit.form._FormMixin");dojo.require("dijit._DialogMixin");dojo.declare("dijit.TooltipDialog",[dijit.layout.ContentPane,dijit._Templated,dijit.form._FormMixin,dijit._DialogMixin],{title:"",doLayout:false,autofocus:true,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,
templateString:dojo.cache("dijit","templates/TooltipDialog.html",'<div role="presentation" tabIndex="-1">\n\t<div class="dijitTooltipContainer" role="presentation">\n\t\t<div class ="dijitTooltipContents dijitTooltipFocusNode" dojoAttachPoint="containerNode" role="dialog"></div>\n\t</div>\n\t<div class="dijitTooltipConnector" role="presentation"></div>\n</div>\n'),_setTitleAttr:function(a){this.containerNode.title=a;this._set("title",a)},postCreate:function(){this.inherited(arguments);this.connect(this.containerNode,
"onkeypress","_onKey")},orient:function(a,c,b){a="dijitTooltipAB"+(b.charAt(1)=="L"?"Left":"Right")+" dijitTooltip"+(b.charAt(0)=="T"?"Below":"Above");dojo.replaceClass(this.domNode,a,this._currentOrientClass||"");this._currentOrientClass=a},focus:function(){this._getFocusItems(this.containerNode);dijit.focus(this._firstFocusItem)},onOpen:function(a){this.orient(this.domNode,a.aroundCorner,a.corner);this._onShow()},onClose:function(){this.onHide()},_onKey:function(a){var c=a.target,b=dojo.keys;a.charOrCode===
b.TAB&&this._getFocusItems(this.containerNode);var d=this._firstFocusItem==this._lastFocusItem;if(a.charOrCode==b.ESCAPE){setTimeout(dojo.hitch(this,"onCancel"),0);dojo.stopEvent(a)}else if(c==this._firstFocusItem&&a.shiftKey&&a.charOrCode===b.TAB){d||dijit.focus(this._lastFocusItem);dojo.stopEvent(a)}else if(c==this._lastFocusItem&&a.charOrCode===b.TAB&&!a.shiftKey){d||dijit.focus(this._firstFocusItem);dojo.stopEvent(a)}else a.charOrCode===b.TAB&&a.stopPropagation()}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.Menu"]){dojo._hasResource["dijit.Menu"]=true;dojo.provide("dijit.Menu");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._KeyNavContainer");dojo.require("dijit._Templated");dojo.require("dijit.MenuItem");dojo.require("dijit.PopupMenuItem");dojo.require("dijit.CheckedMenuItem");dojo.require("dijit.MenuSeparator");dojo.declare("dijit._MenuBase",[dijit._Widget,dijit._Templated,dijit._KeyNavContainer],{parentMenu:null,popupDelay:500,startup:function(){if(!this._started){dojo.forEach(this.getChildren(),
function(a){a.startup()});this.startupKeyNavChildren();this.inherited(arguments)}},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.focusedChild._onClick(a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(false);a.focusedChild=
this.currentPopup.from_item;a.focusedChild._setSelected(true);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive){this.focusChild(a);if(this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer)this.hover_timer=setTimeout(dojo.hitch(this,"_openPopup"),this.popupDelay)}this.focusedChild&&this.focusChild(a);this._hoveredChild=a},_onChildBlur:function(a){this._stopPopupTimer();a._setSelected(false);var b=a.popup;if(b){this._stopPendingCloseTimer(b);
b._pendingClose_timer=setTimeout(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;dijit.popup.close(b)},this.popupDelay)}},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null},_stopPopupTimer:function(){if(this.hover_timer){clearTimeout(this.hover_timer);this.hover_timer=null}},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer){clearTimeout(a._pendingClose_timer);a._pendingClose_timer=null}},
_stopFocusTimer:function(){if(this._focus_timer){clearTimeout(this._focus_timer);this._focus_timer=null}},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){typeof this.isShowingNow=="undefined"&&this._markActive();this.focusChild(a);if(a.disabled)return false;if(a.popup)this._openPopup();else{this.onExecute();a.onClick(b)}},_openPopup:function(){this._stopPopupTimer();var a=this.focusedChild;if(a){var b=a.popup;if(!b.isShowingNow){if(this.currentPopup){this._stopPendingCloseTimer(this.currentPopup);
dijit.popup.close(this.currentPopup)}b.parentMenu=this;b.from_item=a;var c=this;dijit.popup.open({parent:this,popup:b,around:a.domNode,orient:this._orient||(this.isLeftToRight()?{TR:"TL",TL:"TR",BR:"BL",BL:"BR"}:{TL:"TR",TR:"TL",BL:"BR",BR:"BL"}),onCancel:function(){c.focusChild(a);c._cleanUp();a._setSelected(true);c.focusedChild=a},onExecute:dojo.hitch(this,"_cleanUp")});this.currentPopup=b;b.connect(b.domNode,"onmouseenter",dojo.hitch(c,"_onPopupHover"));if(b.focus)b._focus_timer=setTimeout(dojo.hitch(b,
function(){this._focus_timer=null;this.focus()}),0)}}},_markActive:function(){this.isActive=true;dojo.replaceClass(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=true;this._markActive()},_markInactive:function(){this.isActive=false;dojo.replaceClass(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=false;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup){dijit._curFocus&&
dojo.isDescendant(dijit._curFocus,this.currentPopup.domNode)&&this.focusedChild.focusNode.focus();dijit.popup.close(this.currentPopup);this.currentPopup=null}if(this.focusedChild){this.focusedChild._setSelected(false);this.focusedChild._onUnhover();this.focusedChild=null}},_onItemFocus:function(a){this._hoveredChild&&this._hoveredChild!=a&&this._hoveredChild._onUnhover()},_onBlur:function(){this._cleanUp();this.inherited(arguments)},_cleanUp:function(){this._closeChild();typeof this.isShowingNow==
"undefined"&&this._markInactive()}});dojo.declare("dijit.Menu",dijit._MenuBase,{constructor:function(){this._bindings=[]},templateString:dojo.cache("dijit","templates/Menu.html",'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}" dojoAttachEvent="onkeypress:_onKeyPress" cellspacing="0">\n\t<tbody class="dijitReset" dojoAttachPoint="containerNode"></tbody>\n</table>\n'),baseClass:"dijitMenu",targetNodeIds:[],contextMenuForWindow:false,leftClickToOpen:false,
refocus:true,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(dojo.body()):dojo.forEach(this.targetNodeIds,this.bindDomNode,this);var a=dojo.keys,b=this.isLeftToRight();this._openSubMenuKey=b?a.RIGHT_ARROW:a.LEFT_ARROW;this._closeSubMenuKey=b?a.LEFT_ARROW:a.RIGHT_ARROW;this.connectKeyNavHandlers([a.UP_ARROW],[a.DOWN_ARROW])},_onKeyPress:function(a){if(!(a.ctrlKey||a.altKey))switch(a.charOrCode){case this._openSubMenuKey:this._moveToPopup(a);dojo.stopEvent(a);break;case this._closeSubMenuKey:if(this.parentMenu)this.parentMenu._isMenuBar?
this.parentMenu.focusPrev():this.onCancel(false);else dojo.stopEvent(a)}},_iframeContentWindow:function(a){return dojo.window.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&dojo.doc.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&dojo.doc.frames[a.name]&&dojo.doc.frames[a.name].document||null},bindDomNode:function(a){a=dojo.byId(a);var b;if(a.tagName.toLowerCase()=="iframe"){var c=
a,e=this._iframeContentWindow(c);b=dojo.withGlobal(e,dojo.body)}else b=a==dojo.body()?dojo.doc.documentElement:a;var d={node:a,iframe:c};dojo.attr(a,"_dijitMenu"+this.id,this._bindings.push(d));var f=dojo.hitch(this,function(h){return[dojo.connect(h,this.leftClickToOpen?"onclick":"oncontextmenu",this,function(g){dojo.stopEvent(g);this._scheduleOpen(g.target,c,{x:g.pageX,y:g.pageY})}),dojo.connect(h,"onkeydown",this,function(g){if(g.shiftKey&&g.keyCode==dojo.keys.F10){dojo.stopEvent(g);this._scheduleOpen(g.target,
c)}})]});d.connects=b?f(b):[];if(c){d.onloadHandler=dojo.hitch(this,function(){var h=this._iframeContentWindow(c);b=dojo.withGlobal(h,dojo.body);d.connects=f(b)});c.addEventListener?c.addEventListener("load",d.onloadHandler,false):c.attachEvent("onload",d.onloadHandler)}},unBindDomNode:function(a){var b;try{b=dojo.byId(a)}catch(c){return}a="_dijitMenu"+this.id;if(b&&dojo.hasAttr(b,a)){var e=dojo.attr(b,a)-1,d=this._bindings[e];dojo.forEach(d.connects,dojo.disconnect);var f=d.iframe;if(f)f.removeEventListener?
f.removeEventListener("load",d.onloadHandler,false):f.detachEvent("onload",d.onloadHandler);dojo.removeAttr(b,a);delete this._bindings[e]}},_scheduleOpen:function(a,b,c){if(!this._openTimer)this._openTimer=setTimeout(dojo.hitch(this,function(){delete this._openTimer;this._openMyself({target:a,iframe:b,coords:c})}),1)},_openMyself:function(a){function b(){i.refocus&&dijit.focus(j);dijit.popup.close(i)}var c=a.target,e=a.iframe;if(a=a.coords){if(e){c=dojo.position(e,true);var d=this._iframeContentWindow(e);
d=dojo.withGlobal(d,"_docScroll",dojo);var f=dojo.getComputedStyle(e),h=dojo._toPixelValue,g=(dojo.isIE&&dojo.isQuirks?0:h(e,f.paddingLeft))+(dojo.isIE&&dojo.isQuirks?h(e,f.borderLeftWidth):0);e=(dojo.isIE&&dojo.isQuirks?0:h(e,f.paddingTop))+(dojo.isIE&&dojo.isQuirks?h(e,f.borderTopWidth):0);a.x+=c.x+g-d.x;a.y+=c.y+e-d.y}}else{a=dojo.position(c,true);a.x+=10;a.y+=10}var i=this,j=dijit.getFocus(this);dijit.popup.open({popup:this,x:a.x,y:a.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});
this.focus();this._onBlur=function(){this.inherited("_onBlur",arguments);dijit.popup.close(this)}},uninitialize:function(){dojo.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})};
dojo.provide('bizbuysell.wsj');

var BBSWSJ = (function()
{
  var bbsWSJ = {};
  var currentSearchType = 'eb';
  var contentProviderUrl = 'http://www.bizbuysell.com/';
  
  var bbsWidgetContainer = document.getElementById(
    'bbsWidgetContainer');
  
  bbsWSJ.SearchTypeToggle = function(
    searchType)
  {
    if (typeof(searchType) == 'undefined')
    {
      searchType = 'eb';
    }
    
    setSearchType(
      searchType);
      
    var hidCurrentSearchType = document.getElementById(
      'hidCurrentSearchType');
      
    if (hidCurrentSearchType)
    {
      hidCurrentSearchType.value = searchType;
    }
  };
  
  bbsWSJ.LoadCounties = function(
    ddlCountiesClientID,
    maintainSelectedCounty)
  {
    if (!maintainSelectedCounty)
    {
      var hidSelectedCountyCode = document.getElementById(
        'hidSelectedCountyCode');
        
      if (hidSelectedCountyCode)
      {
        hidSelectedCountyCode.value = '0';
      }
    }
    
    if ((typeof(ddlCountiesClientID) != 'undefined') &&
      (ddlCountiesClientID.length > 0))
    {
      var ddlCounties = document.getElementById(
        ddlCountiesClientID);
          
      if (ddlCounties)
      {
        ddlCounties.disabled = true;
        
        if ((bbsWidgetContainer) &&
          (typeof(this.selectedIndex) != 'undefined') &&
          (this.selectedIndex > 0) &&
          (typeof(this.value) != 'undefined') &&
          (this.value.length > 0) &&
          (this.value.toUpperCase() != 'XX'))
        {
          var callBackFunctionName = (
            'loadCountiesCallBack_' +
            Math.floor(Math.random() * 1000));
            
          var webServiceScript = document.createElement(
            'script');
            
          webServiceScript.type = 'text/javascript';
          
          webServiceScript.setAttribute(
            'async', 
            'true');
          
          webServiceScript.src = (
            contentProviderUrl +
            'cobranding/Services/Geo.get.asmx/GetCountiesByRegionLegacyStateCode?selectedRegionLegacyStateCode="' +
            this.value +
            '"&callback="BBSWSJ.' +
            callBackFunctionName +
            '"');
            
          bbsWSJ[callBackFunctionName] = function(
            counties)
          {
            if ((typeof(counties) != 'undefined') &&
              (typeof(counties.length) != 'undefined') &&
              (counties.length > 0))
            {
              ddlCounties.length = 0;
              
              ddlCounties.options.add(
                new Option(
                  'All Counties',
                  ''));
                  
              var selectedCounty = 0;
                  
              var hidSelectedCountyCode = document.getElementById(
                'hidSelectedCountyCode');
                
              if ((hidSelectedCountyCode) &&
                (parseInt(hidSelectedCountyCode.value, 10) > 0))
              {
                selectedCounty = parseInt(hidSelectedCountyCode.value, 10);
              }
                
              for (var index = 0; index < counties.length; index++)
              {
                ddlCounties.options.add(
                  new Option(
                    counties[index].CountyName,
                    counties[index].CountyCode));
              }
              
              if (selectedCounty > 0)
              {
                ddlCounties.value = selectedCounty;
              }
              
              ddlCounties.disabled = false;
            }
            
            if (webServiceScript)
            {
              bbsWidgetContainer.removeChild(
                webServiceScript);
            }
            
            delete bbsWSJ[callBackFunctionName];
          };
            
          bbsWidgetContainer.appendChild(
            webServiceScript);
        }
        else
        {
          ddlCounties.options[0] = new Option(
            'County',
            '');
            
          ddlCounties.options.length = 1;
        }
      }
    }
  };
  
  bbsWSJ.SetSelectedCountyCode = function(
    countyCode)
  {
    if ((typeof(countyCode) != 'undefined') &&
      (countyCode.length > 0) &&
      (parseInt(countyCode, 10) > 0))
    {
      var hidSelectedCountyCode = document.getElementById(
        'hidSelectedCountyCode');
        
      if (hidSelectedCountyCode)
      {
        hidSelectedCountyCode.value = countyCode;
      }
    }
  };
  
  bbsWSJ.OnKeywordFocus = function()
  {
    this.className = this.className.replace(
      /\s+?default/, 
      '');
  };
  
  bbsWSJ.OnKeywordBlur = function()
  {
    if (this.value.length == 0)
    {
      this.className += (
        ((this.className.length > 0) ? ' ' : '') + 
        'default');
    }
  };
  
  function setSearchType(
    searchType)
  {
    if ((typeof(searchType) == 'undefined') ||
      (typeof(searchType.length) == 'undefined') ||
      (searchType.length <= 0))
    {
      searchType = 'eb';
    }
    
    currentSearchType = searchType;
    
    var searchTypeContainer = document.getElementById(
      'searchTypeContainer');
      
    if (searchTypeContainer)
    {
      searchTypeContainer.className = searchType;
    }
  }
  
  function attachEvent(
    eventName,
    eventHandler)
  {
    if (window.attachEvent)
    {
      window.attachEvent(
        ('on' +
          eventName),
        eventHandler);
    }
    else
    {
      window.addEventListener(
        eventName,
        eventHandler,
        false);
    }
  }
  
  attachEvent(
    'load',
    function()
    {
      var ddlBFSCategories = document.getElementById(
        'ddlBFSCategories');
        
      if ((ddlBFSCategories) &&
        (ddlBFSCategories.selectedIndex > 0) &&
        (ddlBFSCategories.value.toUpperCase() == 'XX'))
      {
        ddlBFSCategories.selectedIndex = 0;
      }
      
      var ddlBizOpCategories = document.getElementById(
        'ddlBizOpCategories');
        
      if ((ddlBizOpCategories) &&
        (ddlBizOpCategories.selectedIndex > 0) &&
        (ddlBizOpCategories.value.toUpperCase() == 'XX'))
      {
        ddlBizOpCategories.selectedIndex = 0;
      }
      
      var txtKeywords = document.getElementById(
        'txtKeywords');
        
      if ((txtKeywords) &&
        (txtKeywords.value.length > 0))
      {
        txtKeywords.className = txtKeywords.className.replace(
          /\s+?default/, 
          '');
      }
      
      var hidCurrentSearchType = document.getElementById(
        'hidCurrentSearchType');
        
      if ((hidCurrentSearchType) &&
        (hidCurrentSearchType.value.length > 0))
      {
        setSearchType(
          hidCurrentSearchType.value);
      }
      
      var ddlBFSStates = document.getElementById(
        'ddlBFSStates');
        
      if (ddlBFSStates)
      {
        bbsWSJ.LoadCounties.call(
          ddlBFSStates,
          'ddlBFSCounties',
          true);
      }
      
      var ddlBizOpStates = document.getElementById(
        'ddlBizOpStates');
        
      if (ddlBizOpStates)
      {
        bbsWSJ.LoadCounties.call(
          ddlBizOpStates,
          'ddlBizOpCounties',
          true);
      }
    });
  
  return bbsWSJ;
})();
if (typeof dojo !== "undefined") {
  dojo.provide("blueKai.blueKai");
}

/* global blueKai document unescape */
if (typeof blueKai === "undefined") {
	blueKai = {};
}
var KRUXSetup = {
	pubid:"1c6ac852-8938-481a-84b8-4806affc8c13", 
    async: true

};
blueKai.blueKai = {
	dataJson :{},
	timercounter:0,	
	adDivs:[],
	bk_track:function(check, data){
		if(check && document.location.protocol.indexOf('https')==-1){
			if(data){
				this.dataJson = data;
				this.sendBlueKai();
			}else{
				this.adDivs = this.getbyclass();	
				if(!this.getData()){
					return;
				}
			}
		}
	},
	sendBlueKai: function(){
		/* 2.4.0-31349 */ 
		if(typeof BKTAG=="undefined"||!BKTAG){var BKTAG=(function(){var params=[];var doTagged=false;var _={getKwds:function(){var meta=document.getElementsByTagName('meta');var kwds=[];var ii=meta.length;for(var i=0;i<ii;i++){if(meta[i].name&&meta[i].name.toLowerCase()=='keywords'){kwds.push(meta[i].content)}}return kwds.join(',')},addBkParam:function(k,v){self.addParam('phint','__bk_'+k,v)}};var self={_dest:null,createHidden:function(k,v){var myInput=document.createElement("input");myInput.setAttribute('type','hidden');myInput.setAttribute("name",k);myInput.setAttribute("value",v);return myInput},doTag:function(site,limit,excludeBkParams,allowMultipleCalls){var bkFrame=null;if(doTagged&&!(allowMultipleCalls===true)){return}doTagged=true;params.unshift('r='+parseInt(Math.random()*99999));params.unshift('limit='+limit);params.unshift('ret=html');if(!excludeBkParams){self.addParam('phint','__bk_k',document.title);self.addParam('phint','__bk_k',_.getKwds())}self._dest=('https:'==document.location.protocol?'https://stags':'http://tags')+'.bluekai.com/site/'+site+'?'+params.join('&');self._dest=self._dest.substr(0,2000);var isOpera=false,isIE=false;if(typeof(window.opera)!='undefined'){isOpera=true}var ieIndex=navigator.userAgent.indexOf('Internet Explorer');if(!isOpera&&ieIndex>-1){isIE=true};if(!isIE){bkFrame=document.createElement("iframe");bkFrame.setAttribute('height','1');bkFrame.setAttribute('width','1');bkFrame.setAttribute("name","__bkframe");bkFrame.setAttribute("frameborder","0");bkFrame.setAttribute("src",self._dest);document.body.appendChild(bkFrame)}else{bkFrame=document.createElement("div");bkFrame.innerHTML='<iframe name="__bkframe" height="1" width="1" frameborder="0" src="'+self._dest+'" />';document.body.appendChild(bkFrame)}params=[]},addParam:function(type,k,v){if(v){var val=k+'='+v;val=encodeURIComponent(val);params.push(type+'='+val)}},addValue:function(k,v){if(v){var val=encodeURIComponent(v);params.push(k+'='+val)}}};return self})();function bk_addPageCtx(k,v){BKTAG.addParam('phint',k,v)}function bk_addVar(k,v){BKTAG.addValue(k,v)}function bk_doJSTag(site,limit,allowMultipleCalls){BKTAG.doTag(site,limit,false,allowMultipleCalls)}function bk_doSendData(site,limit,excludeBkParams,allowMultipleCalls){BKTAG.doTag(site,limit,excludeBkParams,allowMultipleCalls)}}		
		
		for(var key in this.dataJson ) {
			if(key && this.dataJson[key] != "" ) {
				bk_addPageCtx(key, this.dataJson[key]);
			}
		}
		
		var siteIds = { 
				"wsj.com" : "4454", 
				"barrons.com" : "4457", 
				"marketwatch.com":"4455", 
				"smartmoney.com":"4458", 
				"allthingsd.com":"4459", 
				"fins.com":"4456", 
				"wsjwine.com":"4461",	
				"efinancialnews.com":"4460"
					};
		var limit = 10;  //( we can tune it later )
		var site = document.location.href;
		var siteId = this.getSiteId(siteIds);
		this.makeFrame();
		bk_doSendData(siteId, limit, false);
//		this.sendKrux();
		var url = document.URL.toLowerCase();
		if(url.indexOf('bluekaidebug=yes')>0) this.showData();
	},
	sendKrux: function(){

		KRUXSetup['site'] = this.dataJson['primaryProduct'];
		KRUXSetup['section'] = this.dataJson['section'];
		KRUXSetup['subSection'] = this.dataJson['articleType'];

		this.include("http://sj.wsj.net/internal/krux.js");
		
	},
	getSiteId:function(siteIds){
		var site = document.location.href;
		var defaultKey ="";
		for( key in siteIds ) {
			if(site.indexOf(key)>-1){
				return siteIds[key];
			}else if(".wsj.com".indexOf(key)>-1){
				defaultKey = siteIds[key];
			} 
		}		
		return defaultKey;
	},
	getData:function(){

		 this.dataJson = { 
			"serverDomain" : s?s.server:"",
			"primaryProduct" : s?s.channel:"",
			"pageName" : s?s.pageName:"",
			"section" : s?s.prop2:"",
			"articleType" : s?s.prop3:"",
			"subSection" : s?s.prop26:"",
			"contentType" : s?s.prop19:"",
			"encryptedUUID" : s?s.prop25:"",
			"contentChannel" : s?s.prop1:"",
			"isSub" : s?s.prop27:"",
			"edition" : s?s.prop24:"",
			"referrer" : document.referrer!=""?document.referrer.split('/')[2]:""
				};
		 if(typeof this.dataJson.subsection=="undefined" || this.dataJson.subsection=="")this.dataJson.subsection=this.dataJson.section;
		return this.getAdsData();
	},
	getAdsData:function(){
		if(this.adDivs.length>0){		
			var countSize=1;
			var countZone=1;
			var countSection=1;						
			var strSection = ",";
			var strZone = ",";
			var strSize = ",";
			for(i=0;i<this.adDivs.length;i++){
				if((this.adDivs[i].innerHTML.replace(/^\s+|\s+$/g,"")!='' && this.adDivs[i].getElementsByTagName('iframe')[0]!=undefined)|| this.timercounter>5){
					var ad=this.adDivs[i].getElementsByTagName('iframe')[0];
					if(ad){
						var ind=ad.src.indexOf('doubleclick.net');
						var height=ad.height;
						var width=ad.width;	
						if(ind>1 && height >2 && width >2){
							var str=ad.src.substring(ind);
							if(strSize.indexOf(","+str+",")==-1){
								strSize = strSize+width+"x"+height + ",";
								this.dataJson['adSize'+(countSize++)] = width+"x"+height;
								if(countSize>10)break;
							}
							if(str.split('/')[3]){
								var zone = str.split('/')[3].split(';')[0];
								if(strZone.indexOf(","+zone+",")==-1){
									strZone = strZone + zone+",";
									this.dataJson['adZone'+(countZone++)] = zone;
								}
								var section = str.split('/')[2];
								if(strSection.indexOf(","+section+",")==-1){
									strSection = strSection + section+",";
									this.dataJson['adSection'+(countSection++)] = section;
								}
	
							}
						}
					}
				}else{
					this.timercounter++;
					window.setTimeout('blueKai.blueKai.getAdsData()',1000);
					return false;
				}
				
				
			}
			
		}
		this.sendBlueKai();
	},
	makeFrame:function () {
	   var ifrm = document.createElement("IFRAME");
	   ifrm.setAttribute("src", "javascript:void(0)");
	   ifrm.setAttribute("name", "__bkframe");
	   ifrm.setAttribute("frameborder", 0);
	   ifrm.style.width = 0+"px";
	   ifrm.style.height = 0+"px";
	   document.body.appendChild(ifrm);
	},
	include: function(file){
		var script  = document.createElement('script');
		script.src  = file;
		script.type = 'text/javascript';
		script.defer = true;
		document.getElementsByTagName('head').item(0).appendChild(script);
	},
	showData:function(){
		var out = '';
		for (var data in blueKai.blueKai.dataJson) {
			if(blueKai.blueKai.dataJson[data]!=null && blueKai.blueKai.dataJson[data].replace(/^\s+|\s+$/g,"")!=""){
				out += data + ': ' + blueKai.blueKai.dataJson[data] + '\n';
			}
		}
		alert(out);		
	},
	getbyclass: function(){
	  var elements = document.getElementsByTagName("div");
	  var result = [];
	  var attName= "class";
	  if(elements[0].getAttribute("className")!=null){
		  attName= "className";
	  }
	  for(z=0;z<elements.length;z++){
		  if(elements[z].getAttribute(attName) && elements[z].getAttribute(attName).match(/adSummary/)){
	      result.push(elements[z]);
	    }
	  }
	  return result;
	}

};
/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  COMMIT: c93da0623f1d30ebcb065e94a0476d8275225c72
 *  URL: https://github.com/twitter/hogan.js/commits/master/lib/compiler.js
 *  DATE: Apr 17, 2012
 *
 *  NOTE: one more modification (dojox.hogan) at the end of the file
 */

dojo.provide("hogan._compiler");

(function (Hogan) {
  // Setup regex  assignments
  // remove whitespace according to Mustache spec
  var rIsWhitespace = /\S/,
      rQuot = /\"/g,
      rNewline =  /\n/g,
      rCr = /\r/g,
      rSlash = /\\/g;

  Hogan.tags = {
    '#': 1, '^': 2, '<': 3, '$': 4,
    '/': 5, '!': 6, '>': 7, '=': 8, '_v': 9,
    '{': 10, '&': 11, '_t': 12
  };

  Hogan.scan = function scan(text, delimiters) {
    var len = text.length,
        IN_TEXT = 0,
        IN_TAG_TYPE = 1,
        IN_TAG = 2,
        state = IN_TEXT,
        tagType = null,
        tag = null,
        buf = '',
        tokens = [],
        seenTag = false,
        i = 0,
        lineStart = 0,
        otag = '{{',
        ctag = '}}';

    function addBuf() {
      if (buf.length > 0) {
        tokens.push({tag: '_t', text: new String(buf)});
        buf = '';
      }
    }

    function lineIsWhitespace() {
      var isAllWhitespace = true;
      for (var j = lineStart; j < tokens.length; j++) {
        isAllWhitespace =
          (Hogan.tags[tokens[j].tag] < Hogan.tags['_v']) ||
          (tokens[j].tag == '_t' && tokens[j].text.match(rIsWhitespace) === null);
        if (!isAllWhitespace) {
          return false;
        }
      }

      return isAllWhitespace;
    }

    function filterLine(haveSeenTag, noNewLine) {
      addBuf();

      if (haveSeenTag && lineIsWhitespace()) {
        for (var j = lineStart, next; j < tokens.length; j++) {
          if (tokens[j].text) {
            if ((next = tokens[j+1]) && next.tag == '>') {
              // set indent to token value
              next.indent = tokens[j].text.toString()
            }
            tokens.splice(j, 1);
          }
        }
      } else if (!noNewLine) {
        tokens.push({tag:'\n'});
      }

      seenTag = false;
      lineStart = tokens.length;
    }

    function changeDelimiters(text, index) {
      var close = '=' + ctag,
          closeIndex = text.indexOf(close, index),
          delimiters = trim(
            text.substring(text.indexOf('=', index) + 1, closeIndex)
          ).split(' ');

      otag = delimiters[0];
      ctag = delimiters[1];

      return closeIndex + close.length - 1;
    }

    if (delimiters) {
      delimiters = delimiters.split(' ');
      otag = delimiters[0];
      ctag = delimiters[1];
    }

    for (i = 0; i < len; i++) {
      if (state == IN_TEXT) {
        if (tagChange(otag, text, i)) {
          --i;
          addBuf();
          state = IN_TAG_TYPE;
        } else {
          if (text.charAt(i) == '\n') {
            filterLine(seenTag);
          } else {
            buf += text.charAt(i);
          }
        }
      } else if (state == IN_TAG_TYPE) {
        i += otag.length - 1;
        tag = Hogan.tags[text.charAt(i + 1)];
        tagType = tag ? text.charAt(i + 1) : '_v';
        if (tagType == '=') {
          i = changeDelimiters(text, i);
          state = IN_TEXT;
        } else {
          if (tag) {
            i++;
          }
          state = IN_TAG;
        }
        seenTag = i;
      } else {
        if (tagChange(ctag, text, i)) {
          tokens.push({tag: tagType, n: trim(buf), otag: otag, ctag: ctag,
                       i: (tagType == '/') ? seenTag - otag.length : i + ctag.length});
          buf = '';
          i += ctag.length - 1;
          state = IN_TEXT;
          if (tagType == '{') {
            if (ctag == '}}') {
              i++;
            } else {
              cleanTripleStache(tokens[tokens.length - 1]);
            }
          }
        } else {
          buf += text.charAt(i);
        }
      }
    }

    filterLine(seenTag, true);

    return tokens;
  }

  function cleanTripleStache(token) {
    if (token.n.substr(token.n.length - 1) === '}') {
      token.n = token.n.substring(0, token.n.length - 1);
    }
  }

  function trim(s) {
    if (s.trim) {
      return s.trim();
    }

    return s.replace(/^\s*|\s*$/g, '');
  }

  function tagChange(tag, text, index) {
    if (text.charAt(index) != tag.charAt(0)) {
      return false;
    }

    for (var i = 1, l = tag.length; i < l; i++) {
      if (text.charAt(index + i) != tag.charAt(i)) {
        return false;
      }
    }

    return true;
  }

  // the tags allowed inside super templates
  var allowedInSuper = {'_t': true, '\n': true, '$': true, '/': true};

  function buildTree(tokens, kind, stack, customTags) {
    var instructions = [],
        opener = null,
        tail = null,
        token = null;

    tail = stack[stack.length - 1];

    while (tokens.length > 0) {
      token = tokens.shift();

      if (tail && tail.tag == '<' && !(token.tag in allowedInSuper)) {
        throw new Error('Illegal content in < super tag.');
      }

      if (Hogan.tags[token.tag] <= Hogan.tags['$'] || isOpener(token, customTags)) {
        stack.push(token);
        token.nodes = buildTree(tokens, token.tag, stack, customTags);
      } else if (token.tag == '/') {
        if (stack.length === 0) {
          throw new Error('Closing tag without opener: /' + token.n);
        }
        opener = stack.pop();
        if (token.n != opener.n && !isCloser(token.n, opener.n, customTags)) {
          throw new Error('Nesting error: ' + opener.n + ' vs. ' + token.n);
        }
        opener.end = token.i;
        return instructions;
      } else if (token.tag == '\n') {
        token.last = (tokens.length == 0) || (tokens[0].tag == '\n');
      }

      instructions.push(token);
    }

    if (stack.length > 0) {
      throw new Error('missing closing tag: ' + stack.pop().n);
    }

    return instructions;
  }

  function isOpener(token, tags) {
    for (var i = 0, l = tags.length; i < l; i++) {
      if (tags[i].o == token.n) {
        token.tag = '#';
        return true;
      }
    }
  }

  function isCloser(close, open, tags) {
    for (var i = 0, l = tags.length; i < l; i++) {
      if (tags[i].c == close && tags[i].o == open) {
        return true;
      }
    }
  }

  function stringifyFunctions(obj) {
    var items = [];
    for (var key in obj) {
      items.push('"' + esc(key) + '": function(c,p,t) {' + obj[key] + '}');
    }
    return "{ " + items.join(",") + " }";
  }

  function stringifyPartials(codeObj) {
    var partials = [];
    for (var key in codeObj.partials) {
      partials.push('"' + esc(key) + '":{name:"' + esc(codeObj.partials[key].name) + '", ' + stringifyPartials(codeObj.partials[key]) + "}");
    }
    return "partials: {" + partials.join(",") + "}, subs: " + stringifyFunctions(codeObj.subs);
  }

  Hogan.stringify = function(codeObj, text, options) {
    return "{code: function (c,p,i) { " + Hogan.wrapMain(codeObj.code) + " }," + stringifyPartials(codeObj) +  "}";
  }

  var serialNo = 0;
  Hogan.generate = function(tree, text, options) {
    serialNo = 0;
    var context = { code: '', subs: {}, partials: {} };
    Hogan.walk(tree, context);

    if (options.asString) {
      return this.stringify(context, text, options);
    }

    return this.makeTemplate(context, text, options);
  }

  Hogan.wrapMain = function(code) {
    return 'var t=this;t.b(i=i||"");' + code + 'return t.fl();';
  }

  Hogan.template = Hogan.Template;

  Hogan.makeTemplate = function(codeObj, text, options) {
    var template = this.makePartials(codeObj);
    template.code = new Function('c', 'p', 'i', this.wrapMain(codeObj.code));
    return new this.template(template, text, this, options);
  }

  Hogan.makePartials = function(codeObj) {
    var key, template = {subs: {}, partials: codeObj.partials, name: codeObj.name};
    for (key in template.partials) {
      template.partials[key] = this.makePartials(template.partials[key]);
    }
    for (key in codeObj.subs) {
      template.subs[key] = new Function('c', 'p', 't', codeObj.subs[key]);
    }
    return template;
  }

  function esc(s) {
    return s.replace(rSlash, '\\\\')
            .replace(rQuot, '\\\"')
            .replace(rNewline, '\\n')
            .replace(rCr, '\\r');
  }

  function chooseMethod(s) {
    return (~s.indexOf('.')) ? 'd' : 'f';
  }

  function createPartial(node, context) {
    var prefix = "<" + (context.prefix || "");
    var sym = prefix + node.n + serialNo++;
    context.partials[sym] = {name: node.n, partials: {}};
    context.code += 't.b(t.rp("' +  esc(sym) + '",c,p,"' + (node.indent || '') + '"));';
    return sym;
  }

  Hogan.codegen = {
    '#': function(node, context) {
      context.code += 'if(t.s(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,1),' +
                      'c,p,0,' + node.i + ',' + node.end + ',"' + node.otag + " " + node.ctag + '")){' +
                      't.rs(c,p,' + 'function(c,p,t){';
      Hogan.walk(node.nodes, context);
      context.code += '});c.pop();}';
    },

    '^': function(node, context) {
      context.code += 'if(!t.s(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,1),c,p,1,0,0,"")){';
      Hogan.walk(node.nodes, context);
      context.code += '};';
    },

    '>': createPartial,
    '<': function(node, context) {
      var ctx = {partials: {}, code: '', subs: {}, inPartial: true};
      Hogan.walk(node.nodes, ctx);
      var template = context.partials[createPartial(node, context)];
      template.subs = ctx.subs;
      template.partials = ctx.partials;
    },

    '$': function(node, context) {
      var ctx = {subs: {}, code: '', partials: context.partials, prefix: node.n};
      Hogan.walk(node.nodes, ctx);
      context.subs[node.n] = ctx.code;
      if (!context.inPartial) {
        context.code += 't.sub("' + esc(node.n) + '",c,p);';
      }
    },

    '\n': function(node, context) {
      context.code += write('"\\n"' + (node.last ? '' : ' + i'));
    },

    '_v': function(node, context) {
      context.code += 't.b(t.v(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,0)));';
    },

    '_t': function(node, context) {
      context.code += write('"' + esc(node.text) + '"');
    },

    '{': tripleStache,

    '&': tripleStache
  }

  function tripleStache(node, context) {
    context.code += 't.b(t.t(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,0)));';
  }

  function write(s) {
    return 't.b(' + s + ');';
  }

  Hogan.walk = function (nodelist, context) {
    var func;
    for (var i = 0, l = nodelist.length; i < l; i++) {
      func = Hogan.codegen[nodelist[i].tag];
      func && func(nodelist[i], context);
    }
    return context;
  }

  Hogan.parse = function(tokens, text, options) {
    options = options || {};
    return buildTree(tokens, '', [], options.sectionTags || []);
  },

  Hogan.cache = {};

  Hogan.cacheKey = function(text, options) {
    return [text, !!options.asString, !!options.disableLambda].join('||');
  },

  Hogan.compile = function(text, options) {
    options = options || {};
    var key = Hogan.cacheKey(text, options);
    var template = this.cache[key];

    if (template) {
      return template;
    }

    template = this.generate(this.parse(this.scan(text, options.delimiters), text, options), text, options);
    return this.cache[key] = template;
  };
})(typeof exports !== 'undefined' ? exports : hogan);
/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  COMMIT: 5b442f08817a00e9fe33d329c66e204b40f6312b
 *  URL: https://github.com/twitter/hogan.js/commits/master/lib/template.js
 *  DATE: Apr 02, 2012
 *
 *  NOTE: 2 mods (removed var Hogan = {}), and added dojox.hogan at the end of file
 */
dojo.provide("hogan.Template");

(function (Hogan, useArrayBuffer) {
  Hogan.Template = function (codeObj, text, compiler, options) {
    codeObj = codeObj || {};
    this.r = codeObj.code || this.r;
    this.c = compiler;
    this.options = options;
    this.text = text || '';
    this.partials = codeObj.partials || {};
    this.subs = codeObj.subs || {};
    this.ib();
  }

  Hogan.Template.prototype = {
    // render: replaced by generated code.
    r: function (context, partials, indent) { return ''; },

    // variable escaping
    v: hoganEscape,

    // triple stache
    t: coerceToString,

    render: function render(context, partials, indent) {
      return this.ri([context], partials || {}, indent);
    },

    // render internal -- a hook for overrides that catches partials too
    ri: function (context, partials, indent) {
      return this.r(context, partials, indent);
    },

    // ensurePartial
    ep: function(symbol, partials) {
      var partial = this.partials[symbol];

      // check to see that if we've instantiated this partial before
      var template = partials[partial.name];
      if (partial.instance && partial.base == template) {
        return partial.instance;
      }

      if (typeof template == 'string') {
        if (!this.c) {
          throw new Error("No compiler available.");
        }
        template = this.c.compile(template, this.options);
      }

      if (!template) {
        return null;
      }

      // We use this to check whether the partials dictionary has changed
      this.partials[symbol].base = template;

      if (partial.subs) {
        template = createSpecializedPartial(template, partial.subs, partial.partials);
      }

      this.partials[symbol].instance = template;
      return template;
    },

    // tries to find a partial in the curent scope and render it
    rp: function(symbol, context, partials, indent) {
      var partial = this.ep(symbol, partials);
      if (!partial) {
        return '';
      }

      return partial.ri(context, partials, indent);
    },

    // render a section
    rs: function(context, partials, section) {
      var tail = context[context.length - 1];

      if (!isArray(tail)) {
        section(context, partials, this);
        return;
      }

      for (var i = 0; i < tail.length; i++) {
        context.push(tail[i]);
        section(context, partials, this);
        context.pop();
      }
    },

    // maybe start a section
    s: function(val, ctx, partials, inverted, start, end, tags) {
      var pass;

      if (isArray(val) && val.length === 0) {
        return false;
      }

      if (typeof val == 'function') {
        val = this.ms(val, ctx, partials, inverted, start, end, tags);
      }

      pass = (val === '') || !!val;

      if (!inverted && pass && ctx) {
        ctx.push((typeof val == 'object') ? val : ctx[ctx.length - 1]);
      }

      return pass;
    },

    // find values with dotted names
    d: function(key, ctx, partials, returnFound) {
      var names = key.split('.'),
          val = this.f(names[0], ctx, partials, returnFound),
          cx = null;

      if (key === '.' && isArray(ctx[ctx.length - 2])) {
        return ctx[ctx.length - 1];
      }

      for (var i = 1; i < names.length; i++) {
        if (val && typeof val == 'object' && val[names[i]] != null) {
          cx = val;
          val = val[names[i]];
        } else {
          val = '';
        }
      }

      if (returnFound && !val) {
        return false;
      }

      if (!returnFound && typeof val == 'function') {
        ctx.push(cx);
        val = this.mv(val, ctx, partials);
        ctx.pop();
      }

      return val;
    },

    // find values with normal names
    f: function(key, ctx, partials, returnFound) {
      var val = false,
          v = null,
          found = false;

      for (var i = ctx.length - 1; i >= 0; i--) {
        v = ctx[i];
        if (v && typeof v == 'object' && v[key] != null) {
          val = v[key];
          found = true;
          break;
        }
      }

      if (!found) {
        return (returnFound) ? false : "";
      }

      if (!returnFound && typeof val == 'function') {
        val = this.mv(val, ctx, partials);
      }

      return val;
    },

    // higher order templates
    ls: function(func, cx, partials, text, tags) {
      var oldTags = this.options.delimiters;

      this.options.delimiters = tags;
      this.b(this.ct(coerceToString(func.call(cx, text)), cx, partials));
      this.options.delimiters = oldTags;

      return false;
    },

    // compile text
    ct: function(text, cx, partials) {
      if (this.options.disableLambda) {
        throw new Error('Lambda features disabled.');
      }
      return this.c.compile(text, this.options).render(cx, partials);
    },

    // template result buffering
    b: (useArrayBuffer) ? function(s) { this.buf.push(s); } :
                          function(s) { this.buf += s; },

    fl: (useArrayBuffer) ? function() { var r = this.buf.join(''); this.buf = []; return r; } :
                           function() { var r = this.buf; this.buf = ''; return r; },
    // init the buffer
    ib: function () {
      this.buf = (useArrayBuffer) ? [] : '';
    },

    // method replace section
    ms: function(func, ctx, partials, inverted, start, end, tags) {
      var cx = ctx[ctx.length - 1],
          result = func.call(cx);

      if (typeof result == 'function') {
        if (inverted) {
          return true;
        } else {
          return this.ls(result, cx, partials, this.text.substring(start, end), tags);
        }
      }

      return result;
    },

    // method replace variable
    mv: function(func, ctx, partials) {
      var cx = ctx[ctx.length - 1];
      var result = func.call(cx);

      if (typeof result == 'function') {
        return this.ct(coerceToString(result.call(cx)), cx, partials);
      }

      return result;
    },

    sub: function(name, context, partials) {
      var f = this.subs[name];
      if (f) {
        f(context, partials, this);
      }
    }

  };

  function createSpecializedPartial(instance, subs, partials) {
    function PartialTemplate() {};
    PartialTemplate.prototype = instance;
    function Substitutions() {};
    Substitutions.prototype = instance.subs;
    var key;
    var partial = new PartialTemplate();
    partial.subs = new Substitutions();
    partial.ib();

    for (key in subs) {
      partial.subs[key] = subs[key];
    }

    for (key in partials) {
      partial.partials[key] = partials[key];
    }

    return partial;
  }

  var rAmp = /&/g,
      rLt = /</g,
      rGt = />/g,
      rApos =/\'/g,
      rQuot = /\"/g,
      hChars =/[&<>\"\']/;

  function coerceToString(val) {
    return String((val === null || val === undefined) ? '' : val);
  }

  function hoganEscape(str) {
    str = coerceToString(str);
    return hChars.test(str) ?
      str
        .replace(rAmp,'&amp;')
        .replace(rLt,'&lt;')
        .replace(rGt,'&gt;')
        .replace(rApos,'&#39;')
        .replace(rQuot, '&quot;') :
      str;
  }

  var isArray = Array.isArray || function(a) {
    return Object.prototype.toString.call(a) === '[object Array]';
  };

})(typeof exports !== 'undefined' ? exports : hogan);
dojo.provide("jkl.jkl-parsexml");

// ================================================================
//  jkl-parsexml.js ---- JavaScript Kantan Library for Parsing XML
//  Copyright 2005-2007 Kawasaki Yusuke <u-suke@kawa.net>
//  http://www.kawa.net/works/js/jkl/parsexml.html
// ================================================================
//  v0.01  2005/05/18  first release
//  v0.02  2005/05/20  Opera 8.0beta may be abailable but somtimes crashed
//  v0.03  2005/05/20  overrideMimeType( "text/xml" );
//  v0.04  2005/05/21  class variables: REQUEST_TYPE, RESPONSE_TYPE
//  v0.05  2005/05/22  use Msxml2.DOMDocument.5.0 for GET method on IE6
//  v0.06  2005/05/22  CDATA_SECTION_NODE
//  v0.07  2005/05/23  use Microsoft.XMLDOM for GET method on IE6
//  v0.10  2005/10/11  new function: JKL.ParseXML.HTTP.responseText()
//  v0.11  2005/10/13  new sub class: JKL.ParseXML.Text, JSON and DOM.
//  v0.12  2005/10/14  new sub class: JKL.ParseXML.CSV and CSVmap.
//  v0.13  2005/10/28  bug fixed: TEXT_NODE regexp for white spaces
//  v0.14  2005/11/06  bug fixed: TEXT_NODE regexp at Safari
//  v0.15  2005/11/08  bug fixed: JKL.ParseXML.CSV.async() method
//  v0.16  2005/11/15  new sub class: LoadVars, and UTF-8 text on Safari
//  v0.18  2005/11/16  improve: UTF-8 text file on Safari
//  v0.19  2006/02/03  use XMLHTTPRequest instead of ActiveX on IE7,iCab
//  v0.20  2006/03/22  (skipped)
//  v0.21  2006/11/30  use ActiveX again on IE7
//  v0.22  2007/01/04  JKL.ParseXML.JSON.parseResponse() updated
// ================================================================

if ( typeof(JKL) == 'undefined' ){JKL = function() {};}

// ================================================================
//  class: JKL.ParseXML

JKL.ParseXML = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, false );
    return this;
};

// ================================================================
//  class variables

JKL.ParseXML.VERSION = "0.22";
JKL.ParseXML.MIME_TYPE_XML  = "text/xml";
JKL.ParseXML.MAP_NODETYPE = [
    "",
    "ELEMENT_NODE",                 // 1
    "ATTRIBUTE_NODE",               // 2
    "TEXT_NODE",                    // 3
    "CDATA_SECTION_NODE",           // 4
    "ENTITY_REFERENCE_NODE",        // 5
    "ENTITY_NODE",                  // 6
    "PROCESSING_INSTRUCTION_NODE",  // 7
    "COMMENT_NODE",                 // 8
    "DOCUMENT_NODE",                // 9
    "DOCUMENT_TYPE_NODE",           // 10
    "DOCUMENT_FRAGMENT_NODE",       // 11
    "NOTATION_NODE"                 // 12
];

// ================================================================
//  define callback function (ajax)

JKL.ParseXML.prototype.async = function ( func, args ) {
    this.callback_func = func;      // callback function
    this.callback_arg  = args;      // first argument
};

JKL.ParseXML.prototype.onerror = function ( func, args ) {
    this.onerror_func = func;       // callback function
};

// ================================================================
//  method: parse()
//  return: parsed object
//  Download a file from remote server and parse it.

JKL.ParseXML.prototype.parse = function () {
    if ( ! this.http ) {
      return;
    }

    // set onerror call back
    if ( this.onerror_func ) {
        this.http.onerror( this.onerror_func );
    }

    if ( this.callback_func ) {                             // async mode
        var copy = this;
        var proc = function() {
            if ( ! copy.http ) {
              return;
            }
            var data = copy.parseResponse();
            copy.callback_func( data, copy.callback_arg );  // call back
        };
        this.http.async( proc );
    }

    this.http.load();

    if ( ! this.callback_func ) {                           // sync mode
        var data = this.parseResponse();
        return data;
    }
};

// ================================================================
//  every child/children into array
JKL.ParseXML.prototype.setOutputArrayAll = function () {
    this.setOutputArray( true );
};
//  a child into scalar, children into array
JKL.ParseXML.prototype.setOutputArrayAuto = function () {
    this.setOutputArray( null );
};
//  every child/children into scalar (first sibiling only)
JKL.ParseXML.prototype.setOutputArrayNever = function () {
    this.setOutputArray( false );
};
//  specified child/children into array, other child/children into scalar
JKL.ParseXML.prototype.setOutputArrayElements = function ( list ) {
    this.setOutputArray( list );
};
//  specify how to treate child/children into scalar/array
JKL.ParseXML.prototype.setOutputArray = function ( mode ) {
    if ( typeof(mode) == "string" ) {
        mode = [ mode ];                // string into array
    }
    if ( mode && typeof(mode) == "object" ) {
        if ( mode.length < 0 ) {
            mode = false;               // false when array == []
        } else {
            var hash = {};
            for( var i=0; i<mode.length; i++ ) {
                hash[mode[i]] = true;
            }
            mode = hash;                // array into hashed array
            if ( mode["*"] ) {
                mode = true;            // true when includes "*"
            }
        }
    }
    this.usearray = mode;
};

// ================================================================
//  method: parseResponse()

JKL.ParseXML.prototype.parseResponse = function () {
    var root = this.http.documentElement();
    var data = this.parseDocument( root );
    return data;
};

// ================================================================
//  convert from DOM root node to JavaScript Object
//  method: parseElement( rootElement )

JKL.ParseXML.prototype.parseDocument = function ( root ) {
    // debug.print( "parseDocument: "+root );
    if ( ! root ) {
      return;
    }

    var ret = this.parseElement( root );            // parse root node
    // debug.print( "parsed: "+ret );

    if ( this.usearray == true ) {                  // always into array
        ret = [ ret ];
    } else if ( this.usearray == false ) {          // always into scalar
        //
    } else if ( this.usearray == null ) {           // automatic
        //
    } else if ( this.usearray[root.nodeName] ) {    // specified tag
        ret = [ ret ];
    }

    var json = {};
    json[root.nodeName] = ret;                      // root nodeName
    return json;
};

// ================================================================
//  convert from DOM Element to JavaScript Object
//  method: parseElement( element )

JKL.ParseXML.prototype.parseElement = function ( elem ) {
    // debug.print( "nodeType: "+JKL.ParseXML.MAP_NODETYPE[elem.nodeType]+" <"+elem.nodeName+">" );

    //  COMMENT_NODE

    if ( elem.nodeType == 7 ) {
        return;
    }

    //  TEXT_NODE CDATA_SECTION_NODE

    if ( elem.nodeType == 3 || elem.nodeType == 4 ) {
        // var bool = elem.nodeValue.match( /[^\u0000-\u0020]/ );
        var bool = elem.nodeValue.match( /[^\x00-\x20]/ ); // for Safari
        if ( bool == null ) {
          return;     // ignore white spaces
        }
        // debug.print( "TEXT_NODE: "+elem.nodeValue.length+ " "+bool );
        return elem.nodeValue;
    }

    var retval;
    var cnt = {};

    //  parse attributes

    if ( elem.attributes && elem.attributes.length ) {
        retval = {};
        for ( var i=0; i<elem.attributes.length; i++ ) {
            var key = elem.attributes[i].nodeName;
            if ( typeof(key) != "string" ) {
              continue;
            }
            var val = elem.attributes[i].nodeValue;
            if ( ! val ) {
              continue;
            }
            if ( typeof(cnt[key]) == "undefined" ){cnt[key] = 0;}
            cnt[key] ++;
            this.addNode( retval, key, cnt[key], val );
        }
    }

    //  parse child nodes (recursive)

    if ( elem.childNodes && elem.childNodes.length ) {
        var textonly = true;
        if ( retval ){textonly = false;        // some attributes exists
}
        for ( var i=0; i<elem.childNodes.length && textonly; i++ ) {
            var ntype = elem.childNodes[i].nodeType;
            if ( ntype == 3 || ntype == 4 ) {
              continue;
            }
            textonly = false;
        }
        if ( textonly ) {
            if ( ! retval ){retval = "";}
            for ( var i=0; i<elem.childNodes.length; i++ ) {
                retval += elem.childNodes[i].nodeValue;
            }
        } else {
            if ( ! retval ){retval = {};}
            for ( var i=0; i<elem.childNodes.length; i++ ) {
                var key = elem.childNodes[i].nodeName;
                if ( typeof(key) != "string" ) {
                  continue;
                }
                var val = this.parseElement( elem.childNodes[i] );
                if ( ! val ) {
                  continue;
                }
                if ( typeof(cnt[key]) == "undefined" ){cnt[key] = 0;}
                cnt[key] ++;
                this.addNode( retval, key, cnt[key], val );
            }
        }
    }
    return retval;
};

// ================================================================
//  method: addNode( hash, key, count, value )

JKL.ParseXML.prototype.addNode = function ( hash, key, cnts, val ) {
    if ( this.usearray == true ) {              // into array
        if ( cnts == 1 ){hash[key] = [];}
        hash[key][hash[key].length] = val;      // push
    } else if ( this.usearray == false ) {      // into scalar
        if ( cnts == 1 ){hash[key] = val;       // only 1st sibling
}
    } else if ( this.usearray == null ) {
        if ( cnts == 1 ) {                      // 1st sibling
            hash[key] = val;
        } else if ( cnts == 2 ) {               // 2nd sibling
            hash[key] = [ hash[key], val ];
        } else {                                // 3rd sibling and more
            hash[key][hash[key].length] = val;
        }
    } else if ( this.usearray[key] ) {
        if ( cnts == 1 ){hash[key] = [];}
        hash[key][hash[key].length] = val;      // push
    } else {
        if ( cnts == 1 ){hash[key] = val;       // only 1st sibling
}
    }
};

// ================================================================
//  class: JKL.ParseXML.Text

JKL.ParseXML.Text = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.Text( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.Text.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.Text.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.Text.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.Text.prototype.parseResponse = function () {
    var data = this.http.responseText();
    return data;
};

// ================================================================
//  class: JKL.ParseXML.JSON

JKL.ParseXML.JSON = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.JSON( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.JSON.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.JSON.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.JSON.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.JSON.prototype.parseResponse = function () {
    var text = this.http.responseText();
    // http://www.antimon2.atnifty.com/2007/01/jklparsexmljson.html
    if ( typeof(text) == 'undefined' ) {
      return;
    }
    if ( ! text.length ) {
      return;
    }
    var data = eval( "("+text+")" );
    return data;
};

// ================================================================
//  class: JKL.ParseXML.DOM

JKL.ParseXML.DOM = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.DOM( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, false );
    return this;
};

JKL.ParseXML.DOM.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.DOM.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.DOM.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.DOM.prototype.parseResponse = function () {
    var data = this.http.documentElement();
    return data;
};

// ================================================================
//  class: JKL.ParseXML.CSV

JKL.ParseXML.CSV = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.CSV( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.CSV.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.CSV.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.CSV.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.CSV.prototype.parseResponse = function () {
    var text = this.http.responseText();
    var data = this.parseCSV( text );
    return data;
};

JKL.ParseXML.CSV.prototype.parseCSV = function ( text ) {
    text = text.replace( /\r\n?/g, "\n" );              // new line character
    var pos = 0;
    var len = text.length;
    var table = [];
    while( pos<len ) {
        var line = [];
        while( pos<len ) {
            if ( text.charAt(pos) == '"' ) {            // "..." quoted column
                var nextquote = text.indexOf( '"', pos+1 );
                while ( nextquote<len && nextquote > -1 ) {
                    if ( text.charAt(nextquote+1) != '"' ) {
                        break;                          // end of column
                    }
                    nextquote = text.indexOf( '"', nextquote+2 );
                }
                if ( nextquote < 0 ) {
                    // unclosed quote
                } else if ( text.charAt(nextquote+1) == "," ) { // end of column
                    var quoted = text.substr( pos+1, nextquote-pos-1 );
                    quoted = quoted.replace(/""/g,'"');
                    line[line.length] = quoted;
                    pos = nextquote+2;
                    continue;
                } else if ( text.charAt(nextquote+1) == "\n" || // end of line
                            len==nextquote+1 ) {                // end of file
                    var quoted = text.substr( pos+1, nextquote-pos-1 );
                    quoted = quoted.replace(/""/g,'"');
                    line[line.length] = quoted;
                    pos = nextquote+2;
                    break;
                } else {
                    // invalid column
                }
            }
            var nextcomma = text.indexOf( ",", pos );
            var nextnline = text.indexOf( "\n", pos );
            if ( nextnline < 0 ){nextnline = len;}
            if ( nextcomma > -1 && nextcomma < nextnline ) {
                line[line.length] = text.substr( pos, nextcomma-pos );
                pos = nextcomma+1;
            } else {                                    // end of line
                line[line.length] = text.substr( pos, nextnline-pos );
                pos = nextnline+1;
                break;
            }
        }
        if ( line.length >= 0 ) {
            table[table.length] = line;                 // push line
        }
    }
    if ( table.length < 0 ) {
      return;                     // null data
    }
    return table;
};

// ================================================================
//  class: JKL.ParseXML.CSVmap

JKL.ParseXML.CSVmap = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.CSVmap( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.CSVmap.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.CSVmap.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.CSVmap.prototype.onerror = JKL.ParseXML.prototype.onerror;
JKL.ParseXML.CSVmap.prototype.parseCSV = JKL.ParseXML.CSV.prototype.parseCSV;

JKL.ParseXML.CSVmap.prototype.parseResponse = function () {
    var text = this.http.responseText();
    var source = this.parseCSV( text );
    if ( ! source ) {
      return;
    }
    if ( source.length < 0 ) {
      return;
    }

    var title = source.shift();                 // first line as title
    var data = [];
    for( var i=0; i<source.length; i++ ) {
        var hash = {};
        for( var j=0; j<title.length && j<source[i].length; j++ ) {
            hash[title[j]] = source[i][j];      // array to map
        }
        data[data.length] = hash;               // push line
    }
    return data;
};

// ================================================================
//  class: JKL.ParseXML.LoadVars

JKL.ParseXML.LoadVars = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.LoadVars( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.LoadVars.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.LoadVars.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.LoadVars.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.LoadVars.prototype.parseResponse = function () {
    var text = this.http.responseText();
    text = text.replace( /\r\n?/g, "\n" );              // new line character
    var hash = {};
    var list = text.split( "&" );
    for( var i=0; i<list.length; i++ ) {
        var eq = list[i].indexOf( "=" );
        if ( eq > -1 ) {
            var key = decodeURIComponent(list[i].substr(0,eq).replace("+","%20"));
            var val = decodeURIComponent(list[i].substr(eq+1).replace("+","%20"));
            hash[key] = val;
        } else {
            hash[list[i]] = "";
        }
    }
    return hash;
};

// ================================================================
//  class: JKL.ParseXML.HTTP
//  constructer: new JKL.ParseXML.HTTP()

JKL.ParseXML.HTTP = function( url, query, method, textmode ) {
    // debug.print( "new JKL.ParseXML.HTTP( '"+url+"', '"+query+"', '"+method+"', '"+textmode+"' );" );
    this.url = url;
    if ( typeof(query) == "string" ) {
        this.query = query;
    } else {
        this.query = "";
    }
    if ( method ) {
        this.method = method;
    } else if ( typeof(query) == "string" ) {
        this.method = "POST";
    } else {
        this.method = "GET";
    }
    this.textmode = textmode ? true : false;
    this.req = null;
    this.xmldom_flag = false;
    this.onerror_func  = null;
    this.callback_func = null;
    this.already_done = null;
    return this;
};

// ================================================================
//  class variables

JKL.ParseXML.HTTP.REQUEST_TYPE  = "application/x-www-form-urlencoded";
JKL.ParseXML.HTTP.ACTIVEX_XMLDOM  = "Microsoft.XMLDOM";  // Msxml2.DOMDocument.5.0
JKL.ParseXML.HTTP.ACTIVEX_XMLHTTP = "Microsoft.XMLHTTP"; // Msxml2.XMLHTTP.3.0
JKL.ParseXML.HTTP.EPOCH_TIMESTAMP = "Thu, 01 Jun 1970 00:00:00 GMT";

// ================================================================

JKL.ParseXML.HTTP.prototype.onerror = JKL.ParseXML.prototype.onerror;
JKL.ParseXML.HTTP.prototype.async = function( func ) {
    this.async_func = func;
};

// ================================================================
//  [IE+IXMLDOMElement]
//      XML     text/xml            OK
//      XML     application/rdf+xml OK
//      TEXT    text/plain          NG
//      TEXT    others              NG
//  [IE+IXMLHttpRequest]
//      XML     text/xml            OK
//      XML     application/rdf+xml NG
//      TEXT    text/plain          OK
//      TEXT    others              OK
//  [Firefox+XMLHttpRequest]
//      XML     text/xml            OK
//      XML     application/rdf+xml OK (overrideMimeType)
//      TEXT    text/plain          OK
//      TEXT    others              OK (overrideMimeType)
//  [Opera+XMLHttpRequest]
//      XML     text/xml            OK
//      XML     application/rdf+xml OK
//      TEXT    text/plain          OK
//      TEXT    others              OK
// ================================================================

JKL.ParseXML.HTTP.prototype.load = function() {
    // create XMLHttpRequest object
    if ( window.ActiveXObject ) {                           // IE5.5,6,7
        var activex = JKL.ParseXML.HTTP.ACTIVEX_XMLHTTP;    // IXMLHttpRequest
        if ( this.method == "GET" && ! this.textmode ) {
            // use IXMLDOMElement to accept any mime types
            // because overrideMimeType() is not available on IE6
            activex = JKL.ParseXML.HTTP.ACTIVEX_XMLDOM;     // IXMLDOMElement
        }
        // debug.print( "new ActiveXObject( '"+activex+"' )" );
        this.req = new ActiveXObject( activex );
    } else if ( window.XMLHttpRequest ) {                   // Firefox, Opera, iCab
        // debug.print( "new XMLHttpRequest()" );
        this.req = new XMLHttpRequest();
    }

    // async mode when call back function is specified
    var async_flag = this.async_func ? true : false;
    // debug.print( "async: "+ async_flag );

    // open for XMLHTTPRequest (not for IXMLDOMElement)
    if ( typeof(this.req.send) != "undefined" ) {
        // debug.print( "open( '"+this.method+"', '"+this.url+"', "+async_flag+" );" );
        this.req.open( this.method, this.url, async_flag );
    }

//  // If-Modified-Since: Thu, 01 Jun 1970 00:00:00 GMT
//  if ( typeof(this.req.setRequestHeader) != "undefined" ) {
//      // debug.print( "If-Modified-Since"+JKL.ParseXML.HTTP.EPOCH_TIMESTAMP );
//      this.req.setRequestHeader( "If-Modified-Since", JKL.ParseXML.HTTP.EPOCH_TIMESTAMP );
//  }

    // Content-Type: application/x-www-form-urlencoded (request header)
    // Some server does not accept without request content-type.
    if ( typeof(this.req.setRequestHeader) != "undefined" ) {
        // debug.print( "Content-Type: "+JKL.ParseXML.HTTP.REQUEST_TYPE+" (request)" );
        this.req.setRequestHeader( "Content-Type", JKL.ParseXML.HTTP.REQUEST_TYPE );
    }

    // Content-Type: text/xml (response header)
    // FireFox does not accept other mime types like application/rdf+xml etc.
    if ( typeof(this.req.overrideMimeType) != "undefined" && ! this.textmode ) {
        // debug.print( "Content-Type: "+JKL.ParseXML.MIME_TYPE_XML+" (response)" );
        this.req.overrideMimeType( JKL.ParseXML.MIME_TYPE_XML );
    }

    // set call back handler when async mode
    if ( async_flag ) {
        var copy = this;
        copy.already_done = false;                  // not parsed yet
        var check_func = function () {
            if ( copy.req.readyState != 4 ) {
              return;
            }
            // debug.print( "readyState(async): "+copy.req.readyState );
            var succeed = copy.checkResponse();
            // debug.print( "checkResponse(async): "+succeed );
            if ( ! succeed ) {
              return;                // failed
            }
            if ( copy.already_done ) {
              return;        // parse only once
            }
            copy.already_done = true;               // already parsed
            copy.async_func();                      // call back async
        };
        this.req.onreadystatechange = check_func;
        // for document.implementation.createDocument
        // this.req.onload = check_func;
    }

    // send the request and query string
    if ( typeof(this.req.send) != "undefined" ) {
        // debug.print( "XMLHTTPRequest: send( '"+this.query+"' );" );
        this.req.send( this.query );                        // XMLHTTPRequest
    } else if ( typeof(this.req.load) != "undefined" ) {
        // debug.print( "IXMLDOMElement: load( '"+this.url+"' );" );
        this.req.async = async_flag;
        this.req.load( this.url );                          // IXMLDOMElement
    }

    // just return when async mode
    if ( async_flag ) {
      return;
    }

    var succeed = this.checkResponse();
    // debug.print( "checkResponse(sync): "+succeed );
};

// ================================================================
//  method: checkResponse()

JKL.ParseXML.HTTP.prototype.checkResponse = function() {
    // parseError on IXMLDOMElement
    if ( this.req.parseError && this.req.parseError.errorCode != 0 ) {
        // debug.print( "parseError: "+this.req.parseError.reason );
        if ( this.onerror_func ){this.onerror_func( this.req.parseError.reason );}
        return false;                       // failed
    }

    // HTTP response code
    if ( this.req.status-0 > 0 &&
         this.req.status != 200 &&          // OK
         this.req.status != 206 &&          // Partial Content
         this.req.status != 304 ) {         // Not Modified
        // debug.print( "status: "+this.req.status );
        if ( this.onerror_func ){this.onerror_func( this.req.status );}
        return false;                       // failed
    }

    return true;                            // succeed
};

// ================================================================
//  method: documentElement()
//  return: XML DOM in response body

JKL.ParseXML.HTTP.prototype.documentElement = function() {
    // debug.print( "documentElement: "+this.req );
    if ( ! this.req ) {
      return;
    }
    if ( this.req.responseXML ) {
        return this.req.responseXML.documentElement;    // XMLHTTPRequest
    } else {
        return this.req.documentElement;                // IXMLDOMDocument
    }
};

// ================================================================
//  method: responseText()
//  return: text string in response body

JKL.ParseXML.HTTP.prototype.responseText = function() {
    // debug.print( "responseText: "+this.req );
    if ( ! this.req ) {
      return;
    }

    //  Safari and Konqueror cannot understand the encoding of text files.
    if ( navigator.appVersion.match( "KHTML" ) ) {
        var esc = escape( this.req.responseText );
//        debug.print( "escape: "+esc );
        if ( ! esc.match("%u") && esc.match("%") ) {
            return decodeURIComponent(esc);
        }
    }

    return this.req.responseText;
};

// ================================================================
//  http://msdn.microsoft.com/library/en-us/xmlsdk/html/d051f7c5-e882-42e8-a5b6-d1ce67af275c.asp
// ================================================================

dojo.provide("nielsenTracking");

nielsenTracking = {
      init: function() {
//  if(dj.util.Region.getViewByRegion() === "na,us") {
            var d = new Image(1, 1);
            d.onerror = d.onload = function () {
              d.onerror = d.onload = null;
            };
            d.src = ["//secure-us.imrworldwide.com/cgi-bin/m?ci=us-403743h&cg=0&cc=1&si=", escape(window.location.href), "&rp=", escape(document.referrer), "&ts=compact&rnd=", (new Date()).getTime()].join('');
//        }
      }

};
dojo.provide("swfobject.swfobject_1_5.swfobject");
/**
 * SWFObject v1.5: Flash Player detection and embed - http://blog.deconcept.com/swfobject/
 *
 * SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;
/*  SWFObject v2.2 <http://code.google.com/p/swfobject/>
  is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
dojo.provide("swfobject.swfobject_2_2.swfobject");

swfobject = function() {
	
	var UNDEF = "undefined",
		OBJECT = "object",
		SHOCKWAVE_FLASH = "Shockwave Flash",
		SHOCKWAVE_FLASH_AX = "ShockwaveFlash.ShockwaveFlash",
		FLASH_MIME_TYPE = "application/x-shockwave-flash",
		EXPRESS_INSTALL_ID = "SWFObjectExprInst",
		ON_READY_STATE_CHANGE = "onreadystatechange",
		
		win = window,
		doc = document,
		nav = navigator,
		
		plugin = false,
		domLoadFnArr = [main],
		regObjArr = [],
		objIdArr = [],
		listenersArr = [],
		storedAltContent,
		storedAltContentId,
		storedCallbackFn,
		storedCallbackObj,
    isInitDelayed = true,
		isDomLoaded = isInitDelayed,
		isExpressInstallActive = false,
		dynamicStylesheet,
		dynamicStylesheetMedia,
		autoHideShow = true,
	
	/* Centralized function for browser feature detection
		- User agent string detection is only used when no good alternative is possible
		- Is executed directly for optimal performance
	*/	
	ua = function() {
		var w3cdom = typeof doc.getElementById != UNDEF && typeof doc.getElementsByTagName != UNDEF && typeof doc.createElement != UNDEF,
			u = nav.userAgent.toLowerCase(),
			p = nav.platform.toLowerCase(),
			windows = p ? /win/.test(p) : /win/.test(u),
			mac = p ? /mac/.test(p) : /mac/.test(u),
			webkit = /webkit/.test(u) ? parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, "$1")) : false, // returns either the webkit version or false if not webkit
			ie = !+"\v1", // feature detection based on Andrea Giammarchi's solution: http://webreflection.blogspot.com/2009/01/32-bytes-to-know-if-your-browser-is-ie.html
			playerVersion = [0,0,0],
			d = null;
		if (typeof nav.plugins != UNDEF && typeof nav.plugins[SHOCKWAVE_FLASH] == OBJECT) {
			d = nav.plugins[SHOCKWAVE_FLASH].description;
			if (d && !(typeof nav.mimeTypes != UNDEF && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) { // navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin indicates whether plug-ins are enabled or disabled in Safari 3+
				plugin = true;
				ie = false; // cascaded feature detection for Internet Explorer
				d = d.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
				playerVersion[0] = parseInt(d.replace(/^(.*)\..*$/, "$1"), 10);
				playerVersion[1] = parseInt(d.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
				playerVersion[2] = /[a-zA-Z]/.test(d) ? parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
			}
		}
		else if (typeof win.ActiveXObject != UNDEF) {
			try {
				var a = new ActiveXObject(SHOCKWAVE_FLASH_AX);
				if (a) { // a will return null when ActiveX is disabled
					d = a.GetVariable("$version");
					if (d) {
						ie = true; // cascaded feature detection for Internet Explorer
						d = d.split(" ")[1].split(",");
						playerVersion = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
					}
				}
			}
			catch(e) {}
		}
		return { w3:w3cdom, pv:playerVersion, wk:webkit, ie:ie, win:windows, mac:mac };
	}(),
	
	/* Cross-browser onDomLoad
		- Will fire an event as soon as the DOM of a web page is loaded
		- Internet Explorer workaround based on Diego Perini's solution: http://javascript.nwbox.com/IEContentLoaded/
		- Regular onload serves as fallback
	*/ 
	onDomLoad = function() {
		if (!ua.w3) { return; }
		if ((typeof doc.readyState != UNDEF && doc.readyState == "complete") || (typeof doc.readyState == UNDEF && (doc.getElementsByTagName("body")[0] || doc.body))) { // function is fired after onload, e.g. when script is inserted dynamically 
			callDomLoadFunctions();
		}
		if (!isDomLoaded) {
			if (typeof doc.addEventListener != UNDEF) {
				doc.addEventListener("DOMContentLoaded", callDomLoadFunctions, false);
			}		
			if (ua.ie && ua.win) {
				doc.attachEvent(ON_READY_STATE_CHANGE, function() {
					if (doc.readyState == "complete") {
						doc.detachEvent(ON_READY_STATE_CHANGE, arguments.callee);
						callDomLoadFunctions();
					}
				});
				if (win == top) { // if not inside an iframe
					(function(){
						if (isDomLoaded) { return; }
						try {
							doc.documentElement.doScroll("left");
						}
						catch(e) {
							setTimeout(arguments.callee, 0);
							return;
						}
						callDomLoadFunctions();
					})();
				}
			}
			if (ua.wk) {
				(function(){
					if (isDomLoaded) { return; }
					if (!/loaded|complete/.test(doc.readyState)) {
						setTimeout(arguments.callee, 0);
						return;
					}
					callDomLoadFunctions();
				})();
			}
			addLoadEvent(callDomLoadFunctions);
		}
	}();
	
	function callDomLoadFunctions() {
		if (isDomLoaded) { return; }
		try { // test if we can really add/remove elements to/from the DOM; we don't want to fire it too early
			var t = doc.getElementsByTagName("body")[0].appendChild(createElement("span"));
			t.parentNode.removeChild(t);
		}
		catch (e) { return; }
		isDomLoaded = true;
		var dl = domLoadFnArr.length;
		for (var i = 0; i < dl; i++) {
			domLoadFnArr[i]();
		}
	}
	
	function addDomLoadEvent(fn) {
		if (isDomLoaded) {
			fn();
		}
		else { 
			domLoadFnArr[domLoadFnArr.length] = fn; // Array.push() is only available in IE5.5+
		}
	}
	
	/* Cross-browser onload
		- Based on James Edwards' solution: http://brothercake.com/site/resources/scripts/onload/
		- Will fire an event as soon as a web page including all of its assets are loaded 
	 */
	function addLoadEvent(fn) {
		if (typeof win.addEventListener != UNDEF) {
			win.addEventListener("load", fn, false);
		}
		else if (typeof doc.addEventListener != UNDEF) {
			doc.addEventListener("load", fn, false);
		}
		else if (typeof win.attachEvent != UNDEF) {
			addListener(win, "onload", fn);
		}
		else if (typeof win.onload == "function") {
			var fnOld = win.onload;
			win.onload = function() {
				fnOld();
				fn();
			};
		}
		else {
			win.onload = fn;
		}
	}
	
	/* Main function
		- Will preferably execute onDomLoad, otherwise onload (as a fallback)
	*/
	function main() { 
		if (plugin) {
			testPlayerVersion();
		}
		else {
			matchVersions();
		}
	}
	
	/* Detect the Flash Player version for non-Internet Explorer browsers
		- Detecting the plug-in version via the object element is more precise than using the plugins collection item's description:
		  a. Both release and build numbers can be detected
		  b. Avoid wrong descriptions by corrupt installers provided by Adobe
		  c. Avoid wrong descriptions by multiple Flash Player entries in the plugin Array, caused by incorrect browser imports
		- Disadvantage of this method is that it depends on the availability of the DOM, while the plugins collection is immediately available
	*/
	function testPlayerVersion() {
		var b = doc.getElementsByTagName("body")[0];
		var o = createElement(OBJECT);
		o.setAttribute("type", FLASH_MIME_TYPE);
		var t = b.appendChild(o);
		if (t) {
			var counter = 0;
			(function(){
				if (typeof t.GetVariable != UNDEF) {
					var d = t.GetVariable("$version");
					if (d) {
						d = d.split(" ")[1].split(",");
						ua.pv = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
					}
				}
				else if (counter < 10) {
					counter++;
					setTimeout(arguments.callee, 10);
					return;
				}
				b.removeChild(o);
				t = null;
				matchVersions();
			})();
		}
		else {
			matchVersions();
		}
	}
	
	/* Perform Flash Player and SWF version matching; static publishing only
	*/
	function matchVersions() {
		var rl = regObjArr.length;
		if (rl > 0) {
			for (var i = 0; i < rl; i++) { // for each registered object element
				var id = regObjArr[i].id;
				var cb = regObjArr[i].callbackFn;
				var cbObj = {success:false, id:id};
				if (ua.pv[0] > 0) {
					var obj = getElementById(id);
					if (obj) {
						if (hasPlayerVersion(regObjArr[i].swfVersion) && !(ua.wk && ua.wk < 312)) { // Flash Player version >= published SWF version: Houston, we have a match!
							setVisibility(id, true);
							if (cb) {
								cbObj.success = true;
								cbObj.ref = getObjectById(id);
								cb(cbObj);
							}
						}
						else if (regObjArr[i].expressInstall && canExpressInstall()) { // show the Adobe Express Install dialog if set by the web page author and if supported
							var att = {};
							att.data = regObjArr[i].expressInstall;
							att.width = obj.getAttribute("width") || "0";
							att.height = obj.getAttribute("height") || "0";
							if (obj.getAttribute("class")) { att.styleclass = obj.getAttribute("class"); }
							if (obj.getAttribute("align")) { att.align = obj.getAttribute("align"); }
							// parse HTML object param element's name-value pairs
							var par = {};
							var p = obj.getElementsByTagName("param");
							var pl = p.length;
							for (var j = 0; j < pl; j++) {
								if (p[j].getAttribute("name").toLowerCase() != "movie") {
									par[p[j].getAttribute("name")] = p[j].getAttribute("value");
								}
							}
							showExpressInstall(att, par, id, cb);
						}
						else { // Flash Player and SWF version mismatch or an older Webkit engine that ignores the HTML object element's nested param elements: display alternative content instead of SWF
							displayAltContent(obj);
							if (cb) { cb(cbObj); }
						}
					}
				}
				else {	// if no Flash Player is installed or the fp version cannot be detected we let the HTML object element do its job (either show a SWF or alternative content)
					setVisibility(id, true);
					if (cb) {
						var o = getObjectById(id); // test whether there is an HTML object element or not
						if (o && typeof o.SetVariable != UNDEF) { 
							cbObj.success = true;
							cbObj.ref = o;
						}
						cb(cbObj);
					}
				}
			}
		}
	}
	
	function getObjectById(objectIdStr) {
		var r = null;
		var o = getElementById(objectIdStr);
		if (o && o.nodeName == "OBJECT") {
			if (typeof o.SetVariable != UNDEF) {
				r = o;
			}
			else {
				var n = o.getElementsByTagName(OBJECT)[0];
				if (n) {
					r = n;
				}
			}
		}
		return r;
	}
	
	/* Requirements for Adobe Express Install
		- only one instance can be active at a time
		- fp 6.0.65 or higher
		- Win/Mac OS only
		- no Webkit engines older than version 312
	*/
	function canExpressInstall() {
		return !isExpressInstallActive && hasPlayerVersion("6.0.65") && (ua.win || ua.mac) && !(ua.wk && ua.wk < 312);
	}
	
	/* Show the Adobe Express Install dialog
		- Reference: http://www.adobe.com/cfusion/knowledgebase/index.cfm?id=6a253b75
	*/
	function showExpressInstall(att, par, replaceElemIdStr, callbackFn) {
		isExpressInstallActive = true;
		storedCallbackFn = callbackFn || null;
		storedCallbackObj = {success:false, id:replaceElemIdStr};
		var obj = getElementById(replaceElemIdStr);
		if (obj) {
			if (obj.nodeName == "OBJECT") { // static publishing
				storedAltContent = abstractAltContent(obj);
				storedAltContentId = null;
			}
			else { // dynamic publishing
				storedAltContent = obj;
				storedAltContentId = replaceElemIdStr;
			}
			att.id = EXPRESS_INSTALL_ID;
			if (typeof att.width == UNDEF || (!/%$/.test(att.width) && parseInt(att.width, 10) < 310)) { att.width = "310"; }
			if (typeof att.height == UNDEF || (!/%$/.test(att.height) && parseInt(att.height, 10) < 137)) { att.height = "137"; }
			doc.title = doc.title.slice(0, 47) + " - Flash Player Installation";
			var pt = ua.ie && ua.win ? "ActiveX" : "PlugIn",
				fv = "MMredirectURL=" + win.location.toString().replace(/&/g,"%26") + "&MMplayerType=" + pt + "&MMdoctitle=" + doc.title;
			if (typeof par.flashvars != UNDEF) {
				par.flashvars += "&" + fv;
			}
			else {
				par.flashvars = fv;
			}
			// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,
			// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work
			if (ua.ie && ua.win && obj.readyState != 4) {
				var newObj = createElement("div");
				replaceElemIdStr += "SWFObjectNew";
				newObj.setAttribute("id", replaceElemIdStr);
				obj.parentNode.insertBefore(newObj, obj); // insert placeholder div that will be replaced by the object element that loads expressinstall.swf
				obj.style.display = "none";
				(function(){
					if (obj.readyState == 4) {
						obj.parentNode.removeChild(obj);
					}
					else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			createSWF(att, par, replaceElemIdStr);
		}
	}
	
	/* Functions to abstract and display alternative content
	*/
	function displayAltContent(obj) {
		if (ua.ie && ua.win && obj.readyState != 4) {
			// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,
			// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work
			var el = createElement("div");
			obj.parentNode.insertBefore(el, obj); // insert placeholder div that will be replaced by the alternative content
			el.parentNode.replaceChild(abstractAltContent(obj), el);
			obj.style.display = "none";
			(function(){
				if (obj.readyState == 4) {
					obj.parentNode.removeChild(obj);
				}
				else {
					setTimeout(arguments.callee, 10);
				}
			})();
		}
		else {
			obj.parentNode.replaceChild(abstractAltContent(obj), obj);
		}
	} 

	function abstractAltContent(obj) {
		var ac = createElement("div");
		if (ua.win && ua.ie) {
			ac.innerHTML = obj.innerHTML;
		}
		else {
			var nestedObj = obj.getElementsByTagName(OBJECT)[0];
			if (nestedObj) {
				var c = nestedObj.childNodes;
				if (c) {
					var cl = c.length;
					for (var i = 0; i < cl; i++) {
						if (!(c[i].nodeType == 1 && c[i].nodeName == "PARAM") && !(c[i].nodeType == 8)) {
							ac.appendChild(c[i].cloneNode(true));
						}
					}
				}
			}
		}
		return ac;
	}
	
	/* Cross-browser dynamic SWF creation
	*/
	function createSWF(attObj, parObj, id) {
		var r, el = getElementById(id);
		if (ua.wk && ua.wk < 312) { return r; }
		if (el) {
			if (typeof attObj.id == UNDEF) { // if no 'id' is defined for the object element, it will inherit the 'id' from the alternative content
				attObj.id = id;
			}
			if (ua.ie && ua.win) { // Internet Explorer + the HTML object element + W3C DOM methods do not combine: fall back to outerHTML
				var att = "";
				for (var i in attObj) {
					if (attObj[i] != Object.prototype[i]) { // filter out prototype additions from other potential libraries
						if (i.toLowerCase() == "data") {
							parObj.movie = attObj[i];
						}
						else if (i.toLowerCase() == "styleclass") { // 'class' is an ECMA4 reserved keyword
							att += ' class="' + attObj[i] + '"';
						}
						else if (i.toLowerCase() != "classid") {
							att += ' ' + i + '="' + attObj[i] + '"';
						}
					}
				}
				var par = "";
				for (var j in parObj) {
					if (parObj[j] != Object.prototype[j]) { // filter out prototype additions from other potential libraries
						par += '<param name="' + j + '" value="' + parObj[j] + '" />';
					}
				}
				el.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + att + '>' + par + '</object>';
				objIdArr[objIdArr.length] = attObj.id; // stored to fix object 'leaks' on unload (dynamic publishing only)
				r = getElementById(attObj.id);	
			}
			else { // well-behaving browsers
				var o = createElement(OBJECT);
				o.setAttribute("type", FLASH_MIME_TYPE);
				for (var m in attObj) {
					if (attObj[m] != Object.prototype[m]) { // filter out prototype additions from other potential libraries
						if (m.toLowerCase() == "styleclass") { // 'class' is an ECMA4 reserved keyword
							o.setAttribute("class", attObj[m]);
						}
						else if (m.toLowerCase() != "classid") { // filter out IE specific attribute
							o.setAttribute(m, attObj[m]);
						}
					}
				}
				for (var n in parObj) {
					if (parObj[n] != Object.prototype[n] && n.toLowerCase() != "movie") { // filter out prototype additions from other potential libraries and IE specific param element
						createObjParam(o, n, parObj[n]);
					}
				}
				el.parentNode.replaceChild(o, el);
				r = o;
			}
		}
		return r;
	}
	
	function createObjParam(el, pName, pValue) {
		var p = createElement("param");
		p.setAttribute("name", pName);	
		p.setAttribute("value", pValue);
		el.appendChild(p);
	}
	
	/* Cross-browser SWF removal
		- Especially needed to safely and completely remove a SWF in Internet Explorer
	*/
	function removeSWF(id) {
		var obj = getElementById(id);
		if (obj && obj.nodeName == "OBJECT") {
			if (ua.ie && ua.win) {
				obj.style.display = "none";
				(function(){
					if (obj.readyState == 4) {
						removeObjectInIE(id);
					}
					else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			else {
				obj.parentNode.removeChild(obj);
			}
		}
	}
	
	function removeObjectInIE(id) {
		var obj = getElementById(id);
		if (obj) {
			for (var i in obj) {
				if (typeof obj[i] == "function") {
					obj[i] = null;
				}
			}
			obj.parentNode.removeChild(obj);
		}
	}
	
	/* Functions to optimize JavaScript compression
	*/
	function getElementById(id) {
		var el = null;
		try {
			el = doc.getElementById(id);
		}
		catch (e) {}
		return el;
	}
	
	function createElement(el) {
		return doc.createElement(el);
	}
	
	/* Updated attachEvent function for Internet Explorer
		- Stores attachEvent information in an Array, so on unload the detachEvent functions can be called to avoid memory leaks
	*/	
	function addListener(target, eventType, fn) {
		target.attachEvent(eventType, fn);
		listenersArr[listenersArr.length] = [target, eventType, fn];
	}
	
	/* Flash Player and SWF content version matching
	*/
	function hasPlayerVersion(rv) {
		var pv = ua.pv, v = rv.split(".");
		v[0] = parseInt(v[0], 10);
		v[1] = parseInt(v[1], 10) || 0; // supports short notation, e.g. "9" instead of "9.0.0"
		v[2] = parseInt(v[2], 10) || 0;
		return (pv[0] > v[0] || (pv[0] == v[0] && pv[1] > v[1]) || (pv[0] == v[0] && pv[1] == v[1] && pv[2] >= v[2])) ? true : false;
	}
	
	/* Cross-browser dynamic CSS creation
		- Based on Bobby van der Sluis' solution: http://www.bobbyvandersluis.com/articles/dynamicCSS.php
	*/	
	function createCSS(sel, decl, media, newStyle) {
		if (ua.ie && ua.mac) { return; }
		var h = doc.getElementsByTagName("head")[0];
		if (!h) { return; } // to also support badly authored HTML pages that lack a head element
		var m = (media && typeof media == "string") ? media : "screen";
		if (newStyle) {
			dynamicStylesheet = null;
			dynamicStylesheetMedia = null;
		}
		if (!dynamicStylesheet || dynamicStylesheetMedia != m) { 
			// create dynamic stylesheet + get a global reference to it
			var s = createElement("style");
			s.setAttribute("type", "text/css");
			s.setAttribute("media", m);
			dynamicStylesheet = h.appendChild(s);
			if (ua.ie && ua.win && typeof doc.styleSheets != UNDEF && doc.styleSheets.length > 0) {
				dynamicStylesheet = doc.styleSheets[doc.styleSheets.length - 1];
			}
			dynamicStylesheetMedia = m;
		}
		// add style rule
		if (ua.ie && ua.win) {
			if (dynamicStylesheet && typeof dynamicStylesheet.addRule == OBJECT) {
				dynamicStylesheet.addRule(sel, decl);
			}
		}
		else {
			if (dynamicStylesheet && typeof doc.createTextNode != UNDEF) {
				dynamicStylesheet.appendChild(doc.createTextNode(sel + " {" + decl + "}"));
			}
		}
	}
	
	function setVisibility(id, isVisible) {
		if (!autoHideShow) { return; }
		var v = isVisible ? "visible" : "hidden";
		if (isDomLoaded && getElementById(id)) {
			getElementById(id).style.visibility = v;
		}
		else {
			createCSS("#" + id, "visibility:" + v);
		}
	}

	/* Filter to avoid XSS attacks
	*/
	function urlEncodeIfNecessary(s) {
		var regex = /[\\\"<>\.;]/;
		var hasBadChars = regex.exec(s) != null;
		return hasBadChars && typeof encodeURIComponent != UNDEF ? encodeURIComponent(s) : s;
	}
	
	/* Release memory to avoid memory leaks caused by closures, fix hanging audio/video threads and force open sockets/NetConnections to disconnect (Internet Explorer only)
	*/
	var cleanup = function() {
		if (ua.ie && ua.win) {
			window.attachEvent("onunload", function() {
				// remove listeners to avoid memory leaks
				var ll = listenersArr.length;
				for (var i = 0; i < ll; i++) {
					listenersArr[i][0].detachEvent(listenersArr[i][1], listenersArr[i][2]);
				}
				// cleanup dynamically embedded objects to fix audio/video threads and force open sockets and NetConnections to disconnect
				var il = objIdArr.length;
				for (var j = 0; j < il; j++) {
					removeSWF(objIdArr[j]);
				}
				// cleanup library's main closures to avoid memory leaks
				for (var k in ua) {
					ua[k] = null;
				}
				ua = null;
				for (var l in swfobject) {
					swfobject[l] = null;
				}
				swfobject = null;
			});
		}
	}();
	
	var publicApi = {
		/* Public API
			- Reference: http://code.google.com/p/swfobject/wiki/documentation
		*/ 
		registerObject: function(objectIdStr, swfVersionStr, xiSwfUrlStr, callbackFn) {
			if (ua.w3 && objectIdStr && swfVersionStr) {
				var regObj = {};
				regObj.id = objectIdStr;
				regObj.swfVersion = swfVersionStr;
				regObj.expressInstall = xiSwfUrlStr;
				regObj.callbackFn = callbackFn;
				regObjArr[regObjArr.length] = regObj;
				setVisibility(objectIdStr, false);
			}
			else if (callbackFn) {
				callbackFn({success:false, id:objectIdStr});
			}
		},
		
		getObjectById: function(objectIdStr) {
			if (ua.w3) {
				return getObjectById(objectIdStr);
			}
		},
		
		embedSWF: function(swfUrlStr, replaceElemIdStr, widthStr, heightStr, swfVersionStr, xiSwfUrlStr, flashvarsObj, parObj, attObj, callbackFn) {
			var callbackObj = {success:false, id:replaceElemIdStr};
			if (ua.w3 && !(ua.wk && ua.wk < 312) && swfUrlStr && replaceElemIdStr && widthStr && heightStr && swfVersionStr) {
				setVisibility(replaceElemIdStr, false);
				addDomLoadEvent(function() {
					widthStr += ""; // auto-convert to string
					heightStr += "";
					var att = {};
					if (attObj && typeof attObj === OBJECT) {
						for (var i in attObj) { // copy object to avoid the use of references, because web authors often reuse attObj for multiple SWFs
							att[i] = attObj[i];
						}
					}
					att.data = swfUrlStr;
					att.width = widthStr;
					att.height = heightStr;
					var par = {}; 
					if (parObj && typeof parObj === OBJECT) {
						for (var j in parObj) { // copy object to avoid the use of references, because web authors often reuse parObj for multiple SWFs
							par[j] = parObj[j];
						}
					}
					if (flashvarsObj && typeof flashvarsObj === OBJECT) {
						for (var k in flashvarsObj) { // copy object to avoid the use of references, because web authors often reuse flashvarsObj for multiple SWFs
							if (typeof par.flashvars != UNDEF) {
								par.flashvars += "&" + k + "=" + flashvarsObj[k];
							}
							else {
								par.flashvars = k + "=" + flashvarsObj[k];
							}
						}
					}
					if (hasPlayerVersion(swfVersionStr)) { // create SWF
						var obj = createSWF(att, par, replaceElemIdStr);
						if (att.id == replaceElemIdStr) {
							setVisibility(replaceElemIdStr, true);
						}
						callbackObj.success = true;
						callbackObj.ref = obj;
					}
					else if (xiSwfUrlStr && canExpressInstall()) { // show Adobe Express Install
						att.data = xiSwfUrlStr;
						showExpressInstall(att, par, replaceElemIdStr, callbackFn);
						return;
					}
					else { // show alternative content
						setVisibility(replaceElemIdStr, true);
					}
					if (callbackFn) { callbackFn(callbackObj); }
				});
			}
			else if (callbackFn) { callbackFn(callbackObj);	}
		},
		
		switchOffAutoHideShow: function() {
			autoHideShow = false;
		},
		
		ua: ua,
		
		getFlashPlayerVersion: function() {
			return { major:ua.pv[0], minor:ua.pv[1], release:ua.pv[2] };
		},
		
		hasFlashPlayerVersion: hasPlayerVersion,
		
		createSWF: function(attObj, parObj, replaceElemIdStr) {
			if (ua.w3) {
				return createSWF(attObj, parObj, replaceElemIdStr);
			}
			else {
				return undefined;
			}
		},
		
		showExpressInstall: function(att, par, replaceElemIdStr, callbackFn) {
			if (ua.w3 && canExpressInstall()) {
				showExpressInstall(att, par, replaceElemIdStr, callbackFn);
			}
		},
		
		removeSWF: function(objElemIdStr) {
			if (ua.w3) {
				removeSWF(objElemIdStr);
			}
		},
		
		createCSS: function(selStr, declStr, mediaStr, newStyleBoolean) {
			if (ua.w3) {
				createCSS(selStr, declStr, mediaStr, newStyleBoolean);
			}
		},
		
		addDomLoadEvent: addDomLoadEvent,
		
		addLoadEvent: addLoadEvent,
		
		getQueryParamValue: function(param) {
			var q = doc.location.search || doc.location.hash;
			if (q) {
				if (/\?/.test(q)) { q = q.split("?")[1]; } // strip question mark
				if (param == null) {
					return urlEncodeIfNecessary(q);
				}
				var pairs = q.split("&");
				for (var i = 0; i < pairs.length; i++) {
					if (pairs[i].substring(0, pairs[i].indexOf("=")) == param) {
						return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=") + 1)));
					}
				}
			}
			return "";
		},
		
		// For internal usage only
		expressInstallCallback: function() {
			if (isExpressInstallActive) {
				var obj = getElementById(EXPRESS_INSTALL_ID);
				if (obj && storedAltContent) {
					obj.parentNode.replaceChild(storedAltContent, obj);
					if (storedAltContentId) {
						setVisibility(storedAltContentId, true);
						if (ua.ie && ua.win) { storedAltContent.style.display = "block"; }
					}
					if (storedCallbackFn) { storedCallbackFn(storedCallbackObj); }
				}
				isExpressInstallActive = false;
			} 
		}
	};

  if (isInitDelayed) {
    var that = this,
        isInitialized = false;
    for (var fn in publicApi) {
      (function(oldFn) {
        if (typeof oldFn === "function") {
          publicApi[fn] = function() {
            if (!isInitialized) { 
              main();
              isInitialized = true;
            }
            return oldFn.apply(that, arguments);
          };
        }
      }(publicApi[fn]));
    }
  }

  return publicApi;
}();

dojo.provide('trimpath.TrimPath');
/**
 * TrimPath Template. Release 1.1.2.
 * Copyright (C) 2004 - 2007 TrimPath.
 *
 * TrimPath Template is licensed under the GNU General Public License
 * and the Apache License, Version 2.0, as follows:
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed WITHOUT ANY WARRANTY; without even the
 * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if (typeof(TrimPath) == 'undefined'){TrimPath = {};}

// TODO: Debugging mode vs stop-on-error mode - runtime flag.
// TODO: Handle || (or) characters and backslashes.
// TODO: Add more modifiers.

(function() {               // Using a closure to keep global namespace clean.
    if (TrimPath.evalEx == null){TrimPath.evalEx = function(src) { return eval(src); };}

    var UNDEFINED;
    if (Array.prototype.pop == null){Array.prototype.pop = function() {
        if (this.length === 0) {return UNDEFINED;}
        return this[--this.length];
    };}
    if (Array.prototype.push == null){Array.prototype.push = function() {
        for (var i = 0; i < arguments.length; ++i) {this[this.length] = arguments[i];}
        return this.length;
    };}

    TrimPath.parseTemplate = function(tmplContent, optTmplName, optEtc) {
        if (optEtc == null){optEtc = TrimPath.parseTemplate_etc;}
        var funcSrc = parse(tmplContent, optTmplName, optEtc);
        var func = TrimPath.evalEx(funcSrc, optTmplName, 1);
        if (func != null) {
          return new optEtc.Template(optTmplName, tmplContent, funcSrc, func, optEtc);
        }
        return null;
    }

    var exceptionDetails = function(e) {
        return (e.toString()) + ";\n " +
               (e.message) + ";\n " +
               (e.name) + ";\n " +
               (e.stack       || 'no stack trace') + ";\n " +
               (e.description || 'no further description') + ";\n " +
               (e.fileName    || 'no file name') + ";\n " +
               (e.lineNumber  || 'no line number');
    }

    try {
        String.prototype.process = function(context, optFlags) {
            var template = TrimPath.parseTemplate(this, null);
            if (template != null) {
              return template.process(context, optFlags);
            }
            return this;
        }
    } catch (e) { // Swallow exception, such as when String.prototype is sealed.
    }

    TrimPath.parseTemplate_etc = {};            // Exposed for extensibility.
    TrimPath.parseTemplate_etc.statementTag = "forelse|for|if|elseif|else|var|macro";
    TrimPath.parseTemplate_etc.statementDef = { // Lookup table for statement tags.
        "if"     : { delta:  1, prefix: "if (", suffix: ") {", paramMin: 1 },
        "else"   : { delta:  0, prefix: "} else {" },
        "elseif" : { delta:  0, prefix: "} else if (", suffix: ") {", paramDefault: "true" },
        "/if"    : { delta: -1, prefix: "}" },
        "for"    : { delta:  1, paramMin: 3,
                     prefixFunc : function(stmtParts, state, tmplName, etc) {
                        if (stmtParts[2] != "in") {
                          throw new etc.ParseError(tmplName, state.line, "bad for loop statement: " + stmtParts.join(' '));
                        }
                        var iterVar = stmtParts[1];
                        var listVar = "__LIST__" + iterVar;
                        return [ "var ", listVar, " = ", stmtParts[3], ";",
                             // Fix from Ross Shaull for hash looping, make sure that we have an array of loop lengths to treat like a stack.
                             "var __LENGTH_STACK__;",
                             "if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();",
                             "__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;", // Push a new for-loop onto the stack of loop lengths.
                             "if ((", listVar, ") != null) { ",
                             "var ", iterVar, "_ct = 0;",       // iterVar_ct variable, added by B. Bittman
                             "for (var ", iterVar, "_index in ", listVar, ") { ",
                             iterVar, "_ct++;",
                             "if (typeof(", listVar, "[", iterVar, "_index]) == 'function') {continue;}", // IE 5.x fix from Igor Poteryaev.
                             "__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;",
                             "var ", iterVar, " = ", listVar, "[", iterVar, "_index];" ].join("");
                     } },
        "forelse" : { delta:  0, prefix: "} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (", suffix: ") {", paramDefault: "true" },
        "/for"    : { delta: -1, prefix: "} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];" }, // Remove the just-finished for-loop from the stack of loop lengths.
        "var"     : { delta:  0, prefix: "var ", suffix: ";" },
        "macro"   : { delta:  1,
                      prefixFunc : function(stmtParts, state, tmplName, etc) {
                          var macroName = stmtParts[1].split('(')[0];
                          return [ "var ", macroName, " = function",
                                   stmtParts.slice(1).join(' ').substring(macroName.length),
                                   "{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; " ].join('');
                     } },
        "/macro"  : { delta: -1, prefix: " return _OUT_arr.join(''); };" }
    }
    TrimPath.parseTemplate_etc.modifierDef = {
        "eat"        : function(v)    { return ""; },
        "escape"     : function(s)    { return String(s).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); },
        "capitalize" : function(s)    { return String(s).toUpperCase(); },
        "default"    : function(s, d) { return s != null ? s : d; }
    }
    TrimPath.parseTemplate_etc.modifierDef.h = TrimPath.parseTemplate_etc.modifierDef.escape;

    TrimPath.parseTemplate_etc.Template = function(tmplName, tmplContent, funcSrc, func, etc) {
        this.process = function(context, flags) {
            if (context == null){context = {};}
            if (context._MODIFIERS == null){context._MODIFIERS = {};}
            if (context.defined == null){context.defined = function(str) { return (context[str] != undefined); };}
            for (var k in etc.modifierDef) {
                if (context._MODIFIERS[k] == null){context._MODIFIERS[k] = etc.modifierDef[k];}
            }
            if (flags == null){flags = {};}
            var resultArr = [];
            var resultOut = { write: function(m) { resultArr.push(m); } };
            try {
                func(resultOut, context, flags);
            } catch (e) {
                if (flags.throwExceptions == true) {
                  throw e;
                }
                var result = new String(resultArr.join("") +
                    "[ERROR: template: <pre>" + exceptionDetails(e) + "</pre>]");
                result["exception"] = e;
                return result;
            }
            return resultArr.join("");
        }
        this.name       = tmplName;
        this.source     = tmplContent;
        this.sourceFunc = funcSrc;
        this.toString   = function() { return "TrimPath.Template [" + tmplName + "]"; }
    }
    TrimPath.parseTemplate_etc.ParseError = function(name, line, message) {
        this.name    = name;
        this.line    = line;
        this.message = message;
    }
    TrimPath.parseTemplate_etc.ParseError.prototype.toString = function() {
        return ("TrimPath template ParseError in " + this.name + ": line " + this.line + ", " + this.message);
    }

    var parse = function(body, tmplName, etc) {
        body = cleanWhiteSpace(body);
        var funcText = [ "var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {" ];
        var state    = { stack: [], line: 1 };                              // TODO: Fix line number counting.
        var endStmtPrev = -1;
        while (endStmtPrev + 1 < body.length) {
            var begStmt = endStmtPrev;
            // Scan until we find some statement markup.
            begStmt = body.indexOf("{", begStmt + 1);
            while (begStmt >= 0) {
                var endStmt = body.indexOf('}', begStmt + 1);
                var stmt = body.substring(begStmt, endStmt);
                var blockrx = stmt.match(/^\{(cdata|minify|eval)/); // From B. Bittman, minify/eval/cdata implementation.
                if (blockrx) {
                    var blockType = blockrx[1];
                    var blockMarkerBeg = begStmt + blockType.length + 1;
                    var blockMarkerEnd = body.indexOf('}', blockMarkerBeg);
                    if (blockMarkerEnd >= 0) {
                        var blockMarker;
                        if( blockMarkerEnd - blockMarkerBeg <= 0 ) {
                            blockMarker = "{/" + blockType + "}";
                        } else {
                            blockMarker = body.substring(blockMarkerBeg + 1, blockMarkerEnd);
                        }

                        var blockEnd = body.indexOf(blockMarker, blockMarkerEnd + 1);
                        if (blockEnd >= 0) {
                            emitSectionText(body.substring(endStmtPrev + 1, begStmt), funcText);

                            var blockText = body.substring(blockMarkerEnd + 1, blockEnd);
                            if (blockType == 'cdata') {
                                emitText(blockText, funcText);
                            } else if (blockType == 'minify') {
                                emitText(scrubWhiteSpace(blockText), funcText);
                            } else if (blockType == 'eval') {
                                if (blockText != null && blockText.length > 0){funcText.push('_OUT.write( (function() { ' + blockText + ' })() );');}
                            }
                            begStmt = endStmtPrev = blockEnd + blockMarker.length - 1;
                        }
                    }
                } else if (body.charAt(begStmt - 1) != '$' &&               // Not an expression or backslashed,
                           body.charAt(begStmt - 1) != '\\') {              // so check if it is a statement tag.
                    var offset = (body.charAt(begStmt + 1) == '/' ? 2 : 1); // Close tags offset of 2 skips '/'.
                                                                            // 10 is larger than maximum statement tag length.
                    if (body.substring(begStmt + offset, begStmt + 10 + offset).search(TrimPath.parseTemplate_etc.statementTag) == 0) {
                      break;                                              // Found a match.
                    }
                }
                begStmt = body.indexOf("{", begStmt + 1);
            }
            if (begStmt < 0) {
              break;
            }
            var endStmt = body.indexOf("}", begStmt + 1); // In "a{for}c", endStmt will be 5.
            if (endStmt < 0) {
              break;
            }
            emitSectionText(body.substring(endStmtPrev + 1, begStmt), funcText);
            emitStatement(body.substring(begStmt, endStmt + 1), state, funcText, tmplName, etc);
            endStmtPrev = endStmt;
        }
        emitSectionText(body.substring(endStmtPrev + 1), funcText);
        if (state.stack.length != 0) {
          throw new etc.ParseError(tmplName, state.line, "unclosed, unmatched statement(s): " + state.stack.join(","));
        }
        funcText.push("}}; TrimPath_Template_TEMP");
        return funcText.join("");
    }

    var emitStatement = function(stmtStr, state, funcText, tmplName, etc) {
        var parts = stmtStr.slice(1, -1).split(' ');
        var stmt = etc.statementDef[parts[0]]; // Here, parts[0] == for/if/else/...
        if (stmt == null) {                    // Not a real statement.
            emitSectionText(stmtStr, funcText);
            return;
        }
        if (stmt.delta < 0) {
            if (state.stack.length <= 0) {
              throw new etc.ParseError(tmplName, state.line, "close tag does not match any previous statement: " + stmtStr);
            }
            state.stack.pop();
        }
        if (stmt.delta > 0){state.stack.push(stmtStr);}

        if (stmt.paramMin != null &&
            stmt.paramMin >= parts.length) {
          throw new etc.ParseError(tmplName, state.line, "statement needs more parameters: " + stmtStr);
        }
        if (stmt.prefixFunc != null){funcText.push(stmt.prefixFunc(parts, state, tmplName, etc));} else {funcText.push(stmt.prefix);}
        if (stmt.suffix != null) {
            if (parts.length <= 1) {
                if (stmt.paramDefault != null){funcText.push(stmt.paramDefault);}
            } else {
                for (var i = 1; i < parts.length; i++) {
                    if (i > 1){funcText.push(' ');}
                    funcText.push(parts[i]);
                }
            }
            funcText.push(stmt.suffix);
        }
    }

    var emitSectionText = function(text, funcText) {
        if (text.length <= 0) {
          return;
        }
        var nlPrefix = 0;               // Index to first non-newline in prefix.
        var nlSuffix = text.length - 1; // Index to first non-space/tab in suffix.
        while (nlPrefix < text.length && (text.charAt(nlPrefix) == '\n')){nlPrefix++;}
        while (nlSuffix >= 0 && (text.charAt(nlSuffix) == ' ' || text.charAt(nlSuffix) == '\t')){nlSuffix--;}
        if (nlSuffix < nlPrefix){nlSuffix = nlPrefix;}
        if (nlPrefix > 0) {
            funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');
            var s = text.substring(0, nlPrefix).replace('\n', '\\n'); // A macro IE fix from BJessen.
            if (s.charAt(s.length - 1) == '\n'){s = s.substring(0, s.length - 1);}
            funcText.push(s);
            funcText.push('");');
        }
        var lines = text.substring(nlPrefix, nlSuffix + 1).split('\n');
        for (var i = 0; i < lines.length; i++) {
            emitSectionTextLine(lines[i], funcText);
            if (i < lines.length - 1){funcText.push('_OUT.write("\\n");\n');}
        }
        if (nlSuffix + 1 < text.length) {
            funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');
            var s = text.substring(nlSuffix + 1).replace('\n', '\\n');
            if (s.charAt(s.length - 1) == '\n'){s = s.substring(0, s.length - 1);}
            funcText.push(s);
            funcText.push('");');
        }
    }

    var emitSectionTextLine = function(line, funcText) {
        var endMarkPrev = '}';
        var endExprPrev = -1;
        while (endExprPrev + endMarkPrev.length < line.length) {
            var begMark = "${", endMark = "}";
            var begExpr = line.indexOf(begMark, endExprPrev + endMarkPrev.length); // In "a${b}c", begExpr == 1
            if (begExpr < 0) {
              break;
            }
            if (line.charAt(begExpr + 2) == '%') {
                begMark = "${%";
                endMark = "%}";
            }
            var endExpr = line.indexOf(endMark, begExpr + begMark.length);         // In "a${b}c", endExpr == 4;
            if (endExpr < 0) {
              break;
            }
            emitText(line.substring(endExprPrev + endMarkPrev.length, begExpr), funcText);
            // Example: exprs == 'firstName|default:"John Doe"|capitalize'.split('|')
            var exprArr = line.substring(begExpr + begMark.length, endExpr).replace(/\|\|/g, "#@@#").split('|');
            for (var k in exprArr) {
                if (exprArr[k].replace){exprArr[k] = exprArr[k].replace(/#@@#/g, '||');}
            }
            funcText.push('_OUT.write(');
            emitExpression(exprArr, exprArr.length - 1, funcText);
            funcText.push(');');
            endExprPrev = endExpr;
            endMarkPrev = endMark;
        }
        emitText(line.substring(endExprPrev + endMarkPrev.length), funcText);
    }

    var emitText = function(text, funcText) {
        if (text == null ||
            text.length <= 0) {
          return;
        }
        text = text.replace(/\\/g, '\\\\');
        text = text.replace(/\n/g, '\\n');
        text = text.replace(/"/g,  '\\"');
        funcText.push('_OUT.write("');
        funcText.push(text);
        funcText.push('");');
    }

    var emitExpression = function(exprArr, index, funcText) {
        // Ex: foo|a:x|b:y1,y2|c:z1,z2 is emitted as c(b(a(foo,x),y1,y2),z1,z2)
        var expr = exprArr[index]; // Ex: exprArr == [firstName,capitalize,default:"John Doe"]
        if (index <= 0) {          // Ex: expr    == 'default:"John Doe"'
            funcText.push(expr);
            return;
        }
        var parts = expr.split(':');
        funcText.push('_MODIFIERS["');
        funcText.push(parts[0]); // The parts[0] is a modifier function name, like capitalize.
        funcText.push('"](');
        emitExpression(exprArr, index - 1, funcText);
        if (parts.length > 1) {
            funcText.push(',');
            funcText.push(parts[1]);
        }
        funcText.push(')');
    }

    var cleanWhiteSpace = function(result) {
        result = result.replace(/\t/g,   "    ");
        result = result.replace(/\r\n/g, "\n");
        result = result.replace(/\r/g,   "\n");
        result = result.replace(/^(\s*\S*(\s+\S+)*)\s*$/, '$1'); // Right trim by Igor Poteryaev.
        return result;
    }

    var scrubWhiteSpace = function(result) {
        result = result.replace(/^\s+/g,   "");
        result = result.replace(/\s+$/g,   "");
        result = result.replace(/\s+/g,   " ");
        result = result.replace(/^(\s*\S*(\s+\S+)*)\s*$/, '$1'); // Right trim by Igor Poteryaev.
        return result;
    }

    // The DOM helper functions depend on DOM/DHTML, so they only work in a browser.
    // However, these are not considered core to the engine.
    //
    TrimPath.parseDOMTemplate = function(elementId, optDocument, optEtc) {
        if (optDocument == null){optDocument = document;}
        var element = optDocument.getElementById(elementId);
        var content = element.value;     // Like textarea.value.
        if (content == null){content = element.innerHTML; // Like textarea.innerHTML.
}
        content = content.replace(/&lt;/g, "<").replace(/&gt;/g, ">");
        return TrimPath.parseTemplate(content, elementId, optEtc);
    }

    TrimPath.processDOMTemplate = function(elementId, context, optFlags, optDocument, optEtc) {
        return TrimPath.parseDOMTemplate(elementId, optDocument, optEtc).process(context, optFlags);
    }
}) ();
dojo.provide("clickability.w-button");
dojo.require("dj.util.Cookie");


/* Copyright 2000-2004 Clickability Inc.  */
/* Clickability ButtonServer v4.01        */

/*Functions*/
function getRegionpartnerID(TrackType)
{
  var regionCookie = dj.util.Cookie.getCookie('wsjregion');
  var defaultETRegion = 398944;
  var defaultPVRegion = 399154;

  if (typeof regionCookie !== "string" || regionCookie.length === 0)
  {
    return ((TrackType == "ET") ? defaultETRegion : defaultPVRegion);
  }
  var regionid = regionCookie.split(',');
  var ET = {};
  var PV = {};

  if (TrackType == 'ET')
  {
    ET.na = defaultETRegion;
    ET.europe = 398949;
    ET.asia = 398954;
  ET.india = 398959;
    //  console.log(ET[regionid[0]]);
  if(typeof regionid[1]!== "string")
  {
  return ET[regionid[0]];
  }
  else
  {
   return ((regionid[1].toLowerCase()=="india") ? ET[regionid[1]] : ET[regionid[0]]);
  }
  }
  else
  {
   PV.na = defaultPVRegion;
   PV.europe = 399159;
   PV.asia = 399164;
   PV.india = 399169;
   //  console.log(PV[regionid[0]]);
   if(typeof regionid[1]!== "string")
  {
    return PV[regionid[0]];
  }
  else
  {
     return ((regionid[1].toLowerCase()=="india") ? PV[regionid[1]] : PV[regionid[0]]);
    }
  }
}


function ST () {
  window.open('http://www.savethis.clickability.com/st/saveThisApp?clickMap=saveThis'+commonLoc(),'click',popWin);
  return false;
}

function STMouseOver () {
  window.status='SAVE THIS';
  return true;
}

function STMouseOut () {
  window.status='';
  return true;
}

function ET (mod) {
      var _c=new Image();
      var _qc='http://s.clickability.com/s?';
      _qc+="&7="+regionpartnerID;
      _qc+="&8="+escape(getEmailURL());
      _qc+="&10="+escape(getClickTitle());
      _qc+="&19=40003";
      _qc+="&21=1";
      _qc+="&18="+Math.random();
      _c.src=_qc;

  window.open('http://www.emailthis.clickability.com/et/emailThis?clickMap=create'+commonLoc(mod),'click',popWin);
  return false;
}

function ETMouseOver () {
  window.status='EMAIL THIS';
  return true;
}

function ETMouseOut () {
  window.status='';
  return true;
}

function MP () {
  window.open('http://at.wsj.com/mostpopular','click',popWin);
  return false;
}

function MPMouseOver () {
  window.status='MOST POPULAR';
  return true;
}

function MPMouseOut () {
  window.status='';
  return true;
}

function getClickURL() {
        if (self.clickURL) {
          return clickURL;
        }
        return document.location.href;
}

function getEmailURL() {
  if (typeof AT_VARS!=="undefined" && AT_VARS.articleEmailUrl && AT_VARS.articleUrl) {
    var emailUrl = AT_VARS.articleUrl;
    if(dj.context.article && dj.context.article.fullArticle){
        emailUrl = AT_VARS.articleEmailUrl;
    }
    return emailUrl;
  }
  return getClickURL();
}

function getClickTitle() {
  if (typeof AT_VARS!=="undefined" && AT_VARS.clickTitle) {
    return AT_VARS.clickTitle;
  }
  return document.title;
}
function getClickExpire() {
  if (self.clickExpire) {
    return clickExpire;
  }
  return "";
}

//document.write('<script language="JavaScript"> \n');
//document.write('window.onerror=function(){clickURL=document.location.href;return true;} \n');
//document.write('if(!self.clickURL) clickURL=parent.location.href; \n');
//document.write('<\/script> \n');

try {
    if (!self.clickURL) {
      clickURL=parent.location.href;
    }
  } catch (e) {
    console.error("Clickability. Cannot access parent.location.");
  }

/* WSJ.com Clickability Default Section Id/PV Id */
var PVpartnerID="59941",partnerID="150";
var regionpartnerID  = getRegionpartnerID('ET');
var PVregionpartnerID = getRegionpartnerID('PV');
/* WSJ.com Clickbility Section Id and PV Id mapping */

/* Barrons partnerID*/
if(dj.context.authorization.role.subscriber == 'BARRONS') {
  partnerID="3820";
}

var section_pv = new Array(20);

section_pv["Technology"]="110636";
section_pv["Tech"]="110636";
section_pv["Markets"]="110641";
section_pv["Market News"]="110641";
section_pv["Personal Journal"]="110651";
section_pv["Personal Finance"]="110651";
section_pv["Opinion"]="110646";
section_pv["Leisure/Weekend"]="110656";
section_pv["Lifestyle"]="110656";
section_pv["Life & Style"]="110656";
section_pv["Life &amp; Style"]="110656";
section_pv["Health"]="110676";
section_pv["Media"]="110671";

var section = new Array(20);

section["Technology"]="110591";
section["Tech"]="110591";
section["Markets"]="110596";
section["Market News"]="110596";
section["Personal Journal"]="110606";
section["Personal Finance"]="110606";
section["Opinion"]="110601";
section["Leisure/Weekend"]="110611";
section["Lifestyle"]="110611";
section["Life & Style"]="110611";
section["Life &amp; Style"]="110611";
section["Health"]="110631";
section["Media"]="110626";

try {
  if(window.mpsection){
    if(section_pv[mpsection]){
      PVpartnerID = section_pv[mpsection];
    }
    if(section[mpsection]){
      partnerID = section[mpsection];
    }
  }
}catch(err){
  txt="ERROR.\n\n"
  txt+="Error description: " + err.description + "\n\n"
  txt+="Click OK to continue.\n\n"
  console.error(txt);
}

var popWin="width=510,height=480,resizable=1,scrollbars=1";
var commonLoc=function(mod){return "&fb=Y&url="+escape(getEmailURL()+"?mod="+mod)+"&title="+escape(getClickTitle())+"&random="+Math.random()+"&partnerID="+partnerID+"&expire="+escape(getClickExpire())};

var inpop  = ( (document.domain.indexOf("printthis.clickability.com")>-1)?true:false);
var _a=new Image();
var _b=new Image();
var clickRan=Math.random();
var clickFac = 10;
if(clickFac==0){clickFac=1;}
if(!inpop && clickRan>(1-(1/clickFac))){
var _ti=900;
    var _qa="";
    var _qb="";


    // PAGE VIEW TRACKING
    var _qa='http://s.clickability.com/s?';
    _qa+="&7="+PVpartnerID;
    _qa+="&8="+escape(getClickURL());
    _qa+="&10="+escape(getClickTitle());
    _qa+="&19="+_ti;
    _qa+="&21="+clickFac;
    _qa+="&18="+Math.random();
    _a.src=_qa;
    // ET PAGEVIEW TRACKING
     var _qb='http://s.clickability.com/s?';
    _qb+="&7="+partnerID;
    _qb+="&8="+escape(getEmailURL());
    _qb+="&10="+escape(getClickTitle());
    _qb+="&19="+_ti;
    _qb+="&21="+clickFac;
    _qb+="&18="+Math.random();
    _b.src=_qb;


   // PAGE VIEW REGION TRACKING
    var _qa='http://s.clickability.com/s?';
    _qa+="&7="+PVregionpartnerID;
    _qa+="&8="+escape(getClickURL());
    _qa+="&10="+escape(getClickTitle());
    _qa+="&19="+_ti;
    _qa+="&21="+clickFac;
    _qa+="&18="+Math.random();
    _a.src=_qa;


    // ET PAGEVIEW REGION TRACKING
     var _qb='http://s.clickability.com/s?';
    _qb+="&7="+regionpartnerID;
    _qb+="&8="+escape(getEmailURL());
    _qb+="&10="+escape(getClickTitle());
    _qb+="&19="+_ti;
    _qb+="&21="+clickFac;
    _qb+="&18="+Math.random();
    _b.src=_qb;
}

// TODO: is this necessary?  This was written between 2000 and 2004, and this may be a Netscape 4 or IE 5 hack
// TODO:  intercepting window.onresize seems to be generally a bad idea.
window.onresize = function () {
    for (var i=0; i<document.links.length; i++) {
        document.links[i].onclick = document.links[i].onclick;
    }
};
dojo.provide("gravity.beacon");
dojo.require("dj.util.User");
dojo.require("dj.util.Cookie");

gravity.beacon = {
	init: function() {

		dj.util.User.getUserId(function(_u){
			var _cookieVal = '';
			if(_u !== ""){ 
				_cookieVal = _u;
			}else{
				var _anonymous = dj.util.Cookie.getCookie("djcs_route");
				if(_anonymous !== null){
					_cookieVal = _anonymous;
				}
			}
		
			if(dj.util.Cookie.getCookie("grvinsights") === null){
				if(_cookieVal !== ''){
					dj.util.Cookie.setCookie("grvinsights", _cookieVal);
					console.log("GARVITY COOKIE SET - "+_cookieVal);
				}
			}
		
			/* Gravity provided JS - Start */
			
			if(_u !== ""){ 
				var gravityInsightsParams = {type:'content', site_guid:'18f3b45caef80572d421f68a979bd6dc', user_id: _u};
			}else{
				var gravityInsightsParams = {type:'content', site_guid:'18f3b45caef80572d421f68a979bd6dc'};
			}
		
			var GravityInsights=function(b){
		
				function h(a,d){var c,f=d||"beacon";c=document.getElementsByTagName("title")[0]===void 0?"":encodeURIComponent(document.getElementsByTagName("title")[0].innerHTML);var g=new Date,g=g.getMilliseconds()+"-"+g.getSeconds();c=["cbust="+g,"site_guid="+b.site_guid,"action="+f,"user_guid="+a,"referrer="+e(document.referrer),"browser_useragent="+e(navigator.userAgent),"OS="+e(j()),"href="+e(location.href),"url="+k(),b.thread_id!==void 0?"thread_id="+b.thread_id:"",b.post_id!== void 0?"post_id="+b.post_id:"",b.forum_id!==void 0?"forum_id="+b.forum_id:"",b.user_id!==void 0?"user_id="+b.user_id:"",b.username!==void 0?"user_name="+e(b.username):"",b.post_title!==void 0?"post_title="+e(b.post_title):"",b.thread_title!==void 0?"thread_title="+e(b.thread_title):"",b.forum_title!==void 0?"forum_title="+e(b.forum_title):"",c!==void 0?"article_title="+c:"",b.external_user_id!==void 0?"external_user_id="+b.external_user_id:"",b.article_id!==void 0?"article_id="+b.article_id:"",b.type!== void 0?"type="+b.type:"",b.board!==void 0?"board="+encodeURIComponent(b.board):""].join("&");f=document.createElement("script");f.src=i+"/log?"+c;f.type="text/javascript";c=document.getElementsByTagName("head")[0]||document.documentElement;c.insertBefore(f,c.firstChild)}
		
				function e(a){return window.encodeURIComponent?encodeURIComponent(a):escape(a)}
		
				function j(){var a="Unknown OS";navigator.appVersion.indexOf("Win")!==-1&&(a="Windows");navigator.appVersion.indexOf("Mac")!==-1&&(a="MacOS");navigator.appVersion.indexOf("X11")!== -1&&(a="UNIX");navigator.appVersion.indexOf("Linux")!==-1&&(a="Linux");return a}
		
				function k(){var a=document.getElementsByTagName("link"),b=a.length,c="";for(x=0;x<b;x++)if((c=a[x].getAttribute("rel"))&&c.indexOf("canonical")===0)return encodeURIComponent(a[x].getAttribute("href"));else if(x===b)break;return encodeURIComponent(location.href)}
		
				var i="http://rma-api.gravity.com/v1/beacons";
				(function(){var a;a=document.cookie;var d=a.indexOf("grvinsights");if(d===-1)a=" ";else{var c=a.indexOf(";",d);if(c=== -1)c=a.length;a=unescape(a.substring(d+11+1,c))}if(a===" "||a==="")d="?u="+b.user_id+"&sg="+b.site_guid,a=document.createElement("script"),a.src=i+"/initialize"+d,a.type="text/javascript",d=document.getElementsByTagName("head")[0]||document.documentElement,d.insertBefore(a,d.firstChild),a=!1;a!==void 0&&a&&h(a,"beacon")})();
		
				return{cc:function(a,b){if(a!==""){var c=new Date;c.setTime(c.getTime()+432E8);c="; expires="+c.toGMTString();document.cookie=a+"="+b+c+"; path=/";h(b,"beacon")}}}
		
			}(gravityInsightsParams);
			
			/* Gravity provided JS - End */
		
		});
	}
};
/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  URL: https://github.com/twitter/hogan.js
 */

dojo.provide("hogan");
dojo.require("hogan._compiler");
dojo.require("hogan.Template");
hogan.template = hogan.Template;
dojo.provide("dj.util.AddressParser");
dj.util.AddressParser={clearAndNormalize:function(a){a=a.replace(/,/g," ");a=a.replace(/[^a-zA-Z 0-9]+/g,"");return a=a.toLowerCase()},parseZipCode:function(a){a=dojo.trim(a);if(this.pattern)this.pattern.compile(/\d{1,5}/gi);else this.pattern=/\d{1,5}/gi;return(this.matches=this.pattern.exec(a))?{zipCode:dojo.trim(this.matches[this.matches.length-1]),index:this.matches.index}:{zipCode:"",index:a.length}},parseAbbreviatedState:function(a){a=dojo.trim(a);var b=a.split(" ");b=b[b.length-1];var c=a.length;
if(b.length==2){c=a.lastIndexOf(b);if(b.match("al|ak|az|ar|ca|co|ct|de|dc|fl|ga|hi|id|il|in|ia|ks|ky|la|me|md|ma|mi|mn|ms|mo|mt|ne|nv|nh|nj|nm|ny|nc|nd|oh|ok|or|pa|ri|sc|sd|tn|tx|ut|vt|va|wa|wv|wi|wy"))return{state:b,index:c}}return{state:"",index:c}},abbreviateState:function(a){for(var b=["al","ak","az","ar","ca","co","ct","de","dc","fl","ga","hi","id","il","in","ia","ks","ky","la","me","md","ma","mi","mn","ms","mo","mt","ne","nv","nh","nj","nm","ny","nc","nd","oh","ok","or","pa","ri","sc","sd",
"tn","tx","ut","vt","va","wa","wv","wi","wy"],c=["alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","district of columbia","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island",
"south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming"],e=c.length-1;e>=0;e--)if(c[e]==a)return b[e];return a},parseState:function(a,b){a=dojo.trim(a);var c=this.parseAbbreviatedState(a);if(c.state!=="")return c;else{a=a.substring(0,c.index);c=a.split(" ");var e=c.length>1?c.length-2:0;if(e>=0){if(c[e]=="of"&&e>=0)e-=1;c=c[e].match("new|north|south|west|rhode|district")?c[e]=="district"&&c[e+2]?c[e]+" "+c[e+1]+" "+c[e+2]:
c[e]+" "+c[e+1]:c[c.length==1?0:e+1];if(e=c.match("alabama|alaska|arizona|arkansas|california|colorado|connecticut|delaware|district of columbia|florida|georgia|hawaii|idaho|illinois|indiana|iowa|kansas|kentucky|louisiana|maine|maryland|massachusetts|michigan|minnesota|mississippi|missouri|montana|nebraska|nevada|new hampshire|new jersey|new mexico|new york|north carolina|north dakota|ohio|oklahoma|oregon|pennsylvania|rhode island|south carolina|south dakota|tennessee|texas|utah|vermont|virginia|washington|west virginia|wisconsin|wyoming")){if(b)c=
this.abbreviateState(c);return{state:c,index:a.lastIndexOf(e[0])}}}return{state:"",index:a.length}}},parseCity:function(a){a=a.toLowerCase().replace(".","");var b=a.match(/^mt |^st |^ft |^pt |^pointe |^n |^s |^e |^w /),c={"mt ":"mount ","ft ":"fort ","st ":"saint ","pt ":"point ","pointe ":"point ","n ":"north ","s ":"south ","e ":"east ","w ":"west "};if(b)a=a.replace(b,c[b]);return a},parse:function(a,b){a=this.clearAndNormalize(a);var c=this.parseZipCode(a),e=this.parseState(a.substring(0,c.index),
b);return{city:this.parseCity(dojo.trim(a.substring(0,e.index))),state:e.state,zipCode:c.zipCode}}};
dojo.provide("dj.util.animation");
dj.util.animation={crossFadeInsert:function(a,b,c){var e=new dojo.Deferred,f=0,j,h,g,l;h=dojo.byId(b);b=dojo.delegate({height:500,fadeOut:800,fadeIn:1200},c);c=dojo.contentBox(h);dojo.style(h,{position:"relative",height:c.h+"px"});if(!dojo.isIE||dojo.isIE&&!dojo.isQuirks&&dojo.isIE>7)dojo.style(h,{minHeight:"inherit"});g=dojo.create("div",{innerHTML:h.innerHTML,style:{position:"absolute",top:dojo.style(h,"paddingTop")+"px",left:dojo.style(h,"paddingLeft")+"px"}});dojo.place(g,h,"only");l=dojo.create("div",
{style:{overflow:"hidden",opacity:0,height:0}},h);a=typeof a==="object"?dojo.place(a,l):dojo.create("div",{innerHTML:a},l);a=dojo.marginBox(a);j=function(){++f===3&&e.callback()};a=dojo.animateProperty({node:h,duration:b.height,properties:{height:{start:c.h,end:a.h}},onEnd:function(){dojo.style(l,{overflow:"visible"});j()}});c=dojo.fadeOut({node:g,duration:b.fadeIn,onEnd:function(){dojo.destroy(g);dojo.style(h,{position:""});dojo.attr(l,"style","");j()}});b=dojo.fadeIn({node:l,duration:b.fadeIn,onEnd:function(){j()}});
a.play();c.play();b.play();return e}};
dojo.provide("dj.util.Compatibility");function OpenG(a){dj.util.Url.openWin(a,"",980,707,"off",true,40,10)}function OpenWin(){dj.util.Url.openWin.apply(null,arguments)}function launchAudio(a){var b=a.split("/");OpenG("http://s.wsj.net/public/resources/documents/WSJ_audioPlayer08.html?audioFile="+a+"&trackName="+b[b.length-1])};
dojo.provide("dj.util.Form");
dj.util.Form={submitOnEvent:function(a,b,c){c=c||"onclick";a=dojo.byId(a);var e=document[b];if(typeof a==="undefined"||a===null||typeof e==="undefined"||e===null)console.warn("{dj.util.Form} element and/or form not found");else return dojo.connect(a,c,function(f){dojo.stopEvent(f);e.submit()})},clearOrDefaultValue:function(a){a=dojo.byId(a);dojo.connect(a,"onfocus",this,function(b){b=b.srcElement||b.target;if(b.value===b.defaultValue)b.value=""});dojo.connect(a,"onblur",this,function(b){b=b.srcElement||
b.target;if(b.value==="")b.value=b.defaultValue})},clearValue:function(a,b){var c=[],e=dojo.byId(a);if(e===null)throw Error("{dj.util.Form} element not found");var f=dojo.trim(e.value);if(typeof b=="undefined")e.value=" ";else if(dojo.isArray(b))c=b;else c.push(b);for(var j=0,h=c.length;j<h;j++)if(c[j]==f)e.value=""},checkEmpty:function(a){a=dojo.byId(a);if(a===null)throw Error("{dj.util.Form} element not found");return dojo.trim(a.value)===""},validateEmailAddresses:function(a){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(a)},
hasValidContent:function(a,b){if(b!=="")return a.test(b);return false}};
dojo.provide("dj.util.PollingConditionChecker");dojo.declare("dj.util.PollingConditionChecker",[],{check:function(a,b,c,e){var f=new dojo.Deferred,j=0,h;h=function(){if(j>=c)f.errback(e);else if(a())f.callback();else{j++;setTimeout(h,b)}};setTimeout(h,b);return f}});
dojo.provide("dj.util.user.Environment");dojo.declare("dj.util.user.Environment",[],{constructor:function(a,b,c){this.region=a;this.product=b;this.subType=c},toString:function(){return this.region+"_"+this.product+"_"+this.subType}});
dojo.provide("dj.util.Template");dojo.require("trimpath.TrimPath");dj.util.Template={processDOMTemplate:function(a,b){return TrimPath.processDOMTemplate(a,b)},parseTemplate:function(a,b,c){return TrimPath.parseTemplate(a,b,c)}};
dojo.provide("dj.util.Config");dojo.require("dj.util.Observer");
dojo.declare("dj.util.Config",null,{constructor:function(a){this.setOwner(a);this.cfg={};this.obs={};this.hasFired={}},getOwner:function(){return this.owner},setOwner:function(a){this.owner=a},addProperty:function(a,b){a=a.toLowerCase();if(typeof b=="undefined")throw Error("Config {key: '_', value: '_'} must be set for key '"+a+"'.");else if(typeof b.value=="undefined")throw Error("Config value must be defined for key '"+a+"'.");else if(typeof b.handler=="undefined"){this.setProperty(a,b.value,true);
return}var c=new dj.util.Observer,e=this.getOwner();c.subscribe(b.handler,e);this.obs[a]=c;this.setProperty(a,b.value,true)},getProperty:function(a){a=a.toLowerCase();return this.cfg[a]},setProperty:function(a,b,c){a=a.toLowerCase();this.cfg[a]=b;var e=null;if(!c){e=this.obs[a];e.fire(b)}},applyConfig:function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b],true)},fireQueue:function(a){a=typeof a=="undefined"?false:a;var b=null,c;for(c in this.cfg)if(this.cfg.hasOwnProperty(c)){var e=
this.cfg[c];if(!a&&this.hasFired[c])break;b=this.obs[c];if(typeof b=="undefined")break;b.fire(e);this.hasFired[c]=true}}});
dojo.provide("dj.util.History");dojo.require("dj.util.Observer");
dj.util.History=function(){function a(){var h=window.location.hash;if(h.charAt(0)=="#")h=h.substring(1);return dojo.isMozilla?h:decodeURIComponent(h)}function b(h){h||(h="");window.location.hash=encodeURIComponent(h);historyCounter=history.length}function c(){var h=a();j=new dj.util.Observer;e=dojo.queryToObject(h);dojo.back.init();dojo.back.setInitialState({changeUrl:h,back:function(){j.fireByName("_init",null)},forward:function(){j.fireByName("_init",null)}})}var e=null,f=false,j=null;return{init:function(){if(!f){f=
true;c()}},get:function(h){return e[h]},set:function(h,g,l){e[h]=g;var n=dojo.objectToQuery(e);(typeof l==="boolean"?l:false)===false?dojo.back.addToHistory({changeUrl:n,back:function(){j.fireByName(h,g)},forward:function(){j.fireByName(h,g)}}):b(n)},subscribe:function(h,g,l){j.subscribeByName(h,g,l)}}}();
dojo.provide("dj.util.user.EnvironmentDao");dojo.require("dj.util.user.Environment");
dojo.declare("dj.util.user.EnvironmentDao",[],{constructor:function(a,b){this.region=a;this.user=b},getEnvironment:function(){var a=new dojo.Deferred,b=new dj.util.user.Environment;b.region=this.getRegion();this.getProduct().then(dojo.hitch(this,function(c){b.product=c;return this.user.getSubscriptionType()})).then(dojo.hitch(this,function(c){b.subType=c;a.callback(b)}));return a},getRegion:function(){return(this.region.getViewByRegion().split(",")[0]||"NA").toUpperCase()},getProduct:function(){var a=
new dojo.Deferred;this.user.hasRole("WSJ-PRO",dojo.hitch(this,function(b){b?a.callback("PRO"):this.user.hasRole("WSJ-ENT",function(c){c?a.callback("PRO"):a.callback("WSJ")})}));return a}});
dojo.provide("dj.util.io.script");dojo.require("dj.util.string");dojo.require("dj.util.io");
dj.util.io.script={get:function(a){var b=new dojo.Deferred,c="dj.util.io.script._jsonp"+ ++this.__ctr+"._jsonpCallback";a=dojo.mixin({jsonp:"c",jsonpCallback:c,content:{},timeout:5E3},a);var e,f=false;dj.util.string.toFunction(a.jsonpCallback,function(j){f=true;b.callback(j)});a.content[a.jsonp]=a.jsonpCallback;c=dojo.objectToQuery(a.content);e=a.url+"?"+c;dj.util.io.insertScriptAsync(e);setTimeout(function(){f||b.errback("[io.script] url timed out: '"+e+"'")},a.timeout);return b},__ctr:0};
dojo.provide("dj.util.onVisible");dojo.require("dj.util.Element");dojo.require("dojo.window");
dj.util.onVisible={_cfg:{defaultScrollProximity:70,pollingInterval:50},scan:function(){if(!this.__isScanning){this.__isScanning=true;this._getModules();this._initOnScroll()}},addModule:function(a,b){this._getModules().push({query:a,nodeList:dojo.query(a),cb:b})},refreshModules:function(){dojo.forEach(this._getModules(),function(a){var b=dojo.query(a.query);a.nodeList=a.nodeList.concat(b)});this._handleOnScroll()},isInitialized:function(a){if(a==null){console.error("{isInitialized} domNode="+a);return true}return dj.util.Element.getData(a,
"isInitialized")=="true"},markAsInitialized:function(a){if(a==null){console.error("{markAsInitialized} domNode="+a);return true}dj.util.Element.setData(a,"isInitialized","true")},getDatasetFromWidget:function(a){a=dj.util.Element.getDataset(a);delete a.djWidget;return a},_getModules:function(){if(!this.modules)this.modules=[];return this.modules},_initOnScroll:function(){if(!this._onScrollAdded){this._onScrollAdded=true;this._interval=window.setInterval(dojo.hitch(this,this._handleOnScroll),this._cfg.pollingInterval)}if(!this._lastTick)this._lastTick=
(new Date).getTime()-1;if(!this._lastBox){this._lastBox=dojo.window.getBox();this._lastBox.t++}this._canScroll=this._isOnScrollPossible()},_handleOnScroll:function(){var a=dojo.window.getBox(),b=(new Date).getTime();if(!(a.t===this._lastBox.t&&a.h===this._lastBox.h&&b-this._lastTick<1E3)){this._lastTick=b;this._lastBox=a;dojo.forEach(this.modules,function(c){c.nodeList.forEach(function(e){if(!this.isInitialized(e)){var f=this.getDatasetFromWidget(e);if(!this._canScroll||this._isNodeVisible(e,f)){this.markAsInitialized(e);
try{c.cb(e,f)}catch(j){console.error("{util.onVisible} failed to load module: %o, error: %o",e,j)}}}},this)},this)}},_isNodeVisible:function(a,b){var c=dojo.position(a,true);if(!this._isNodeDisplayed(a))return false;var e=(this.getDatasetFromWidget(a)||b).djScrollProximity||this._cfg.defaultScrollProximity;e=new Number(e);var f=dojo.window.getBox();return this._isInProximity(c,f,e)},_isNodeDisplayed:function(a){if(a===null)return true;var b=a.tagName.toLowerCase();if(b==="body")return true;var c=
dojo.style(a,"display");return b=="script"||c!=="none"?this._isNodeDisplayed(a.parentNode):false},_isInProximity:function(a,b,c){var e=b.t-c<a.y+a.h,f=b.t+b.h+c>a.y;return b.t-c>a.y&&b.t+b.h+c<a.y+a.h||e&&f},_isOnScrollPossible:function(){var a=navigator.userAgent.toLowerCase(),b=a.indexOf("iphone")>-1;a=a.indexOf("ipad")>-1;return dojo.isBrowser&&!(b||a)}};
dojo.provide("dj.util.onVisibleWidget");dojo.require("dj.util.onVisible");dojo.require("dj.util.Template");
dj.util.onVisibleWidget={scan:function(){this.onv=dj.util.onVisible;this.onv.addModule("[data-dj-widget=onvisible.module]",dojo.hitch(this,this.loadModule));this.onv.addModule("[data-dj-widget=onvisible.template]",dojo.hitch(this,this.loadTemplate));this.onv.scan()},loadModule:function(a,b){var c=b.djModule,e=b.djModuleInit||"init";console.info("{loadModule} deferred load, module="+c+"."+e);if(c=dojo.getObject(c))if(typeof c[e]==="function"){delete b.djWidget;delete b.djModule;delete b.djModuleInit;
delete b.djScrollProximity;c[e].call(c,b,a)}else throw Error("{_loadModule} data-module-init %s is not a function",e);},loadTemplate:function(a,b){console.info("{loadTemplate} deferred load, template id="+(a.id?a.id:""));delete b.djWidget;this._handleTemplate(a,b);this.onv.refreshModules()},getDatasetFromWidget:function(a){this.onv.getDatasetFromWidget(a)},_handleTemplate:function(a,b){var c=this._getTemplateFromWidget(a);this._renderTemplate(a,c,b)},_getTemplateFromWidget:function(a){var b=dojo.query("textarea",
a)[0];if(!b)throw Error("{util.onVisibleWidget} no template domNode found in %o",a);return this._stripCdataTags(b.value)},_renderTemplate:function(a,b,c){b=dj.util.Template.parseTemplate(b).process(c);a.innerHTML=b},_stripCdataTags:function(a){a=a.replace(/\s*<!\[CDATA\[\s*/,"");return a=a.replace(/\s*\]\]>\s*/,"")}};
dojo.provide("dj.util.liveWidget");dojo.require("dj.lang");dojo.require("dj.util.Element");
dj.util.liveWidget={register:function(a,b,c){if(typeof a!=="string"||!a||typeof b!=="function")throw Error("{liveWidget.register} widgetName must be a non-empty string, and callback -- a function");var e=this;this._widgetEvents[a]=dj.lang.addLiveEvent("div[data-dj-live-widget="+a+"]","click",function(f){if(!e._isInitialized(this)){e._markAsInitialized(this);var j=dj.util.Element.getDataset(this);delete j.djLiveWidget;f={domNode:this,event:f};try{b.call(c,f,j)}catch(h){console.error("{liveWidget} '%s': %o threw: %o",
a,this,h.message)}}})},unregister:function(a){if(typeof a!=="string"||!a)throw Error("{liveWidget.unregister} widgetName must be a non-empty string");(a=this._widgetEvents[a])&&dj.lang.removeLiveEvent(a)},_isInitialized:function(a){return dj.util.Element.getData(a,"isInitialized")=="true"},_markAsInitialized:function(a){dj.util.Element.setData(a,"isInitialized","true")},_widgetEvents:[]};
dojo.provide("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.dao.FileServiceDao",[],{DEFAULT_CONFIG:{TTL:"24h"},constructor:function(a,b,c){this.script=a;this.coreContext=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c)},getFragment:function(a){if(!a||!a.id)throw Error("FileServiceDao: fragment must have an id");this._useDataId(a.id);var b=new dojo.Deferred,c,d=a.getAbsolutePaths();c=this._getFileServiceUrl();d={absolutePath:d,TTL:this.cfg.TTL};if(this.cfg.maxCacheDurationSeconds!==null&&typeof this.cfg.maxCacheDurationSeconds!=
"undefined")d.maxCacheDurationSeconds=this.cfg.maxCacheDurationSeconds;c=this.script.get({url:c,content:d,jsonp:"c",jsonpCallback:"dj.module._fileServiceDao."+a.id,timeout:25E3});c.addCallback(this,function(e){var f,g,h;g=0;for(h=e.files.length;g<h;g++){f=e.files[g];if(f.statusCode!==200){b.errback(Error("FileServiceDao: unsuccessful status code: "+f.statusCode+" for url: "+f.absolutePath));return}}b.callback(this._populateFragmentWithFiles(a,e.files))});c.addErrback(function(e){b.errback(Error("FileServiceDao: service error: "+
e))});return b},__dataIds:{},_useDataId:function(a){this.__dataIds[a]=true},_getFileServiceUrl:function(){var a=this.coreContext.customCacheCdnPrefix;if(typeof this.cfg.akamaiCdnPrefix!=="undefined"&&this.cfg.akamaiCdnPrefix!=="")a=this.cfg.akamaiCdnPrefix;return a+"/cdssvco/file/v2/Files"},_populateFragmentWithFiles:function(a,b){if(dojo.isArray(a.cssFiles))for(var c=0,d=a.cssFiles.length;c<d;c++){var e=a.cssFiles[c];e.data=this._getDataByPath(b,e.absolutePath)}if(a.jsFile)a.jsFile.data=this._getDataByPath(b,
a.jsFile.absolutePath);if(a.htmlFile)a.htmlFile.data=this._getDataByPath(b,a.htmlFile.absolutePath);if(a.jsonFile)a.jsonFile.data=this._getDataByPath(b,a.jsonFile.absolutePath);return a},_getDataByPath:function(a,b){var c,d,e;c=0;for(d=a.length;c<d;c++){e=a[c];if(e.absolutePath===b)return e.data}throw"FileServiceDao: path is not in the files";}});
dojo.provide("dj.widget.fragmentloader.File");dojo.declare("dj.widget.fragmentloader.File",[],{constructor:function(a,b){this.absolutePath=a;this.data=b}});
dojo.provide("dj.widget.fragmentloader.Fragment");dojo.declare("dj.widget.fragmentloader.Fragment",[],{constructor:function(a,b,c,d){this.id=a;this.cssFiles=b;this.jsFile=c;this.htmlFile=d},getAbsolutePaths:function(){var a=[],b,c;if(dojo.isArray(this.cssFiles)){b=0;for(c=this.cssFiles.length;b<c;b++)a.push(this.cssFiles[b].absolutePath)}this.jsFile&&a.push(this.jsFile.absolutePath);this.htmlFile&&a.push(this.htmlFile.absolutePath);return a}});
dojo.provide("dj.widget.fragmentloader.JSONFragment");dojo.declare("dj.widget.fragmentloader.JSONFragment",[],{constructor:function(a){this.id=(this.jsonFile=a)&&this.jsonFile.cId?this.jsonFile.cId:"x"},getAbsolutePaths:function(){var a=[];this.jsonFile&&this.jsonFile.absolutePath&&a.push(this.jsonFile.absolutePath);return a}});
dojo.provide("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.util.string");
dojo.declare("dj.widget.fragmentloader.renderer.FileRenderer",[],{constructor:function(a,b){this.animation=a;this.checker=b},renderCss:function(a){var b,c,d,e,f=dojo.doc.head||dojo.query("head")[0];b=0;for(c=a.length;b<c;b++){e=a[b];d=dojo.create("style",{type:"text/css","data-absolutePath":e.absolutePath});cssStr=e.data;if(d.styleSheet)d.styleSheet.cssText=cssStr;else d.appendChild(dojo.doc.createTextNode(cssStr));dojo.place(d,f,"last")}},renderHtml:function(a,b,c){c=typeof c=="undefined"?true:c;
var d=new this.checker.check(function(){return dojo.byId(b)},25,40,"Retriever: exceded num of retries for HTML");if(c)return dojo.when(d,dojo.hitch(this.animation,"crossFadeInsert",a.data,b));else{dojo.place(a.data,b,"only");def=new dojo.Deferred;def.resolve();return def}},renderJs:function(a){var b=dojo.create("script",{type:"text/javascript"});if(dojo.isIE)b.text=a.data;else b.appendChild(dojo.doc.createTextNode(a.data));a=dojo.doc.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)},
renderInlineJs:function(a){dj.util.string.evalScripts(a.data,a.absolutePath)}});
dojo.provide("dj.widget.fragmentloader.bo.FragmentBo");dojo.require("dj.widget.fragmentloader.File");dojo.require("dj.widget.fragmentloader.Fragment");
dojo.declare("dj.widget.fragmentloader.bo.FragmentBo",[],{DEFAULT_CONFIG:{js:{providedUnits:"j_global_slim"},css:{},html:{}},constructor:function(a,b,c){this.dao=a;this.userEnv=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c);this.assetPaths=dj.context.core.assetPaths;this.cssToGetList=dj.context.core.cssToGet},getFragment:function(a,b){return dojo.when(this.userEnv,dojo.hitch(this,function(c){var d="fragment_"+c.toString()+"_"+a;d=new dj.widget.fragmentloader.Fragment(d);d.cssFiles=this.cfg.isLoadCss?
this._getCssFiles(c,a,b):undefined;d.jsFile=this.cfg.isLoadJs?this._getJsFile(c,a,b):undefined;d.htmlFile=this.cfg.isLoadHtml?this._getHtmlFile(c,a,b):undefined;return this.dao.getFragment(d)}))},_getCssFiles:function(a,b,c){var d=this._getCssFileList(dojo.isIE),e=Array(d.length);i=0;for(len=d.length;i<len;i++)e[i]=new dj.widget.fragmentloader.File(this.assetPaths.style+"/"+d[i]+"/"+a+"/"+b+"-"+c+".css");return e},_getJsFile:function(a,b,c){return new dj.widget.fragmentloader.File(this.assetPaths.script+
"/bucket/"+a+"/page/"+b+"/provided/"+this.cfg.js.providedUnits+"/version/"+c+".js")},_getHtmlFile:function(a,b,c){var d=this._getHtmlChipStr();return new dj.widget.fragmentloader.File("/public"+this.assetPaths.page+"/"+a+":"+b+"-"+d+c+".html")},_getHtmlChipStr:function(){return dojo.isArray(this.cfg.html.chips)?this.cfg.html.chips.join("-")+"-":""},_getCssFileList:function(a){var b=["2/std","3/std","4/std"];if(typeof this.cssToGetList!=="undefined")b=this.cssToGetList;if(typeof a!=="undefined")if(a<
7)b.push("1/ie6");else if(a==7)b.push("1/ie7");else if(a==8)b.push("1/ie8");else a==9&&b.push("1/ie9");return b}});
dojo.provide("dj.widget.fragmentloader.bo.FragmentJSONBo");dojo.require("dj.widget.fragmentloader.File");dojo.require("dj.widget.fragmentloader.JSONFragment");
dojo.declare("dj.widget.fragmentloader.bo.FragmentJSONBo",dj.widget.fragmentloader.bo.FragmentBo,{DEFAULT_CONFIG:{},constructor:function(a,b,c){this.dao=a;this.userEnv=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c)},getFragment:function(a,b){return dojo.when(this.userEnv,dojo.hitch(this,function(c){frag=new dj.widget.fragmentloader.JSONFragment(this.cfg);frag.jsonFile=this.cfg.isLoadJson?this._getJsonFile(c,b):undefined;return this.dao.getFragment(frag)}))},_getJsonFile:function(a,b){var c=a;c+=
a.indexOf("?")==-1?"?v="+b:"&v="+b;return new dj.widget.fragmentloader.File(c)}});
dojo.provide("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.PollingConditionChecker");dojo.require("dj.util.animation");dojo.require("dj.util.io.script");dojo.require("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.widget.fragmentloader.bo.FragmentBo");dojo.require("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.FragmentLoader",[],{DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,isLoadInlineJs:false,isDataCallback:false,isAnimated:true,akamaiCdnPrefix:""},constructor:function(a,b,c,d,e){this.userEnv=a;this.mstPageId=b;this.domNodeId=d;this.version=c;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,e);this._initRenderers()},load:function(){return dojo.when(this.fragmentBo.getFragment(this.mstPageId,this.version),dojo.hitch(this,function(a){this.cfg.isDataCallback&&
this.onDataCallback(a);if(this.cfg.isLoadCss){this.fileRenderer.renderCss(a.cssFiles);this.onCssLoad()}if(this.cfg.isLoadHtml)this.fileRenderer.renderHtml(a.htmlFile,this.domNodeId,this.cfg.isAnimated).then(dojo.hitch(this,function(){this.onHtmlLoad();if(this.cfg.isLoadJs){this.fileRenderer.renderJs(a.jsFile);this.onJsLoad()}if(this.cfg.isLoadInlineJs){this.fileRenderer.renderInlineJs(a.htmlFile);this.onInlineJsLoad()}}));else if(this.cfg.isLoadJs){this.fileRenderer.renderJs(a.jsFile);this.onJsLoad()}}))},
onCssLoad:function(){},onJsLoad:function(){},onHtmlLoad:function(){},onInlineJsLoad:function(){},onDataCallback:function(){},_initRenderers:function(){var a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,dj.context.core,this.cfg),b=new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentBo(a,this.userEnv,this.cfg);this.fileRenderer=new dj.widget.fragmentloader.renderer.FileRenderer(dj.util.animation,b)}});
dojo.provide("dj.widget.fragmentloader.FragmentJSONLoader");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.PollingConditionChecker");dojo.require("dj.util.animation");dojo.require("dj.util.io.script");dojo.require("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.widget.fragmentloader.bo.FragmentJSONBo");dojo.require("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.FragmentJSONLoader",dj.widget.fragmentloader.FragmentLoader,{DEFAULT_CONFIG:{isLoadJson:true,TTL:"24h"},constructor:function(a,b,c){this.url=a;this.version=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c);this._initRenderers()},load:function(){return dojo.when(this.fragmentBo.getFragment(this.mstPageId,this.version),dojo.hitch(this,function(a){this.cfg.isLoadJson&&this.onLoadJson(a)}))},onLoadJson:function(){},_initRenderers:function(){var a=dojo.clone(dj.context.core);
a.customCacheCdnPrefix=dj.context.core.cdnPrefix;a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,a,this.cfg);new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentJSONBo(a,this.url,this.cfg)}});

dojo.provide("dj.util.bluegrass");dj.util.bluegrass=function(){var Connection=function(runtime,endpoint,callback){var _runtime=runtime;var _endpoint=endpoint;var _callbacks=[];_callbacks.push(callback);var _channels={};var _impl=null;var _reconnectTimer=null;var thunk=this;var _callback=function(connection,type){dojo.forEach(_callbacks,function(callbck){try{callbck(connection,type);}
catch(err){if(typeof(console)!="undefined"&&console.warn)
{console.warn("Error in connection callback: "+err.message);}}});};var _channelTrigger=function(message,channel){if(message.h.a=="unsubscribe"){if(_channels[channel.getChannelName()]!==null)
{delete _channels[channel.getChannelName()];}}
_impl.send(message);};var _systemCallback=function(message){if(message.h.a==="process"&&message.b){if(message.b.reconnect&&_reconnectTimer===null){_impl.setPickupInterval(5000);_reconnectTimer=setTimeout(function(){_reconnect();},2000);}
else if(message.b.pickupInterval&&_impl!==null){_impl.setPickupInterval(message.b.pickupInterval);}
else if(message.b.channelState){_setChannelState(message.b.channelState);}}
else if(message.h.a==="inform"){if(message.h.t==="/system/channelinfo"){_setChannelInfo(message.b);}}};var _reconnect=function(){var channels=[];try{for(var channelKey in _channels){if(channelKey)
{var tempChannel=_channels[channelKey];if(tempChannel)
{tempChannel.clearTimers();channels.push({c:tempChannel.getChannelName(),b:tempChannel.getCallbacks(),n:tempChannel.getLastMessageNumber()});}}}}
catch(e){}
_channels={};var type="reconnect";if(!_impl||!_impl.isOpen()){type="connect";}
var callback=function(){_callback(thunk,type);dojo.forEach(channels,function(channel){channel=thunk.subscribe(channel.c,channel.b[0],{sequence:null,number:channel.n});if(typeof channel.b!=='undefined'&&channel.b.length>1){for(var i=1;i<channel.b.length;i++){channel.addCallback(channel.b[i]);}}});};_implInitialize(callback);_reconnectTimer=null;};var _setChannelInfo=function(channelInfo){if(channelInfo&&channelInfo.channelName){var tempChannel=_channels[channelInfo.channelName];if(tempChannel){if(tempChannel.getChannelName()==channelInfo.channelName){if(channelInfo.deliveryType){tempChannel.setDeliveryType(channelInfo.deliveryType);}}}}};var _setChannelState=function(channelState){var channel=_channels[channelState.channelName];if(channel!==null){if(!channelState.enabled){channel.resetState();}}};var _implInitialize=function(callback){_implTerminate();var connectCallback=function(){_callback(thunk,"connect");};if(callback){connectCallback=callback;}
_impl=new ConnectionImpl(connectCallback,function(message){_systemCallback(message);});_impl.initialize(_endpoint,function(impl,messages){_implCallback(impl,messages);});};var _implTerminate=function(){if(_impl!==null){_impl.terminate();_impl=null;}};var _implCallback=function(impl,messages){if(impl!=_impl){impl.terminate();return;}
if(!messages){return;}
for(var i=0;i<messages.length;i++){var mess=messages[i];var channel=_channels[mess.h.t];if(channel){channel.deliver(mess);}}};this.subscribe=function(channelName,callback,options){var channel;if(_channels[channelName]===null||typeof(_channels[channelName])==='undefined'){channel=new Channel(channelName,callback,options,_channelTrigger);_channels[channelName]=channel;}
else{channel=_channels[channelName];channel.addCallback(callback);}
return channel;};this.unsubscribe=function(channelName,callback,options){var channel;if(_channels[channelName]!==null||typeof(_channels[channelName])!=='undefined'){console.log(channelName);channel=_channels[channelName];channel.removeCallback(callback);channel.unsubscribe();}
return channel;};this.getChannel=function(channelName){return _channels[channelName];};this.close=function(){_callbacks=[];_channels={};_implTerminate();};this.reconnect=function(){if(_reconnectTimer===null){_reconnectTimer=setTimeout(function(){_reconnect();},100);}};this.isOpen=function(){if(_impl!==null){return _impl.isOpen();}
else{return false;}};this.isDisabled=function(){if(_impl!==null){return _impl.isDisabled();}
else{return false;}};this.addCallback=function(callback){_callbacks.push(callback);};this.setTransmitHook=function(hook){_impl.setTransmitHook(hook);};this.setReceiveHook=function(hook){_impl.setReceiveHook(hook);};this.scrambleClientId=function(){_impl.scrambleClientId();};this.getChannelCount=function(){var size=0;for(var key in _channels){if(_channels.hasOwnProperty(key)){size++;}}
return size;};_implInitialize();};var ConnectionImpl=(function(){return function(connectCallback,systemCallback){var _callback,_endpoint;var _clientInfo,_protocolInfo;var _transmitHookCallback=null;var _receiveHookCallback=null;var _outgoing=[];var _connectFailCount=0;var _failCount=0;var _inProgress=0;var _timer,_connectTimer;var _isOpen=false,_isDisabled=false;var _sendTimer=null;var _connectCallback=connectCallback;var _systemCallback=systemCallback;var thunk=this;var _pumpMessages=function(){if(!_isOpen){return;}
_sendTimer=null;var shouldSend=false;if(_inProgress<1){shouldSend=true;}
else if(_inProgress<2&&_outgoing.length>0){shouldSend=true;}
if(shouldSend){var immediate=_outgoing.length>0;for(var i=0,l=_outgoing.length;i<l;i++){var o=_outgoing[i];if(o.b&&('0'===o.b.number)&&(''===o.b.sequence)){delete o.b;}}
var payload={c:dojo.toJson(_clientInfo),m:dojo.toJson(_outgoing.splice(0,15))};if(typeof(_protocolInfo.pickupInterval)==='number'&&_protocolInfo.pickupInterval>0&&_failCount===0&&!immediate){_timer=setTimeout(function(){_messageRequest(payload);},_protocolInfo.pickupInterval);}
else if(_failCount>0){_timer=setTimeout(function(){_messageRequest(payload);},1000*Math.min(900,Math.pow(2,_failCount)));}
else{clearTimeout(_timer);_messageRequest(payload);if(_outgoing.length>0){_sendTimer=setTimeout(_pumpMessages,100);}}}};var _connectFail=function(xhr,status,error,message){_connectFailCount++;_connectTimer=setTimeout(function(){_connectRequest();},1000*Math.min(900,Math.pow(2,_connectFailCount)));};var _connectResponse=function(request,response){_clientInfo=response.clientInfo;_protocolInfo=response.protocolInfo;_inProgress=0;if(response.status.disabled){_isOpen=false;_isDisabled=true;}
else{_isOpen=true;_pumpMessages();if(dojo.isFunction(_connectCallback)){_connectCallback();}}};var _connectRequest=function(){var url=_endpoint.to;if(_endpoint.via){url=_endpoint.via+"?to="+url;}
dojo.xhrGet({url:url,preventCache:true,failOk:true,headers:{"X-Requested-With":""},handleAs:"json",load:function(responseObject,xhr){_connectResponse(xhr,responseObject);},error:function(error,ioArgs){_connectFail(ioArgs,ioArgs.xhr.status,error,request);}});};var _messageRequest=function(request){var url=_protocolInfo.pickupUrl;var currentDomain='http://'+document.location.toString().split(/\/+/g)[1];if(_endpoint.altPickupUrl){url=_endpoint.altPickupUrl;}else if(_endpoint.via){url=_endpoint.via+"?to="+url;}else{var tmpUrl=url;if(tmpUrl.indexOf("com")!==-1){tmpUrl=tmpUrl.substring(tmpUrl.indexOf("com")+3,tmpUrl.length);url=currentDomain+tmpUrl;}
else{url=tmpUrl.replace(tmpUrl.split(/\/+/g)[1],document.location.toString().split(/\/+/g)[1]);}}
_inProgress++;if(_transmitHookCallback!==null){dojo.forEach(eval(request.m),function(rm){_transmitHookCallback(rm,_clientInfo);});}
dojo.xhrGet({url:url,content:request,preventCache:true,failOk:true,headers:{"X-Requested-With":""},handleAs:"json",load:function(responseObject,xhr){_messageResponse(responseObject);},error:function(error,ioArgs){_messageFail(ioArgs,ioArgs.xhr.status,error,request);}});};var _messageResponse=function(response){_inProgress--;_failCount=0;if(response!==null&&response.length>0){if(_receiveHookCallback!==null){dojo.forEach(response,function(res){_receiveHookCallback(res);});}
dojo.forEach(response,function(res){if(res.h&&res.h.t&&res.h.t.indexOf("\/system\/")===0){_systemCallback(res);}});}
_callback(thunk,response);_pumpMessages();};var _messageFail=function(xhr,status,error,message){_inProgress--;_failCount++;var originalMessage=unescape(message.data);originalMessage="{\""+originalMessage.replace(new RegExp("\\+","g"),"").replace(new RegExp("=","g"),"\":").replace(new RegExp("&amp;","g"),",\"")+"}";var messageData=dojo.toJson(originalMessage);if(messageData&&messageData.m&&messageData.m.length>0){for(var i=0;i<messageData.m.length;i++){_outgoing.push(messageData.m[i]);}}
_pumpMessages();};this.initialize=function(endpoint,callback){_endpoint=endpoint;_callback=callback;_connectRequest();};this.terminate=function(){_isOpen=false;if(_timer){clearInterval(_timer);}
if(_connectTimer)
{clearInterval(_connectTimer);}};this.setPickupInterval=function(interval){_protocolInfo.pickupInterval=interval;};this.scrambleClientId=function(){_clientInfo.c="Boom!";};this.setTransmitHook=function(hook){_transmitHookCallback=hook;};this.setReceiveHook=function(hook){_receiveHookCallback=hook;};this.send=function(messages){if(!_isOpen){return;}
_outgoing.splice(_outgoing.length,0,messages);if(_sendTimer===null){_sendTimer=setTimeout(_pumpMessages,100);}};this.isOpen=function(){return _isOpen;};this.isDisabled=function(){return _isDisabled;};};})();var Channel=function(channelName,callback,options,trigger){var _channelName=channelName;var _callbacks=[];var _currentSequence="";var _firstMessageNumber="0";var _trigger=trigger;_callbacks.push(callback);var _callback=function(message){for(var i=0;i<_callbacks.length;i++){try{var callbck=_callbacks[i];callbck(message);}
catch(err){if(typeof(console)!="undefined"&&console.warn)
{console.warn("Error delivering message on \""+_channelName+"\": "+err.message);}}}};var _deliveryType="";if(options&&options.sequence)
{_currentSequence=options.sequence;}
if(options&&options.number)
{_firstMessageNumber=options.number;}
var _lastMessageNumber=_firstMessageNumber;var _ackTimer=null;var _acksSent=0;var _bypassQueue=[];var _bypassTimer=null;if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"subscribe"},b:{sequence:_currentSequence,number:_firstMessageNumber}};_trigger(message,this);}
var thunk=this;var _scanBypassQueue=function(){if(_bypassQueue&&_bypassQueue.length>0){_bypassQueue.sort(function(a,b){return a.h.n-b.h.n;});var index=0;for(var i=0;i<_bypassQueue.length;i++){var bypassQ=_bypassQueue[i];if(bypassQ.h.n==_lastMessageNumber+1){_callback(bypassQ);_lastMessageNumber=bypassQ.h.n;index=i+1;}
else{break;}}
if(_bypassQueue.length>index)
{_bypassQueue=_bypassQueue.slice(index);}
else{_bypassQueue=[];}
if(_bypassQueue.length>0){_bypassTimer=setTimeout(function(){_scanBypassQueue();},1000);}
else{clearTimeout(_ackTimer);_bypassTimer=null;_acksSent=0;_bypassQueue=[];}}};var _sendAck=function(){if(_acksSent>=10){_ackTimer=setTimeout(function(){thunk.unsubscribe();},1000);return;}
var numbers=1+"-"+_lastMessageNumber;var numbersInQueue="";var last=0;var next="";_bypassQueue.sort(function(a,b){return a.h.n-b.h.n;});if(typeof(_bypassQueue!='undefined')){for(var i=0;i<_bypassQueue.length;i++){var m=_bypassQueue[i];if(last===0){numbersInQueue=m.h.n;}
else if(m.h.n==last+1){next="-"+m.h.n;}
else{if(next.length>0){numbersInQueue+=next+","+m.h.n;next="";}
else{numbersInQueue+=","+m.h.n;}}
last=m.h.n;}
numbersInQueue+=next;}
if(numbersInQueue.length>0||numbersInQueue>0)
{numbers+=","+numbersInQueue;}
if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"acknowledge"},b:{sequence:_currentSequence,numbers:numbers}};_trigger(message,thunk);}
_acksSent++;_ackTimer=setTimeout(function(){_sendAck();},1000*Math.min(32,Math.pow(2,_acksSent)));};this.getChannelName=function(){return _channelName;};this.getDeliveryType=function(){return _deliveryType;};this.setDeliveryType=function(deliveryType){_deliveryType=deliveryType;};this.getCallbacks=function(){return _callbacks;};this.clearTimers=function(){if(_ackTimer)
{clearTimeout(_ackTimer);}
if(_bypassTimer)
{clearTimeout(_bypassTimer);}};this.unsubscribe=function(){if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"unsubscribe"}};_trigger(message,this);}};this.deliver=function(message){if(_callback&&message&&message.h&&(message.h.t==_channelName)){if(message.h.a=="retransmit"){var inQueue=false;for(var i=0;i<_bypassQueue.length;i++){var bpQueue=_bypassQueue[i];if(bpQueue.h.n==message.h.n){inQueue=true;break;}}
if(!inQueue){_bypassQueue.push(message);}
if(_bypassTimer===null){_bypassTimer=setTimeout(function(){_scanBypassQueue();},1000);}}
else if(message.h.a=="broadcast"){if(message.h.s!=_currentSequence){_currentSequence=message.h.s;_firstMessageNumber=message.h.n;_bypassQueue=[];clearTimeout(_ackTimer);_acksSent=0;}
var messageOk=false;if((_deliveryType=="Lossy"&&message.h.n>_lastMessageNumber)||_deliveryType=="BestEffort"){messageOk=true;}
else if(_deliveryType=="Guaranteed"){if(_lastMessageNumber+1==message.h.n||message.h.n==_firstMessageNumber){messageOk=true;}
else{var count=_bypassQueue.push(message);if(count==1){_ackTimer=setTimeout(function(){_sendAck();},1000);}
else if(count>=50){this.resetState();this.deliver(message);}}}
if(messageOk){_lastMessageNumber=message.h.n;_callback(message,_channelName);}}}};this.resetState=function(){_currentSequence="";_bypassQueue=[];clearTimeout(_ackTimer);_acksSent=0;};this.addCallback=function(callback){if(dojo.indexOf(_callbacks,callback)==-1){_callbacks.push(callback);}};this.removeCallback=function(callback){var index=-1;if(_callbacks.length==1&&_callbacks[0]==callback){this.unsubscribe();return;}
for(var i=0;i<_callbacks.length;i++){var callBck=_callbacks[i];if(callBck==callback){index=i;}}
if(index>=0){_callbacks=BlueGrass.Utility.arrayRemove(_callbacks,index);}};this.getLastMessageNumber=function(){return _lastMessageNumber;};};var _connection=null;var _userOffset=new Date().getTimezoneOffset()/60;var _reconTimer=null;var _isConnecting=false;return{Runtime:{openConnection:function(endpoint,callback){if(!endpoint)
{endpoint={to:"/bg/api/Connect.ashx"};}
else if(!endpoint.to)
{endpoint.to="/bg/api/Connect.ashx";}
if((document.domain=="localhost"||document.domain=="localhost.marketwatch.com")&&typeof(_bgProxyUrl)!="undefined"){endpoint.via=_bgProxyUrl;if(endpoint.to.substr(0,5)!="http:")
{endpoint.to="http://mw5.marketwatch.com"+endpoint.to;}}
if(_connection===null){if(_isConnecting){setTimeout(function(){BlueGrass.Runtime.openConnection(endpoint,callback);},100);}
else{_isConnecting=true;_connection=new Connection(this,endpoint,callback);var checkConn=function(){if(_connection.isOpen())
{_isConnecting=false;}
else
{setTimeout(checkConn,1000);}};checkConn();}}
else{_connection.addCallback(callback);if(_connection.isOpen()){callback(_connection,"connect");}
else if(!_isConnecting){if(_reconTimer===null){_reconTimer=setTimeout(function(){if(!_connection.isOpen()&&!_connection.isDisabled())
{_connection.reconnect();}
_reconTimer=null;},1000);}}}},getConnection:function(){return _connection;}},Utility:{arrayRemove:function(array,from,to){var rest=array.slice((to||from)+1||array.length);array.length=from<0?array.length+from:from;return array.push.apply(array,rest);},convertToExchangeTime:function(utcDateString,offset){if(!utcDateString){return;}
if(typeof(offset)!='undefined'){offset=offset+_userOffset;}else{offset=0;}
var converted=parseInt(utcDateString,10);if(isNaN(converted)){if(utcDateString.indexOf("-")>=0||utcDateString.indexOf("+")>=0){utcDateString=utcDateString.substring(6,utcDateString.length-7);}
else{utcDateString=utcDateString.substring(6,utcDateString.length-2);}
converted=parseInt(utcDateString,10);}
converted+=3600000*offset;var dateTime=new Date(converted);return dateTime;},prettyDate:function(date,offset){if(typeof(date)!="object"){date=this.convertToExchangeTime(date,offset);}
var time_formats=[[60,'Just Now'],[90,'1 Minute'],[3600,'Minutes',60],[5400,'1 Hour'],[86400,'Hours',3600],[129600,'1 Day'],[604800,'Days',86400],[907200,'1 Week'],[2628000,'Weeks',604800],[3942000,'1 Month'],[31536000,'Months',2628000],[47304000,'1 Year'],[3153600000,'Years',31536000],[4730400000,'1 Century']];var dt=new Date(),seconds=(dt-date)/1000,token=' Ago',format;if(seconds<0){seconds=Math.abs(seconds);token='';}
for(var i=0,l=time_formats.length;i<l;i++){format=time_formats[i];if(seconds<format[0]){if(format.length==2){return format[1]+(i>1?token:'');}else{return Math.round(seconds/format[2])+' '+format[1]+(i>1?token:'');}}}
if(seconds>4730400000){return Math.round(seconds/4730400000)+' Centuries'+token;}
return date;}}};}();
dojo.provide("dj.service.livenews.BluegrassProvider");dojo.require("dj.lang");dojo.require("dj.util.bluegrass");dojo.declare("dj.service.livenews.BluegrassProvider",null,{channels:[],_cfg:{},DEFAULT_CONFIG:{toURL:"/bg/api/connect.ashx",viaURL:null},constructor:function(a){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a)},subscribeToChannel:function(a,b,c){this.channels.push({channelName:a,view:b,options:c})},subscribeToChannels:function(a,b,c){var d=this;dojo.forEach(a,function(e){d.subscribeToChannel(e,b,c)})},connectCallback:function(a,b){if(b=="connect"){connection=a;dojo.forEach(this.channelList,function(c){if(typeof c.view.render=="function"){var d=dojo.hitch(c.view,c.view.render);connection.subscribe(c.channelName,d,c.options)}else console.log("View object for channel %s does not have a render method",channelName)})}},connect:function(){var a=dojo.hitch({channelList:this.channels},this.connectCallback);dj.util.bluegrass.Runtime.openConnection({to:"/bg/api/connect.ashx",via:this._cfg.viaURL},a)}});
dojo.provide("dj.widget.Slider");dojo.declare("dj.widget.Slider",null,{constructor:function(handle,track,options){this._eventConnectHandles=[];var slider=this;if(dojo.isArray(handle)){this.handles=[];for(var count=0,max=handle.length;count<max;count++){this.handles.push(dojo.byId(handle[count]));}}else{this.handles=[dojo.byId(handle)];}
this.track=dojo.byId(track);this.options=options||{};this.axis=this.options.axis||'horizontal';this.increment=this.options.increment||1;this.step=parseInt(this.options.step||'1',10);this.range=this.options.range||{start:0,end:1};this.value=0;this.values=[];dojo.forEach(this.handles,dojo.hitch(this,function(){this.values.push(0);}));this.spans=this.options.spans?dojo.forEach(this.options.spans,function(s){return dojo.byId(s);}):false;this.options.startSpan=dojo.byId(this.options.startSpan||null);this.options.endSpan=dojo.byId(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||'0',10);this.alignY=parseInt(this.options.alignY||'0',10);this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!==0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!==0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled();}
this.allowedValues=this.options.values?this.options.values.sort():false;if(this.allowedValues){this.minimum=(this.allowedValues.length>0)?this.allowedValues[0]:0;this.maximum=(this.allowedValues.length>0)?this.allowedValues[this.allowedValues.length-1]:0;}
this.eventMouseDown=dojo.hitch(this,this.startDrag);this.eventMouseUp=dojo.hitch(this,this.endDrag);this.eventMouseMove=dojo.hitch(this,this.update);dojo.forEach(this.handles,function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((dojo.isArray(slider.options.sliderValue)?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);if(h.style.position&&h.style.position==='static'){h.style.position='relative';if(dojo.isOpera){h.style.top=0;h.style.left=0;}}
slider._eventConnectHandles.push(dojo.connect(h,'onmousedown',slider.eventMouseDown));});this._eventConnectHandles.push(dojo.connect(this.track,'onmousedown',this.eventMouseDown));this._eventConnectHandles.push(dojo.connect(document,'onmouseup',this.eventMouseUp));this._eventConnectHandles.push(dojo.connect(document,'onmousemove',this.eventMouseMove));this.initialized=true;},dispose:function(){dojo.forEach(this._eventConnectHandles,dojo.disconnect);},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(value){if(this.allowedValues){var max=(this.allowedValues.length>0)?this.allowedValues[this.allowedValues.length-1]:0;if(value>=max){return(max);}
var min=(this.allowedValues.length>0)?this.allowedValues[0]:0;if(value<=min){return(min);}
var offset=Math.abs(this.allowedValues[0]-value);var newValue=this.allowedValues[0];dojo.forEach(this.allowedValues,function(v){var currentOffset=Math.abs(v-value);if(currentOffset<=offset){newValue=v;offset=currentOffset;}});return newValue;}
if(value>this.range.end){return this.range.end;}
if(value<this.range.start){return this.range.start;}
return value;},setValue:function(sliderValue,handleIdx){if(!this.active){this.activeHandleIdx=handleIdx||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}
handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1])){sliderValue=this.values[handleIdx-1];}
if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1])){sliderValue=this.values[handleIdx+1];}}
sliderValue=this.getNearestValue(sliderValue);this.values[handleIdx]=sliderValue;this.value=this.values[0];this.handles[handleIdx].style[this.isVertical()?'top':'left']=this.translateToPx(sliderValue);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished();}},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0);},translateToPx:function(value){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(value-this.range.start))+"px";},translateToValue:function(offset){return((offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(range){var v=this.values.sort();range=range||0;return{start:v[range],end:v[range+1]};},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!==0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!==0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return(this.axis=='vertical');},drawSpans:function(){var slider=this;if(this.spans){for(var count=0,max=this.spans.length-1;count<=max;count++){slider.setSpan(slider.spans[count],slider.getRange(count));}}
if(this.options.startSpan){this.setSpan(this.options.startSpan,{start:0,end:this.values.length>1?this.getRange(0).start:this.value});}
if(this.options.endSpan){this.setSpan(this.options.endSpan,{start:this.values.length>1?this.getRange(this.spans.length-1).end:this.value,end:this.maximum});}},setSpan:function(span,range){if(this.isVertical()){span.style.top=this.translateToPx(range.start);span.style.height=this.translateToPx(range.end-range.start+this.range.start);}else{span.style.left=this.translateToPx(range.start);span.style.width=this.translateToPx(range.end-range.start+this.range.start);}},updateStyles:function(){dojo.forEach(this.handles,function(h){dojo.removeClass(h,'selected');});dojo.addClass(this.activeHandle,'selected');},startDrag:function(event){if(dojo.mouseButtons.isLeft(event)){if(!this.disabled){this.active=true;var handle=event.target;var pointer=[event.clientX,event.clientY];var track=handle;if(track==this.track){var trackPosition=dojo.position(this.track);this.event=event;this.setValue(this.translateToValue((this.isVertical()?pointer[1]-trackPosition.y:pointer[0]-trackPosition.x)-(this.handleLength/2)));var handlePosition=dojo.position(this.activeHandle);this.offsetX=(pointer[0]-handlePosition.x);this.offsetY=(pointer[1]-handlePosition.y);}else{while((dojo.indexOf(this.handles,handle)==-1)&&handle.parentNode){handle=handle.parentNode;}
if(dojo.indexOf(this.handles,handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=dojo.indexOf(this.handles,this.activeHandle);this.updateStyles();var activeHandlePosition=dojo.position(this.activeHandle);this.offsetX=(pointer[0]-activeHandlePosition.x);this.offsetY=(pointer[1]-activeHandlePosition.y);}}}
dojo.stopEvent(event);}},update:function(event){if(this.active){if(!this.dragging){this.dragging=true;}
this.draw(event);if(dojo.isWebKit){window.scrollBy(0,0);}
dojo.stopEvent(event);}},draw:function(event){var pointer=[event.clientX,event.clientY];var trackPosition=dojo.position(this.track);pointer[0]-=this.offsetX+trackPosition.x;pointer[1]-=this.offsetY+trackPosition.y;this.event=event;this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this);}},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);dojo.stopEvent(event);}
this.active=false;this.dragging=false;},finishDrag:function(event,success){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this);}
this.event=null;}});
dojo.provide("dj.widget.panels.PanelDTO");dojo.declare("dj.widget.panels.PanelDTO",null,{constructor:function(id,position){this._id=null;this._position=null;if(typeof id!=="undefined"){this.setId(id);}
if(typeof position!=="undefined"){this.setPosition(position);}},getId:function(){return this._id;},setId:function(id){if(typeof id==="undefined"){throw new Error("ID must be defined.");}
this._id=id;},getPosition:function(){return this._position;},setPosition:function(position){if(typeof position!=="number"){throw new TypeError("Position must be a number.");}
this._position=position;}});dojo.provide("dj.widget.panels.view.Pagination");dojo.declare("dj.widget.panels.view.Pagination",null,{constructor:function(model,pagCnt,config){this._model=model;this._pagCnt=pagCnt;this.panelIncrement=config.panelIncrement;this.paginationDivider=config.paginationDivider;},displayActiveSuccess:function(){var ap=this._model.getActive();var num=this._model.getNumberOfPanels();var start=Math.ceil(ap.getPosition()/this.panelIncrement)+(ap.getPosition()%this.panelIncrement>1?1:0);this._pagCnt.innerHTML=start+" "+this.paginationDivider+" "+Math.ceil(num/this.panelIncrement);}});dojo.provide("dj.widget.panels.controller.History");dojo.require("dj.util.History");dojo.declare("dj.widget.panels.controller.History",null,{constructor:function(model,cfg){this._isEnabled=false;this._model=model;this._cfg=(cfg||{});this._container=cfg.container;this._cfg.doSetActive=(typeof this._cfg.doSetActive==="boolean")?this._cfg.doSetActive:true;},isEnabled:function(){return this._isEnabled;},addEvents:function(){if(this._isEnabled){console.warn("{Panels} browser-history has already been enabled for \""+this._container+"\"");return;}else{console.info("{Panels} browser-history enabled for \""+this._container+"\"");this._isEnabled=true;}
var hist=dj.util.History;hist.init();var model=this._model;var pid=hist.get(this._container);var panelId="";if((typeof pid==="string")&&model.hasId(pid)){panelId=pid;}else if(model.hasPosition(1)){panelId=model.getByPosition(1).getId();}else{console.warn("{Panels} browser-history failed. No panels found.");return;}
if(this._cfg.doSetActive){model.setActiveById(panelId);}
var fromHist=false;hist.subscribe("_init",function(){fromHist=true;model.setActiveById(panelId);});hist.subscribe(this._container,function(tid){fromHist=true;model.setActiveById(tid);});var that=this;model.addChangeListener(function(panel){if(fromHist){fromHist=false;return;}
hist.set(that._container,panel.getId());});}});dojo.provide("dj.widget.panels.controller.NavArrows");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.NavArrows",null,{DEFAULT_CONFIG:{panelIncrement:1,doStopEvent:true,tabletSwipe:false,thresholdRatio:(1/2),swipeStartId:"imageSlide",hasLastSlideScrim:false},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;this._procs=[];this.connectHandles=[];},setLastActive:function(){var mdl=this._model;if(mdl.isLocked()){this._enqueueProc(this.setNextActive);return;}
mdl.setActiveByPosition(mdl.getNumberOfPanels()-mdl.getViewArea()+1);},setFirstActive:function(){if(this._model.isLocked()){this._enqueueProc(this.setPreviousActive);return;}
this._model.setDirection(this._model.DIRECTION.PREVIOUS);this._model.setActiveByPosition(1);},setPreviousActive:function(){if(this._model.isLocked()){this._enqueueProc(this.setPreviousActive);return;}
this._model.setDirection(this._model.DIRECTION.PREVIOUS);this._model.setActiveByPosition(this._model.getActive().getPosition()-this._cfg.panelIncrement);},setNextActive:function(){var mdl=this._model;if(mdl.isLocked()){this._enqueueProc(this.setNextActive);return;}
var tryNextPosition=(this._model.getActive().getPosition()+this._cfg.panelIncrement);var nxt=mdl.getByPosition(tryNextPosition);if(mdl.getRotationType()==mdl.ROTATION_TYPE.LINEAR){var hasMore=(((mdl.getNumberOfPanels()-(mdl.getViewArea()||0))-mdl.getActive().getPosition())>=0);if(hasMore===false){mdl._activePanelObserver.fireByName("failure",tryNextPosition);if(this._cfg.hasLastSlideScrim){this.ignoreActions=true;}
return;}}
mdl.setDirection(mdl.DIRECTION.NEXT);mdl.setActiveByPosition(tryNextPosition);},addEvents:function(){if(this._nav.prevButton){this._addEventForType(this._nav.prevButton,"prev");}
if(this._nav.nextButton){this._addEventForType(this._nav.nextButton,"next");}
if(this._nav.firstButton){this._addEventForType(this._nav.firstButton,"first");}
if(this._nav.lastButton){this._addEventForType(this._nav.lastButton,"last");}
if(this._cfg.tabletSwipe){this._addSwipeEventHandlers();}},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}},_enqueueProc:function(proc){this._procs.push(proc);this._model.addLockListener(function(){var pr=this._procs.shift();if(pr){pr.call(this);}},this);},_addEventForType:function(oBtn,btnType,doRemoveEvent){this.connectHandles.push(dojo.connect(oBtn,"onclick",this,this._stopEventBridge));this.connectHandles.push(dojo.connect(oBtn,'onmousedown',this,function(ev){this._stopEventBridge(ev);this._setActiveByTypeOrBeginInterval(btnType);}));this.connectHandles.push(dojo.connect(oBtn,'onmouseup',this,this._endEventBridge));this.connectHandles.push(dojo.connect(oBtn,'onmouseout',this,this._endEventBridge));},_stopEventBridge:function(ev){if(this._cfg.doStopEvent===true){dojo.stopEvent(ev);}},_setActiveByTypeOrBeginInterval:function(type){if(!this._nextInterval||this._nextInterval===null){this._setActiveByType(type);}
if(!this._cfg.disableInterval){this._nextInterval=setInterval(dojo.hitch(this,function(){this._setActiveByType(type);}),400);}},_endEventBridge:function(){clearInterval(this._nextInterval);this._nextInterval=null;},_setActiveByType:function(type){if(this.ignoreActions){return;}
var proc;switch(type){case"prev":proc=this.setPreviousActive;break;case"first":proc=this.setFirstActive;break;case"last":proc=this.setLastActive;break;case"next":proc=dojo.hitch(this,"setNextActive",type);break;default:var panelPosition=(isNaN(parseInt(type,10))?0:parseInt(type,10));if(panelPosition>0){this._model.setViewArea(panelPosition);proc=dojo.hitch(this._model,"setActiveByPosition",panelPosition);}
break;}
proc.call(this);},_addSwipeEventHandlers:function(){var that=this,_oUl=dojo.byId(this._cfg.swipeStartId);dojo.query("li img",_oUl).forEach(function(ele){that.connectHandles.push(dojo.connect(ele,'touchstart',that,that._swipeHandleStart));});},_swipeHandleStart:function(ev){var touch=ev.touches[0],_b=dojo.body(),_dc=dojo.connect,_pnls=this._model.views.panels;_pnls._doSetup();this.oSwipe={clientX:touch.clientX,clientY:touch.clientY,oUL:_pnls.getPanelByPosition(1).getElement().parentNode,mouseUpHandle:_dc(_b,"touchend",this,this._swipeHandleStop),mouseMoveHandle:_dc(_b,"touchmove",this,this._swipeHandleMouseMove)};},_swipeHandleStop:function(ev){if(typeof this.oSwipe.lastPosition!=="undefined"){var begin=this.oSwipe,end=begin.lastPosition,bx=begin.clientX,by=begin.clientY,ex=end.clientX,ey=end.clientY,_pnls=this._model.views.panels,_model=this._model.model,numOfPanels=_model.getNumberOfPanels(),panelWidth=_pnls._panelWidth;var finalDistance=(ex-bx),slidesToMove=Math.floor(Math.abs(finalDistance)/panelWidth),remainder=Math.abs(finalDistance%panelWidth),direction=(finalDistance>0?-1:(finalDistance===0?0:1)),threshold=panelWidth*this._cfg.thresholdRatio;var lastSlide=_model.getActive()._position;if(remainder>threshold){slidesToMove++;}
var newSlide=lastSlide+(slidesToMove*direction);if(newSlide<1){newSlide=1;}
else if(newSlide>numOfPanels){newSlide=numOfPanels;}
_model.setActiveByPosition(newSlide);}
dojo.disconnect(this.oSwipe.mouseUpHandle);dojo.disconnect(this.oSwipe.mouseMoveHandle);delete this.oSwipe;},_swipeHandleMouseMove:function(ev){var touch=ev.touches[0],_pnls=this._model.views.panels,_hasLast=(typeof this.oSwipe.lastPosition!=="undefined"),_oLast=(_hasLast?this.oSwipe.lastPosition:this.oSwipe),oUL=this.oSwipe.oUL,left=oUL.style.left;this.oSwipe.lastPosition={clientX:touch.clientX,clientY:touch.clientY};var distanceX=touch.clientX-_oLast.clientX,distanceY=touch.clientY-_oLast.clientY;if(Math.abs(distanceX)>Math.abs(distanceY)){dojo.stopEvent(ev);}
else{return;}
if(left===""){left=0;}
else{left=parseInt(left.replace("px",""),10);}
oUL.style.left=(left+distanceX)+"px";},disableLastSlideScrim:function(){this.ignoreActions=false;}});dojo.provide("dj.widget.panels.controller.NavTabs");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.NavTabs",null,{DEFAULT_CONFIG:{activeEvent:"onclick",doStopEvent:true},constructor:function(model,tabs,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this.model=model;this.tabs=tabs;this.connectHandles=[];},setActive:function(tid){this.model.setActiveById(tid);},addEvents:function(doRemoveEvents){for(var tid in this.tabs){if(this.tabs.hasOwnProperty(tid)){this._addEventForTab(this.tabs[tid]);}}},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}},_addEventForTab:function(tab){this.connectHandles.push(dojo.connect(tab.getElement(),this._cfg.activeEvent,dojo.hitch(this,function(ev){if(this._cfg.doStopEvent===true){dojo.stopEvent(ev);}
this.setActive(tab.getId());})));}});dojo.provide("dj.widget.panels.PanelModel");dojo.require("dj.util.Observer");dojo.declare("dj.widget.panels.PanelModel",null,{ROTATION_TYPE:{LINEAR:0,CIRCULAR:1},DIRECTION:{PREVIOUS:0,NEXT:1},DEFAULT_CONFIG:{rotationType:0},constructor:function(panels,cfg){this._cfg=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),cfg);this._hPanels={};this._panelIds=[];this._prevInHistory=null;this._lastPosition=1;this._activePanel=null;this._activePanelObserver=new dj.util.Observer();this._direction=this.DIRECTION.NEXT;this._isLocked=false;this._lockObserver=new dj.util.Observer();this._rotationState=1;if(panels){this.addPanels(panels);}},updatePanels:function(panels){this._hPanels={};this._panelIds=[];var i=1;for(var pid in panels){if(panels.hasOwnProperty(pid)){var panel=panels[pid],panelId=panel.getId();this._panelIds[i++]=panelId;this._hPanels[panelId]=panel;}}},addPanel:function(panelId){var panel=new dj.widget.panels.Panel(panelId,this._lastPosition);this._panelIds[this._lastPosition]=panel.getId();this._hPanels[panelId]=panel;this._lastPosition++;},addPanels:function(panels){for(var pid in panels){if(panels.hasOwnProperty(pid)){var panel=panels[pid],panelId=panel.getId();this._panelIds[this._lastPosition]=panelId;this._hPanels[panelId]=panel;this._lastPosition++;}}},hasId:function(panelId){return(typeof this._hPanels[panelId]!=="undefined");},hasPosition:function(panelPosition){return((panelPosition>0)&&(panelPosition<this._panelIds.length));},getById:function(panelId){if(!this.hasId(panelId)){throw new Error("NoSuchElementException");}
return this._hPanels[panelId];},getByPosition:function(panelPosition){if(!this.hasPosition(panelPosition)){if(this._cfg.rotationType===this.ROTATION_TYPE.CIRCULAR){var numOfPan=this.getNumberOfPanels();panelPosition=(panelPosition%numOfPan);panelPosition=(panelPosition===0)?numOfPan:panelPosition;}else{return;}}
var pid=this._panelIds[panelPosition];return this._hPanels[pid];},getActive:function(){return this._activePanel;},getPrevInHistory:function(){return this._prevInHistory;},getAll:function(){var values=[];for(var value in this._hPanels){if(this._hPanels.hasOwnProperty(value)){values.push(this._hPanels[value]);}}
return values;},getNumberOfPanels:function(){return(this._panelIds.length-1);},getRotationState:function(){return this._rotationState;},getRotationType:function(){return this._cfg.rotationType;},getDirection:function(){return this._direction;},setRotationState:function(state){if(state<0||state>1){this._activePanelObserver.fireByName("rotationStateFailure",state);}
this._rotationState=state;this._activePanelObserver.fireByName("rotationStateSuccess",state);},setDirection:function(dir){if(dir<0||dir>1){throw new Error("IndexOutOfBoundsException");}
this._direction=dir;},setActive:function(panel){if(panel&&panel.getId){this.setActiveById(panel.getId());}},setActiveById:function(panelId){if(!this.hasId(panelId)){this._activePanelObserver.fireByName("failure",panelId);return;}
var panel=this.getById(panelId);this._prevInHistory=this._activePanel;this._activePanel=panel;this._activePanelObserver.fireByName("success",panel);for(var controller in this.controllers){if(this.controllers[controller].panelChangedHook){this.controllers[controller].panelChangedHook(panelId);}}},setActiveByPosition:function(panelPosition){if(!this.hasPosition(panelPosition)){if(this._cfg.rotationType===this.ROTATION_TYPE.CIRCULAR){var numOfPan=this.getNumberOfPanels();panelPosition=(panelPosition%numOfPan);panelPosition=(panelPosition===0)?numOfPan:panelPosition;}else{this._activePanelObserver.fireByName("failure",panelPosition);return;}}
var pid=this._panelIds[panelPosition];this.setActiveById(pid);},addChangeListener:function(event,listener,context){if(arguments.length<3&&(typeof event==="function")){context=listener;listener=event;event="success";}
context=(typeof context!=="undefined")?context:this;this._activePanelObserver.subscribeByName(event,listener,context);},isLocked:function(){return this._isLocked;},addLockListener:function(cb,context){this._lockObserver.subscribe(cb,context);},doLock:function(){this._isLocked=true;},releaseLock:function(){this._isLocked=false;this._lockObserver.fire();},runAfterLockReleased:function(cb,ctx){if(this._isLocked){this.addLockListener(cb,ctx);}else{cb.call(ctx);}},getViewArea:function(){return this._viewArea;},setViewArea:function(va){this._viewArea=va;},getActivePanel:function(){return this.getActive().getId();},setActivePanel:function(pid){var meth=(typeof pid=="string")?this.setActiveById:this.setActiveByPosition;return meth.call(this,pid);},hasPanel:function(panel){var pid=(panel.getId)?panel.getId():panel;return this.hasId(pid);},observePanels:function(callback){this.addChangeListener(function(panel){callback.apply(this,[panel.getId(),panel.getId()]);},this);}});dojo.provide("dj.widget.panels.view.BasePanel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.BasePanel",null,{DEFAULT_CONFIG:{animationDuration:0.3,animationType:"slide",orientation:"horizontal"},enableLazyImages:function(model,panelGroup){var a=model.getActivePanel();var v=model.getViewArea();var ulCount=dojo.query('ul.newsItem',panelGroup.parentNode).length;for(j=0;j<ulCount;j++){for(i=a;i<a+(2*v);i++){var ULs=dojo.query('ul.newsItem',panelGroup.parentNode);var image=dojo.query('img',ULs[j])[i];if(!image){break;}
if(image.getAttribute('data-src')){image.setAttribute('src',image.getAttribute('data-src'));}}}}});dojo.provide("dj.widget.panels.view.NavArrows");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.NavArrows",null,{DEFAULT_CONFIG:{prevButtonEnabledStyle:"enabledPrev",nextButtonEnabledStyle:"enabledNext",firstButtonEnabledStyle:"enabledFirst",lastButtonEnabledStyle:"enabledLast",panelIncrement:1},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;},displayActiveSuccess:function(panel){this._updatePrevious();this._updateNext();},_updatePrevious:function(){var mod=this._model,pp=mod.getByPosition(mod.getActive().getPosition()-this._cfg.panelIncrement);if(!pp){dojo.removeClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);if(this._nav.firstButton){dojo.removeClass(this._nav.firstButton,this._cfg.firstButtonEnabledStyle);}}else{dojo.addClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);if(this._nav.firstButton){dojo.addClass(this._nav.firstButton,this._cfg.firstButtonEnabledStyle);}}},_updateNext:function(){var mod=this._model,np=mod.getByPosition(mod.getActive().getPosition()+mod.getViewArea());if(!np){dojo.removeClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);if(this._nav.lastButton){dojo.removeClass(this._nav.lastButton,this._cfg.lastButtonEnabledStyle);}}else{dojo.addClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);if(this._nav.lastButton){dojo.addClass(this._nav.lastButton,this._cfg.lastButtonEnabledStyle);}}},displayLastSlideScrim:function(){dojo.removeClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);dojo.removeClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);}});dojo.provide("dj.widget.panels.view.Panel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.Panel",null,{DEFAULT_CONFIG:{selectedClass:"",deselectedClass:"hidden"},constructor:function(model,panels,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._oPanels=panels;},displayActiveSuccess:function(panel){this._deselectAllExcept(panel);this._select(panel);},getContainer:function(){if(this._oCnt){return this._oCnt;}
if(this._cfg.container&&this._cfg.container!==""){this._oCnt=dojo.byId(this._cfg.container);return this._oCnt;}
if(this._oPanelGroup){this._oCnt=this._oPanelGroup.parentNode;return this._oCnt;}
var ap=this._model.getByPosition(1);var el=this._oPanels[ap.getId()];if(!el.parentNode||!el.parentNode.parentNode){return null;}
var grp=el.parentNode;this._oCnt=grp.parentNode;return this._oCnt;},getPanelByPosition:function(pos){return this._oPanels[pos];},_deselectAllExcept:function(panelNotToHide){var panel=null;for(var pid in this._oPanels){if(this._oPanels.hasOwnProperty(pid)){panel=this._oPanels[pid];if(panelNotToHide.getId()==pid){continue;}
dojo.removeClass(panel.getElement(),this._cfg.selectedClass);dojo.addClass(panel.getElement(),this._cfg.deselectedClass);}}},_select:function(panel){var pid=panel.getId();var oPan=this._oPanels[pid];if(!oPan){return;}
dojo.removeClass(oPan.getElement(),this._cfg.deselectedClass);dojo.addClass(oPan.getElement(),this._cfg.selectedClass);}});dojo.provide("dj.widget.panels.Panel");dojo.require("dj.widget.panels.PanelDTO");dojo.declare("dj.widget.panels.Panel",dj.widget.panels.PanelDTO,{constructor:function(id,position,element){this._element=null;if(typeof element!=="undefined"){this.setElement(element);}},getElement:function(){return this._element;},setElement:function(element){if(typeof element!=="object"){throw new TypeError("Element must be an object.");}
this._element=element;}});dojo.provide("dj.widget.panels.view.SlidePanel");dojo.require("dj.widget.panels.view.BasePanel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.SlidePanel",dj.widget.panels.view.BasePanel,{DEFAULT_CONFIG:{animationDuration:0.3,animationType:"slide",orientation:"horizontal",cacheVector:true,tabletSwipe:false},constructor:function(model,panels,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._isOrientVert=(this._cfg.orientation=="vertical");this._isOrientHoriz=(this._cfg.orientation=="horizontal");this._model=model;this._panels=panels;this._isSetupDone=false;this._animation=null;this._vectorMap={};this._oCnt=this._cfg.container;this._enableLazyImages=this._cfg.enableLazyImages;this._isPanelsUpdated=false;},updatePanels:function(panels){this._panels=panels;this._isPanelsUpdated=true;},displayActiveSuccess:function(activePanel){this._model.doLock();this._doSetup();if(this._isPanelGroupLargerThanAllPanels()){return;}
if(this._isRotationCircular){this._doCircularActiveSuccess(activePanel);}else{this._doLinearActiveSuccess(activePanel);}},_doCircularActiveSuccess:function(activePanel){var prevPanel=this._model.getPrevInHistory(),prvPos=prevPanel.getPosition(),avePos=activePanel.getPosition(),that=this,isIncreasing=(this._model.getDirection()==this._model.DIRECTION.NEXT),delta=0;var isIncFlip=false;var isDecrFlip=false;if(isIncreasing&&(prvPos==this._numberOfPanels)&&(avePos==1)){isIncFlip=true;delta=(that._isOrientVert)?-this._panelHeight:-this._panelWidth;}else if(!isIncreasing&&(prvPos==1)&&(avePos==this._numberOfPanels)){isDecrFlip=true;delta=(that._isOrientVert)?this._panelHeight:this._panelWidth;}else{delta=this._getVector(prevPanel,activePanel);}
afterFin=function(){if(this._enableLazyImages){this.enableLazyImages(this._model,this._oPanelGroup);}
if(isIncFlip){var offsetType=(that._isOrientVert)?"top":"left";that._oPanelGroup.style[offsetType]="0px";}
that._model.setViewArea(that.getViewArea());that._model.releaseLock();};beforeStr=function(){if(isDecrFlip){var mv,offsetTopOrLeft,offsetHeightOrWidth;if(that._isOrientVert){offsetTopOrLeft="top";offsetHeightOrWidth="_panelHeight";}else if(that._isOrientHoriz){offsetTopOrLeft="left";offsetHeightOrWidth="_panelWidth";}
mv=that._getVector(prevPanel,activePanel)-that[offsetHeightOrWidth];this.properties.left=(mv+this.properties.xD);dojo.style(that._oPanelGroup,offsetTopOrLeft,mv+"px");}};this._doScrollAnimation(delta,beforeStr,afterFin);},_doLinearActiveSuccess:function(activePanel){var prevPanel=this._model.getPrevInHistory(),afterFin=dojo.hitch(this,function(){if(this._enableLazyImages){this.enableLazyImages(this._model,this._oPanelGroup);}
this._model.setViewArea(this.getViewArea());this._model.releaseLock();}),beforeStr=function(){};var delta=this._getVector(prevPanel,activePanel);this._doScrollAnimation(delta,beforeStr,afterFin);},_doSetup:function(){if(this._isSetupDone){return;}
this._isSetupDone=true;this._setCoreValues();this._resetStyle();if(this._isRotationCircular&&!this._isPanelGroupLargerThanAllPanels()){this._circularLoopSetup();}},_doScrollAnimation:function(delta,beforeStr,afterFin){var xD,yD;if(this._isOrientVert){xD=0;yD=delta;}else if(this._isOrientHoriz){xD=delta;yD=0;}
var newLeft=(dojo.style(this._oPanelGroup,"left")+xD),newTop=(dojo.style(this._oPanelGroup,"top")+yD),animationDurationInMillis=(this._cfg.animationDuration*1000);var animCfg={node:this._oPanelGroup,duration:animationDurationInMillis,beforeBegin:beforeStr,onEnd:afterFin,properties:{"xD":xD,"yD":yD,left:newLeft,top:newTop}};this._animation=dojo.animateProperty(animCfg);this._animation.play();},getContainer:function(){if(this._oCnt){return this._oCnt;}
if(this._cfg.container&&this._cfg.container!==""){this._oCnt=dojo.byId(this._cfg.container);return this._oCnt;}
if(this._oPanelGroup){this._oCnt=this._oPanelGroup.parentNode;return this._oCnt;}
var ap=this._panels[this._model.getByPosition(1).getId()];var el=ap.getElement();if(!el.parentNode||!el.parentNode.parentNode){return null;}
var grp=el.parentNode;this._oCnt=grp.parentNode;return this._oCnt;},getPanelByPosition:function(pos){var el=this._model.getByPosition(pos);return this._panels[el.getId()];},destroy:function(){this._resetStyle();},getViewArea:function(){var viewArea=0;if(typeof this._cfg.viewArea=="number"){viewArea=this._cfg.viewArea;}else if(this._isRotationCircular||this._isFixedSizePanels()){viewArea=this._getFixedSizeViewArea();}else{viewArea=this._getDynamicSizeViewArea();}
this._model.setViewArea(viewArea);return viewArea;},_getFixedSizeViewArea:function(){var el=(this._panels[this._model.getByPosition(1).getId()]).getElement(),cnt=el.parentNode.parentNode,hOrW=(this._isOrientVert)?"h":"w",viewArea=Math.round(dojo.position(cnt)[hOrW]/dojo.position(el)[hOrW]);return viewArea;},_getDynamicSizeViewArea:function(){var viewArea=0,activePanel=this._panels[this._model.getActive().getId()],cnt=activePanel.getElement().parentNode.parentNode,numOfPanels=this._model.getNumberOfPanels(),hOrW=(this._isOrientVert)?"h":"w",cntWidthOrHeight=dojo.position(cnt)[hOrW],totalWidthOrHeight=0;for(var i=activePanel.getPosition();i<=numOfPanels;i++){var panel=this._panels[this._model.getByPosition(i).getId()];totalWidthOrHeight+=dojo.position(panel.getElement())[hOrW];if(totalWidthOrHeight>cntWidthOrHeight){break;}
viewArea++;}
return viewArea;},_isFixedSizePanels:function(){if(typeof this.__isFixedLengthPanels==="undefined"){this.__isFixedLengthPanels=true;var hOrW=(this._isOrientVert)?"h":"w",prevLen=Math.round(dojo.position(this.getPanelByPosition(1).getElement())[hOrW]);for(var i=2;i<=this._model.getNumberOfPanels();i++){var len=Math.round(dojo.position(this.getPanelByPosition(i).getElement())[hOrW]);if(prevLen!==len){this.__isFixedLengthPanels=false;break;}
prevLen=len;}}
return this.__isFixedLengthPanels;},_getWidthOrHeightOfPanels:function(){if(typeof this._widthOrHeightOfPanels=="undefined"||this._isPanelsUpdated){var lastPanel=this.getPanelByPosition(this._model.getNumberOfPanels()),lastPanelBox=dojo.marginBox(lastPanel.getElement());this._widthOrHeightOfPanels=(this._isOrientVert)?(lastPanel.getElement().offsetTop+lastPanelBox.h):(lastPanel.getElement().offsetLeft+lastPanelBox.w);}
return this._widthOrHeightOfPanels;},_getVector:function(prevPanel,currPanel){var existingVector=this._getExistingVector(prevPanel,currPanel);if(existingVector&&this._cfg.cacheVector){return existingVector;}
currPanel=this._panels[currPanel.getId()];var offsetType=(this._isOrientVert)?"offsetTop":"offsetLeft",topOrLeft=(this._isOrientVert)?"t":"l",heightOrWidth=(this._isOrientVert)?"h":"w",yOrx=(this._isOrientVert)?"y":"x",panelsHeightOrWidth=this._getWidthOrHeightOfPanels();var panelGroupBox=dojo.marginBox(this._oPanelGroup),panelGroupOffset=this._oPanelGroup[offsetType],prevOffset=Math.abs(panelGroupBox[topOrLeft]),currPanelBox=dojo.marginBox(currPanel.getElement()),currOffset=Math.abs(currPanel.getElement()[offsetType]);var currPanelPos=currPanel.getPosition(),prevPanelPos=prevPanel.getPosition(),lastPanelPos=this._getPanelsCount(),panelDiff=currPanelPos-prevPanelPos,samePanel=(panelDiff===0),isInc=panelDiff>0;if(!isInc&&(currOffset>prevOffset)){if(!samePanel||!this._cfg.tabletSwipe){return 0;}
else{isInc=true;}}
var delta=Math.abs(currOffset-prevOffset);vector=((isInc)?(delta*-1):delta);if(this._cfg.tabletSwipe){if(samePanel){if(currPanelPos===1&&panelGroupOffset>0){vector*=-1;}}}
if(!this._isRotationCircular&&(!this._isFixedSizePanels()||!this._hasSufficientPanelsAtEnd(currPanel))){var panelGroupPos=dojo.position(this._oPanelGroup.parentNode),newPos=(panelGroupBox[topOrLeft]+vector),maxPos=(panelGroupPos[heightOrWidth]-panelsHeightOrWidth),diff=(maxPos-newPos);if(isInc&&(diff>0)){vector+=diff;}}
if(this._cfg.cacheVector){this._setExistingVector(prevPanel,currPanel,vector);}
return vector;},_hasSufficientPanelsAtEnd:function(currPanel){var delta=this._model.getNumberOfPanels()-(currPanel.getPosition()-1+this.getViewArea());if(delta>=0){return true;}else{return false;}},_getExistingVector:function(panel1,panel2){return this._vectorMap[panel1.getId()+"_"+panel2.getId()];},_setExistingVector:function(panel1,panel2,vector){this._vectorMap[panel1.getId()+"_"+panel2.getId()]=vector;},_isPanelGroupLargerThanAllPanels:function(){var heightOrWidth=(this._isOrientVert)?"h":"w",panelsHeightOrWidth=this._getWidthOrHeightOfPanels(),panelGroupPos=dojo.position(this._oPanelGroup.parentNode);return(panelGroupPos[heightOrWidth]>panelsHeightOrWidth);},_setCoreValues:function(){if(this._isCoreValuesSet){return;}
var model=this._model,ap=this._panels[model.getByPosition(1).getId()];this._oPanelGroup=dojo.query(this._cfg.panelGroup,this.getContainer())[0];this._numberOfPanels=model.getNumberOfPanels();this._isRotationCircular=(model.getRotationType()==model.ROTATION_TYPE.CIRCULAR);if(this._isOrientVert){this._panelHeight=dojo.position(ap.getElement()).h;}else if(this._isOrientHoriz){this._panelWidth=dojo.position(ap.getElement()).w;}
this._isCoreValuesSet=true;},_resetStyle:function(){if(typeof this._oPanelGroup==="object"){dojo.style(this._oPanelGroup,{left:0,top:0});}},_circularLoopSetup:function(){for(var i=1,element=null,clone=null,len=this.getViewArea();i<=len;i++){element=this._panels[this._model.getByPosition(i).getId()].getElement();clone=element.cloneNode(true);this._oPanelGroup.appendChild(clone);}},_getPanelsCount:function(){if(typeof this.panelsCount==="undefined"){var _pnls=this._panels,lastPanelPos=-1;for(var i in _pnls){if(_pnls.hasOwnProperty(i)){var pos=_pnls[i].getPosition();if(pos>lastPanelPos){lastPanelPos=pos;}}}
this.panelsCount=lastPanelPos;}
return this.panelsCount;}});dojo.provide("dj.widget.panels.PanelsFactory");dojo.require("dj.lang");dojo.require("dj.widget.panels.PanelDTO");dojo.require("dj.widget.panels.Panel");dojo.require("dj.widget.panels.PanelModel");dj.widget.panels.PanelsFactory={_CONFIG:{core:{panelGroup:".newsItem",panel:"> li",panelPrefix:"panelsPanel_",panels:undefined,panelToggleStyle:"hidden",activePanel:1,disabledPanels:undefined,panelIncrement:1,viewArea:undefined,paginationDivider:"/",paginationContainer:".pagination",controller:undefined,enableBrowserHistory:false,animationDuration:0.3},tabs:{tabPrefix:"panelsTab_",tabGroup:".newsItem",tab:"> li",navContainer:".nav-inline",prevButton:".prev",nextButton:".next",navButtonEnabledStyle:"enabled",tabOnEvent:"click",tabOnStyle:"active",tabOffStyle:"deselected"},carousel:{orientation:"horizontal",navContainer:".nav-inline",pagination:{container:false,linkClass:"prevnext_page",selectedClass:"prevnext_page-current",label:false,labelClass:"prevnext_pagelabel",prevNextDisableClass:'prevnext_prev-disabled'},disableInterval:false,prevButton:".prev",nextButton:".next",prevButtonEnabledStyle:"enabledPrev",nextButtonEnabledStyle:"enabledNext"},rotator:{rotateTime:8,rotateIterations:3,pauseOnMouseOver:false,pauseButton:".nav-inline .pause",pauseButtonEnabledStyle:"enabledPause",progressBar:".progressbarBox"}},_panelsType:{NONE:0,SLIDE:1,SWITCH:2},_paginationType:{SIMPLE:0,RANGE:1},_lookupType:{NONE:0,SELECTOR:1,PREFIX:2},create:function(container,cfg,doIgnoreOptCache){if(!container||(typeof cfg!=="object")){console.warn("{Panels} no container or config specified.");return;}
container=dojo.byId(container);if(container&&!doIgnoreOptCache){if(this._isReinitializedAndSetCache(container,cfg)){console.warn("{Panels} prevented attempt to reinitialize \""+container.id+"\".");return;}}
try{var mvc=this._setupMvc(container,cfg);this._addCompatibilityMethods(mvc,container,cfg);return mvc.model;}catch(ex){console.info(ex.message);}},_isReinitializedAndSetCache:function(container,cfg){var optCache=['{',container.id,': ',dj.lang.objectToString(cfg,true),'}'].join(''),cntOpt=container.getAttribute("djw_optcache");if(cntOpt){var opts=cntOpt.split("_");for(var i=0,len=opts.length;i<len;i++){if(opts[i]==optCache){return true;}}}
if(cntOpt){container.setAttribute("djw_optcache",[optCache,cntOpt].join("_"));}else{container.setAttribute("djw_optcache",optCache);}
return false;},createPanels:function(userCfg){var djwp=dj.widget.panels,_lookupType=this._lookupType,_panType=this._panelsType,_d=dojo,model=null,views={},controllers={};var config=dojo.clone(this._CONFIG.core);config.container="";config.doAddChangeListeners=true;config.panelsType=_panType.SWITCH;config.panelsLookupType=_lookupType.SELECTOR;dojo.mixin(config,userCfg);var panels=null;switch(config.panelsLookupType){case _lookupType.PREFIX:panels=this.lookupByPrefix(config.panelPrefix,config.panels);break;case _lookupType.SELECTOR:panels=this.lookupBySelector(config.container,config.panelGroup,config.panel);break;default:return;}
var rotType=(((config.type==djwp.PanelModel.prototype.ROTATION_TYPE.CIRCULAR)||(config.type=="circular"))?djwp.PanelModel.prototype.ROTATION_TYPE.CIRCULAR:djwp.PanelModel.prototype.ROTATION_TYPE.LINEAR);model=new djwp.PanelModel(this.panelsToPanelsDTO(panels),{rotationType:rotType});model.setActiveByPosition(config.activePanel);var view=null,viewPanelConfig,viewPanelType;switch(config.panelsType){case _panType.SLIDE:_d.require("dj.widget.panels.view.SlidePanel");viewPanelType="SlidePanel";viewPanelConfig={animationDuration:config.animationDuration,viewArea:config.viewArea,orientation:config.orientation,panelGroup:config.panelGroup,container:config.container,enableLazyImages:config.enableLazyImages};if(typeof config.cacheVector!=="undefined"){viewPanelConfig.cacheVector=config.cacheVector;}
if(typeof config.tabletSwipe!=="undefined"){viewPanelConfig.tabletSwipe=config.tabletSwipe;}
break;case _panType.SWITCH:_d.require("dj.widget.panels.view.Panel");viewPanelType="Panel";viewPanelConfig={selectedClass:config.selectedPanelClass,deselectedClass:config.deselectedPanelClass};break;}
view=new djwp.view[viewPanelType](model,panels,viewPanelConfig);views.panels=view;if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}
return{"model":model,"views":views,"controllers":controllers};},addModuleNavArrows:function(mvc,userCfg){var _lookupType=this._lookupType,model=mvc.model,views=mvc.views,controllers=mvc.controllers,_d=dojo;var config=_d.clone(this._CONFIG.carousel);config.container="";config.doAddEvents=true;config.doAddChangeListeners=true;config.doHide=false;dj.lang.mixin(config,userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var navArrowsLookupType=_lookupType.NONE;if(!config.lookupType){navArrowsLookupType=(config)?_lookupType.SELECTOR:navArrowsLookupType;}else{navArrowsLookupType=config.lookupType;}
var navArrows={};if(navArrowsLookupType==_lookupType.SELECTOR){navArrows.navContainer=_d.query(config.navContainer,config.container)[0];if(navArrows.navContainer){navArrows.prevButton=_d.query(config.prevButton,navArrows.navContainer)[0];navArrows.nextButton=_d.query(config.nextButton,navArrows.navContainer)[0];navArrows.lastButton=(config.lastButton)?_d.query(config.lastButton,navArrows.navContainer)[0]:null;navArrows.firstButton=(config.firstButton)?_d.query(config.firstButton,navArrows.navContainer)[0]:null;}else{return;}}else{return;}
if(config.doHide){navArrows.navContainer.style.visibility="hidden";return;}else if(navArrows.navContainer.style.visibility==="hidden"){navArrows.navContainer.style.visibility="";}
var controller;if(config.pagination.container){_d.require("dj.widget.panels.controller.NavArrowsPagination");controller=new dj.widget.panels.controller.NavArrowsPagination(model,navArrows,config);}else{_d.require("dj.widget.panels.controller.NavArrows");controller=new dj.widget.panels.controller.NavArrows(model,navArrows,config);}
controllers.navArrows=controller;_d.require("dj.widget.panels.view.NavArrows");var view=new dj.widget.panels.view.NavArrows(model,navArrows,config);view.displayActiveSuccess();views.navArrows=view;if(config.doAddEvents){controller.addEvents();}
if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModuleNavTabs:function(mvc,userCfg){var _lookupType=this._lookupType,model=mvc.model,views=mvc.views,controllers=mvc.controllers,_d=dojo;var config=dojo.clone(this._CONFIG.tabs);config.container="";config.panels=this._CONFIG.core.panels;config.doAddEvents=true;config.doAddChangeListeners=true;dj.lang.mixin(config,userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var navTabsLookupType=_lookupType.NONE;if(!config.lookupType){navTabsLookupType=(userCfg)?_lookupType.SELECTOR:navTabsLookupType;navTabsLookupType=(userCfg&&userCfg.tabPrefix)?_lookupType.PREFIX:navTabsLookupType;}else{navTabsLookupType=config.lookupType;}
var navTabs=null;switch(navTabsLookupType){case _lookupType.PREFIX:navTabs=this.lookupByPrefix(config.tabPrefix,config.panels);break;case _lookupType.SELECTOR:navTabs=this.lookupBySelector(config.container,config.tabGroup,config.tab);break;default:return;}
_d.require("dj.widget.panels.view.Panel");var view=new dj.widget.panels.view.Panel(model,navTabs,{selectedClass:config.tabOnStyle,deselectedClass:config.tabOffStyle});_d.require("dj.widget.panels.controller.NavTabs");var controller=new dj.widget.panels.controller.NavTabs(model,navTabs,{activeEvent:config.tabOnEvent});views.navTabs=view;controllers.navTabs=controller;if(config.doAddEvents){controller.addEvents();}
if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModulePagination:function(mvc,userCfg){var config={},_d=dojo;var model=mvc.model,views=mvc.views;dj.lang.mixin((config={container:"",doAddChangeListeners:true,paginationContainer:this._CONFIG.core.paginationContainer,doHide:false}),userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var oPaginationCnt=_d.query(config.paginationContainer,config.container)[0];if(!oPaginationCnt){return;}
if(config.doHide){oPaginationCnt.style.visibility="hidden";return;}
var view,isTypeRangePagination=(config.type&&config.type==this._paginationType.RANGE),requireClassName=(isTypeRangePagination)?"RangePagination":"Pagination";if(isTypeRangePagination){var ototalResultsCnt=_d.query(config.totalResultsContainer,config.container)[0];var totalCnt=ototalResultsCnt.innerHTML;_d.require("dj.widget.panels.view.RangePagination");view=new dj.widget.panels.view.RangePagination(model,oPaginationCnt,totalCnt,ototalResultsCnt,config.pageSize);model.setViewArea(1);model.setActiveByPosition(1);}else{_d.require("dj.widget.panels.view.Pagination");view=new dj.widget.panels.view.Pagination(model,oPaginationCnt,config);}
view.displayActiveSuccess();views.pagination=view;if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModuleTimer:function(mvc,userCfg){var _d=dojo,config=_d.clone(this._CONFIG.rotator);config.container="";config.doAddEvents=true;config.doAddChangeListeners=true;dj.lang.mixin(config,userCfg);var controllers=mvc.controllers;_d.require("dj.widget.panels.controller.Timer");controllers.timer=new dj.widget.panels.controller.Timer(mvc.model,config);var oPause=_d.query(config.pauseButton,config.container)[0];if(oPause){_d.require("dj.widget.panels.view.Timer");var view=new dj.widget.panels.view.Timer(mvc.model,{pauseButton:oPause},userCfg);if(config.doAddChangeListeners){mvc.model.addChangeListener("rotationStateSuccess",view.rotationStateSuccess,view);}}
if(config.doAddEvents){controllers.timer.addEvents();}},addModuleBrowserHistory:function(mvc,userCfg){var config={},_d=dojo;dj.lang.mixin((config={doAddEvents:true}),userCfg);_d.require("dj.widget.panels.controller.History");mvc.controllers.browserHistory=new dj.widget.panels.controller.History(mvc.model,config);if(config.doAddEvents){controllers.browserHistory.addEvents();}},addController:function(mvc,cMvc){if(!cMvc||!cMvc.model||!cMvc.model.addChangeListener||!mvc||!mvc.model){throw new Error("{Panels.addController} mvc and/or controller is invalid.");}
var model=mvc.model,controllerModel=cMvc.model;controllerModel.addChangeListener("success",function(panel){model.setActive(panel);});},_setupMvc:function(container,userConfig){var oCnt=dojo.byId(container);container=(oCnt.id||container);var config=dj.lang.cloneMixin(this._CONFIG,userConfig),typeCfg=this._getPanelsTypeConfig(userConfig,config);var panelsCfg={container:oCnt,doAddChangeListeners:false,panelsType:typeCfg.panelsType,panelsLookupType:typeCfg.panelsLookupType};dj.lang.mixin(panelsCfg,config.core);if(typeCfg.panelsType==this._panelsType.SWITCH){dj.lang.mixin(panelsCfg,config.tabs);}else if(typeCfg.panelsType==this._panelsType.SLIDE){dj.lang.mixin(panelsCfg,config.carousel);}
var mvc=this.createPanels(panelsCfg);if(mvc.model.getNumberOfPanels()==-1){throw new Error("{Panels} container \""+container+"\" has no panels.");}
var model=mvc.model,views=mvc.views,controllers=mvc.controllers;if(typeCfg.hasNavTabs){var navTabCfg=config.tabs;navTabCfg.container=oCnt;navTabCfg.panels=config.core.panels;navTabCfg.doAddEvents=false;navTabCfg.doAddChangeListeners=false;navTabCfg.lookupType=typeCfg.navTabsLookupType;this.addModuleNavTabs(mvc,navTabCfg);}
if(typeCfg.hasNavArrows){var navArrCfg=config.carousel;navArrCfg.container=oCnt;navArrCfg.doAddEvents=false;navArrCfg.doAddChangeListeners=false;navArrCfg.lookupType=typeCfg.navArrowsLookupType;navArrCfg.panelIncrement=config.core.panelIncrement;navArrCfg.doHide=((typeCfg.panelsType==this._panelsType.SLIDE)&&(views.panels.getViewArea()>=model.getNumberOfPanels())&&!config.carousel.showNavButtons);this.addModuleNavArrows(mvc,navArrCfg);}
var enablePagination=config.core.enablePagination;if((typeCfg.panelsType==this._panelsType.SLIDE&&(views.panels.getViewArea()<=1))||enablePagination){var paginCfg={container:oCnt,paginationContainer:config.core.paginationContainer,panelIncrement:config.core.panelIncrement,paginationDivider:config.core.paginationDivider,doAddEvents:false,doAddChangeListeners:false,doHide:(views.panels.getViewArea()==1&&enablePagination)};this.addModulePagination(mvc,paginCfg);}
if(typeCfg.hasTimer){var timerCfg=config.rotator;timerCfg.container=oCnt;timerCfg.doAddEvents=false;this.addModuleTimer(mvc,timerCfg);}
if(typeCfg.hasBrowserHistory){var histConf={container:(typeCfg.panelsLookupType==this._lookupType.SELECTOR)?oCnt.id:container,doAddEvents:false};this.addModuleBrowserHistory(mvc,histConf);}
if(typeCfg.hasController){this.addController(mvc,config.core.controller);}
this._addViewChangeListenersToModel(model,views);this._addEventsToControllers(controllers);if(!typeCfg.hasBrowserHistory&&typeCfg.panelsType==this._panelsType.SWITCH){model.setActiveByPosition(panelsCfg.activePanel);}
return mvc;},_getPanelsTypeConfig:function(userConfig,config){var _panType=this._panelsType;var _lookType=this._lookupType;var typeCfg={};typeCfg.panelsType=_panType.NONE;typeCfg.panelsType=(userConfig.core)?_panType.SWITCH:typeCfg.panelsType;typeCfg.panelsType=(userConfig.carousel)?_panType.SLIDE:typeCfg.panelsType;typeCfg.panelsLookupType=_lookType.SELECTOR;typeCfg.panelsLookupType=(userConfig.core&&userConfig.core.panelPrefix)?_lookType.PREFIX:typeCfg.panelsLookupType;typeCfg.navTabsLookupType=_lookType.NONE;typeCfg.navTabsLookupType=(userConfig.tabs)?_lookType.SELECTOR:typeCfg.navTabsLookupType;typeCfg.navTabsLookupType=(userConfig.tabs&&userConfig.tabs.tabPrefix)?_lookType.PREFIX:typeCfg.navTabsLookupType;typeCfg.navArrowsLookupType=_lookType.NONE;typeCfg.navArrowsLookupType=(userConfig.carousel)?_lookType.SELECTOR:typeCfg.navArrowsLookupType;typeCfg.navArrowsLookupType=(userConfig.tab&&userConfig.tab.navContainer)?_lookType.SELECTOR:typeCfg.navArrowsLookupType;typeCfg.hasController=(userConfig.core&&(typeof userConfig.core.controller=="object"));typeCfg.hasNavArrows=(typeCfg.navArrowsLookupType!==_lookType.NONE);typeCfg.hasNavTabs=(typeCfg.navTabsLookupType!==_lookType.NONE);typeCfg.hasTimer=(typeof userConfig.rotator=="object"&&userConfig.rotator.rotateTime>0);typeCfg.hasBrowserHistory=(config.core.enableBrowserHistory);return typeCfg;},_addViewChangeListenersToModel:function(model,views){var view=null;for(var viewName in views){if(views.hasOwnProperty(viewName)){view=views[viewName];if(view.displayActiveSuccess){model.addChangeListener("success",view.displayActiveSuccess,view);}
if(view.displayActiveFailure){model.addChangeListener("failure",view.displayActiveFailure,view);}}}},_addEventsToControllers:function(controllers){var controller=null;for(var controllerName in controllers){if(controllers.hasOwnProperty(controllerName)){controller=controllers[controllerName];controller.addEvents();}}},_addCompatibilityMethods:function(mvc,container,config){var that=this;if(typeof mvc.model.update==="undefined"){mvc.model.update=function(){that.destroy(mvc);mvc=that.create((container.id||container),config,true);return mvc;};}
if(typeof mvc.model.destroy==="undefined"){mvc.model.destroy=function(){that.destroy(mvc);};}
if(mvc.controllers&&mvc.controllers.navTabs){var tabs=mvc.controllers.navTabs.tabs,_d=dojo;mvc.model.observeTabs=function(callback,eventType){eventType=(eventType||"onclick");var _addEvForTab=function(tab){_d.connect(tab.getElement(),eventType,function(ev){var tid=tab.getId();if(mvc.controllers.navTabs._cfg.doStopEvent===true){_d.stopEvent(ev);}
tid=(isNaN(parseInt(tid,10)))?tid:(mvc.model.getById(tid).getPosition()+"");callback.call(null,tid,mvc.model);});};for(var tid in tabs){if(tabs.hasOwnProperty(tid)){_addEvForTab(tabs[tid]);}}};}
if(typeof mvc.model.updateNewPanels==="undefined"){mvc.model.updateNewPanels=function(container,group,node){var panels=that.lookupBySelector(container,group,node);mvc.model.updatePanels(that.panelsToPanelsDTO(panels));mvc.views.panels.updatePanels(panels);};}
mvc.model.model=mvc.model;mvc.model.views=mvc.views;mvc.model.controllers=mvc.controllers;},destroy:function(mvc){for(var controller in mvc.controllers){if(mvc.controllers.hasOwnProperty(controller)){mvc.controllers[controller].removeEvents();delete mvc.controllers[controller];}}
for(var viewName in mvc.views){if(mvc.views.hasOwnProperty(viewName)){var view=mvc.views[viewName];if(typeof view.destroy=="function"){view.destroy();}
delete mvc.views[viewName];}}},panelsToPanelsDTO:function(panels){var elms={};for(var panId in panels){if(panels.hasOwnProperty(panId)){var pan=panels[panId];elms[panId]=new dj.widget.panels.PanelDTO(pan.getId(),pan.getPosition());}}
return elms;},lookupByPrefix:function(prefix,names){var elms={};for(var i=0,len=names.length,id=null,el=null,pos=1;i<len;i++){id=names[i];el=dojo.byId(prefix+id);if((typeof el==="undefined")||el===null||el.firstChild===null){continue;}
elms[id]=new dj.widget.panels.Panel(id,pos++,el);}
return elms;},lookupBySelector:function(container,group,node){if(!container||container===null){throw new Error('{dj.util.Panels} container for group: "'+group+'" is undefined.');}
var oCnt=dojo.byId(container);var oPanels=dojo.query((group+' '+node),oCnt);var elms={};for(var i=0,len=oPanels.length,el=null,pos=1;i<len;i++){el=oPanels[i];if(el===null||(el.tagName!=="IMG"&&el.firstChild===null)){continue;}
elms[pos-1]=new dj.widget.panels.Panel(pos-1,pos++,el);}
return elms;}};dojo.provide("dj.widget.panels.prebuilt.Slideshow");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.view.Pagination");dojo.declare("dj.widget.panels.prebuilt.Slideshow",null,{STATE_CLASS:{NORMAL:"sl_inline-norm",OVER:"sl_inline-over",END:"sl_inline-end"},constructor:function(id){this._domContainer=dojo.byId(id);this._isCaptionsEnabled=true;this._isLastFrameEnabled=true;this._createPanels(this._domContainer);this._connectCaptionEvents();this._connectLastFrameEvents();},getPanels:function(){return this._panels;},nextSlide:function(){this._panels.controllers.navArrows.setNextActive();},previousSlide:function(){this._panels.controllers.navArrows.setPreviousActive();},showCaption:function(){if(!this._isCaptionsEnabled){return;}
dojo.removeClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.addClass(this._domContainer,this.STATE_CLASS.OVER);var caption=this._getCurrentCaption(),captionHeight=dojo.position(caption).h;dojo.anim(caption,{top:{end:-captionHeight}});},hideCaption:function(){if(!this._isCaptionsEnabled){return;}
var caption=this._getCurrentCaption(),an=dojo.anim(caption,{top:{end:0}});dojo.connect(an,"onEnd",this,function(){dojo.addClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.removeClass(this._domContainer,this.STATE_CLASS.OVER);});},_createPanels:function(domNode){this._panels=dj.widget.panels.PanelsFactory.create(domNode,{core:{panelGroup:".sl_c",panel:".sl_i"},carousel:{navContainer:".box-arrows",prevButton:".prev",nextButton:".next"}});},_connectCaptionEvents:function(){var captions=dojo.query(".cap_c",this._domContainer);if(captions.length===0){this._isCaptionsEnabled=false;return;}
captions.connect("onclick",dojo.hitch(this,function(event){dojo.stopEvent(event);this.showCaption();}));dojo.connect(dojo.doc,"onclick",this,this.hideCaption);this._panels.addChangeListener("success",this.hideCaption,this);},_connectLastFrameEvents:function(){var lastFrame=dojo.query(".sl_end",this._domContainer);if(lastFrame.length===0){this._isLastFrameEnabled=false;return;}
this._panels.addChangeListener("success",this._hideLastFrame,this);this._panels.addChangeListener("failure",this._showLastFrame,this);},_getCurrentCaption:function(){var activePanelModel=this._panels.model.getActive(),activePanel=this._panels.views.panels.getPanelByPosition(activePanelModel.getPosition());return dojo.query(".cap_l",activePanel.getElement())[0];},_showLastFrame:function(){dojo.removeClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.addClass(this._domContainer,this.STATE_CLASS.END);},_hideLastFrame:function(){if(dojo.hasClass(this._domContainer,this.STATE_CLASS.END)){dojo.addClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.removeClass(this._domContainer,this.STATE_CLASS.END);}}});dojo.provide("dj.widget.panels.virtual.History");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.controller.History");dojo.provide("dj.module.panels.liveSlideshow");dojo.require("dj.util.liveWidget");dojo.require("dj.util.Element");dojo.require("dj.widget.panels.prebuilt.Slideshow");dj.module.panels.liveSlideshow={init:function(type){if(this._isInit){return;}
this._isInit=true;this.type=type;this._setupLiveWidget();},destroy:function(){dj.util.liveWidget.unregister("panels.Slideshow");},_setupLiveWidget:function(){dj.util.liveWidget.register("panels.Slideshow",function(liveWidget,dataset){dojo.stopEvent(liveWidget.event);this._initWidget(liveWidget,dataset);},this);},_initWidget:function(liveWidget,dataset){var id=dj.util.Element.identify(liveWidget.domNode),slideshow;if(this.type&&this.type==="Article"){slideshow=new dj.widget.panels.prebuilt.ArticleSlideshow(id);}else{slideshow=new dj.widget.panels.prebuilt.Slideshow(id);}
var target=liveWidget.event.target;this._tryPossibleInitEvents(target,slideshow);},_tryPossibleInitEvents:function(target,slideshow){var is=dj.util.Element.isOrIsChildOf;if(is(target,".cap_s")){slideshow.showCaption();}
if(is(target,".next")){slideshow.nextSlide();}
if(is(target,".prev")){slideshow.previousSlide();}}};dojo.provide("dj.widget.panels.virtual.Tabs");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.controller.NavTabs");dojo.require("dj.widget.panels.view.Panel");dojo.provide("dj.widget.panels.virtual.Carousel");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.view.SlidePanel");dojo.require("dj.widget.panels.view.NavArrows");dojo.require("dj.widget.panels.controller.NavArrows");
dojo.provide("dj.widget.panel.LiveModalPanel");dojo.require("dj.util.Element");(function(djl){(dj.widget.panel.LiveModalPanel=function(cfg){this.cfg=djl.cloneMixin(this.DEFAULT_CONFIG,cfg);this._setupEvents();}).prototype={DEFAULT_CONFIG:{container:".linklist_dropdown .mn_dropdown_container",containerInd:".linklist_dropdown .mn_dropdown_container",dropdownContent:".mn_dropdownPanel > .mn_dropdownContent",actionEvent:"click",stateContainer:".mn_dropdownTree",stateCollapsed:"mn_ddState-collapsed",stateExpanded:"mn_ddState-expanded",navContainer:".pmMainNav",stateHover:"mndd_ddState-hover ",queryUpClass:"mn_dropdownTree",addMouseEvents:false},prevActivePanel:undefined,navOpened:false,_setupEvents:function(){var that=this;if(this.cfg.addMouseEvents){djl.addLiveEvent(this.cfg.container,"mouseover",function(ev){that.mouseOverOut(this,ev);});}
djl.addLiveEvent(this.cfg.containerInd,this.cfg.actionEvent,function(ev){var node=that._queryUpForClassName(this,that.cfg.queryUpClass);that.togglePanel(node,ev);});if(this.cfg.addMouseEvents){djl.addLiveEvent(this.cfg.container,"mouseout",function(ev){that.mouseOverOut(this,ev);});}
this.oDropdownContainer=dojo.query(this.cfg.navContainer)[0];dojo.connect(document,'onclick',function(ev){if(ev.target.nodeName=="A"){return true;}
if(that.prevActivePanel!==undefined&&that.navOpened===true){var dropd=dojo.query(that.cfg.dropdownContent,that.prevActivePanel)[0];if(dropd!==undefined&&!dj.util.Element.contains(dropd,ev.clientX,ev.clientY)){that.togglePanel(dropd,ev);that.navOpened=false;}}});},_queryUpForClassName:function(node,cn){if(node.className.indexOf(cn)==-1){while((typeof node!=="object")||(null===node.className)||!node.className||(node.className.indexOf(cn)!==0)){node=node.parentNode;}}
return node;},togglePanel:function(dropd,event){var cfg=this.cfg;if(dojo.hasClass(dropd,cfg.stateCollapsed)){dojo.removeClass(dropd,cfg.stateCollapsed);dojo.addClass(dropd,cfg.stateExpanded);this.navOpened=true;}else{dojo.removeClass(dropd,cfg.stateExpanded);dojo.addClass(dropd,cfg.stateCollapsed);this.navOpened=false;}
if(this.prevActivePanel!==undefined&&this.prevActivePanel!=dropd){dojo.removeClass(this.prevActivePanel,cfg.stateExpanded);dojo.addClass(this.prevActivePanel,cfg.stateCollapsed);}
this.prevActivePanel=dropd;dojo.stopEvent(event);},mouseOverOut:function(elm,ev){var cfg=this.cfg,dropd=dojo.query(cfg.stateContainer,elm)[0];if(dropd!==undefined){if(ev.type=="mouseover"){dojo.addClass(dropd,cfg.stateHover);}else if(ev.type=="mouseout"){dojo.removeClass(dropd,cfg.stateHover);}}}};}(dj.lang));dojo.provide("dj.widget.panel.Tooltip");dojo.require("dj.lang");dojo.require("dj.util.Query");dojo.declare("dj.widget.panel.Tooltip",null,{constructor:function(containerClass,tipTargetBox,tipTarget,tooltipBox,container,hideDelayInMillis){this._delayedMouseOver(tipTarget,dojo.hitch(this,function(node){this.init(containerClass,{elementsContainerClass:tipTargetBox,targetClass:tipTarget,tooltipClass:tooltipBox,container:container,hideTooltipDelay:hideDelayInMillis});this.isInitialized=true;var ttb=dj.util.Query.up(node,tipTargetBox),tb=dojo.query(tooltipBox,ttb)[0];this.showTooltip(tb);}),200);},_delayedMouseOver:function(containerClass,func,time){var doInit=false,initDelay;var outEvent=dj.lang.addLiveEvent(containerClass,"mouseout",function(){doInit=false;});var overEvent=dj.lang.addLiveEvent(containerClass,"mouseover",function(){if(initDelay){clearTimeout(initDelay);}
doInit=true;var elm=this;initDelay=setTimeout(function(){if(!doInit){return;}
dj.lang.removeLiveEvent(overEvent);dj.lang.removeLiveEvent(outEvent);func.call(null,elm);},time);});},DEFAULT_CONFIG:{hideTooltipDelay:100},init:function(containerClass,config){this.eventPointerList=[];this.containerClass=containerClass;this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,config);this._setupTooltips();},_setupTooltips:function(){this.oContainer=(this.cfg.container?dojo.byId(this.cfg.container):this.cfg.container);this.oTooltipContainers=((typeof this.oContainer!=='undefined')&&(this.oContainer!==null))?dojo.query(this.containerClass,this.oContainer):dojo.query(this.containerClass);this.oTooltipContainers.forEach(dojo.hitch(this,function(oTooltipContainer){var oTooltipElementsContainer=dojo.query(this.cfg.elementsContainerClass,oTooltipContainer)[0],oTooltipTarget=dojo.query(this.cfg.targetClass,oTooltipContainer)[0],oTooltip=dojo.query(this.cfg.tooltipClass,oTooltipContainer)[0];if(!((typeof oTooltipElementsContainer!=='undefined')&&(oTooltipElementsContainer!==null)&&(typeof oTooltipTarget!=='undefined')&&(oTooltipTarget!==null)&&(typeof oTooltip!=='undefined')&&(oTooltip!==null))){console.log("{Tooltip} oTooltipTarget or oTooltip is not defined for tooltip container");return;}
var tipTarget=dojo.query(this.cfg.targetClass,oTooltipElementsContainer)[0];if((typeof tipTarget==='undefined')||(tipTarget===null)){dojo.place(oTooltipElementsContainer,oTooltipTarget,"before");dojo.place(oTooltipTarget,oTooltip,"after");}
var tooltipVisibleFlag=false;var showTooltipListener=function(){tooltipVisibleFlag=true;this.showTooltip(oTooltip);};var hideTooltipListener=function(){tooltipVisibleFlag=false;setTimeout(dojo.hitch(this,function(){if(tooltipVisibleFlag===false){this.hideTooltip(oTooltip);}}),this.cfg.hideTooltipDelay);};this.eventPointerList.push(dojo.connect(oTooltipTarget,"onmouseover",dojo.hitch(this,showTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltipTarget,"onmouseout",dojo.hitch(this,hideTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltip,"onmouseover",dojo.hitch(this,showTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltip,"onmouseout",dojo.hitch(this,hideTooltipListener)));}));},showTooltip:function(oTooltip){dojo.style(oTooltip,{display:"block"});},hideTooltip:function(oTooltip){dojo.style(oTooltip,{display:"none"});},destructor:function(){if(!this.isInitialized){console.warn("{dj.widget.panel.Tooltip} has not been initialized yet");return;}
this.oContainer=null;this.oTooltipContainers=null;for(var i=0,len=this.eventPointerList.length;i<len;i++){dojo.disconnect(this.eventPointerList[i]);delete this.eventPointerList[i];}},refreshTooltips:function(container){if(!this.isInitialized){return;}
this.destructor();this._setupTooltips();}});dojo.provide("dj.widget.panel.ModalPanel");dojo.require("dj.util.Config");dojo.require("dj.util.Element");dojo.require("dj.util.Observer");(dj.widget.panel.ModalPanel=function(modalId,modalContainer,config){this.oModalId=dojo.byId(modalId);if(!this.oModalId){throw new Error("{dj.widget.panel.ModalPanel} modal-id is null or undefined");}
this.oModalContainer=dojo.byId(modalContainer);if(!this.oModalContainer){throw new Error("{dj.widget.panel.ModalPanel} modal-container is null or undefined");}
this.observeOpenModalPanel=new dj.util.Observer();this.observeCloseModalPanel=new dj.util.Observer();this.cfg=new dj.util.Config(this);this._setupConfig();if(config){this.cfg.applyConfig(config,true);}
this.cfg.fireQueue();if(this.oModalId===null){this._setupTargetlessModalPanel(this.oModalContainer);}else{this._setupModalPanel(this.oModalId,this.oModalContainer);}}).prototype={DEFAULT_CONFIG:{OPEN_MODAL_PANEL_EVENT_OPTION:{key:"openModalPanelEvent",value:"mouseover"},CLOSE_MODAL_PANEL_EVENT_OPTION:{key:"closeModalPanelEvent",value:"mouseout"},CLOSE_MODAL_PANEL_BUTTON_SELECTOR:{key:"closeModalPanelButtonSelector",value:null},CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR:{key:"closeModalPanelEventForButtonSelector",value:null}},_setupModalPanel:function(oModalId,oModalContainer){dojo.style(oModalContainer,{visibility:"hidden"});var modalOpenEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.OPEN_MODAL_PANEL_EVENT_OPTION.key);var modalCloseEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_OPTION.key);var that=this;dojo.connect(oModalId,"on"+modalOpenEvent,this,function(event){dojo.stopEvent(event);this.openModalPanel();});var closeModalPanelSelector=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key);if(closeModalPanelSelector!==null){var closeModalPanelButtons=dojo.query(closeModalPanelSelector,oModalContainer);var modalCloseEventForButtonSelector=(this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key)!==null)?this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key):modalCloseEvent;closeModalPanelButtons.forEach(function(oCloseModalPanelButton){dojo.connect(oCloseModalPanelButton,"on"+modalCloseEventForButtonSelector,this,function(event){dojo.stopEvent(event);this.closeModalPanel();});},this);}else{dojo.connect(oModalContainer,"onmouseover",this,this.openModalPanel);dojo.connect(oModalContainer,"on"+modalCloseEvent,this,this.closeModalPanel);}
if(modalCloseEvent=='blur'){dojo.connect(document,"onclick",this,function(event){var isMousePointerinModalContainer=dj.util.Element.contains(oModalContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer===false){this.closeModalPanel();}});}},_setupTargetlessModalPanel:function(oModalContainer){var modalCloseEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_OPTION.key);var closeModalPanelSelector=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key);this.openModalPanel();var that=this;if(closeModalPanelSelector!==null){var closeModalPanelButtons=dojo.query(closeModalPanelSelector,oModalContainer).each(function(oCloseModalPanelButton){dojo.connect(oCloseModalPanelButton,"on"+modalCloseEvent,this,function(event){dojo.stopEvent(event);this.closeModalPanel();});});}else{dojo.connect(oCloseModalPanelButton,"on"+modalCloseEvent,this,this.closeModalPanel);}},openModalPanel:function(){dojo.style(this.oModalContainer,{visibility:"visible"});},closeModalPanel:function(){dojo.style(this.oModalContainer,{visibility:"hidden"});},_setupConfig:function(config){var cfg=this.cfg;var defCfg=this.DEFAULT_CONFIG;cfg.addProperty(defCfg.OPEN_MODAL_PANEL_EVENT_OPTION.key,{value:defCfg.OPEN_MODAL_PANEL_EVENT_OPTION.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_EVENT_OPTION.key,{value:defCfg.CLOSE_MODAL_PANEL_EVENT_OPTION.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key,{value:defCfg.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key,{value:defCfg.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.value});}};dojo.provide("dj.widget.panel.SelectDropdownPanel");dojo.require("dj.util.Element");dojo.require("dj.lang");dojo.declare("dj.widget.panel.SelectDropdownPanel",null,{DEFAULT_CONFIG:{scrollContainerClass:".scroll_container",scrollBarClass:".scrollbar",scrollTrackClass:".scrollbar_container",scrollValuesContainerClass:".scroll_values_container",dropdownCollapsedClassName:"dropdown_collapsed",dropdownExpandedClassName:"dropdown_open",scrollContainerCollapsedClassName:"collapsed",scrollContainerExpandedClassName:"expanded",selectedClassName:".selected",scrollTrackContainerClassName:".scroll_track",dropdownScrollUpArrow:".scroll_up",dropdownScrollDownArrow:".scroll_down",scrollTrackHeight:"154",scrollValuesDisplayHeight:"190",scrollBarArrowShiftValue:"2"},constructor:function(selectDropdownContainer,config){this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,config);var scrollBarClass=this.cfg.scrollBarClass;var scrollTrackClass=this.cfg.scrollTrackClass;var scrollContainerClass=this.cfg.scrollContainerClass;var scrollValuesContainerClass=this.cfg.scrollValuesContainerClass;this.oSelectDropDownContainer=dojo.byId(selectDropdownContainer);if(this.oSelectDropDownContainer){this.oScrollBar=dojo.query(scrollBarClass,this.oSelectDropDownContainer)[0];this.oScrollTrack=dojo.query(scrollTrackClass,this.oSelectDropDownContainer)[0];this.oScrollContainer=dojo.query(scrollContainerClass,this.oSelectDropDownContainer)[0];this.oScrollValuesContainer=dojo.query(scrollValuesContainerClass,this.oSelectDropDownContainer)[0];this._setupSelectDropdown(this.oSelectDropDownContainer,this.oScrollContainer,this.oScrollValuesContainer,this.oScrollBar,this.oScrollTrack);}},_setupSelectDropdown:function(oSelectDropdownContainer,oScrollContainer,oScrollValuesContainer,oScrollBar,oScrollTrack){var selectDropdownCollapsedClassName=this.cfg.dropdownCollapsedClassName;var selectDropdownExpandedClassName=this.cfg.dropdownExpandedClassName;var scrollContainerCollapsedClassName=this.cfg.scrollContainerCollapsedClassName;var scrollContainerExpandedClassName=this.cfg.scrollContainerExpandedClassName;var selectedClassName=this.cfg.selectedClassName;this.oSelected=dojo.query(selectedClassName,oSelectDropdownContainer)[0];var toggleDropdownClass=function(){if(dojo.hasClass(oSelectDropdownContainer,selectDropdownCollapsedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownExpandedClassName);}else
if(dojo.hasClass(oSelectDropdownContainer,selectDropdownExpandedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownExpandedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);}
if(dojo.hasClass(oScrollContainer,scrollContainerCollapsedClassName)){dojo.removeClass(oScrollContainer,scrollContainerCollapsedClassName);dojo.addClass(oScrollContainer,scrollContainerExpandedClassName);}else
if(dojo.hasClass(oScrollContainer,scrollContainerExpandedClassName)){dojo.removeClass(oScrollContainer,scrollContainerExpandedClassName);dojo.addClass(oScrollContainer,scrollContainerCollapsedClassName);}};dojo.connect(this.oSelected,"onclick",toggleDropdownClass);dojo.connect(oScrollValuesContainer,"onclick",toggleDropdownClass);dojo.connect(document,"onclick",function(event){var isMousePointerinModalContainer=dj.util.Element.contains(oScrollContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer===false){if(dojo.hasClass(oSelectDropdownContainer,selectDropdownExpandedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownExpandedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);}
if(dojo.hasClass(oScrollContainer,scrollContainerExpandedClassName)){dojo.removeClass(oScrollContainer,scrollContainerExpandedClassName);dojo.addClass(oScrollContainer,scrollContainerCollapsedClassName);}}});if(oScrollBar&&oScrollBar!==null&&oScrollTrack&&oScrollTrack!==null){dojo.require("dj.widget.Slider");var noOfValues=oScrollValuesContainer.children.length;var scrollTrackHeight=parseInt(this.cfg.scrollTrackHeight,10);var scrollValuesDisplayHeight=parseInt(this.cfg.scrollValuesDisplayHeight,10);var scrollBarHeight=parseInt((scrollTrackHeight/(noOfValues/10)),10);dojo.style(oScrollBar,{height:scrollBarHeight+"px"});var scrollValuesTopShiftFactor=(scrollValuesDisplayHeight/scrollTrackHeight)*(noOfValues/10);var moveDropDown=function(value){var sliderPx=slider.translateToPx(value);var sliderPxValue=sliderPx.replace("px","");dojo.style(oScrollValuesContainer,{top:"-"+sliderPxValue*scrollValuesTopShiftFactor+"px"});};var slider=new dj.widget.Slider(oScrollBar,oScrollTrack,{onSlide:moveDropDown,onChange:moveDropDown,axis:'vertical'});var scrollTrackContainerClass=this.cfg.scrollTrackContainerClassName;this.oScrollTrackContainer=dojo.query(scrollTrackContainerClass,oSelectDropdownContainer)[0];var scrollUpArrowClass=this.cfg.dropdownScrollUpArrow;var scrollDownArrowClass=this.cfg.dropdownScrollDownArrow;this.oScrollUpArrow=dojo.query(scrollUpArrowClass,this.oScrollTrackContainer)[0];this.oScrollDownArrow=dojo.query(scrollDownArrowClass,this.oScrollTrackContainer)[0];var scrollArrowShiftValue=parseInt(this.cfg.scrollBarArrowShiftValue,10);var scrollBarTopPx,scrollBarTop,sliderValue;dojo.connect(this.oScrollUpArrow,"onclick",function(event){scrollBarTop=dojo.style(oScrollBar,"top");sliderValue=slider.translateToValue(scrollBarTop-scrollArrowShiftValue);if(scrollBarTop>0){slider.setValue(sliderValue);}});dojo.connect(this.oScrollDownArrow,"onclick",function(event){scrollBarTop=dojo.style(oScrollBar,"top");sliderValue=slider.translateToValue(scrollBarTop+scrollArrowShiftValue);if(scrollBarTop<(scrollTrackHeight-scrollBarHeight)){slider.setValue(sliderValue);}});}}});
dojo.provide("dj.widget.flash.Flash");dojo.require("dj.util.Cookie");dojo.require("dj.util.Observer");dojo.require("dj.util.Element");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.flash.Flash",null,{constructor:function(idOrDomNode,p,s,params){this.parent=dojo.byId(idOrDomNode);if(this._isWidgetAlreadyHandled()){return;}
dj.util.Element.identify(this.parent);params=dojo.mixin({noload:false,getSettings:true,swfsettings:undefined},params);this.config={};this.config.myMovie='/public/resources/documents/info-flash08-preloader.swf';this.p=p;this.s=s;this.swfsettings=params.swfsettings;this.getSettings=params.getSettings;this.swfPrefix='info-';this.params=params;this._swfFlashvars={};this._swfParams={};this._swfAttributes={};this.settingsObserver=new dj.util.Observer();if(p&&!params.noload){this.load(p,s);}},_isWidgetAlreadyHandled:function(){var isWidgetAlreadyHandled=((typeof dojo.query("div[data-dj-live-widget]",this.parent)[0]==="object")||(typeof dojo.query("div[data-dj-widget]",this.parent)[0]==="object"));if(isWidgetAlreadyHandled){console.info("{Flash} %o will be handled by the util.template.",this.parent.id);return true;}
return false;},load:function(p,s){this.newId();this.settingsObserver.subscribe(this.create,this);this.loadsettings(p,s);if(this.swfsettings){this.create(p,s);}},newId:function(){this.flid="flashdiv_"+Math.floor(Math.random()*999999);},loadsettings:function(p,s){this.p=p;this.s=s;if(!this.getSettings){this.swfsettings={};return;}
this.settingfile='/public/resources/documents/'+this.swfPrefix+p+'-settings.js';if(!this.swfsettings){this.swfsettings=null;var that=this;var deferred=dojo.xhrGet({url:this.settingfile,load:function(data,ioargs){if(!data){return;}
var jso=that._normalizeJsonToObject(data);that.swfsettings=jso.swfsettings;that.settingsObserver.fire(that.p,that.s);},error:function(response,ioargs){console.error("{Flash} HTTP status code: %s, response: %o",ioargs.xhr.status,response);}});}},create:function(p,s){this.createwrapper();this.createflash();this.settingsObserver.unsubscribe(this.create);},createwrapper:function(){this.newId();this.div=document.createElement('div');this.div.setAttribute('id',this.flid);this.parent.appendChild(this.div);},createflash:function(){if(this.so){return;}
var preloader=null;try{if(this.swfsettings.requiredSettings.preloader!==undefined&&this.swfsettings.requiredSettings.preloader!==null)
{preloader=this.swfsettings.requiredSettings.preloader;if(preloader.indexOf('http://')===-1){preloader='/public/resources/documents/'+this.swfsettings.requiredSettings.preloader;}else{preloader=this.swfsettings.requiredSettings.preloader;}}}catch(exp){console.log('Unable to load swfsettings.requiredSettings.preloader : '+exp);}
this.myMovie=(preloader)?(preloader):(this.config.myMovie);this._setSwfParams();this._setSwfFlashvars();this._setSwfAttributes();try{swfobject.embedSWF(this.myMovie,this.flid,this.swfsettings.requiredSettings.swfwidth,this.swfsettings.requiredSettings.swfheight,"9.0.0","",this._swfFlashvars,this._swfParams,this._swfAttributes);}catch(e){console.error("{Flash} threw the following error: %o",e.message);}},_setSwfParams:function(){this._swfParams=dojo.mixin(this._swfParams,{allowScriptAccess:"always",wmode:"opaque",base:"/public/resources/documents",menu:"false",bgcolor:"#FFFFFF",allowfullscreen:"true",height:this.swfsettings.requiredSettings.swfheight});},_setSwfFlashvars:function(){if(this.swfsettings&&this.swfsettings.optionalSettings){for(var setting in this.swfsettings.optionalSettings){if(this.swfsettings.optionalSettings.hasOwnProperty(setting)){this._swfFlashvars[setting]=this.swfsettings.optionalSettings[setting];}}}
if(this.params&&this.params.flashVars){for(var flashVar in this.params.flashvars){if(this.params.flashvars.hasOwnProperty(flashVar)){this._swfFlashvars[flashVar]=this.params.flashvars[flashVar];}}}
this._swfFlashvars.SlugName=this.p;this._swfFlashvars.placement="tab";this.preload='info-'+this.p+'-preload.xml';this._swfFlashvars.PreloaderURL=this.preload;this._swfFlashvars.MovieWidth=this.swfsettings.requiredSettings.swfwidth;this._swfFlashvars.MovieHeight=this.swfsettings.requiredSettings.swfheight;this._swfFlashvars.asub=dj.util.Cookie.getCookie("user_type");this._swfFlashvars.basePath='/public/resources/documents';this._swfFlashvars.cdnDomain=dj.context.core.cdnPrefix;this._swfFlashvars.serverDomain=dj.context.core.urlPrefix;try{if((this.s===undefined||this.s===null||this.s==="")&&(this.swfsettings.optionalSettings.id!==undefined&&this.swfsettings.optionalSettings.id!=="")){this._swfFlashvars.id=this.swfsettings.optionalSettings.id;}else{this._swfFlashvars.id=this.s;}}catch(error){this._swfFlashvars.id=this.s;}
this._swfFlashvars.PLAYER_ID=this.p;try{console.log("parent.id*************** "+this.parent.id+" ******************");this._swfFlashvars.containermodule=this.parent.id;}catch(exp){console.error("Error while getting parent.id in Flash.js");}},_setSwfAttributes:function(){this._swfAttributes=dojo.mixin(this._swfAttributes,{id:this.p});},_normalizeJsonToObject:function(response){var json_start=response.indexOf('{');var json_end=response.lastIndexOf('}');if(json_start>-1){response=response.substring(json_start,json_end+1);}
return dojo.fromJson(response);}});dojo.declare("dj.widget.flash.SlideshowFlash",dj.widget.flash.Flash,{constructor:function(id,p,s,noload){this.config.myMovie='/public/resources/documents/info-slideshow08-preloader.swf';window.getContent=this.getContent;},getContent:function(){return null;}});dojo.provide("dj.widget.flash.IssuuFlash");dojo.require("dj.util.Observer");dojo.require("dj.widget.flash.Flash");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.flash.IssuuFlash",dj.widget.flash.Flash,{constructor:function(idOrDomNode,p,s,params){this.omniture={};this.omniture.saveVars=["pageName","section","subsection","aheadline","abasedocid","author","atype","csource","ctype","apage","basesection"];this.omniture.saveValues=[];},hasValidFlashVersion:function(){return(swfobject.getFlashPlayerVersion().major>=9);},nonSupportingFlashPlayer:function(divId){var imagePath=dj.context.core.cdnPrefix+"/img/PDF_screen.jpg";dojo.byId(divId).innerHTML="<div class=\"noFlash-PDF\"><img src=\""+imagePath+"\" alt=\"PDF document available (click to view)\" /></div>";},createIssuuFlash:function(){dj.util.Flash.subscribe("pageChange",this.handlePageChange,this);this._setSwfParams();this._setSwfFlashvars(docId,docName);this._setSwfAttributes();try{swfobject.embedSWF(this.swfsettings.requiredSettings.preloader,this.flid,this.swfsettings.requiredSettings.swfwidth,this.swfsettings.requiredSettings.swfheight,"9.0.0","",this._swfFlashvars,this._swfParams,this._swfAttributes);this.omniturefirepixel("load");}catch(e){console.error("{Flash} threw the following error: %o",e.message);}},createflash:function(){docId='';docName='';pageNum='';if(this.hasValidFlashVersion()){if(this.s!==''){var alternateTxtArr=this.s.split('|');if(alternateTxtArr!==undefined){if(alternateTxtArr[0]!==undefined){docId=alternateTxtArr[0].substr((alternateTxtArr[0].indexOf('=')+1),alternateTxtArr[0].length);}
if(alternateTxtArr[1]!==undefined){docName=alternateTxtArr[1].substr((alternateTxtArr[1].indexOf('=')+1),alternateTxtArr[1].length);if(docName.indexOf(".pdf")===-1){docName=docName+".pdf";}}
if(alternateTxtArr[2]!==undefined){pageNum=alternateTxtArr[2].substr((alternateTxtArr[2].indexOf('=')+1),alternateTxtArr[2].length);}}}
var that=this;var url="/issuuSearch/api/2_0/document?documentId="+docId;dojo.xhrGet({url:url,handleAs:"json",timeout:4000,load:function(response){var docFound=response.response.numFound;if(docFound==="undefined"||docFound===null||docFound===0){window.location="/public/resources/documents/"+docName;}else if(docFound===1){that.createIssuuFlash();}},error:function(error){window.location="/public/resources/documents/"+docName;}});}else{this.nonSupportingFlashPlayer(this.div);}},_setSwfParams:function(){this._swfParams.allowScriptAccess="always";this._swfParams.allowfullscreen="true";this._swfParams.wmode="opaque";this._swfParams.menu=this.swfsettings.optionalSettings.menu;},_setSwfFlashvars:function(docId,docName){this._swfFlashvars.jsAPIClientDomain=this.swfsettings.optionalSettings.jsAPIClientDomain;this._swfFlashvars.placement='tab';this._swfFlashvars.mode='embed';this._swfFlashvars.wmode='opaque';this._swfFlashvars.viewMode=this.swfsettings.optionalSettings.viewMode;this._swfFlashvars.layout=this.swfsettings.optionalSettings.layout;this._swfFlashvars.showFlipBtn='false';this._swfFlashvars.jsAPIInitCallback='addEventHandler';this._swfFlashvars.documentId=docId;this._swfFlashvars.docName=docName;this._swfFlashvars.pageNumber=pageNum;this._swfFlashvars.username=this.swfsettings.optionalSettings.username;this._swfFlashvars.loadingInfoText=this.swfsettings.optionalSettings.loadingInfoText;this._swfFlashvars.et='1251461518896';this._swfFlashvars.er='26';},_setSwfAttributes:function(){this._swfAttributes.id='issuuViewer';},handlePageChange:function(documentId){this.omniturefirepixel("change");},omnituresavepixel:function(){var svlen=this.omniture.saveVars.length;for(var f=0;f<svlen;f++){this.omniture.saveValues[f]=this.omniture.pixel.getMetaData(this.omniture.saveVars[f]);}},omniturerestorepixel:function(){var svlen=this.omniture.saveVars.length;for(var f=0;f<svlen;f++){this.omniture.pixel.setMetaData(this.omniture.saveVars[f],this.omniture.saveValues[f]);}},omniturefirepixel:function(event){var viewer=document.getElementById('issuuViewer');var pageNumber=pageNum;if(pageNumber===0||pageNumber===""){pageNumber=1;}
var pageCount=0;if(viewer!==null&&event==="change"){pageNumber=viewer.getPageNumber();pageCount=viewer.getPageCount();}
pageName='WSJ_PDF_'+docId+'_pdf_'+pageNumber+' of '+pageCount;if(!this.omniture.pixel){this.omniture.pixel=dj.util.Tracking.omniture;}
var wsjPrefix='WSJ_';this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData('section',"Multimedia");this.omniture.pixel.setMetaData('pageName',pageName);this.omniture.pixel.setMetaData('atype','WSJ_Multimedia_PDFs');var subsection=s.prop2;var section=subsection;if(subsection!=="undefined"&&subsection.indexOf(wsjPrefix)!==-1){section=subsection.substring(wsjPrefix.length,subsection.length);if(subsection==="WSJ_Infographic"){this.omniture.pixel.setMetaData('basesection',"WSJ_PDFs");}else{this.omniture.pixel.setMetaData('basesection',this.omniture.basesection);}}
this.omniture.pixel.setMetaData('aheadline','WSJ_pdf_'+section+"_"+s.prop4);this.omniture.pixel.setMetaData('csource','DJ PDFs');this.omniture.pixel.setMetaData('ctype','pdfs');this.omniture.pixel.setMetaData('caccess','free');this.omniture.pixel.setMetaData('abasedocid',"pdf_"+docId);this.omniture.pixel.setMetaData('apage',"WSJ_Multimedia_PDFs");this.omniture.pixel.firePixel(true);this.omniturerestorepixel();}});function addEventHandler(){try{var viewer=document.getElementById('issuuViewer');document.getElementById("issuuViewer").addEventListener("change","dj.util.Flash.pageChange");}catch(err){console.info(" error calling callback function by Issuu "+err);}}
(function(){var dju=dj.util,obs=new dju.Observer(dj.util.Video);dj.util.Flash={subscribe:function(flashEventName,callback,context){obs.subscribeByName(flashEventName,callback,context);},pageChange:function(documentId){obs.fireByName("pageChange",documentId);}};}());dojo.provide("dj.util.flash.template");dojo.require("dj.util.Element");dojo.require("dj.util.Template");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.flash.Flash");dojo.require("dj.util.Ads");dj.util.flash.template={scan:function(){var that=this;dojo.query("div[data-dj-widget=flash.Template]").forEach(function(domNode){try{if(that._isInitialized(domNode)){return;}
that._markAsInitialized(domNode);var dataset=that._getDatasetFromWidget(domNode);if(that._hasValidFlashVersion()){that._handleFlash(domNode,dataset);}else if(dataset.djHideIfNoFlash=="true"){that._destroyWidget(domNode);}else{that._setMagicDatapoints(dataset);that._handleTemplate(domNode,dataset);}}catch(e){console.error("{flash.Template} threw the following error: %s",e.message);}});dojo.query("div[data-dj-live-widget=slideshow.nonflash]").forEach(function(domNode){try{if(that._isInitialized(domNode)){return;}
that._markAsInitialized(domNode);var dataset=that._getDatasetFromWidget(domNode);if(dataset.djWidgetType=="largeSlideshow"){dj.widget.article.slideshow.nonflashSlideshow.init({containerId:"slideContainer",adRefreshCounter:dataset.djWidgetAdrefreshcounter});var a=new dj.util.Ads().loadAds("slideshow");if(dojo.getObject("dj.util.onVisibleWidget",true).scan){dj.util.onVisibleWidget.scan();}}else if(dataset.djWidgetType=="slideshow.explore"){dj.widget.article.slideshow.nonflashSlideshow.initExplore();}}catch(e){console.error("{flash.Template} threw the following error: %s",e.message);}});},_isInitialized:function(domNode){return(dj.util.Element.getData(domNode,"isInitialized")=="true");},_markAsInitialized:function(domNode){dj.util.Element.setData(domNode,"isInitialized","true");},_hasValidFlashVersion:function(){return(swfobject.getFlashPlayerVersion().major>=9);},_handleFlash:function(domNode,dataset){var hasFlashSettings=dataset.flashSettings;var options=hasFlashSettings?{noload:true,swfsettings:dojo.fromJson(dataset.flashSettings).swfsettings}:{};var fl=new dj.widget.flash.Flash(domNode,dataset.flashProject,dataset.flashSecondParam,options);if(hasFlashSettings){fl.create(dataset.flashProject,dataset.flashSecondParam);}},_destroyWidget:function(domNode){var parent=domNode.parentNode;dojo.destroy(domNode);var textarea=dojo.query("textarea",parent)[0];if(textarea){dojo.destroy(textarea);}
this._recursivelyDestroyEmptyParents(parent);},_recursivelyDestroyEmptyParents:function(parent){var numOfChildren=dojo.query("*",parent).length;if(numOfChildren===0){var itsParent=parent.parentNode;dojo.destroy(parent);this._recursivelyDestroyEmptyParents(itsParent);}},_setMagicDatapoints:function(dataset){dataset.djIsFlashPossible=this._isFlashPossible();},_handleTemplate:function(domNode,dataset){var template=this._getTemplateFromWidget(domNode);this._renderTemplate(domNode,template,dataset);},_getTemplateFromWidget:function(domNode){var template=dojo.query("textarea",domNode)[0];if(!template){throw new Error("{flash.Template} no template domNode found in %o",domNode);}
return this._stripCdataTags(template.value);},_getDatasetFromWidget:function(domNode){var dataset=dj.util.Element.getDataset(domNode);delete dataset.djWidget;return dataset;},_renderTemplate:function(domNode,template,dataset){domNode.innerHTML=dj.util.Template.parseTemplate(template).process(dataset);},_stripCdataTags:function(string){string=string.replace(/\s*<!\[CDATA\[\s*/,"");string=string.replace(/\s*\]\]>\s*/,"");return string;},_isFlashPossible:function(){var userAgentString=navigator.userAgent.toLowerCase(),isIphone=(userAgentString.indexOf("iphone")>-1),isIpad=(userAgentString.indexOf("ipad")>-1);return(dojo.isBrowser&&!(isIphone||isIpad));}};
dojo.provide("dj.util.account");dojo.require("dj.lang");dj.util.account={getAccountData:function(a,b){b.responseType=!b.responseType?"application/json":b.responseType;var c=b.responseType.indexOf("json")>-1;this._sendXhrRequest(a,b,{requestMethod:"GET",handleAs:c?"json":"text",requestHeaders:{Accept:b.responseType}})},postAccountData:function(a,b,c){c.requestType=!c.requestType?"application/json":c.requestType;this._sendXhrRequest(a,c,{requestMethod:"POST",content:b,requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":c.requestType}})},putAccountData:function(a,b,c){this._sendXhrRequest(a,c,{requestMethod:"PUT",content:dojo.toJson(b),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"}})},_sendXhrRequest:function(a,b,c){var d=dj.lang.cloneMixin({callback:function(){}},b);b=dj.lang.cloneMixin({requestHeaders:{Accept:"application/json"},handleAs:"json"},c);return this._getRequestByMethod(b.requestMethod)({url:a,headers:b.requestHeaders,handleAs:b.handleAs,postData:b.content,timeout:dj.context.account.serviceTimeOut,load:function(e,f){d.callback.apply(d.context,[e,f.xhr,d])},error:function(e,f){console.error("HTTP status code: %s, response: %o",f.xhr.status,e);typeof d.errorCallback!=="undefined"?d.errorCallback.apply(d.context,[e.status,f.xhr,d]):d.callback.apply(d.context,[e.status,f.xhr,d])}})},_getRequestByMethod:function(a){return a=="GET"?dojo.xhrGet:dojo.xhrPost}};dojo.provide("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.user.EnvironmentDao");dojo.require("dj.util.Url");dojo.declare("dj.widget.loader.LoadPageFragment",null,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.getGreyBckgroundCSSDiv="getGreyBckgroundCSSDiv";this.scrimManagerFile=dj.context.account.scrimManagerFilePath},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:5.9},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)})},initScrim:function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)},getScrimContents:function(a,b,c,d,e){var f=(new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User)).getEnvironment();if(typeof e!="undefined")this._cfg.akamaiCdnPrefix=e;a=new dj.widget.fragmentloader.FragmentLoader(f,b,this._cfg.version,a,this._cfg);a.load();dojo.connect(a,"onJsLoad",this,function(){typeof c!="undefined"&&typeof c==="function"&&c.call(d)})},initLoader:function(a,b,c,d,e){var f=dojo.byId(a);if(f!=null&&dj.lang.trim(f.innerHTML)!="")if(dojo.hasClass(f,"initialLoad")){dojo.removeClass(f,"initialLoad");d.scrimCallback(true)}else d.showScrim(a);else{if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles()}dojo.destroy("overlayDiv");dojo.create("div",{id:a},this.getGreyBckgroundCSSDiv,"last");this.getScrimContents(a,b,c,d,e)}},initIframeLoader:function(a,b){this._cfg.domNodeId="overlayDiv";if(dojo.byId(this._cfg.domNodeId)==null||dj.lang.trim(dojo.byId(this._cfg.domNodeId).innerHTML)==""){if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles()}if(dojo.byId("loginScrimLoader")==null){dojo.create("div",{id:"loginScrimLoader","class":"login_scrim_loader"},this.getGreyBckgroundCSSDiv,"last");dojo.byId("loginScrimLoader").innerHTML="<h4>"+dj.context.account.loading+"</h4>"}dojo.create("div",{id:this._cfg.domNodeId,"class":"login_scrim_wrapper hidden"},this.getGreyBckgroundCSSDiv,"last");dojo.create("div",{id:"login_inner","class":"login_scrim_inner"},this._cfg.domNodeId,"last");dojo.create("div",{id:"module","class":"login_scrim_module"},"login_inner","last");dojo.create("div",{id:"iframe_headerStrap","class":"headerStrap"},"module","last");dojo.byId("iframe_headerStrap").innerHTML='<a href="#" class="closeBtn iframeOverlayCloseBtn">'+dj.context.account.closeText+"</a>";this.addListnerForCloseButton()}else{dojo.addClass(this._cfg.domNodeId,"hidden");if(typeof this.userdata!="undefined"&&(typeof this.userdata.screenName!="undefined"||typeof this.userdata.confScreenName!="undefined"))if(this.userdata.screenName=="LoginVerifyEmail"||this.userdata.confScreenName=="LoginVerifyEmail"||this.userdata.screenName=="UnverifiedFreeReg"||this.userdata.confScreenName=="UnverifiedFreeReg")this.addListnerForCloseButton()}if(dojo.byId("moduleiframe")==null||dj.lang.trim(dojo.byId("moduleiframe")).innerHTML==""){this.disableIPadScroll();this.initIFrame("module",a,b)}else{this.fadeScrim("moduleiframe",300);dojo.removeClass(dojo.byId("module"),"hidden")}},addListnerForCloseButton:function(){dojo.query(".iframeOverlayCloseBtn").connect("click",this,function(a){dojo.stopEvent(a);this.enableIPadScroll();dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId(this.getGreyBckgroundCSSDiv));this.destroyAccountInstanceArr();if(typeof this.userdata!="undefined"&&(typeof this.userdata.screenName!="undefined"||typeof this.userdata.confScreenName!="undefined"))if(this.userdata.screenName=="LoginVerifyEmail"||this.userdata.confScreenName=="LoginVerifyEmail"){a=decodeURIComponent(this.userdata.refreshPageUrlForUnverifiedSub);parent.location=decodeURIComponent(a)}else if(this.userdata.screenName=="UnverifiedFreeReg"||this.userdata.confScreenName=="UnverifiedFreeReg")this.initIFrameForLogout()})},enableIPadScroll:function(){document.ontouchmove=function(){return true}},disableIPadScroll:function(){document.ontouchmove=function(){return false}},initIFrameForLogout:function(){dojo.byId("unverifiedFreeReglogout")==null&&dojo.create("div",{id:"unverifiedFreeReglogout","class":"hidden"},dojo.body(),"last");var a="http://"+document.domain+"/logout";window.console&&console.log("url for logout "+a);a={src:a,"class":"hidden"};setTimeout(this.isUserLoggedout,1E4);dj.util.Url.createSimpleIframe(a,"unverifiedFreeReglogout",this.testLogoutIframeLoaded,this)},testLogoutIframeLoaded:function(){this.userLoggedOut=true;dojo.destroy("unverifiedFreeReglogout")},isUserLoggedout:function(){this.userLoggedOut||window.console&&console.warn(" unverified free reg user couldn't be logged out ")},initIFrame:function(a,b,c){url=dj.context.account.idDomainToHostScrims+this._cfg.mstPageId+".html?successFileUrl="+encodeURIComponent("http://"+document.domain+this.scrimManagerFile)+"&currentPageUrl="+encodeURIComponent(this.getPageUrl())+"&region="+encodeURIComponent(dj.util.Region.getViewByRegion());if(typeof this.userdata!="undefined"){if(typeof this.userdata.refreshPageUrlForUnverifiedSub!="undefined")this.userdata.refreshPageUrlForUnverifiedSub=encodeURIComponent(this.userdata.refreshPageUrlForUnverifiedSub);url+="&userdata="+dojo.toJson(this.userdata)}dj.util.Url.createSimpleIframe({src:url,"class":"login_scrim_framed",style:{height:b,width:c},allowTransparency:"true"},a,this.iframeLoaded,this)},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},iframeLoaded:function(){if(dojo.hasClass(this._cfg.domNodeId,"hidden")){this.fadeScrim(this._cfg.domNodeId,300);dojo.byId(this._cfg.domNodeId)!=null&&dojo.removeClass(dojo.byId(this._cfg.domNodeId),"hidden")}},getDomain:function(){var a="";return a=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain},getPageUrl:function(){var a=this._cfg.NONSUBSCRIBER_HOMEPAGE_PID,b=this._cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,c=this._cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,d=this._cfg.MDC_PAGE_PID,e;e=this.getDomain();var f;var g=f=dojo.isIE?window.location.href:document.location.href;if(typeof pID!=="undefined"){g=pID===a?e+this._cfg.HOMEPAGE_SUBSCRIBER_URL:pID===c?e+"/email":pID===b?e+this._cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===d?e+this._cfg.MDC_LINK_URL:f;a=g.indexOf("?")!=-1?"&":"?";if(typeof a!==undefined){a=a+"_nocache="+(new Date).getTime();if(g.indexOf("#")!=-1)g=g.replace("#",a);else g+=a}}return g},initHiddenScrim:function(a,b,c,d){if(typeof b=="undefined")b=this._cfg.mstPageId;if(typeof a=="undefined")a=this._cfg.domNodeId;if(dojo.byId(a)==null||dj.lang.trim(dojo.byId(a).innerHTML)==""){if(dojo.byId(a)==null){if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles()}dojo.create("div",{id:a,"class":"hidden initialLoad"},this.getGreyBckgroundCSSDiv,"last")}else dojo.addClass(dojo.byId(a),"hidden");this.getScrimContents(a,b,c,d)}},fadeScrim:function(a,b){var c=1E3;if(b)c=b;dojo.style(a,"opacity","0");dojo.fadeIn({node:a,duration:c}).play()},addclassForArticles:function(){this.getPageUrl().indexOf("/article/")>0&&dojo.addClass(dojo.byId(this.getGreyBckgroundCSSDiv),"article_LIFP")},setUserdata:function(a){this.userdata=a},addToAccountInstanceArr:function(a){if(typeof dj.module.loader.accountInstanceArr=="undefined")dj.module.loader.accountInstanceArr=[];dj.module.loader.accountInstanceArr.push(a)},addToAccountWidgetInstanceArr:function(){},destroyAccountInstanceArr:function(){if(typeof dj.module.loader!="undefined"&&typeof dj.module.loader.accountInstanceArr!="undefined"){for(;dj.module.loader.accountInstanceArr.length!=0;){var a=dj.module.loader.accountInstanceArr.pop();typeof a!="undefined"&&typeof a.destroyObject!="undefined"&&typeof a.destroyObject=="function"&&a.destroyObject()}if(dj.module.loader.accountInstanceArr.length==0){dj.module.loader.accountInstanceArr={};dj.module.loader={}}}}});dojo.provide("dj.widget.loader.FBInitLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FBInitLoader",[],{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.loadpageFragObj=new dj.widget.loader.LoadPageFragment({version:this._cfg.version})},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbInitPageId,domNodeId:"fbInitDivId"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initScrim()})},initScrim:function(){this.isShow=true;if(typeof this.loadStatus!="undefined")this.loadStatus=="loaded"&&this.showScrim();else this.loadpageFragObj.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)},initHiddenScrim:function(){if(typeof this.isShow=="undefined"&&typeof this.loadStatus=="undefined"){this.isShow=false;this.loadStatus="loading";this.loadpageFragObj.initHiddenScrim(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)}else this.isShow=false},initScrimFromIframe:function(){this.isShow=true;if(typeof this.loadStatus!="undefined")this.loadStatus=="loaded"&&this.showScrim();else this.loadpageFragObj.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this,this._cfg.akamaiCdnPrefix)},scrimCallback:function(a){this.loadStatus="loaded";if(typeof this.fbInitdWidget!="undefined"&&this.fbInitdWidget!=null)this.fbInitdWidget.init(this._cfg.domNodeId,a,this.isShow);else{this.fbInitdWidget=new dj.widget.accountscrim.FBInit(this._cfg);this.fbInitdWidget.init(this._cfg.domNodeId,a,this.isShow);this.loadpageFragObj.addToAccountWidgetInstanceArr(this.fbInitdWidget)}},showScrim:function(){if(typeof this.fbInitdWidget!="undefined"&&this.fbInitdWidget!=null)this.fbInitdWidget.showScrim(this._cfg.domNodeId,true);else{this.fbInitdWidget=new dj.widget.accountscrim.FBInit(this._cfg);this.fbInitdWidget.showScrim(this._cfg.domNodeId,true);this.loadpageFragObj.addToAccountWidgetInstanceArr(this.fbInitdWidget)}},destroyObject:function(){delete this.fbInitdWidget}});dojo.provide("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"370px",width:"678px"},scrimCallback:function(a){if(typeof this.fbLoginOrWSJPswdConfWidget!="undefined"&&this.fbLoginOrWSJPswdConfWidget!=null)this.fbLoginOrWSJPswdConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.fbLoginOrWSJPswdConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.fbLoginOrWSJPswdConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.fbLoginOrWSJPswdConfWidget)}},showScrim:function(){if(typeof this.fbLoginOrWSJPswdConfWidget!="undefined"&&this.fbLoginOrWSJPswdConfWidget!=null)this.fbLoginOrWSJPswdConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.fbLoginOrWSJPswdConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.fbLoginOrWSJPswdConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.fbLoginOrWSJPswdConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.fbLoginOrWSJPswdConfPageId},destroyObject:function(){delete this.fbLoginOrWSJPswdConfWidget}});dojo.provide("dj.widget.loader.FbLoginOrWSJPswdLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FbLoginOrWSJPswdLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"fbLoginOrWSJPswdDivId",mstPageId:dj.context.account.fbLoginOrWSJPswdPageId,height:"370px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},destroyObject:function(){delete this.fbLoginOrWSJPswdWidget}});dojo.provide("dj.widget.loader.ForgotPasswordConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotPasswordConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"340px",width:"678px"},scrimCallback:function(a){if(typeof this.forgotPasswordConfWidget!="undefined"&&this.forgotPasswordConfWidget!=null)this.forgotPasswordConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.forgotPasswordConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotPasswordConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.forgotPasswordConfWidget)}},showScrim:function(){if(typeof this.forgotPasswordConfWidget!="undefined"&&this.forgotPasswordConfWidget!=null)this.forgotPasswordConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.forgotPasswordConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotPasswordConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.forgotPasswordConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.forgotPasswordConfPageId},destroyObject:function(){delete this.forgotPasswordConfWidget}});dojo.provide("dj.widget.loader.ForgotPasswordLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotPasswordLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata={}},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.4,initNodeClass:".forgotPasswordClass",mstPageId:dj.context.account.forgotPasswordPageId,domNodeId:"forgotPasswordDivId",height:"370px",width:"678px"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initIframeLoader(this._cfg.height,this._cfg.width)})},destroyObject:function(){delete this.forgotPasswordWidget}});dojo.provide("dj.widget.loader.ForgotUsernameConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotUsernameConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"370px",width:"678px"},scrimCallback:function(a){if(typeof this.forgotUsernameConfWidget!="undefined"&&this.forgotUsernameConfWidget!=null)this.forgotUsernameConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.forgotUsernameConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotUsernameConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.forgotUsernameConfWidget)}},showScrim:function(){if(typeof this.forgotUsernameConfWidget!="undefined"&&this.forgotUsernameConfWidget!=null)this.forgotUsernameConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.forgotUsernameConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotUsernameConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.forgotUsernameConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.forgotUsernameConfPageId},destroyObject:function(){delete this.forgotUsernameConfWidget}});dojo.provide("dj.widget.loader.ForgotUserOrPswdLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotUserOrPswdLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.userdata={}},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.4,initNodeClass:".forgotUsernameClass",mstPageId:dj.context.account.forgotUsernamePageId,domNodeId:"forgotUsernameDivId",height:"350px",width:"678px"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initIframeLoader(this._cfg.height,this._cfg.width)})},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},destroyObject:function(){delete this.forgotUsernameWidget}});dojo.provide("dj.widget.loader.LoginVerifyEmailConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.LoginVerifyEmailConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"280px",width:"678px"},scrimCallback:function(a){if(typeof this.loginVerifyConfWidget!="undefined"&&this.loginVerifyConfWidget!=null)this.loginVerifyConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.loginVerifyConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.loginVerifyConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.loginVerifyConfWidget)}},showScrim:function(){if(typeof this.loginVerifyConfWidget!="undefined"&&this.loginVerifyConfWidget!=null)this.loginVerifyConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.loginVerifyConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.loginVerifyConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.loginVerifyConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.loginVerifyEmailConfPageId},destroyObject:function(){delete this.loginVerifyConfWidget}});dojo.provide("dj.widget.loader.LoginVerifyEmailLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.LoginVerifyEmailLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.userdata={}},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"loginVerifyEmailDivId",mstPageId:dj.context.account.loginVerifyEmailPageId,height:"400px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},scrimCallback:function(a){if(typeof this.loginVerifyWidget!="undefined"&&this.loginVerifyWidget!=null)this.loginVerifyWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.loginVerifyWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.loginVerifyWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.loginVerifyWidget)}},showScrim:function(){if(typeof this.loginVerifyWidget!="undefined"&&this.loginVerifyWidget!=null)this.loginVerifyWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.loginVerifyWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.loginVerifyWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.loginVerifyWidget)}},destroyObject:function(){delete this.loginVerifyWidget}});dojo.provide("dj.widget.loader.ThankYouLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ThankYouLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"thankYouDivId",mstPageId:dj.context.account.thankYouPageId,height:"280px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},scrimCallback:function(a){if(typeof this.thankYouWidget!="undefined"&&this.thankYouWidget!=null)this.thankYouWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.thankYouWidget=new dj.widget.accountscrim.ThankYou(this._cfg);this.thankYouWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.thankYouWidget)}},showScrim:function(){if(typeof this.thankYouWidget!="undefined"&&this.thankYouWidget!=null)this.thankYouWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.thankYouWidget=new dj.widget.accountscrim.ThankYou(this._cfg);this.thankYouWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.thankYouWidget)}},destroyObject:function(){delete this.thankYouWidget}});dojo.provide("dj.widget.loader.UnverifiedFreeRegConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UnverifiedFreeRegConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this._cfg.domNodeId=this.getDomNodeId(a);this._cfg.mstPageId=this.getMstPageId(a);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"280px",width:"678px"},scrimCallback:function(a){if(typeof this.unverifiedFreeRegConfWidget!="undefined"&&this.unverifiedFreeRegConfWidget!=null)this.unverifiedFreeRegConfWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.unverifiedFreeRegConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.unverifiedFreeRegConfWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegConfWidget)}},showScrim:function(){if(typeof this.unverifiedFreeRegConfWidget!="undefined"&&this.unverifiedFreeRegConfWidget!=null)this.unverifiedFreeRegConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.unverifiedFreeRegConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.unverifiedFreeRegConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegConfWidget)}},getDomNodeId:function(a){return a.screenName+"ConfirmationDivId"},getMstPageId:function(){return dj.context.account.unverifiedFreeRegConfPageId},destroyObject:function(){delete this.unverifiedFreeRegConfWidget}});dojo.provide("dj.widget.loader.UnverifiedFreeRegLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UnverifiedFreeRegLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.userdata={}},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"unverifiedFreeRegDivId",mstPageId:dj.context.account.unverifiedFreeRegPageId,height:"400px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},scrimCallback:function(a){if(typeof this.unverifiedFreeRegWidget!="undefined"&&this.unverifiedFreeRegWidget!=null)this.unverifiedFreeRegWidget.init(this._cfg.domNodeId,this.userdata,a);else{this.unverifiedFreeRegWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.unverifiedFreeRegWidget.init(this._cfg.domNodeId,this.userdata,a);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegWidget)}},showScrim:function(){if(typeof this.unverifiedFreeRegWidget!="undefined"&&this.unverifiedFreeRegWidget!=null)this.unverifiedFreeRegWidget.showScrim(this._cfg.domNodeId,this.userdata,true);else{this.unverifiedFreeRegWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.unverifiedFreeRegWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegWidget)}},destroyObject:function(){delete this.unverifiedFreeRegWidget}});dojo.provide("dj.widget.loader.UserWithourEmailConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UserWithourEmailConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"userWithoutEmailConfDivId",mstPageId:dj.context.account.userWithoutEmailConfPageId,height:"350px",width:"678px"},scrimCallback:function(a){(new dj.widget.accountscrim.UserWithoutEmailConfirmation(this._cfg)).init(this._cfg.domNodeId,this.userdata,a)},showScrim:function(){(new dj.widget.accountscrim.UserWithoutEmailConfirmation(this._cfg)).showScrim(this._cfg.domNodeId,this.userdata,true)}});dojo.provide("dj.widget.loader.UserWithoutEmailLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UserWithoutEmailLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a,b){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.userdata=a},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.5,mstPageId:dj.context.account.userWithoutEmailPageId,domNodeId:"changeUsernameDivId",height:"400px",width:"678px"},chkIfUserWoEmail:function(){var a=dojo.queryToObject(window.location.search.slice(1));if(typeof a.user!="undefined"&&a.user=="welcome"){var b=this;dj.util.User.isLoggedIn(function(c){if(c)if(!djcs.UserInfo.hasRole("SEAMLESS")){if(dojo.byId("userEmailId_temp")!=null)dojo.byId("userEmailId_temp").innerHTML="";else dojo.addClass(dojo.create("div",{id:"userEmailId_temp"},dojo.body()),"hidden");dj.util.User.renderEmailAddress("userEmailId_temp");c=dojo.byId("userEmailId_temp").innerHTML;var d=dojo.indexOf(["dupe@wsj.com","cancel@dowjones.com","canceled@wsj.com","cancelled@wsj.com","dup@wsj.com","cancel@wsj.com","dupe@wsj.com","test@test.com","cancel@dj.com","dup@dowjones.com","duplicate@wsj.com","refused@wsj.com"],c);if(typeof c=="undefined"||c=="undefined"||c==""||d>0)b.initIframeLoader(b._cfg.height,b._cfg.width)}})}},scrimCallback:function(a){(new dj.widget.accountscrim.UserWithoutEmail(this._cfg)).init(this._cfg.domNodeId,a)},showScrim:function(){(new dj.widget.accountscrim.UserWithoutEmail(this._cfg)).showScrim(this._cfg.domNodeId,true)}});dojo.provide("dj.service.account.LoginService");dojo.require("dj.util.account");dojo.require("dj.util.Observer");dj.service.account.LoginService={loginUser:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleSuccessResp,errorCallback:this.handleErrorResp,context:this,url:a,responseType:"application/json",clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleErrorResp:function(a,b,c){a="";var d=[];if(b.status=="404"||b.status=="500")d[0]="generalError";else if(b.status=="503"||b.status=="403")d[0]="unavailableError";else{a=dojo.fromJson(b.responseText);if(typeof a["user-status"]!="undefined")d[0]=a["user-status"];else dojo.forEach(a.errors,function(e,f){d[f]=e.name+e.status})}c.clientInfo.errorCallback.apply(c.clientInfo.context,[d])},handleSuccessResp:function(a,b,c){b.status=="200"&&c.clientInfo.loadCallback.call(c.clientInfo.context,a)},testLogin:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleLoginSuccess,errorCallback:this.handleLoginError,context:this,url:a,responseType:"application/json",clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleLoginSuccess:function(a,b,c){c.clientInfo.loadCallback.call(c.clientInfo.context,a)},handleLoginError:function(a,b,c){c.clientInfo.errorCallback.call(c.clientInfo.context,a)}};dojo.provide("dj.service.account.RegistrationService");dojo.require("dj.util.account");dojo.require("dj.util.Observer");dj.service.account.RegistrationService={registerUser:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleSuccessResp,errorCallback:this.handleErrorResp,context:this,url:a,responseType:"application/json",requestType:"application/x-www-form-urlencoded;charset="+document.characterSet,clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleErrorResp:function(a,b,c){a=[];if(b.status=="404"||b.status=="500")a[0]="generalError";else if(b.status==412){b=dojo.fromJson(b.responseText);if(b.status=="precondition_failed"){b=b.profile.errors;a[0]=b.emailAddress;if(typeof b.emailAddress=="undefined")a[0]="generalError"}}else if(b.status=="503"||b.status=="403")a[0]="unavailableError";c.clientInfo.errorCallback.apply(c.clientInfo.context,[a])},handleSuccessResp:function(a,b,c){b.status=="200"&&c.clientInfo.loadCallback.call(c.clientInfo.context,a.profile.emailAddress)},changeUsername:function(a,b,c,d,e){dj.util.account.postAccountData(a,b,{callback:this.handleChangeUsernameSuccessResp,errorCallback:this.handleChangeUsernameErrorResp,context:this,url:a,responseType:"application/json",requestType:"application/x-www-form-urlencoded;charset="+document.characterSet,clientInfo:{loadCallback:c,errorCallback:d,context:e}})},handleChangeUsernameErrorResp:function(a,b,c){a=[];if(b.status=="404"||b.status=="500")a[0]="generalError";else if(b.status==412){b=dojo.fromJson(b.responseText);if(b.status=="precondition_failed"){b=b.profile.errors;a[0]=b.username;if(typeof b.username=="undefined")a[0]="generalError"}}else if(b.status=="503"||b.status=="403")a[0]="unavailableError";c.clientInfo.errorCallback.apply(c.clientInfo.context,[a])},handleChangeUsernameSuccessResp:function(a,b,c){b.status=="200"&&c.clientInfo.loadCallback.call(c.clientInfo.context,a.profile.uuid)},getNodeValue:function(a,b){return a.getElementsByTagName(b)[0].firstChild.nodeValue},getNode:function(a,b){return a.getElementsByTagName(b)[0]},getAttribute:function(a,b){return a.getAttribute(b)}};dojo.provide("dj.widget.loader.FBConnectedLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.util.Ads");dojo.declare("dj.widget.loader.FBConnectedLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbConnectedPageId,domNodeId:"fbConnectedDivId"},initScrimFromIframe:function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this)},scrimCallback:function(a){if(typeof this.fbConnectedWidget!="undefined"&&this.fbConnectedWidget!=null)this.fbConnectedWidget.init(this._cfg.domNodeId,a);else{this.fbConnectedWidget=new dj.widget.accountscrim.FBConnected(this._cfg);this.fbConnectedWidget.init(this._cfg.domNodeId,a);this.addToAccountWidgetInstanceArr(this.fbConnectedWidget)}(new dj.util.Ads).loadAds("facebook2")},showScrim:function(){if(typeof this.fbConnectedWidget!="undefined"&&this.fbConnectedWidget!=null)this.fbConnectedWidget.showScrim(this._cfg.domNodeId,true);else{this.fbConnectedWidget=new dj.widget.accountscrim.FBConnected(this._cfg);this.fbConnectedWidget.showScrim(this._cfg.domNodeId,true);this.addToAccountWidgetInstanceArr(this.fbConnectedWidget)}(new dj.util.Ads).loadAds("facebook2")},destroyObject:function(){delete this.fbConnectedWidget}});dojo.provide("dj.widget.loader.LoginLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.util.Region");dojo.declare("dj.widget.loader.LoginLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".loginClass",mstPageId:dj.context.account.loginOverlayPageId,domNodeId:"loginDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:dj.context.account.loginOverlayHeight,width:dj.context.account.loginOverlayWidth,isMobile:false},init:function(){window.console&&console.log("this._cfg.initNodeClass "+this._cfg.initNodeClass);dojo.query(this._cfg.initNodeClass).connect("click",this,function(a){dojo.stopEvent(a);this.redirectIfMobileUser()})},initLoginScrimInIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},isGermanyProduct:function(){if(dj.util.Region.getViewByRegion()==="germany")return true;return false},redirectIfMobileUser:function(){var a=this;navigator.userAgent.search(/Mobile/i)>-1&&!a.isGermanyProduct()?dojo.xhrGet({url:"/static_html_files/mobile/mobileDevices.json",headers:{Accept:"application/json"},handleAs:"json",load:function(b){if(b.hasOwnProperty("deviceList"))for(var c in b.deviceList){device=b.deviceList[c];if(RegExp(device.OS,"i").test(navigator.userAgent)){a._cfg.isMobile=true;break}}},error:function(b,c){console.error("HTTP status code: ",c.xhr.status)}}).then(function(){if(a._cfg.isMobile)window.location=dj.context.core.secureLoginPrefix+"/content/public/page/login-mobile.html";else a.initIframeLoader(a._cfg.height,a._cfg.width)},function(b){console.log("errror"+
b)}):this.initIframeLoader(this._cfg.height,this._cfg.width)}});dojo.provide("dj.widget.loader.LoaderInstanceFactory");dj.widget.loader.LoaderInstanceFactory={intializeLoader:function(){if(dj.module.loader==null||typeof dj.module.loader=="undefined")dj.module.loader={}},getLoginLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.loginLoaderObj=="undefined"||dj.module.loader.loginLoaderObj==null){var b={};if(typeof a!="undefined")b={isLoadJs:a.isLoadJs,version:a.version};dj.module.loader.loginLoaderObj=new dj.widget.loader.LoginLoader(b);dj.module.loader.loginLoaderObj.addToAccountInstanceArr(dj.module.loader.loginLoaderObj)}return dj.module.loader.loginLoaderObj},getRegistrationLoaderInstance:function(){this.intializeLoader();if(typeof dj.module.loader.registrationLoaderObj=="undefined"||dj.module.loader.registrationLoaderObj==null){dj.module.loader.registrationLoaderObj=new dj.widget.loader.RegistrationLoader;dj.module.loader.registrationLoaderObj.addToAccountInstanceArr(dj.module.loader.registrationLoaderObj)}return dj.module.loader.registrationLoaderObj},getForgotUserOrPswdLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.forgotUserOrPswdLoaderObj=="undefined"||dj.module.loader.forgotUserOrPswdLoaderObj==null){dj.module.loader.forgotUserOrPswdLoaderObj=new dj.widget.loader.ForgotUserOrPswdLoader;dj.module.loader.forgotUserOrPswdLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotUserOrPswdLoaderObj)}dj.module.loader.forgotUserOrPswdLoaderObj.setUserdata(a);return dj.module.loader.forgotUserOrPswdLoaderObj},getForgotPasswordLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.forgotPasswordLoaderObj=="undefined"||dj.module.loader.forgotPasswordLoaderObj==null){dj.module.loader.forgotPasswordLoaderObj=new dj.widget.loader.ForgotPasswordLoader;dj.module.loader.forgotPasswordLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotPasswordLoaderObj)}dj.module.loader.forgotPasswordLoaderObj.setUserdata(a);return dj.module.loader.forgotPasswordLoaderObj},getFBInitLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.fbInitLoaderObj=="undefined"||dj.module.loader.fbInitLoaderObj==null){dj.module.loader.fbInitLoaderObj=new dj.widget.loader.FBInitLoader(a);dj.module.loader.fbInitLoaderObj.loadpageFragObj.addToAccountInstanceArr(dj.module.loader.fbInitLoaderObj)}return dj.module.loader.fbInitLoaderObj},getLoginVerifyEmailLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.loginVerifyEmailLoaderObj=="undefined"||dj.module.loader.loginVerifyEmailLoaderObj==null){dj.module.loader.loginVerifyEmailLoaderObj=new dj.widget.loader.LoginVerifyEmailLoader;dj.module.loader.loginVerifyEmailLoaderObj.addToAccountInstanceArr(dj.module.loader.loginVerifyEmailLoaderObj)}dj.module.loader.loginVerifyEmailLoaderObj.setUserdata(a);return dj.module.loader.loginVerifyEmailLoaderObj},getUnverifiedFreeRegLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.unverifiedFreeRegLoaderObj=="undefined"||dj.module.loader.unverifiedFreeRegLoaderObj==null){dj.module.loader.unverifiedFreeRegLoaderObj=new dj.widget.loader.UnverifiedFreeRegLoader;dj.module.loader.unverifiedFreeRegLoaderObj.addToAccountInstanceArr(dj.module.loader.unverifiedFreeRegLoaderObj)}dj.module.loader.unverifiedFreeRegLoaderObj.setUserdata(a);return dj.module.loader.unverifiedFreeRegLoaderObj},getFbLoginOrWSJPswdLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.fbLoginOrWSJPswdLoaderObj=="undefined"||dj.module.loader.fbLoginOrWSJPswdLoaderObj==null){dj.module.loader.fbLoginOrWSJPswdLoaderObj=new dj.widget.loader.FbLoginOrWSJPswdLoader;dj.module.loader.fbLoginOrWSJPswdLoaderObj.addToAccountInstanceArr(dj.module.loader.fbLoginOrWSJPswdLoaderObj)}dj.module.loader.fbLoginOrWSJPswdLoaderObj.setUserdata(a);return dj.module.loader.fbLoginOrWSJPswdLoaderObj},getThankYouLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.thankYouLoaderObj=="undefined"||dj.module.loader.thankYouLoaderObj==null){dj.module.loader.thankYouLoaderObj=new dj.widget.loader.ThankYouLoader;dj.module.loader.thankYouLoaderObj.addToAccountInstanceArr(dj.module.loader.thankYouLoaderObj)}dj.module.loader.thankYouLoaderObj.setUserdata(a);return dj.module.loader.thankYouLoaderObj},getUserWithourEmailConfirmationLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.userWithourEmailConfirmationLoaderObj=="undefined"||dj.module.loader.userWithourEmailConfirmationLoaderObj==null){dj.module.loader.userWithourEmailConfirmationLoaderObj=new dj.widget.loader.UserWithourEmailConfirmationLoader;dj.module.loader.userWithourEmailConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.userWithourEmailConfirmationLoaderObj)}dj.module.loader.userWithourEmailConfirmationLoaderObj.setUserdata(a);return dj.module.loader.userWithourEmailConfirmationLoaderObj},getFBConnectedLoaderInstance:function(a){this.intializeLoader();if(typeof dj.module.loader.fbConnectedLoaderObj=="undefined"||dj.module.loader.fbConnectedLoaderObj==null){dj.module.loader.fbConnectedLoaderObj=new dj.widget.loader.FBConnectedLoader({isLoadJs:a.isLoadJs,version:a.version});dj.module.loader.fbConnectedLoaderObj.addToAccountInstanceArr(dj.module.loader.fbConnectedLoaderObj)}return dj.module.loader.fbConnectedLoaderObj},getConfirmationLoaderInstance:function(a){this.intializeLoader();if(typeof a!="undefined")if(a.confScreenName==="LoginVerifyEmail"){dojo.require("dj.widget.loader.LoginVerifyEmailConfirmationLoader");if(typeof dj.module.loader.loginVerifyEmailConfirmationLoaderObj=="undefined"||dj.module.loader.loginVerifyEmailConfirmationLoaderObj==null){dj.module.loader.loginVerifyEmailConfirmationLoaderObj=new dj.widget.loader.LoginVerifyEmailConfirmationLoader(a);dj.module.loader.loginVerifyEmailConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.loginVerifyEmailConfirmationLoaderObj)}dj.module.loader.loginVerifyEmailConfirmationLoaderObj.setUserdata(a);return dj.module.loader.loginVerifyEmailConfirmationLoaderObj}else if(a.confScreenName==="FbLoginOrWSJPswd"){dojo.require("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader");if(typeof dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj=="undefined"||dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj==null){dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj=new dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader(a);dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj)}dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj.setUserdata(a);return dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj}else if(a.confScreenName==="ForgotUsername"){dojo.require("dj.widget.loader.ForgotUsernameConfirmationLoader");if(typeof dj.module.loader.forgotUsernameConfirmationLoaderObj=="undefined"||dj.module.loader.forgotUsernameConfirmationLoaderObj==null){dj.module.loader.forgotUsernameConfirmationLoaderObj=new dj.widget.loader.ForgotUsernameConfirmationLoader(a);dj.module.loader.forgotUsernameConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotUsernameConfirmationLoaderObj)}dj.module.loader.forgotUsernameConfirmationLoaderObj.setUserdata(a);return dj.module.loader.forgotUsernameConfirmationLoaderObj}else if(a.confScreenName==="ForgotPassword"){dojo.require("dj.widget.loader.ForgotPasswordConfirmationLoader");if(typeof dj.module.loader.forgotPasswordConfirmationLoaderObj=="undefined"||dj.module.loader.forgotPasswordConfirmationLoaderObj==null){dj.module.loader.forgotPasswordConfirmationLoaderObj=new dj.widget.loader.ForgotPasswordConfirmationLoader(a);dj.module.loader.forgotPasswordConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotPasswordConfirmationLoaderObj)}dj.module.loader.forgotPasswordConfirmationLoaderObj.setUserdata(a);return dj.module.loader.forgotPasswordConfirmationLoaderObj}else if(a.confScreenName==="UnverifiedFreeReg"){dojo.require("dj.widget.loader.UnverifiedFreeRegConfirmationLoader");if(typeof dj.module.loader.unverifiedFreeRegConfirmationLoaderObj=="undefined"||dj.module.loader.unverifiedFreeRegConfirmationLoaderObj==null){dj.module.loader.unverifiedFreeRegConfirmationLoaderObj=new dj.widget.loader.UnverifiedFreeRegConfirmationLoader(a);dj.module.loader.unverifiedFreeRegConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.unverifiedFreeRegConfirmationLoaderObj)}dj.module.loader.unverifiedFreeRegConfirmationLoaderObj.setUserdata(a);return dj.module.loader.unverifiedFreeRegConfirmationLoaderObj}}};dojo.provide("dj.widget.loader.RegistrationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.declare("dj.widget.loader.RegistrationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:13.2,initNodeClass:".registerUserClass",mstPageId:dj.context.account.registrationOverlayPageId,domNodeId:"registrationDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:dj.context.account.registrationOverlayHeight,width:dj.context.account.registrationOverlayWidth},init:function(){window.console&&console.log("this._cfg.initNodeClass in reg "+this._cfg.initNodeClass);dojo.query(this._cfg.initNodeClass).connect("click",this,function(){this.initIframeLoader(this._cfg.height,this._cfg.width)})},initRegisterScrimInIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},loadRegistrationRelatedScrims:function(){dj.widget.loader.LoaderInstanceFactory.getThankYouLoaderInstance(this._cfg).initHiddenScrim()}});dojo.provide("dj.widget.loader.FBLoginLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.widget.loader.FBConnectedLoader");dojo.declare("dj.widget.loader.FBLoginLoader",dj.widget.loader.LoadPageFragment,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a)},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbLoginPageId,domNodeId:"fbLoginDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:"660px",width:"678px"},init:function(){this.initIframeLoader(this._cfg.height,this._cfg.width)},loadFBRegistrationRelatedScrims:function(){dj.widget.loader.LoaderInstanceFactory.getFBConnectedLoaderInstance(this._cfg).initHiddenScrim()}});dojo.provide("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.widget.loader.ForgotUserOrPswdLoader");dojo.require("dj.widget.loader.ForgotPasswordLoader");dojo.require("dj.widget.loader.FBInitLoader");dojo.require("dj.widget.loader.RegistrationLoader");dojo.require("dj.util.Url");dojo.declare("dj.widget.accountscrim.BaseScrim",null,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.PRODUCT_CD=dj.context.account.productCd;this.queryStringList={};this.getGreyBckgroundCSSDiv="getGreyBckgroundCSSDiv";this._constants=this.CONSTANTS;this.successFileUrl=this.getQueryStrParam("successFileUrl");this.currentPageUrl=this.getQueryStrParam("currentPageUrl");this.userdata=this.getQueryStrParam("userdata");this.userdata=dojo.fromJson(this.userdata);this.omniturePrefix=dj.context.account&&dj.context.account.omniturePrefix?dj.context.account.omniturePrefix:"WSJ";this.checkIfMobileUser()},DEFAULT_CONFIG:{},CONSTANTS:{FORGOT_USERNAME_SCREEN:"ForgotUsername",FORGOT_PASSWORD_SCREEN:"ForgotPassword",FB_LOGIN_OR_WSJ_PSWD_SCREEN:"FbLoginOrWSJPswd",UNVERIFIED_FREE_REG:"UnverifiedFreeReg",LOGIN_VERIFY_EMAIL_SCREEN:"LoginVerifyEmail",FORGOT_USERNAME_CONF_SCREEN:"ForgotUsernameConfirmation",FORGOT_PASSWORD_CONF_SCREEN:"ForgotPasswordConfirmation",FB_LOGIN_OR_WSJ_PSWD_CONF_SCREEN:"FbLoginOrWSJPswdConfirmation",UNVERIFIED_FREE_CONF_REG:"UnverifiedFreeRegConfirmation",LOGIN_VERIFY_EMAIL_CONF_SCREEN:"LoginVerifyEmailConfirmation",USER_WITHOUT_EMAIL:"UserWithoutEmail",LOGIN_SCREEN:"Login",SCRIMS_OK_CLOSE_BTN_CLASS:".accountScrimOkOrCloseBtnClass"},checkIfMobileUser:function(){if(typeof dj.context.mobile!=="undefined"){dj.context.account.forgotUserOrPswdPageUrl=dj.context.mobile.forgotUserOrPswdPageUrl;dj.context.account.forgotUsernameConfPageUrl=dj.context.mobile.forgotUsernameConfPageUrl;dj.context.account.forgotPasswordPageUrl=dj.context.mobile.forgotPasswordPageUrl;dj.context.account.forgotPasswordConfPageUrl=dj.context.mobile.forgotPasswordConfPageUrl;dj.context.account.resetPasswordPageUrl=dj.context.mobile.resetPasswordPageUrl}},hideErrorMessages:function(){dojo.addClass(dojo.byId(this._nodes.errorUl),this._nodes.hiddenClass)},hideScrim:function(a){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage)dojo.byId(a)!=null&&dojo.addClass(dojo.byId(a),this._nodes.hiddenClass)},displayScrim:function(a,b){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){typeof b!="undefined"&&b&&this.fadeScrim(a);dojo.byId(a)!=null&&dojo.removeClass(dojo.byId(a),this._nodes.hiddenClass)}},showErrorMessage:function(a,b){var c="";if(b.length>0){dojo.forEach(b,function(e){c+=dojo.byId(e).innerHTML},this);var d=dojo.byId(a);d.innerHTML=c;dojo.removeClass(d,this._nodes.hiddenClass);if(typeof this._nodes.isIframe!="undefined"&&this._nodes.isIframe){dojo.removeClass(dojo.byId(this._nodes.iframeErrorOverlayDiv),this._nodes.hiddenClass);dojo.connect(dojo.byId(this._nodes.goBackToIframeFrmErr),"click",this,function(){dojo.addClass(dojo.byId(this._nodes.iframeErrorOverlayDiv),this._nodes.hiddenClass)})}}},addErrorClass:function(a){dojo.addClass(dojo.byId(a),this._nodes.fieldErrorClass)},connectForgotPasswordFromIframe:function(a){dojo.query(this._nodes.gotoForgotPasswordFromIframe).connect("click",this,function(b){dojo.stopEvent(b);if(this._nodes.isStandalonePage)window.location=typeof a=="undefined"?this._nodes.pageUrls.forgotPasswordPageUrl:this._nodes.pageUrls.forgotPasswordPageUrl+"?userEmailId="+a;else if(this.chkIfHttpsDomain())parent.location=dj.context.account.forgotPasswordPageUrl;else this.initForgotPasswordFromIframe(a)})},connectForgotUsernameFromIframe:function(a){dojo.query(this._nodes.gotoForgotUsernameFromIframe).connect("click",this,function(b){dojo.stopEvent(b);if(this._nodes.isStandalonePage)window.location=typeof a=="undefined"?this._nodes.pageUrls.forgotUserOrPswdPageUrl:this._nodes.pageUrls.forgotUserOrPswdPageUrl+"?userEmailId="+a;else this.initForgotUsernameFromIframe(a)})},connectForgotUsername:function(){dojo.query(this._nodes.gotoForgotUsername).connect("click",this,function(a){dojo.stopEvent(a);if(this._nodes.isStandalonePage)window.location=this._nodes.pageUrls.forgotUserOrPswdPageUrl;else this.initForgotUserOrPswd()})},connectForgotPassword:function(){dojo.query(this._nodes.gotoForgotPassword).connect("click",this,function(a){dojo.stopEvent(a);if(this._nodes.isStandalonePage)window.location=this._nodes.pageUrls.forgotPasswordPageUrl;else this.initForgotPassword()})},initForgotUserOrPswd:function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getForgotUserOrPswdLoaderInstance(this._cfg).initScrim()},initForgotPassword:function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getForgotPasswordLoaderInstance(this._cfg).initScrim()},initConfirmation:function(a){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getConfirmationLoaderInstance(a).initScrim()},initConfirmationFromIframe:function(a){if((a.confScreenName=="LoginVerifyEmail"||a.confScreenName=="ForgotPassword")&&this.chkIfHttpsDomain())this.successFileUrl="/content/javascript/account/accountScrimManager.html";document.location=this.successFileUrl+"?userdata="+dojo.toJson(a)},initLoginScrim:function(){if(this.domNodeId!=null&&dojo.byId(this.domNodeId)!=null){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getLoginLoaderInstance(this._cfg).initLoginScrimInIframe()}},initRegistration:function(){dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance(this._cfg).initRegisterScrimInIframe()},initForgotUsernameFromIframe:function(a){if(typeof a=="undefined")a="";document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:this._constants.FORGOT_USERNAME_SCREEN,userEmail:a})},initLoginFromIframe:function(){document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:this._constants.LOGIN_SCREEN})},initForgotPasswordFromIframe:function(a){if(typeof a=="undefined")a="";document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:this._constants.FORGOT_PASSWORD_SCREEN,userEmail:a})},initRegistrationFromIframe:function(){document.location=this.successFileUrl+"?userdata="+dojo.toJson({screenName:"Registration"})},moveOutOfIframe:function(a){if(this._nodes.isStandalonePage||this.chkIfHttpsDomain())parent.dj.widget.loader.ScrimLoaders.callBackFromIframe(dojo.toJson(a));else if(typeof a.refreshPageUrl!="undefined")parent.location=decodeURIComponent(a.refreshPageUrl);else document.location=this.successFileUrl+"?userdata="+dojo.toJson(a)},isChkEnter:function(a){if((a.keyCode||a.which)==dojo.keys.ENTER)return true;return false},isChkBackSpace:function(a){if((a.keyCode||a.which)==dojo.keys.BACKSPACE)return true;return false},initConnectWithFbNoIframe:function(){dojo.query(this._nodes.connectFB).connect("click",this,function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getFBInitLoaderInstance(this._cfg).initScrim()})},initConnectWithFB:function(){this.moveOutOfIframe({cfg:this._cfg,screenName:"FBInit"})},makeFBConnections:function(a){this.makeFBWhatsThisConnection();dojo.query(this._nodes.connectFB).connect("click",this,function(){this.initConnectWithFB(a)})},makeFBConnectionsNoIframe:function(){this.makeFBWhatsThisConnection();this.initConnectWithFbNoIframe()},makeFBWhatsThisConnection:function(){dojo.query(this._nodes.whatsThisFbClass).connect("click",this,function(a){dojo.stopEvent(a);dojo.removeClass(dojo.query(this._nodes.fbToolTipClass)[0],this._nodes.hiddenClass)});dojo.query(this._nodes.fbToolTipCloseClass).connect("click",this,function(a){dojo.stopEvent(a);dojo.addClass(dojo.query(this._nodes.fbToolTipClass)[0],this._nodes.hiddenClass)})},makeCloseOrOKButtonConnection:function(a){dojo.query(this._constants.SCRIMS_OK_CLOSE_BTN_CLASS).connect("click",this,function(b){this.closeNDestroyGreyBckground(a,b)})},closeNDestroyGreyBckground:function(a,b){dojo.stopEvent(b);typeof a!="undefined"&&dojo.byId(a)!=null&&this.hideScrim(a);this.destroyGreyBckground();this.destroyAccountInstanceArr()},destroyGreyBckground:function(){dojo.destroy(this.getGreyBckgroundCSSDiv)},makeCloseOrOKButtonConnectionFromIframe:function(){dojo.query(this._constants.SCRIMS_OK_CLOSE_BTN_CLASS).connect("click",this,function(){this.closeFromIframe()})},closeFromIframe:function(){this.destroyAccountInstanceArr();this.moveOutOfIframe({close:"close"})},hideErrorNPassIndGreen:function(a){dojo.addClass(this._nodes.errorUl,this._nodes.hiddenClass);this.updatePasswordInd(a,this._nodes.passIndClassGreen)},chkEmpty:function(a){if(typeof a!="undefined")return dj.lang.trim(a)===""?false:true;return false},updatePasswordInd:function(a,b){dojo.byId(a).className=b},isValidEmailAddress:function(a){return dj.util.Form.validateEmailAddresses(a)},chkEmailAddress:function(a){if(this.chkEmpty(a)){if(!this.isValidEmailAddress(a)){this.errorArr.push(this._nodes.invalidemailFormat);return false}}else{this.errorArr.push(this._nodes.emailIdrequired);return false}return true},chkPasswordLength:function(a,b){if(typeof a!="undefined"){var c=a.value;if(typeof c!="undefined")if(dj.lang.trim(c).length<5)dojo.indexOf(this.errorArr,this._nodes.passwordTooShort)<0&&this.errorArr.push(this._nodes.passwordTooShort);else if(dj.lang.trim(c).length>15)dojo.indexOf(this.errorArr,this._nodes.passwordTooLong)<0&&this.errorArr.push(this._nodes.passwordTooLong);else{this.updatePasswordInd(b,this._nodes.passIndClassGreen);return true}}this.updatePasswordInd(b,this._nodes.passIndClassRed);return false},chkPasswordMatch:function(a,b){if(typeof a!="undefined"&&typeof b!="undefined")if(typeof a.value!="undefined"&&typeof b.value!="undefined")if(dj.lang.trim(a.value)===dj.lang.trim(b.value)){this.hideErrorNPassIndGreen(this._nodes.newPassInd);this.hideErrorNPassIndGreen(this._nodes.confirmPassInd);return true}this.updatePasswordInd(this._nodes.confirmPassInd,this._nodes.passIndClassRed);this.errorArr.push(this._nodes.passwordDoNotMatch);return false},validateNewPassword:function(){var a=true;if(this.chkEmpty(this.oNewPassword.value))if(this.chkPasswordLength(this.oNewPassword,this._nodes.newPassInd,this._nodes.errorUl))this.chkPasswordSplChars(this.oNewPassword,this._nodes.newPassInd,this._nodes.errorUl)||(a=false);else a=false;else{dojo.indexOf(this.errorArr,this._nodes.newPasswordRequired)<0&&this.errorArr.push(this._nodes.newPasswordRequired);this.updatePasswordInd(this._nodes.newPassInd,this._nodes.passIndClassRed);a=false}a&&this.hideErrorNPassIndGreen(this._nodes.newPassInd);return a},validateConfirmPassword:function(){var a=true;if(this.chkEmpty(this.oConfirmPassword.value))if(this.chkPasswordLength(this.oConfirmPassword,this._nodes.confirmPassInd,this._nodes.errorUl))this.chkPasswordSplChars(this.oConfirmPassword,this._nodes.confirmPassInd,this._nodes.errorUl)||(a=false);else a=false;else{dojo.indexOf(this.errorArr,this._nodes.confirmPasswordRequired)<0&&this.errorArr.push(this._nodes.confirmPasswordRequired);this.updatePasswordInd(this._nodes.confirmPassInd,this._nodes.passIndClassRed);a=false}a&&this.hideErrorNPassIndGreen(this._nodes.confirmPassInd);return a},initForgotPasswordPage:function(){dojo.byId(this._nodes.userEmailId);document.location=this._nodes.pageUrls.forgotPasswordPageUrl},getQueryStrParam:function(a,b){if(typeof this.queryStringList[a]=="undefined"){var c="";c=typeof b=="undefined"?window.location.toString():b.toString();c.match(/\?(.+)$/);c=RegExp.$1;c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");this.queryStringList[e[0]]=unescape(e[1])}}return this.queryStringList[a]},hideFormFactor:function(a){a=dojo.query(a);a.length>0&&dojo.addClass(a[0],"hidden");a=dojo.query(".lnColl");a.length>0&&dojo.addClass(a[0],"hidden");a=dojo.query(".custNav");a.length>0&&dojo.addClass(a[0],"hidden")},fadeScrim:function(a,b){var c=500;if(b)c=b;dojo.style(a,"opacity","0");dojo.fadeIn({node:a,duration:c}).play()},getPageUrl:function(){var a=this._cfg.NONSUBSCRIBER_HOMEPAGE_PID,b=this._cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,c=this._cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,d=this._cfg.MDC_PAGE_PID,e;e=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var f;var g=f=parent.window.location.href;if(typeof pID!=="undefined"){g=this._nodes.isStandalonePage?e+this._cfg.HOMEPAGE_SUBSCRIBER_URL:pID===a?e+this._cfg.HOMEPAGE_SUBSCRIBER_URL:pID===c?e+"/email":pID===b?e+this._cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===d?e+this._cfg.MDC_LINK_URL:f;a=g.indexOf("?")!=-1?"&":"?";if(typeof a!==undefined){a=a+"_nocache="+(new Date).getTime();if(g.indexOf("#")!=-1)g=g.replace("#",a+"#");else g+=a}}return g},chkPasswordSplChars:function(a,b){if(typeof a!="undefined"){var c=a.value;if(typeof c!="undefined"){for(var d=true,e=0;e<c.length;e++)if("!@#$%^&*()+=-[]\\';,./{}|\":<>?~_ ".indexOf(c.charAt(e))!=-1)d=false;if(d){this.updatePasswordInd(b,this._nodes.passIndClassGreen);return true}else dojo.indexOf(this.errorArr,this._nodes.invalidCharacters)<0&&this.errorArr.push(this._nodes.invalidCharacters)}}this.updatePasswordInd(b,this._nodes.passIndClassRed);return false},resizeIframe:function(){if(dojo.byId("moduleiframe")!=null&&typeof dojo.byId("moduleiframe")!="undefined"){var a=dojo.query(".loginModule")[0].clientHeight?dojo.query(".loginModule")[0].clientHeight:0;if(a!=0)dojo.byId("moduleiframe").style.height=a}},addClassToBody:function(){dojo.addClass(dojo.body(),"loginForm_content")},chkIfHttpsDomain:function(){try{if(typeof parent.window.location.href!="undefined"&&parent.window.location.href.indexOf("https://")>-1)return true;return false}catch(a){return false}},lifpOmnitureTracking:function(a,b,c){setMetaData("pagename",c);c=c.replace(this.omniturePrefix,"");setMetaData("apage",this.omniturePrefix+"_Customer Resources_"+
c);setMetaData("atype",this.omniturePrefix+"_Customer Resourcess_"+c);setMetaData("section","Customer Resources");setMetaData("subsection",this.omniturePrefix+"_Login");setMetaData("csource","Customer Resources");setMetaData("ctype","marketing and support");setMetaData("basesection",this.omniturePrefix+"_Customer Resources_Login");if(typeof a!="undefined"&&a.length>0)for(index=0;index<a.length;index++)setMetaData(a[index][0],a[index][1]);if(typeof b!="undefined")s.events=b;typeof dj.context.core!=="undefined"&&typeof dj.context.core.urlPrefix!=="undefined"&&dj.context.core.urlPrefix.indexOf("wallstreetjournal.de")!==-1?dj.util.Tracking.omniture.firePixel(true,"WSJDE_"):dj.util.Tracking.omniture.firePixel(true)},destroyIframe:function(){parent.dojo.destroy("moduleiframe");parent.dojo.destroy("overlayDiv")},destroyAccountInstanceArr:function(){if(typeof dj.module.loader!="undefined"&&typeof dj.module.loader.accountInstanceArr!="undefined"){for(;dj.module.loader.accountInstanceArr.length!=0;){var a=dj.module.loader.accountInstanceArr.pop();typeof a!="undefined"&&typeof a.destroyObject!="undefined"&&typeof a.destroyObject=="function"&&a.destroyObject()}if(dj.module.loader.accountInstanceArr.length==0){dj.module.loader.accountInstanceArr={};dj.module.loader={}}}},logoutTheUnverifiedFreeRegUser:function(){this.destroyAccountInstanceArr();this.moveOutOfIframe({logout:"logout"})},submitTowerStreamForm:function(){var a="wsj/wsjwifi";if(this._nodes.towerUsername&&this._nodes.towerUsername!="")a=this._nodes.towerUsername;var b="laiZeis6";if(this._nodes.towerPassword&&this._nodes.towerPassword!="")b=this._nodes.towerPassword;if(this._nodes.towerStreamUrl&&this._nodes.towerStreamUrl!="")document.towerWifiForm.action=this._nodes.towerStreamUrl;if(this._nodes.towerIP&&this._nodes.towerIP!="")document.towerWifiForm.ip.value=this._nodes.towerIP;document.towerWifiForm.username.value=a;document.towerWifiForm.password.value=b;document.towerWifiForm.submit()}});dojo.provide("dj.widget.accountscrim.FBConnected");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.FBConnected",dj.widget.accountscrim.BaseScrim,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.3,NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{closeButton:".closeBtn",tryagain:".tryagian",hiddenClass:"hidden"},init:function(a,b){this.displayScrim(a,b);this.domNodeId=a;this.makeWidgetConnections();if(typeof dj.module.facebook!="undefined"&&typeof dj.module.facebook.connect!="undefined")typeof FB=="undefined"?dj.module.facebook.connect.init(this.updateUserInfo):this.updateUserInfo();else window.console&&console.warn(" In {FBConnected.js} dj.module.facebook.connect is not found, please make the required js file available")},setOmnitureTracking:function(){var a=[],b="";b=this.omniturePrefix+"_Auth_FBConnect_Thank_You_Original";dj.util.User.isSubLoggedIn(function(c){a[0]=c?["caccess","sub"]:["caccess","reg"]});this.lifpOmnitureTracking(a,"event12,evenr57",b)},showScrim:function(a,b){this.domNodeId=a;this.displayScrim(a,b);this.setOmnitureTracking()},makeWidgetConnections:function(){this.makeCloseOrOKButtonConnection(this.domNodeId);dojo.query(".login_invite").connect("click",this,function(a){this.closeNDestroyGreyBckground(this.domNodeId,a);FB.ui({method:"apprequests",message:"You should learn more about this awesome game.",data:"tracking information for the user"})})},updateUserInfo:function(){typeof FB!="undefined"&&FB.api("/me",function(a){if(!(!a||a.error))dojo.byId("name").innerHTML=a.first_name+" "+a.last_name})}});dojo.provide("dj.widget.accountscrim.Registration");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.service.account.RegistrationService");dojo.declare("dj.widget.accountscrim.Registration",dj.widget.accountscrim.BaseScrim,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.2},WIDGET_CONFIG:{serviceUrls:{registrationServiceUrl:"/epiton/registration/v2/profile",loginServiceUrl:"/auth/submitlogin.json"},closeButton:"registrationClose",firstName:"firstName",lastName:"lastName",emailToRegister:"emailToRegister",newPassword:"newPassword",confirmPassword:"confirmPassword",companySize:"companySize",registerNow:"registerNow",newPassInd:"newPassInd",confirmPassInd:"confirmPassInd",jobTitleDropDown:"jobTitleDropDown",passIndClassRed:"validate no",passIndClassGreen:"validate yes",hiddenClass:"hidden",gotoLogin:".loginClass",gotoForgotPasswordFromIframe:".forgotPasswordFromIframeClass",registrationIframeForm:"registrationIframeForm",errorUl:"registrationErrorUl",goBackToIframeFrmErr:"goBackToIframeFrmErr",fieldErrorClass:"errorState",isIframe:false,iframeErrorOverlayDiv:"iframeErrorOverlayDiv",firstNameRequired:"firstNameRequired",lastNameRequired:"lastNameRequired",invalidemailFormat:"invalidemailFormat",emailIdrequired:"emailIdrequired",newPasswordRequired:"newPasswordRequired",confirmPasswordRequired:"confirmPasswordRequired",privacyPolicyRequired:"privacyPolicyRequired",passwordTooShort:"passwordTooShort",passwordTooLong:"passwordTooLong",invalidCharacters:"invalidCharacters",passwordDoNotMatch:"passwordDoNotMatch",passwordSuggestion:".pw_suggestion",passwordSuggestionClose:".pw_tooltip",generalError:"generalError",emailAddressexists:"emailAddressexists",emailAddressinvalid:"emailAddressinvalid",connectFB:".connectwithfb",whatsThisFbClass:".whatsThisFbClass",fbToolTipClass:".fb_tooltip",fbToolTipCloseClass:".fb-close-tooltip-btn"},init:function(a){this.addClassToBody();this.successFileUrl=this.getQueryStrParam("successFileUrl");this.numOfLoginAttempts=0;this.domNodeId=a;this.makeWidgetConnections();this.makeFBConnections(this.successFileUrl);this.setOmnitureTracking()},setOmnitureTracking:function(){var a=[],b=this.omniturePrefix+"_FreeReg_Login_FreeReg_Form";a[0]=["basesection",this.omniturePrefix+"_Free_Reg"];a[1]=["subsection",this.omniturePrefix+"_Free_Reg"];a[2]=["caccess","free"];this.lifpOmnitureTracking(a,"event12",b)},showScrim:function(a){this.domNodeId=a;this.displayScrim(a);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking()},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oFirstName=dojo.byId(this._nodes.firstName);this.oLastName=dojo.byId(this._nodes.lastName);this.oEmailToRegister=dojo.byId(this._nodes.emailToRegister);this.oNewPassword=dojo.byId(this._nodes.newPassword);this.oConfirmPassword=dojo.byId(this._nodes.confirmPassword);this.oCompanySize=dojo.byId(this._nodes.companySize);this.oRegisterNow=dojo.byId(this._nodes.registerNow);if(this.oFirstName!==null){dojo.connect(this.oFirstName,"onfocus",this,function(){dj.util.Form.clearValue(this.oFirstName,"First Name")});dojo.connect(this.oFirstName,"onclick",this,function(){dj.util.Form.clearValue(this.oFirstName,"First Name")})}dojo.connect(dojo.byId("registrationIframeForm"),"onsubmit",this,function(a){dojo.stopEvent(a);this.submitForm()});dojo.connect(dojo.byId(this._nodes.closeButton),"click",this,function(a){dojo.stopEvent(a);dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass)});if(this.oNewPassword!==null)this.oNewPassword.type="password";if(this.oConfirmPassword!==null)this.oConfirmPassword.type="password";dojo.connect(this.oNewPassword,"keyup",this,function(a){if(this.oNewPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("newPassInd"),"validate no");dojo.removeClass(dojo.byId("newPassInd"),"validate yes");dojo.removeClass(dojo.byId("newPassword"),"errorState")}});dojo.connect(this.oConfirmPassword,"keyup",this,function(a){if(this.oConfirmPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("confirmPassInd"),"validate no");dojo.removeClass(dojo.byId("confirmPassInd"),"validate yes");dojo.removeClass(dojo.byId("confirmPassword"),"errorState")}});dojo.query(this._nodes.passwordSuggestion).connect("click",this,function(){dojo.removeClass(dojo.byId("pwSuggestion"),"hidden")});dojo.query(this._nodes.passwordSuggestionClose).connect("click",this,function(){dojo.addClass(dojo.byId("pwSuggestion"),"hidden")});dojo.query(this._nodes.gotoLogin).connect("click",this,function(){this.chkIfHttpsDomain()?this.moveOutOfIframe({close:"close"}):this.initLoginFromIframe(this.successFileUrl)})},submitForm:function(){this.clearRedBoundaryFromFields();if(this.validateForm()){dojo.byId(this._nodes.errorUl).innerHTML="";var a=dojo.byId(this._nodes.jobTitleDropDown),b="profile.firstName="+this.oFirstName.value;b+="&profile.lastName="+this.oLastName.value;b+="&profile.emailAddress="+this.oEmailToRegister.value;b+="&profile.password="+this.oNewPassword.value;b+="&profile.passwordConfirmation="+this.oConfirmPassword.value;b+="&service.prodct=wsj-online&service.templateCode="+this.PRODUCT_CD;b+="&service.registrationType=FREE_REGISTRATION";if(typeof this._nodes.isTowerLoadPage!="undefined"&&typeof this._nodes.isTowerLoadPage!="")b+="&service.trackingCode=tsWifi";if(typeof a!="undefined"&&a.value!="")b+="&profile.demographics.questionId1=dt_job_title&profile.demographics.answer1="+a.value;a=this.load;if(typeof this._nodes.isTowerLoadPage!="undefined"&&typeof this._nodes.isTowerLoadPage!="")a=this.towerLoad;dj.service.account.RegistrationService.registerUser(this._nodes.serviceUrls.registrationServiceUrl,b,a,this.error,this)}},load:function(a){this.moveOutOfIframe({screenName:"RegistrationConfirmation",emailId:encodeURIComponent(a),firstName:encodeURIComponent(this.oFirstName.value),lastName:encodeURIComponent(this.oLastName.value)})},error:function(a){dojo.forEach(a,function(c,d){if(c.indexOf("-")>-1){c=c.replace(/-/g,"");a[d]=c}},this);this.showErrorMessage(this._nodes.errorUl,a);var b=false;dojo.forEach(a,function(c){if(c==this._nodes.emailAddressexists||c==this._nodes.emailAddressinvalid){this.addErrorClass(this._nodes.emailToRegister);if(c==this._nodes.emailAddressexists)b=true}},this);b&&this.lifpOmnitureTracking([],"event12",this.omniturePrefix+"_Auth_"+this.omniturePrefix+"_Registration_Scrim Email Already Exists");this.connectForgotPasswordFromIframe()},validateForm:function(){var a=true;if(!this.chkEmpty(this.oFirstName.value)){this.errorArr.push(this._nodes.firstNameRequired);this.addErrorClass(this._nodes.firstName);a=false}if(!this.chkEmpty(this.oLastName.value)){this.errorArr.push(this._nodes.lastNameRequired);this.addErrorClass(this._nodes.lastName);a=false}var b=this.chkEmailAddress(this.oEmailToRegister.value);b||this.addErrorClass(this._nodes.emailToRegister);a=a?b:false;(b=this.validateNewPassword())||this.addErrorClass(this._nodes.newPassword);var c=this.validateConfirmPassword();c||this.addErrorClass(this._nodes.confirmPassword);a=a?b?c:false:false;if(b&&c)if(!this.chkPasswordMatch(this.oNewPassword,this.oConfirmPassword,this._nodes.errorUl)){this.addErrorClass(this._nodes.confirmPassword);a=false}if(dojo.byId("privacypolicybox"))if(dojo.byId("privacypolicybox").checked==false){this.errorArr.push(this._nodes.privacyPolicyRequired);a=false}this.showErrorNClearArray();return a},showErrorNClearArray:function(){this.showErrorMessage(this._nodes.errorUl,this.errorArr);this.errorArr=[]},highlightTheErrorField:function(a){dojo.forEach(a,function(b){b==this._nodes.usernamemissing&&this.addErrorClass(this._nodes.userOrEmailInput);b==this._nodes.passwordmissing&&this.addErrorClass(this._nodes.password)},this)},clearRedBoundaryFromFields:function(){dojo.removeClass(dojo.byId(this._nodes.firstName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.lastName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.emailToRegister),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.newPassword),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.confirmPassword),this._nodes.fieldErrorClass)}});dojo.provide("dj.widget.accountscrim.BaseLogin");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.BaseLogin",dj.widget.accountscrim.BaseScrim,{constructor:function(){},submitForm:function(a){this.clearRedBoundaryFromFields();if(this.validateForm(a)){dojo.byId(this._nodes.errorUl).innerHTML="";if(this._nodes.isStandalonePage)this.currentPageUrl=this._nodes.isAmazonOffer?this._nodes.shopnbuyUrl:this._nodes.loginTargetUrl?this._nodes.loginTargetUrl:this.getPageUrl();var b="";b=this.currentPageUrl.indexOf("?")>-1?encodeURIComponent(this.currentPageUrl+"&user=welcome"):encodeURIComponent(this.currentPageUrl+"?user=welcome");var c=encodeURIComponent(dj.context.account.testLogin+"?currentPageUrl=")+b;b=this.load;if(typeof this._nodes.isTowerLoadPage!="undefined"&&typeof this._nodes.isTowerLoadPage!=""){b=this.towerLoginLoad;c=encodeURIComponent(this._nodes.landingPage)}a={username:dj.lang.trim(a.username),password:a.password,url:c,template:"default",realm:"default",savelogin:a.savelogin};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(a),b,this.error,this)}},setupLoginData:function(){return{username:this.oUserName.value,password:this.oPassword.value,savelogin:dojo.byId(this._nodes.savelogin).checked+"",errorUI:this._nodes.errorUl}},load:function(a){var b="";if(typeof a.status!="undefined"){if(this.isValidEmailAddress(a.username))b=a.username;else{if(dojo.byId("userEmailIdToResendEmail")!=null)dojo.byId("userEmailIdToResendEmail").innerHTML="";else dojo.create("div",{id:"userEmailIdToResendEmail"},dojo.body());dj.util.User.renderEmailAddress("userEmailIdToResendEmail");b=dojo.byId("userEmailIdToResendEmail").innerHTML}if(a.status==this._nodes.unverifiedsubscriber){this.isUnverifiedSubscriber=true;this.loginVerifyEmailUserdata={screenName:this._constants.LOGIN_VERIFY_EMAIL_SCREEN,uuid:a.uuid,productCode:this.PRODUCT_CD,userEmail:b,refreshPageUrlForUnverifiedSub:encodeURIComponent(this.currentPageUrl)};dojo.byId("unverifiedFreeRegOrSub")==null&&dojo.create("div",{id:"unverifiedFreeRegOrSub","class":"hidden"},dojo.body(),"last")}else if(a.status==this._nodes.unverifiedfreereg){this.isUnverifiedFreeReg=true;this.unverifiedFreeRegUserdata={screenName:this._constants.UNVERIFIED_FREE_REG,uuid:a.uuid,productCode:this.PRODUCT_CD,userEmail:b};dojo.byId("unverifiedFreeRegOrSub")==null&&dojo.create("div",{id:"unverifiedFreeRegOrSub","class":"hidden"},dojo.body(),"last")}else if(typeof a.status!="undefined"&&dojo.trim(a.status)!="")this.successLogin=true}if(this.successLogin)parent.location=a.url;else if(this._nodes.isStandalonePage&&typeof this.isUnverifiedSubscriber=="undefined"&&typeof this.isUnverifiedFreeReg=="undefined")window.location=a.url;else{dojo.create("div",{id:"testLoginContainer"},dojo.body(),"last");this.initIFrame("testLoginContainer",0,0,a.url)}},error:function(a){if(this._nodes.fbConnectLogin){dojo.removeClass(dojo.byId("fbconnect"),"disabled");dojo.removeClass(dojo.byId("loginSubmit"),"disabled")}var b="N";this.numOfLoginAttempts++;dojo.forEach(a,function(e,f){if(e.indexOf("-")>-1){e=e.replace(/-/g,"");a[f]=e;if(e===this._nodes.usernameinvalidcredentials&&this.numOfLoginAttempts>2){a[f]=this._nodes.morethan2invalidcredentials;b="Y"}e===this._nodes.facebookconnected&&this.moveOutOfIframe({screenName:this._constants.FB_LOGIN_OR_WSJ_PSWD_SCREEN,username:this.oUserName.value,productCode:this.PRODUCT_CD})}},this);this.showErrorMessage(this._nodes.errorUl,a);if(a.length>0){this.clearRedBoundaryFromFields();this.focusOnError()}if(b==="Y"){this.connectForgotUsernameFromIframe();this.connectForgotPasswordFromIframe()}var c=[],d="";c=[];d=this._nodes.fbConnectLogin?"WSJ_Auth_WSJ/Barrons_Login_Page_Post_FBConnect Invalid Login Credentials":this._nodes.isStandalonePage?"WSJ_Auth_WSJ_Login_Page Bad Credentials page":"WSJ_Auth_WSJ_Login_Scrim Bad Credentials page";this.lifpOmnitureTracking(c,"event12",d)},gotoSubscribePage:function(){var a={};if(dj.util.Region.getViewByRegion()=="asia,india"){this._nodes.subscribeFromLoginPage=dj.context.account.india_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.india_subscribeFromLoginOverlay}else if(dj.util.Region.getViewByRegion()=="asia"){this._nodes.subscribeFromLoginPage=dj.context.account.asia_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.asia_subscribeFromLoginOverlay}else if(dj.util.Region.getViewByRegion()=="europe"){this._nodes.subscribeFromLoginPage=dj.context.account.europe_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.europe_subscribeFromLoginOverlay}a=this._nodes.isStandalonePage?{refreshPageUrl:encodeURIComponent(this._nodes.subscribeFromLoginPage)}:{refreshPageUrl:encodeURIComponent(this._nodes.subscribeFromLoginOverlay)};this.moveOutOfIframe(a)},highlightTheErrorField:function(a){dojo.forEach(a,function(b){b==this._nodes.usernamemissing&&this.addErrorClass(this._nodes.userOrEmailInput);b==this._nodes.passwordmissing&&this.addErrorClass(this._nodes.password)},this)},clearRedBoundaryFromFields:function(){dojo.removeClass(dojo.byId(this._nodes.userOrEmailInput),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.password),this._nodes.fieldErrorClass)},focusOnError:function(){this.oPassword.value="";this.oUserName.focus()},validateForm:function(a){var b=true;if(!this.chkEmpty(a.username)){this.errorArr.push(this._nodes.usernamemissing);this.addErrorClass(this._nodes.userOrEmailInput);b=false}if(b)if(!this.chkEmpty(a.password)){this.errorArr.push(this._nodes.passwordmissing);this.addErrorClass(this._nodes.password);b=false}this.showErrorMessage(a.errorUI,this.errorArr);this.errorArr=[];return b},initIFrame:function(a,b,c,d){setTimeout(this.isLoginSuccess,2E4);dj.util.Url.createSimpleIframe({src:d,"class":"hidden",allowTransparency:"true"},a,this.testLoginIframeLoaded,this)},isLoginSuccess:function(){if(!this.isUserLoggedIn){this.errorArr=["generalError"];this.showErrorMessage(this._nodes.errorUl,this.errorArr);window.console&&console.warn("User couldn't be logged in ");this.errorArr=[];this.isUserLoggedIn=false}},testLoginIframeLoaded:function(){this.isUserLoggedIn=true;if(this.isUnverifiedSubscriber)this.moveOutOfIframe(this.loginVerifyEmailUserdata);else this.isUnverifiedFreeReg&&this.moveOutOfIframe(this.unverifiedFreeRegUserdata);dojo.destroy("unverifiedFreeRegOrSub")}});dojo.provide("dj.widget.accountscrim.Login");dojo.require("dj.widget.accountscrim.BaseLogin");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.Login",dj.widget.accountscrim.BaseLogin,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this._nodes=this.WIDGET_CONFIG;this._dls=dj.service.account.LoginService;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.2,NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{serviceUrls:{loginServiceUrl:"/auth/submitlogin.json"},closeButton:"loginClose",userOrEmailInput:"loginUserOrEmail",password:"password",submitButton:"loginSubmit",hiddenClass:"hidden",gotoForgotUsernameFromIframe:".forgotUsernameFromIframeClass",gotoForgotPasswordFromIframe:".forgotPasswordFromIframeClass",gotoRegistration:".registerUserClass",gotoSubscribe:".subscribeUser",savelogin:"savelogin",loginIframeForm:"loginIframeForm",errorUl:"loginErrorUl",goBackToIframeFrmErr:"goBackToIframeFrmErr",fieldErrorClass:"errorState",isIframe:false,iframeErrorOverlayDiv:"iframeErrorOverlayDiv",usernamemissing:"usernamemissing",passwordmissing:"passwordmissing",usernameinvalidcredentials:"usernameinvalidcredentials",morethan2invalidcredentials:"morethan2invalidcredentials",cookiesDisabledMsg:"cookiesDisabledMsg",facebookconnected:"facebookconnected",unverifiedsubscriber:"unverified-subscriber",unverifiedfreereg:"unverified-freereg",generalError:"generalError",connectFB:".connectwithfb",whatsThisFbClass:".whatsThisFbClass",fbToolTipClass:".login_tooltip",fbToolTipCloseClass:".close-tooltip-btn",subscribeFromLoginOverlay:dj.context.account.subscribeFromLoginOverlay,subscribeFromLoginPage:dj.context.account.subscribeFromLoginPage},init:function(a,b){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){this.addClassToBody();this.updatePromoUrlnImage()}this.numOfLoginAttempts=0;this.domNodeId=a;this.makeWidgetConnections();if(this._nodes.isStandalonePage&&typeof this._nodes.akamaiCdnPrefix!="undefined"&&this._nodes.akamaiCdnPrefix!="")this._cfg.akamaiCdnPrefix=this._nodes.akamaiCdnPrefix;this.makeFBConnections(this.successFileUrl);var c=this;dj.lang.addLiveEvent(".login_id","keypress",function(d){if(dojo.isIE)if(c.isChkEnter(d)){dojo.stopEvent(d);c.submitForm(c.setupLoginData())}});dj.lang.addLiveEvent(".login_pw","keypress",function(d){if(dojo.isIE)if(c.isChkEnter(d)){dojo.stopEvent(d);c.submitForm(c.setupLoginData())}});if(typeof b=="undefined"||b)dojo.ready(function(){setTimeout(function(){document.loginform.loginUserOrEmail.focus()},100)});this.setOmnitureTracking()},chkIfCookieEnabledOnMob:function(){if(navigator.userAgent.search(/Mobile/i)>-1)navigator.cookieEnabled||this.showErrorMessage(this._nodes.errorUl,[this._nodes.cookiesDisabledMsg])},setOmnitureTracking:function(){var a="";a=this._nodes.isStandalonePage?this.omniturePrefix+"_Auth_"+this.omniturePrefix+"/Barrons_Login_Page_Sub_with_Promo":this.omniturePrefix+"_Auth_"+this.omniturePrefix+"/Barrons_Login_Scrim_Sub_with_Promo";this.lifpOmnitureTracking([],"event12",a)},showScrim:function(a){this.domNodeId=a;this.displayScrim(a);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking()},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oUserName=dojo.byId(this._nodes.userOrEmailInput);this.oPassword=dojo.byId(this._nodes.password);this.oLoginSub=dojo.byId(this._nodes.submitButton);if(this.oUserName!==null){dojo.connect(this.oUserName,"focus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"click",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}dojo.connect(dojo.byId("loginIframeForm"),"onsubmit",this,function(a){this.submitForm(this.setupLoginData());dojo.stopEvent(a)});dojo.connect(dojo.byId(this._nodes.closeButton),"click",this,function(a){dojo.stopEvent(a);dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass)});if(this.oPassword!==null){this.oPassword.type="password";dojo.connect(this.oPassword,"focus",this,function(){dj.util.Form.clearValue(this.oPassword,"Password")})}this.connectForgotPasswordFromIframe();this.connectForgotUsernameFromIframe();dojo.query(this._nodes.gotoRegistration).connect("click",this,function(){this._nodes.isStandalonePage?this.initRegistration():this.initRegistrationFromIframe(this.successFileUrl)});dojo.query(this._nodes.gotoSubscribe).connect("click",this,function(a){dojo.stopEvent(a);this.gotoSubscribePage()})},updatePromoUrlnImage:function(){var a=dj.util.Region.getViewByRegion();console.log("region "+a);if(typeof a!="undefined"&&dojo.byId("usLoginPromo")!=null){var b="usLoginPromo",c="asiaLoginPromo",d="europeLoginPromo";if(a.toUpperCase().indexOf("US")>-1){b="usLoginPromo";c="asiaLoginPromo";d="europeLoginPromo"}else if(a.toUpperCase().indexOf("ASIA")>-1){b="asiaLoginPromo";c="usLoginPromo";d="europeLoginPromo"}else if(a.toUpperCase().indexOf("EUROPE")>-1){b="europeLoginPromo";c="usLoginPromo";d="asiaLoginPromo"}dojo.removeClass(dojo.byId(b),"hidden");dojo.addClass(dojo.byId(c),"hidden");dojo.addClass(dojo.byId(d),"hidden")}}});dojo.provide("dj.widget.accountscrim.FBLogin");dojo.require("dj.widget.accountscrim.BaseLogin");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.widget.accountscrim.Login");dojo.require("dj.widget.accountscrim.Registration");dojo.declare("dj.widget.accountscrim.FBLogin",dj.widget.accountscrim.BaseLogin,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this._dls=dj.service.account.LoginService;this.errorArr=[]},DEFAULT_CONFIG:{isLoadJs:true,version:4.2,productCd:"WSJ_FACEBOOK",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{serviceUrls:{loginServiceUrl:"/auth/submitlogin.json",registrationServiceUrl:"/epiton/registration/v2/profile"},closeButton:".closeBtn",userOrEmailInput:"fb_loginUserOrEmail",password:"fb_password",loginSubmit:"loginSubmit",fbSubmit:"fbconnect",hiddenClass:"hidden",gotoForgotUsernameFromIframe:".forgotUsernameFromIframeClass",loginConnect:".wsj_login_form_intro",loginForm:".wsj_login_form",savelogin:"fb_savelogin",errorUl:"fb_loginErrorUl",usernamemissing:"usernamemissing",passwordmissing:"passwordmissing",usernameinvalidcredentials:"usernameinvalidcredentials",morethan2invalidcredentials:"morethan2invalidcredentials",facebookconnected:"facebookconnected",unverifiedsubscriber:"unverified-subscriber",unverifiedfreereg:"unverified-freereg",generalError:"generalError",fieldErrorClass:"errorState",firstNameRequired:"firstNameRequired",lastNameRequired:"lastNameRequired",invalidemailFormat:"invalidemailFormat",emailIdrequired:"emailIdrequired",newPasswordRequired:"newPasswordRequired",confirmPasswordRequired:"confirmPasswordRequired",passwordTooShort:"passwordTooShort",passwordTooLong:"passwordTooLong",invalidCharacters:"invalidCharacters",passwordDoNotMatch:"passwordDoNotMatch",emailAddressexists:"emailAddressexists",firstName:"fb_firstName",lastName:"fb_lastName",emailToRegister:"fb_emailToRegister",newPassword:"fb_newPassword",confirmPassword:"fb_confirmPassword",registerErrorUl:"fb_registrationErrorUl",registerNow:"registerNow",newPassInd:"newPassInd",confirmPassInd:"confirmPassInd",passIndClassRed:"validate no",passIndClassGreen:"validate yes",passwordSuggestion:".pw_suggestion",passwordSuggestionClose:".pw_tooltip",connectFB:"connectwithfb",whatsThisFb:"whatsThisFb",fbToolTip:"fbToolTip",fbToolTipClose:"fbToolTipClose",helpTipTarget:".helpTipTarget",helpbtnclose:".btn_close"},init:function(a){this.addClassToBody();this._nodes.fbConnectLogin=true;this.successFileUrl=this.getQueryStrParam("successFileUrl");this.currentPageUrl=this.getQueryStrParam("currentPageUrl");this.fbconnectURL=this.getFBConnectURL(this.currentPageUrl);this.numOfLoginAttempts=0;this.domNodeId=a;this.makeWidgetConnections();if(typeof dj.module.facebook!="undefined"&&typeof dj.module.facebook.connect!="undefined")typeof FB=="undefined"?dj.module.facebook.connect.init(this.updateUserInfo):this.updateUserInfo();else window.console&&console.warn(" In {FBLogin.js} dj.module.facebook.connect is not found, please make the required js file available");this.setOmnitureTracking();var b=this;dj.lang.addLiveEvent(".fbloginid","keypress",function(c){if(dojo.isIE)if(b.isChkEnter(c)){dojo.stopEvent(c);b.submitLoginForm()}});dj.lang.addLiveEvent(".fbloginpassword","keypress",function(c){if(dojo.isIE)if(b.isChkEnter(c)){dojo.stopEvent(c);b.submitLoginForm()}})},showScrim:function(a){this.domNodeId=a;this.displayScrim(a);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking()},setOmnitureTracking:function(){var a="";a=this.omniturePrefix+"_Auth_"+this.omniturePrefix+"_Login_Page_Post_FBConnect";this.lifpOmnitureTracking([],"event12",a)},updateUserInfo:function(){FB.api("/me",function(a){if(!(!a||a.error)){dojo.byId("fb_firstName").value=a.first_name;dojo.byId("fb_lastName").value=a.last_name;dojo.byId("fb_emailToRegister").value=a.email}})},showLoginForm:function(){dojo.removeClass(dojo.byId("wsj_login_box"),"wsj_login_box collapsed");dojo.addClass(dojo.byId("wsj_login_box"),"wsj_login_box expanded");this.makeLoginConnections()},setupRegistrationData:function(){return{firstname:this.oFirstName.value,lastname:this.oLastName.value,email:this.oEmailToRegister.value,password:this.oNewPassword.value,confirmpassword:this.oConfirmPassword.value,errorUI:this._nodes.registerErrorUl}},setupLoginData:function(){return{username:this.oUserName.value,password:this.oPassword.value,savelogin:dojo.byId(this._nodes.savelogin).checked+"",errorUI:this._nodes.errorUl}},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oFirstName=dojo.byId(this._nodes.firstName);this.oLastName=dojo.byId(this._nodes.lastName);this.oEmailToRegister=dojo.byId(this._nodes.emailToRegister);this.oNewPassword=dojo.byId(this._nodes.newPassword);this.oConfirmPassword=dojo.byId(this._nodes.confirmPassword);dojo.connect(dojo.byId("fbRegisterForm"),"onsubmit",this,function(a){dojo.stopEvent(a);this.submitFBForm()});dojo.query(this._nodes.closeButton).connect("click",this,function(){dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass)});this.connectForgotPasswordFromIframe();this.connectForgotUsernameFromIframe();dojo.query(this._nodes.loginConnect).connect("click",this,function(){this.showLoginForm()});dojo.query(this._nodes.helpTipTarget).connect("click",this,function(){dojo.removeClass(dojo.byId("helpTipTree"),"helpTipTree-collapsed");dojo.addClass(dojo.byId("helpTipTree"),"helpTipTree-expanded")});dojo.query(this._nodes.helpbtnclose).connect("click",this,function(){dojo.addClass(dojo.byId("helpTipTree"),"helpTipTree-collapsed");dojo.removeClass(dojo.byId("helpTipTree"),"helpTipTree-expanded")});dojo.query(this._nodes.passwordSuggestion).connect("click",this,function(){dojo.removeClass(dojo.byId("pwSuggestion"),"hidden")});dojo.query(this._nodes.passwordSuggestionClose).connect("click",this,function(){dojo.addClass(dojo.byId("pwSuggestion"),"hidden")});dojo.connect(this.oConfirmPassword,"keyup",this,function(a){if(this.oConfirmPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("confirmPassInd"),"validate no");dojo.removeClass(dojo.byId("confirmPassInd"),"validate yes");dojo.removeClass(dojo.byId("fb_confirmPassword"),"errorState")}if(this.isChkEnter(a)){dojo.stopEvent(a);this.submitFBForm()}});dojo.connect(this.oNewPassword,"keyup",this,function(a){if(this.oNewPassword.value==""&&!this.isChkEnter(a)){dojo.removeClass(dojo.byId("newPassInd"),"validate no");dojo.removeClass(dojo.byId("newPassInd"),"validate yes");dojo.removeClass(dojo.byId("fb_newPassword"),"errorState")}if(this.isChkEnter(a)){dojo.stopEvent(a);this.submitFBForm()}})},makeLoginConnections:function(){this.fragmentLoaded=true;this.oUserName=dojo.byId(this._nodes.userOrEmailInput);this.oPassword=dojo.byId(this._nodes.password);this.oLoginSub=dojo.byId(this._nodes.loginSubmit);this.oFBSub=dojo.byId(this._nodes.fbSubmit);if(this.oUserName!==null){dojo.connect(this.oUserName,"focus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"click",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}dojo.connect(dojo.byId("fbLoginForm"),"onsubmit",this,function(a){dojo.stopEvent(a);this.submitLoginForm()})},validateLoginForm:function(a){this.errorArr=[];var b=true;if(!this.chkEmpty(a.username)){this.errorArr.push(this._nodes.usernamemissing);this.addErrorClass(this._nodes.userOrEmailInput);b=false}if(b)if(!this.chkEmpty(a.password)){this.errorArr.push(this._nodes.passwordmissing);this.addErrorClass(this._nodes.password);b=false}this.showErrorMessage(a.errorUI,this.errorArr);this.errorArr=[];return b},submitLoginForm:function(){if(!dojo.hasClass(dojo.byId("loginSubmit"),"disabled")){this.clearRedBoundaryFromFields("loginForm");var a=this.setupLoginData();if(this.validateLoginForm(a)){dojo.byId(this._nodes.errorUl).innerHTML="";dojo.addClass(dojo.byId("loginSubmit"),"disabled");a={username:dj.lang.trim(a.username),password:a.password,url:encodeURIComponent(dj.context.account.testLogin)+"?fbConnectPageUrl="+this.fbconnectURL,template:"default",realm:"default",savelogin:a.savelogin};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(a),this.load,this.error,this)}}},submitFBForm:function(){if(!dojo.hasClass("fbconnect","disabled")){this.clearRedBoundaryFromFields("registrationForm");if(this.validateRegistrationForm()){dojo.byId(this._nodes.registerErrorUl).innerHTML="";dojo.addClass(dojo.byId("fbconnect"),"disabled");var a="profile.firstName="+this.oFirstName.value;a+="&profile.lastName="+this.oLastName.value;a+="&profile.emailAddress="+this.oEmailToRegister.value;a+="&profile.password="+this.oNewPassword.value;a+="&profile.passwordConfirmation="+this.oConfirmPassword.value;a+="&profile.uuid=true";a+="&profile.options.createCommunityProfile=";a+="&profile.options.featureEmailOptIn=true";a+="&profile.options.returnLink=http%3A%2F%2F"+document.domain;a+="&service.registrationType=FREE_REGISTRATION";a+="&profile.trackingCode=FACEBOOK_CONNECT";a+="&profile.newsletterOptIns=";a+="&service.templateCode="+this.PRODUCT_CD+"_FACEBOOK";a+="&profile.registrationSource=facebook";dj.service.account.RegistrationService.registerUser(this._nodes.serviceUrls.registrationServiceUrl,a,this.registrationLoad,this.registrationError,this)}}},registrationLoad:function(){var a={username:dj.lang.trim(this.oEmailToRegister.value),password:this.oNewPassword.value,url:encodeURIComponent(dj.context.account.testLogin)+"?fbConnectPageUrl="+this.fbconnectURL,template:"default",realm:"sbk-default",savelogin:"true"};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(a),this.load,this.error,this)},registrationError:function(a){dojo.removeClass(dojo.byId("fbconnect"),"disabled");dojo.forEach(a,function(c,d){if(c.indexOf("-")>-1){c=c.replace(/-/g,"");a[d]=c}},this);this.showErrorMessage(this._nodes.registerErrorUl,a);this.connectForgotPasswordFromIframe();var b="";b=this.omniturePrefix+"_Auth_"+this.omniturePrefix+"/Barrons_Login_Page_Post_FBConnect EmailAddressexists Error Page";this.lifpOmnitureTracking([],"event12",b)},validateRegistrationForm:function(){var a=true;if(!this.chkEmpty(this.oFirstName.value)){this.errorArr.push(this._nodes.firstNameRequired);this.addErrorClass(this._nodes.firstName);a=false}if(!this.chkEmpty(this.oLastName.value)){this.errorArr.push(this._nodes.lastNameRequired);this.addErrorClass(this._nodes.lastName);a=false}var b=this.chkEmailAddress(this.oEmailToRegister.value);b||this.addErrorClass(this._nodes.emailToRegister);a=a?b:false;(b=this.validateNewPassword())||this.addErrorClass(this._nodes.newPassword);var c=this.validateConfirmPassword();c||this.addErrorClass(this._nodes.confirmPassword);a=a?b?c:false:false;if(b&&c)this.chkPasswordMatch(this.oNewPassword,this.oConfirmPassword,this._nodes.registerErrorUl)||(a=false);this.showErrorNClearArray();return a},showErrorNClearArray:function(){this.showErrorMessage(this._nodes.registerErrorUl,this.errorArr);this.errorArr=[]},getFBConnectURL:function(a){var b=a.substring(a.indexOf("?")+1,a.length);b=dojo.queryToObject(b);var c="";if(typeof b.url!="undefined")c=b.url.constructor.toString().indexOf("Array")==-1?b.url:b.url[1];else{a=a.substring(0,a.indexOf("?"));c=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(a);c=encodeURIComponent(c)}return c},clearRedBoundaryFromFields:function(a){if(typeof a=="undefined")a="loginForm";if(a=="registrationForm"){dojo.removeClass(dojo.byId(this._nodes.firstName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.lastName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.emailToRegister),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.newPassword),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.confirmPassword),this._nodes.fieldErrorClass)}else if(a=="loginForm"){dojo.removeClass(dojo.byId(this._nodes.userOrEmailInput),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.password),this._nodes.fieldErrorClass)}}});dojo.provide("dj.widget.loader.ScrimLoaders");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.util.Url");dj.widget.loader.ScrimLoaders={init:function(){},callBackFromIframe:function(a){a=dojo.fromJson(a);if(typeof a!="undefined"){if(typeof a.logout!="undefined"){this.initIFrameForLogout();dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId("getGreyBckgroundCSSDiv"))}if(typeof a.refreshPageUrl!="undefined")window.location=decodeURIComponent(a.refreshPageUrl);if(typeof a.close!="undefined"){dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId("getGreyBckgroundCSSDiv"))}else parent.dojo.destroy("moduleiframe");if(typeof a.screenName!="undefined")if(a.screenName==="LoginVerifyEmail"){dojo.require("dj.widget.loader.LoginVerifyEmailLoader");dj.widget.loader.LoaderInstanceFactory.getLoginVerifyEmailLoaderInstance(a).initScrimFromIframe()}else if(a.screenName==="UnverifiedFreeReg"){dojo.require("dj.widget.loader.UnverifiedFreeRegLoader");dj.widget.loader.LoaderInstanceFactory.getUnverifiedFreeRegLoaderInstance(a).initScrimFromIframe()}else if(a.screenName==="FbLoginOrWSJPswd"){dojo.require("dj.widget.loader.FbLoginOrWSJPswdLoader");dj.widget.loader.LoaderInstanceFactory.getFbLoginOrWSJPswdLoaderInstance(a).initScrimFromIframe()}else if(a.screenName==="RegistrationConfirmation"){dojo.require("dj.widget.loader.ThankYouLoader");dj.widget.loader.LoaderInstanceFactory.getThankYouLoaderInstance(a).initScrimFromIframe()}else if(a.screenName==="ForgotUsername"){dojo.require("dj.widget.loader.ForgotUserOrPswdLoader");dj.widget.loader.LoaderInstanceFactory.getForgotUserOrPswdLoaderInstance(a).initScrimFromIframe()}else if(a.screenName==="ForgotPassword"){dojo.require("dj.widget.loader.ForgotPasswordLoader");dj.widget.loader.LoaderInstanceFactory.getForgotPasswordLoaderInstance(a).initScrimFromIframe()}else if(a.screenName==="Registration"){dojo.require("dj.widget.loader.RegistrationLoader");dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance().initRegisterScrimInIframe()}else if(a.screenName==="FBInit"){dojo.require("dj.widget.loader.FBInitLoader");dj.widget.loader.LoaderInstanceFactory.getFBInitLoaderInstance(a.cfg).initScrimFromIframe()}else if(a.screenName==="Login"){dojo.require("dj.widget.loader.LoginLoader");dj.widget.loader.LoaderInstanceFactory.getLoginLoaderInstance(a.cfg).initLoginScrimInIframe()}else if(a.screenName==="FBConnected"){dojo.require("dj.widget.loader.FBConnectedLoader");dj.widget.loader.LoaderInstanceFactory.getFBConnectedLoaderInstance(a.cfg).initScrimFromIframe()}else{if(a.screenName==="UserWithoutEmail"){dojo.require("dj.widget.loader.UserWithourEmailConfirmationLoader");dj.widget.loader.LoaderInstanceFactory.getUserWithourEmailConfirmationLoaderInstance(a).initScrimFromIframe()}}else typeof a.confScreenName!="undefined"&&dj.widget.loader.LoaderInstanceFactory.getConfirmationLoaderInstance(a).initScrimFromIframe()}},callBackFromAdops:function(a){parent.dojo.destroy("moduleiframe");parent.dojo.destroy("overlayDiv");if(typeof a!="undefined")if(a=="subscribeFromOverlay")parent.location=dj.context.account.subscribeOfferFromLoginOverlay;else if(a=="subscribeFromPage")parent.location=dj.context.account.subscribeOfferFromLoginPage;else if(a=="subscribeFromAmazonPage")parent.location=dj.context.account.subscribeFromAmazonPage;else if(a=="subscribeFromFB")parent.location=dj.context.account.subscribeOfferFromFBOverlay;else if(a=="subscribeFromRegistration")parent.location=dj.context.account.subscribeOfferFromRegistrationOverlay;else if(a=="registerFromPage"||a=="registerFromOverlay"){dojo.require("dj.widget.loader.RegistrationLoader");dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance().initRegisterScrimInIframe()}},chkIfHttpsDomain:function(){try{if(typeof parent.location.href!="undefined"&&parent.location.href.indexOf("https://")>-1)return true;return false}catch(a){return false}},initIFrameForLogout:function(){dojo.byId("unverifiedFreeReglogout")==null&&dojo.create("div",{id:"unverifiedFreeReglogout","class":"hidden"},dojo.body(),"last");var a={src:"http://"+document.domain+"/logout","class":"hidden"};setTimeout(this.isUserLoggedout,1E4);dj.util.Url.createSimpleIframe(a,"unverifiedFreeReglogout",this.testLogoutIframeLoaded,this)},testLogoutIframeLoaded:function(){this.userLoggedOut=true;dojo.destroy("unverifiedFreeReglogout")},isUserLoggedout:function(){this.userLoggedOut||window.console&&console.warn(" unverified free reg user couldn't be logged out ");this.userLoggedOut=false}};
dojo.provide("dj.module.scrimloader.ScrimLoader");dojo.declare("dj.module.scrimloader.ScrimLoader",[],{DEFAULT_CONFIG:{scrimWrapperDiv:"genericdiv"},constructor:function(b,a){if(a){this.preCallback=a.preCallBack;this.postCallback=a.postCallBack;this.callbackContext=a.context}this.cfg=dojo.mixin(this.DEFAULT_CONFIG,b)},initScrim:function(){this._preCallback(this.preCallback,this.callbackContext);var b=dojo;b.require("djscript.require.dj_module_scrimloader.version.1");b.addOnLoad(this._requiredJSLoaded())},_requiredJSLoaded:function(){this._loadScrimContent();this._showScrim()},_showScrim:function(){var b=new dj.widget.scrim.ShowScrim(this.cfg);this.dialog=b.init()},_loadScrimContent:function(){dojo.create("div",{id:this.cfg.scrimWrapperDiv},dojo.body(),"last");this._scrimContent=new dj.module.scrimloader.LoadScrimContent(this.cfg,this.postCallback,this.callbackContext);this._scrimContent.init()},_preCallback:function(b,a){if(typeof b==="function")return b.call(a);return false}});dojo.provide("dj.widget.scrim.starbucksscrim.scrimTracking");dojo.require("dj.util.Tracking");dj.widget.scrim.starbucksscrim.scrimTracking={init:function(){this.omniture={};this.omniture.saveVars=["pageName","prop2","prop3","prop4","prop8","prop20","prop26"];this.omniture.saveValues=[]},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){this.init();if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData("pageName","WSJ_Starbucks Scrim");this.omniture.pixel.setMetaData("section","Customer Resources");this.omniture.pixel.setMetaData("subsection","WSJ_Marketing");this.omniture.pixel.setMetaData("apage","WSJ_Customer Resources_Starbucks Scrim");this.omniture.pixel.setMetaData("atype","WSJ_Customer Resources_Starbucks Scrim");this.omniture.pixel.setMetaData("aheadline","");this.omniture.pixel.setMetaData("csource","WSJ Online");this.omniture.pixel.setMetaData("abasedocid","");this.omniture.pixel.setMetaData("basesection","WSJ_Marketing");this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}};dojo.provide("dj.module.starbucksscrim.StarbucksScrim");dojo.require("dj.module.scrimloader.ScrimLoader");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.widget.scrim.starbucksscrim.scrimTracking");dojo.declare("dj.module.starbucksscrim.StarbucksScrim",dj.module.scrimloader.ScrimLoader,{constructor:function(b){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,b);this.postCallback=this._postScrimCall;this.callbackContext={StarbucksScrimObj:this}},init:function(){this.showScrim()},hasSeenScrim:function(){return dj.util.Cookie.getGroupCookie("DJSESSION",this.cfg.cookieName)!==null},setScrimAsSeen:function(){dj.util.Cookie.setGroupCookie("DJSESSION",this.cfg.cookieName,"true")},showScrim:function(){if(!this.hasSeenScrim()){if(this._isIpad())return false;if(this._isBlockedScreenResolution(600,800))return false;this._isWsjUser()}return false},_isBlockedScreenResolution:function(b,a){if(screen.height<=b&&screen.width<=a)return true;return false},_isIpad:function(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i))return true;return false},_postScrimCall:function(){dojo.connect(dojo.query(".closeBtn")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide()});dojo.connect(dojo.query(".scrimStarbucksReadMore")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide()});dojo.connect(dojo.query(".starbucksScrimBtnNo")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide()});dojo.query(".dijit_scrim")[0].style.zIndex=1050;dj.widget.scrim.starbucksscrim.scrimTracking.omniturefirepixel()},_isWsjUser:function(){var b=this;dj.util.User.isOpenHouseUser("SDN",function(a){a&&dj.util.User.isLoggedIn(function(c){if(!c){b.setScrimAsSeen();b.initScrim()}})})}});
dojo.provide("dj.module.facebook.connect");dojo.require("dj.lang");dojo.require("dj.util.Region");dj.module.facebook.connect={init:function(a,b){if(typeof FB==="object"&&FB.XFBML)FB.XFBML.parse();else if(typeof FB!=="object"&&typeof FB==="undefined"){window.fbAsyncInit=function(){FB.init({appId:dj.context.facebook.appId,status:true,cookie:false,xfbml:true,oauth:true});FB.getLoginStatus(function(){if(typeof a=="function")b?a.apply(b):a()})};(function(){var c=document.createElement("script"),d,e=dj.util.Region.getViewByRegion(),h={"na,us":"en_US","asia,indo":"id_ID","asia,jp":"ja_JP","asia,kr":"ko_KR",germany:"de_DE","sa,br":"pt_BR"};if(typeof e!=="undefined"&&e)d=h[e];c.src=typeof d!=="undefined"&&d?document.location.protocol+"//connect.facebook.net/"+d+"/all.js":document.location.protocol+"//connect.facebook.net/en_US/all.js";c.type="text/javascript";c.charset="utf-8";c.async=true;d=dojo.byId("fb-root");if(null==d)d=dojo.create("div",{id:"fb-root",style:{display:"none"}},dojo.body());dojo.place(c,d)})()}},registerFBConnect:function(a){if(typeof a=="undefined")a=fbScrimCFG;FB.getLoginStatus(function(b){console.log("Facebook connect staus: "+
b.status);if(b.status=="connected"){dojo.require("dj.widget.loader.FBLoginLoader");dojo.require("dj.widget.accountscrim.FBLogin");(new dj.widget.loader.FBLoginLoader(a)).init()}})},fbConnected:function(a){if(typeof a=="undefined")a=fbScrimCFG;dojo.require("dj.widget.loader.FBConnectedLoader");dojo.require("dj.widget.accountscrim.FBConnected");(new dj.widget.loader.FBConnectedLoader(a)).initScrim()},fireScrimPixel:function(a){if(typeof setMetaData!="undefined"){var b=dj.util.Tracking.omniture.getMetaData("pagename"),c=dj.util.Tracking.omniture.getMetaData("ctype"),d=dj.util.Tracking.omniture.getMetaData("section"),e=dj.util.Tracking.omniture.getMetaData("subsection"),h=dj.util.Tracking.omniture.getMetaData("caccess"),g=dj.util.Tracking.omniture.getMetaData("qsymbol"),f=dj.util.Tracking.omniture.getMetaData("basesection");setMetaData("pagename",a);setMetaData("ctype","marketing and support");setMetaData("section","WSJ_Customer Resources");setMetaData("subsection","WSJ_Customer Resources");setMetaData("caccess","free");setMetaData("basesection","WSJ_FBconnect");setMetaData("qsymbol",null);dj.util.Tracking.omniture.firePixel();setMetaData("pagename",b);setMetaData("ctype",c);setMetaData("section",d);setMetaData("subsection",e);setMetaData("caccess",h);setMetaData("basesection",f);setMetaData("qsymbol",g)}},login:function(a){typeof FB=="undefined"?this.init(dj.module.facebook.connect.processLogin):this.processLogin(a)},processLogin:function(a,b){if(a)this.afterLoginURL=a;typeof b!="undefined"?FB.login(b,{scope:"publish_stream,email,read_stream,publish_actions"}):FB.login(dj.module.facebook.connect.afterLogin,{scope:"publish_stream,email,read_stream,publish_actions"})},afterLogin:function(a){if(a.authResponse){dj.util.Cookie.setCookie("djfbsr_"+dj.context.facebook.appId,'{"accessToken":"'+a.authResponse.accessToken+'","userID":"'+a.authResponse.userID+'","expiresIn":"0","signedRequest":"'+a.authResponse.signedRequest+'"}');if(dj.module.facebook.connect.afterLoginURL)location.href=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(dj.module.facebook.connect.afterLoginURL);else{oldUrlParts=location.href.split("?");location.href=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(oldUrlParts[0])}}},addConnectClick:function(a,b){var c=this;dj.lang.addLiveEvent(a,"click",function(d){dojo.stopEvent(d);c.login(b)})},displayMessage:function(a){a.url="";a.message="";typeof a.callback=="function"&&a.callback()},logout:function(a){dj.util.Cookie.deleteCookie("djfbsr_"+dj.context.facebook.appId);FB.logout(a)},getUserID:function(){return FB.getAuthResponse()?FB.getAuthResponse().userID:null},getFBUserInfo:function(){var a;FB.api("/me",function(b){a=b});return a},checkQueryString:function(a){fbScrimCFG=a;var b=dojo.queryToObject(window.location.search.slice(1));if(typeof b.fbresult!="undefined")if(b.fbresult=="add")typeof FB=="undefined"?dj.module.facebook.connect.init(dj.module.facebook.connect.fbConnected):dj.module.facebook.connect.fbConnected(a);else if(b.fbresult=="register")typeof FB=="undefined"?dj.module.facebook.connect.init(dj.module.facebook.connect.registerFBConnect):dj.module.facebook.connect.registerFBConnect(a)},publish:function(a,b){if(typeof FB!="undefined"){if(FB.getAuthResponse()){myObj=a;myObj.method="stream.publish";myObj.preview=1;myObj.display="popup";FB.ui(myObj,b)}}else{console.error("User is not logged in or FB in undefined");b(false)}},showModalScrim:function(){var a=dojo.byId("fbscrim"),b=dojo.byId("fbscrim_content");a.style.display="block";b.style.display="block";dojo.query("div#fbscrim_content a.closebtn").connect("onclick",dj.module.facebook.connect.hideModalScrim)},hideModalScrim:function(){var a=dojo.byId("fbscrim"),b=dojo.byId("fbscrim_content");a.style.display="none";b.style.display="none"},openModalMessage:function(){}};dojo.provide("dj.module.facebook.api");dojo.require("dj.module.facebook.connect");dj.module.facebook.api={modValue:"fbconnect_wsj",numOfWords:40,truncateWords:function(a,b){var c="",d=a.split(" ");if(d.length>b){c="...";d=d.slice(0,b)}return d.join(" ")+c},addtracking:function(a,b){parseUri=function(g){var f=parseUri.options;g=f.parser[f.strictMode?"strict":"loose"].exec(g);for(var n={},m=14;m--;)n[f.key[m]]=g[m]||"";n[f.q.name]={};n[f.key[12]].replace(f.q.parser,function(k,i,j){if(i)n[f.q.name][i]=j});return n};parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var c=parseUri(a),d=c.protocol+"://"+c.host+c.path+"?",e=b?b:this.modValue,h;for(h in c.queryKey)if(String(h).toUpperCase()!="MOD")d+=h+"="+c.queryKey[h]+"&";d+="mod="+e;d+=c.anchor?"#"+c.anchor:"";return d},postAnswer:function(a){if(!(a.question&&a.answer&&a.questionPermalink))return false;var b=this.truncateWords(a.answer,this.numOfWords),c={name:a.question,href:this.addtracking(a.questionPermalink),caption:"WSJ.com"},d=[{text:"Answer",href:this.addtracking(a.questionPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postArticleComment:function(a){if(!(a.comment&&a.commentPermalink))return false;JSON.stringify=function(g){return dojo.toJson(g)};var b=typeof AT_VARS!="undefined"?AT_VARS.articleUrl:a.commentPermalink,c=typeof AT_VARS!="undefined"?AT_VARS.seoHeadline:"";if(typeof c=="undefined")c=AT_VARS.articleHeadline;var d=typeof AT_VARS!="undefined"?AT_VARS.imgSizeA:"http://s.wsj.net/img/WSJ_profile_lg.gif",e=typeof AT_VARS!="undefined"&&typeof AT_VARS.bodyText!="undefined"?AT_VARS.bodyText.replace(/\+/g," "):"",h=this.truncateWords(a.comment,this.numOfWords);c={name:c,href:this.addtracking(b),description:unescape(e),caption:"WSJ.com"};if(d!=null)c.media=[{type:"image",src:d,href:this.addtracking(b)}];b=[{text:"Read the Article",href:this.addtracking(a.commentPermalink)}];this.sendStream(h,c,b,a.callbackFn,a.callbackParams)},postCreateGroup:function(a){if(!(a.groupName&&a.groupDescription&&a.groupPermalink))return false;var b={name:a.groupName,href:this.addtracking(a.groupPermalink),description:a.groupDescription,caption:"WSJ.com"},c=[{text:"Join this Journal Group",href:this.addtracking(a.groupPermalink)}];this.sendStream("",b,c,a.callbackFn,a.callbackParams)},postJoinGroup:function(a){if(!(a.groupName&&a.groupDescription&&a.groupPermalink))return false;var b={name:a.groupName,href:this.addtracking(a.groupPermalink),description:a.groupDescription,caption:"WSJ.com"},c=[{text:"Join this Journal Group",href:this.addtracking(a.groupPermalink)}];this.sendStream("",b,c,a.callbackFn,a.callbackParams)},postPollVote:function(a){if(!a)return null;params=dojo.fromJson(a);a="";JSON.stringify=function(c){return dojo.toJson(c)};for(var b=0;b<params.options.length;b++)a+=b+1+") "+params.options[b].value+" ";a={name:params.question,href:this.addtracking(window.location),description:a,media:[{type:"image",src:"http://s.wsj.net/img/WSJ_profile_lg.gif",href:this.addtracking(window.location)}]};b=[{text:"Related Article",href:this.addtracking(params.poll_meta.urlSrc)}];if(params.poll_meta.communityURLSrc!="")b=[{text:"Journal Community Group",href:this.addtracking(params.poll_meta.communityURLSrc)}];this.sendStream("voted on a Wall Street Journal poll",a,b,function(){},null)},postQuestion:function(a){if(!(a.question&&a.category&&a.questionPermalink))return false;var b=this.truncateWords(a.question,this.numOfWords),c={name:a.category,href:this.addtracking(a.questionPermalink),caption:"WSJ.com"},d=[{text:"Answer",href:this.addtracking(a.questionPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postTopic:function(a){if(!(a.topic&&a.topicPermalink&&a.description))return false;var b=this.truncateWords(a.topic,this.numOfWords),c={name:a.topic,href:this.addtracking(a.topicPermalink),description:a.description,caption:"WSJ.com"},d=[{text:"Join the discussion",href:this.addtracking(a.topicPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postTopicComment:function(a){if(!(a.comment&&a.commentPermalink&&a.topicName&&a.topicDescription&&a.topicPermalink))return false;var b=this.truncateWords(a.comment,this.numOfWords),c={name:a.topicName,href:this.addtracking(a.topicPermalink),description:a.topicDescription,caption:"WSJ.com"},d=[{text:"Join this discussion",href:this.addtracking(a.commentPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},sendStream:function(a,b,c,d,e){var h=-1;FB.getLoginStatus(function(g){g.session?dj.module.facebook.connect.publish({message:a,attachment:b,action_links:c},function(f){if(f){h=f.post_id;dj.module.facebook.api.omnitureEventCall("event56");d?d(e,dj.module.facebook.connect.getUserID(),h):console.log("success: "+h)}}):dj.module.facebook.connect.processLogin(document.location,dojo.hitch(this,dj.module.facebook.api.sendStream,a,b,c,d,e))});return h},omnitureEventCall:function(){if(typeof s!="undefined"){s.linkTrackVars="events";s.linkTrackEvents="event56";s.events="event56";s.tl(this,"o","fb_activity");s.linkTrackVars="None";s.linkTrackEvents="None"}}};
dojo.provide("dj.community.Subject");dj.community.Subject=function(uri,display,href,typeName,tags,locale){this['s.uri']=uri;this['s.name']=display;this['s.href']=href;this['s.typeName']=typeName;this['s.tags']=tags;this['s.locale']=locale;};dojo.provide("dj.community.feedback");dojo.require("dj.widget.Slider");dj.community.feedback.toggleCommentByForce=function(commentEntry){var entry=dojo.byId(commentEntry);var messageSpan=dojo.query('.cToggle_message',entry)[0];var toggleLink=dojo.query('.cToggle_link a',entry)[0];if(!dojo.hasClass(entry,'cUnitType-forceshow')){dojo.addClass(entry,'cUnitType-forceshow');messageSpan.innerHTML='Nonsubscriber comment';toggleLink.innerHTML='Hide this comment <span>-</span>';}
else
{dojo.removeClass(entry,'cUnitType-forceshow');messageSpan.innerHTML='Nonsubscriber comments are set to \"Hide\"';toggleLink.innerHTML='Show this comment <span>+</span>';}};dj.community.feedback.toggleHelp=function(tooltipTrigger){var container=dojo.query('.sliderbox_tooltip_cont')[0];var trigger=dojo.query('.tooltip_trigger',container)[0];if(dojo.hasClass(container,'sliderbox_tooltip_hidden')){dojo.removeClass(container,'sliderbox_tooltip_hidden');dojo.addClass(container,'sliderbox_tooltip_visible');trigger.innerHTML=dj.community.localPrompt.closeDialog;}
else
{dojo.removeClass(container,'sliderbox_tooltip_visible');dojo.addClass(container,'sliderbox_tooltip_hidden');trigger.innerHTML=dj.community.localPrompt.whatIsIt;}};dj.community.feedback.toggleComments=function(sliderId,siteRoot){if(!dojo.byId(sliderId)||dojo.hasClass(dojo.byId(sliderId),"comment-slider")){return;}
var show=0;var fade=1;var hide=2;var sliderElement=dojo.byId(sliderId);var threadContainer=dojo.byId('threadcontainer0405091518');var hideClass='threadbox_nonsub_hide';var fadeClass='threadbox_nonsub_fade';function fadeComments(){if(dojo.hasClass(threadContainer,hideClass)){dojo.removeClass(threadContainer,hideClass);}
dojo.addClass(threadContainer,fadeClass);}
function hideComments(){if(dojo.hasClass(threadContainer,fadeClass)){dojo.removeClass(threadContainer,fadeClass);}
dojo.addClass(threadContainer,hideClass);}
function showComments(){if(dojo.hasClass(threadContainer,fadeClass)){dojo.removeClass(threadContainer,fadeClass);}
if(dojo.hasClass(threadContainer,hideClass)){dojo.removeClass(threadContainer,hideClass);}}
function toggle(value){switch(value){case fade:fadeComments();break;case hide:hideComments();break;default:showComments();break;}}
function save(value){dojo.xhrPost({url:siteRoot+'/member/updateNonSubscriberCommentTransparency.rails',postData:'value='+value});}
function getCurrentSetting(){if(dojo.hasClass(threadContainer,fadeClass)){return fade;}
else if(dojo.hasClass(threadContainer,hideClass)){return hide;}
return show;}
function changeSetting(value){if(getCurrentSetting()!=value){toggle(value);save(value);}}
var slider=new dj.widget.Slider(dojo.query('.slider_pointer',sliderElement),sliderElement,{range:{start:0,end:2},values:[0,1,2],sliderValue:getCurrentSetting(),onChange:function(value){setTimeout(function(){changeSetting(value);},0);}});dojo.addClass(sliderElement,"comment-slider");};dojo.provide("dj.module.communityUser");dojo.require("dj.widget.panel.ModalPanel");dojo.require("dj.util.Element");dojo.require("dj.util.Url");dj.module.communityUser={ajaxPost:function(postUrl,args,callback){dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(args),error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));callback(ioargs,json);}});},ajaxUpdate:function(oElement,postUrl,args,callback){dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),oElement,"only");},error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));callback(ioargs,json);}});},handleError300:function(postUrl,args,uFirstName,uLastName,callback){this.initializeCommunityUserPopup(postUrl,args,uFirstName,uLastName,300,callback);this._openCommunityUserPopup();},handleError301:function(uFirstName,uLastName){this.initializeCommunityUserPopup("","",uFirstName,uLastName,301);this._openCommunityUserPopup();},_openCommunityUserPopup:function(){var oPopupPosition=dojo.position(this.oPopup,true);dojo.style(this.oPopup,{position:"absolute",left:oPopupPosition.x+"px",top:(oPopupPosition.y+200)+"px",width:oPopupPosition.w+"px",height:oPopupPosition.h+"px"});var panel=new dj.widget.panel.ModalPanel(null,dojo.query("div.communityUserPopup")[0],{closeModalPanelEvent:"click",closeModalPanelButtonSelector:".popupClose"});},initializeCommunityUserPopup:function(postUrl,args,uFirstName,uLastName,errorCode,callback){this.oPopup=dojo.query("div.communityUserPopup")[0];this.oUnblockedUserContainer=dojo.query(".unblockedUser",this.oPopup)[0];this.oBlockedUserContainer=dojo.query(".blockedUser",this.oPopup)[0];this.oCommentsText=dojo.query(".commentsText",this.oPopup)[0];this.oAskQuestionText=dojo.query(".askQuestionText",this.oPopup)[0];this.oUserFirstName=dojo.query(".userFirstName",this.oPopup);this.oUserLastName=dojo.query(".userLastName",this.oPopup);if((postUrl!==null)&&(postUrl.indexOf('SaveQuestion')!==-1)){dj.util.Element.show(this.oAskQuestionText);dj.util.Element.hide(this.oCommentsText);}else{dj.util.Element.hide(this.oAskQuestionText);dj.util.Element.show(this.oCommentsText);}
var that=this;var isUserFirstLastNamePresent=true;if(((uFirstName===null)||(uFirstName===''))&&((uLastName===null)||(uLastName===''))){isUserFirstLastNamePresent=false;}
if(errorCode===300){this.oBlockedUserContainer.setStyle({display:"none"});this.oUnblockedUserContainer.setStyle({display:"block"});this.oPost=dojo.query(".post",this.oPopup)[0];this.oChkBox=dojo.query(".chkBox",this.oPopup)[0];this.oWhyLink=dojo.query(".whyLink",this.oPopup)[0];this.oWhyLinkPara=dojo.query(".whyLinkPara",this.oPopup)[0];this.oFirstNameText=dojo.query(".firstNameText",this.oPopup)[0];this.oLastNameText=dojo.query(".lastNameText",this.oPopup)[0];this.oUserNameInfoContainer=dojo.query(".userNameInfoContainer",this.oPopup)[0];this.oErrorMessage=dojo.query(".errorMessage",this.oPopup)[0];this.oCommunityLink=dojo.query(".communityLink",this.oPopup)[0];this.oPrivacyLink=dojo.query(".privacyLink",this.oPopup)[0];this.oTermsLink=dojo.query(".termsLink",this.oPopup)[0];if(isUserFirstLastNamePresent===false){dj.util.Element.show(this.oUserNameInfoContainer);}else{dj.util.Element.hide(this.oUserNameInfoContainer);this.oUserFirstName.forEach(function(oFirstName){oFirstName.innerHTML=", "+uFirstName;});this.oUserLastName.forEach(function(oLastName){oLastName.innerHTML=uLastName+",";});}
if(this.whyLinkListener!==null){dojo.disconnect(this.oWhyLinkClickHandle);}
if(this.communityLinkListener!==null){dojo.disconnect(this.oCommunityLinkClickHandle);}
if(this.privacyLinkListener!==null){dojo.disconnect(this.oPrivacyLinkClickHandle);}
if(this.termsLinkListener!==null){dojo.disconnect(this.oTermsLinkClickHandle);}
if(this.postListener!==null){dojo.disconnect(this.oPostClickHandle);}
this.whyLinkListener=dojo.hitch(this.oWhyLink,function(event){dj.util.Element.show(that.oWhyLinkPara);dj.util.Element.hide(that.oWhyLink);});this.communityLinkListener=dojo.hitch(this.oCommunityLink,function(event){dojo.stopEvent(event);dj.util.Url.openWin("/community");});this.privacyLinkListener=dojo.hitch(this.oPrivacyLink,function(event){dojo.stopEvent(event);dj.util.Url.openWin("/public/page/privacy_policy.html");});this.termsLinkListener=dojo.hitch(this.oTermsLink,function(event){dojo.stopEvent(event);dj.util.Url.openWin("/public/page/subscriber_agreement.html");});this.postListener=dojo.hitch(this.oPost,function(event){if(that.oChkBox.checked===true){args.mode=2;}else
if(that.oChkBox.checked===false){args.mode=1;}
if(isUserFirstLastNamePresent===false){if(((that.oFirstNameText.value===null)||(that.oFirstNameText.value===''))&&((that.oLastNameText.value===null)||(that.oLastNameText.value===''))){dojo.stopEvent(event);that.oErrorMessage.show();that._openCommunityUserPopup();}else{args.firstName=that.oFirstNameText.value;args.lastName=that.oLastNameText.value;that.ajaxPost(postUrl,args,callback);}}else{args.firstName=uFirstName;args.lastName=uLastName;that.ajaxPost(postUrl,args,callback);}});this.oWhyLinkClickHandle=dojo.connect(this.oWhyLink,"onclick",this.whyLinkListener);this.oCommunityLinkClickHandle=dojo.connect(this.oCommunityLink,"onclick",this.communityLinkListener);this.oPrivacyLinkClickHandle=dojo.connect(this.oPrivacyLink,"onclick",this.privacyLinkListener);this.oTermsLinkClickHandle=dojo.connect(this.oTermsLink,"onclick",this.termsLinkListener);this.oPostClickHandle=dojo.connect(this.oPost,"onclick",this.postListener);}else
if(errorCode===301){this.oBlockedUserContainer.setStyle({display:"block"});this.oUnblockedUserContainer.setStyle({display:"none"});if(isUserFirstLastNamePresent===true){this.oUserFirstName.forEach(function(oFirstName){oFirstName.innerHTML=uFirstName;});this.oUserLastName.forEach(function(oLastName){oLastName.innerHTML=uLastName;});}}}};dojo.provide("dj.community.communityintegration");dojo.require("dj.module.communityUser");dojo.require("dj.util.Element");dj.community.communityintegration={toggleContent:function(id){var el=dojo.byId(id);if(el.style.display==="none"){el.style.display="";}else{el.style.display="none";}},CommunityIntegration:function(siteroot,fullsiteroot){this._siteroot=siteroot;this.fullsiteroot=fullsiteroot;},postQuestion:function(siteroot,fullsiteroot){if(dojo.byId('message')){dojo.byId('message').innerHTML="";}
var sDescText=dojo.byId('AskQDescription').value;if(sDescText=='Enter your question*'){sDescText='';dojo.byId('AskQDescription').value='';}
var strimmedDesc=sDescText.replace(/^\s+|\s+$/g,'');var objErrorQstMandatory=dojo.byId('errorQstMandatory');var objErrorCatMandatory=dojo.byId('errorCatMandatory');var objErrorDefault=dojo.byId('errorDefault');var objErrorComplyPolicy=dojo.byId('errorComplyPolicy');var objDescription=dojo.byId('AskQDescription');var objErrorQuesLabel=dojo.byId('errorQuesLabel');var objCategory=dojo.byId('Category');var objSubCategoryId=dojo.byId('SubCategoryId');var objErrorSubCatMandatory=dojo.byId('errorSubCatMandatory');if(strimmedDesc.length===0&&objCategory.value=="-1"&&objSubCategoryId.value=="-1"){objErrorQuesLabel.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='block';objErrorComplyPolicy.style.display='none';objErrorQstMandatory.style.display='none';return;}
if(strimmedDesc.length===0){objErrorQstMandatory.style.display='block';objErrorCatMandatory.style.display='none';objErrorSubCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objDescription.value=strimmedDesc;objDescription.focus();return;}
if(strimmedDesc.length>2000){objErrorQuesLabel.style.display='block';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorSubCatMandatory.style.display='none';objDescription.focus();return;}
objDescription.value=strimmedDesc;if(objCategory.value=="-1"){objErrorQstMandatory.style.display='none';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objErrorCatMandatory.style.display='block';objErrorSubCatMandatory.style.display='none';objCategory.focus();return;}
if(objSubCategoryId.value=="-1"){objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objErrorSubCatMandatory.style.display='block';objSubCategoryId.focus();return;}
var subCategoryvar=objSubCategoryId.value;strimmedDesc=objDescription.value;var notifyMebool=dojo.byId('chkEmail').checked;var args={mode:0,firstName:null,lastName:null,subCategory:subCategoryvar,strDescription:strimmedDesc,notifyMe:notifyMebool};dj.module.communityUser.ajaxPost(fullsiteroot+"/public/SaveQuestion.html",args,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/#identifier";}
else if(transport.xhr.status==305){objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorSubCatMandatory.style.display='none';objErrorComplyPolicy.style.display='block';return false;}
else{if(transport.xhr.status==300){dj.module.communityUser.handleError300(fullsiteroot+"/public/SaveQuestion.html",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/#identifier";}
else if(transport.xhr.status==305){objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorSubCatMandatory.style.display='none';objErrorComplyPolicy.style.display='block';return false;}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}}});},answerQuestion:function(siteroot,fullsiteroot){var answerText=dojo.byId('AnsDescription').value;if(answerText=='Enter your answer'){answerText='';dojo.byId('AnsDescription').value='';}
answerText=answerText.replace(/^\s+|\s+$/g,'');var questionId=dojo.byId('hdnQuestionId').value;if(answerText.length===0){dj.util.Element.show("errorAnsDefault");dj.util.Element.hide("errorAnsComplyPolicy");dojo.byId('errorAnsDefault').innerHTML='Please fill out the answer field.';return;}
if(answerText.length>2000){dj.util.Element.show("errorAnsDefault");dj.util.Element.hide("errorAnsComplyPolicy");dojo.byId('errorAnsDefault').innerHTML='The Answer should not be more than 2000 characters';return;}
var args={mode:0,firstName:null,lastName:null,questionId:questionId,strDescription:answerText};dj.module.communityUser.ajaxPost(fullsiteroot+"/public/SaveSectionAnswer.html",args,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/questions/"+questionId;}
else if(transport.xhr.status==305){dj.util.Element.show("errorAnsComplyPolicy");dj.util.Element.hide("errorAnsDefault");return false;}
else{if(transport.xhr.status==300){dj.module.communityUser.handleError300(fullsiteroot+"/public/SaveSectionAnswer.html",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/questions/"+questionId;}
else if(transport.xhr.status==305){dj.util.Element.show("errorAnsComplyPolicy");dj.util.Element.hide("errorAnsDefault");return false;}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}}});},fnOpenMessageBox:function(targetElement,URI,rowKey){if(dojo.byId('hdnLastShownId').value!==""){dojo.byId(dojo.byId('hdnLastShownId').value).style.display="none";}
if(targetElement==1){targetElement='dvMessage'+rowKey;}else{targetElement='dvConnect'+rowKey;}
var subject='msgsubject'+rowKey;var message='msgeditor'+rowKey;var connectMessage='txtMessage'+rowKey;dojo.byId(targetElement).style.display='block';dojo.byId('hdnMemberUri'+rowKey).value=URI;dojo.byId('hdnLastShownId').value=targetElement;dojo.byId(subject).value="Subject";dojo.byId(message).value="Type your personal message.";if(dojo.byId(connectMessage)){dojo.byId(connectMessage).value="Type your personal message.";}
var _subjectGotFocus=function subject_GotFocus(){if(dojo.byId(subject).value=="Subject"){dojo.byId(subject).value="";}};var _subjectLostFocus=function subject_LostFocus(){if(dojo.byId(subject).value===""){dojo.byId(subject).value="Subject";}};var _messageGotFocus=function message_GotFocus(){if(dojo.byId(message).value=="Type your personal message."){dojo.byId(message).value="";}};var _messageLostFocus=function message_LostFocus(){if(dojo.byId(message).value===""){dojo.byId(message).value="Type your personal message.";}};var _messageConnectGotFocus=function messageConnect_GotFocus(){if(dojo.byId(connectMessage).value=="Type your personal message."){dojo.byId(connectMessage).value="";}};var _messageConnectLostFocus=function messageConnect_LostFocus(){if(dojo.byId(connectMessage).value===""){dojo.byId(connectMessage).value="Type your personal message.";}};subjectGotFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_subjectGotFocus();};subjectLostFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_subjectLostFocus();};messageGotFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageGotFocus();};messageLostFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageLostFocus();};messageConnectGotFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageConnectGotFocus();};messageConnectLostFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageConnectLostFocus();};dojo.connect(dojo.byId(subject),'onfocus',_subjectGotFocus);dojo.connect(dojo.byId(subject),'onblur',_subjectLostFocus);dojo.connect(dojo.byId(message),'onfocus',_messageGotFocus);dojo.connect(dojo.byId(message),'onblur',_messageLostFocus);dojo.connect(dojo.byId(connectMessage),'onfocus',_messageConnectGotFocus);dojo.connect(dojo.byId(connectMessage),'onblur',_messageConnectLostFocus);},SetMostFocus:function(){if(dojo.byId('commentBody')!==null&&dojo.byId('commentBody')!==undefined){dojo.byId('commentBody').focus();dojo.byId('commentBody').blur();}},ReportTopic1:function(ajaxFunction){dojo.xhrPost({url:ajaxFunction,handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));var reported=json.reported;var alreadyreported=json.alreadyreported;if(reported){dojo.byId('reporttopic').innerHTML="Topic Reported";}
if(alreadyreported){dojo.byId('reporttopic').innerHTML="Topic is already reported";}}});},fnCloseMessage:function(Rowkey){dojo.byId('dvMessage'+Rowkey).style.display='none';},fnCloseMessageSent:function(Rowkey){dojo.byId('dvMessageSent'+Rowkey).style.display='none';},fnCloseConnectionSent:function(Rowkey){dojo.byId('dvConnectionSent'+Rowkey).style.display='none';},ReportComment:function(siteroot,CommentId){var args={commentid:CommentId,mode:0,firstName:null,lastName:null};dj.module.communityUser.ajaxPost(siteroot+"/mdcrpc/comments/report.sync",args,function(transport,json){if(transport.xhr.status==200){dojo.byId('reportcomment'+CommentId).innerHTML=transport.xhr.responseText;}
else if(transport.xhr.status==300){dj.module.communityUser.handleError300(siteroot+"/comments/report.sync",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){dojo.byId('reportcomment'+CommentId).innerHTML=transport.xhr.responseText;}});}
else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}});},fnSendMessage:function(siteroot,Rowkey){var recipients=dj.community.communityintegration.trim(dojo.byId('hdnMemberUri'+Rowkey).value);var subject=dj.community.communityintegration.trim(dojo.byId('msgsubject'+Rowkey).value);var content=dj.community.communityintegration.trim(dojo.byId('msgeditor'+Rowkey).value);if(subject.length<=0||subject=='Subject'){dojo.byId('errorMsg'+Rowkey).style.display="block";dojo.byId('errorMsg'+Rowkey).innerHTML="Please enter valid subject.";return false;}
if(content.length<=0||content=='Type your personal message.'){dojo.byId('errorMsg'+Rowkey).style.display="block";dojo.byId('errorMsg'+Rowkey).innerHTML="Please enter valid message.";return false;}
subject=dj.community.communityintegration.fnReplaceHTMLTags(subject);content=dj.community.communityintegration.fnReplaceHTMLTags(content);var targetElement='dvMessage'+Rowkey;var messageSent='dvMessageSent'+Rowkey;var args={recipients:recipients,subject:subject,content:content,mode:0,firstName:null,lastName:null};dj.module.communityUser.ajaxPost(siteroot+"/member/sendmessage.sync",args,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsg'+Rowkey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}
else if(transport.xhr.status==300){dj.module.communityUser.handleError300(siteroot+"/member/sendmessage.sync",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsg'+Rowkey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}});},fnCloseConnect:function(Rowkey){dojo.byId('dvConnect'+Rowkey).style.display='none';},fnSendInvite:function(siteroot,rowKey){var name=dj.community.communityintegration.trim(dojo.byId('hdnMemberUri'+rowKey).value);var message=dj.community.communityintegration.trim(dojo.byId('txtMessage'+rowKey).value);message=dj.community.communityintegration.fnReplaceHTMLTags(message);if(message.length<=0||message=='Type your personal message.'){dojo.byId('errorMsgInvite'+rowKey).style.display="block";dojo.byId('errorMsgInvite'+rowKey).innerHTML="Please enter valid message.";return false;}
var targetElement='dvConnect'+rowKey;var messageSent='dvConnectionSent'+rowKey;var args={name:name,message:message,mode:0,firstName:null,lastName:null};dj.module.communityUser.ajaxPost(siteroot+"/member/InviteFriend.sync",args,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsgInvite'+rowKey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}else
if(transport.xhr.status==300){dj.module.communityUser.handleError300(siteroot+"/member/InviteFriend.sync",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsgInvite'+rowKey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}});},GotFocus:function Connect_GotFocus(){if(dojo.byId('txtMessage${Rowkey}').value=="Type your personal message"){dojo.byId('txtMessage${Rowkey}').value="";}},LostFocus:function Connect_LostFocus(){if(dojo.byId('txtMessage${Rowkey}').value===""){dojo.byId('txtMessage${Rowkey}').value="Type your personal message";}},fillSubCategoryJS:function(){var parentCategoryId=dojo.byId('Category').value;if(parentCategoryId=='-1'){dojo.byId('SubCategoryId').options.length=0;dojo.byId('SubCategoryId').options[0]=new Option('Sub-category','-1');return;}
var values=dojo.byId('hdnValues').value;var categories=values.split("~");dojo.byId('SubCategoryId').options.length=0;var SelectedSubCategoryId=dojo.byId('hdnSubCategoryId').value;for(i=0;i<categories.length;i++){var subCatInfo=categories[i];var subCategories=subCatInfo.split("^");var categoryId=subCategories[0];if(categoryId==parentCategoryId){for(j=1;j<subCategories.length;j++){var subCatValues=subCategories[j].split("=");var subCategoryText=subCatValues[0];var subCategoryId=subCatValues[1];dojo.byId('SubCategoryId').options[j-1]=new Option(subCategoryText,subCategoryId);if(SelectedSubCategoryId==subCategoryId){dojo.byId('SubCategoryId').options[j-1].selected=true;}}}}
if(SelectedSubCategoryId==-1){dojo.byId('SubCategoryId').options[j-1]=new Option('Sub-category','-1');dojo.byId('SubCategoryId').options[j-1].selected=true;}},setCategorySubcategory:function(categoryId,subCategoryId){var categoryDropDown=dojo.byId('Category');for(i=0;i<categoryDropDown.options.length;i++){if(categoryDropDown.options[i].value==categoryId){categoryDropDown.options[i].selected=true;}}
if(subCategoryId===null){subCategoryId=-1;}
dojo.byId('hdnSubCategoryId').value=subCategoryId;dj.community.communityintegration.fillSubCategoryJS();},SortArticleComments:function(SBNumber,siteRoot,index,sortId){dojo.byId('sortId').value=sortId;dojo.xhrPost({url:siteRoot+"/public/ArticleComments.html",postData:dojo.objectToQuery({SBNumber:SBNumber,index:index,sortIndex:sortId}),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId('Commentsblock'),"only");},error:function(exception,ioargs){console.error('Exception occured while SortArticleComments : '+exception);}});},fnReplaceHTMLTags:function(strValue){strValue=strValue.replace(/</g,'&lt;');strValue=strValue.replace(/>/g,'&gt;');return strValue;},trim:function trim(str){return str.replace(/^\s+|\s+$/,'');},ToggleLeaderboard:function(){dojo.query('#leaderboard .tabBar .tab').forEach(function(e){dojo.toggleClass(e,'selectedTab');});dojo.query('#leaderboard .tabBar span.unLinked').forEach(function(e){dj.util.Element.toggleHiddenClass(e);});dojo.query('#leaderboard .tabBar a').forEach(function(e){dj.util.Element.toggleHiddenClass(e);});dojo.query('#leaderboard ul.listItems').forEach(function(e){dj.util.Element.toggleHiddenClass(e);});}};function toggleContent(id){dojo.deprecated("toggleContent","use dj.community.communityintegration.toggleContent instead","1.0.0");dj.community.communityintegration.toggleContent(id);}
function CommunityIntegration(siteroot,fullsiteroot){dojo.deprecated("CommunityIntegration","use dj.community.communityintegration.CommunityIntegration instead","1.0.0");dj.community.communityintegration.CommunityIntegration(siteroot,fullsiteroot);}
function postQuestion(siteroot,fullsiteroot){dojo.deprecated("postQuestion","use dj.community.communityintegration.postQuestion instead","1.0.0");dj.community.communityintegration.postQuestion(siteroot,fullsiteroot);}
function answerQuestion(siteroot,fullsiteroot){dojo.deprecated("answerQuestion","use dj.community.communityintegration.answerQuestion instead","1.0.0");dj.community.communityintegration.answerQuestion(siteroot,fullsiteroot);}
function fnOpenMessageBox(targetElement,URI,rowKey){dojo.deprecated("fnOpenMessageBox","use dj.community.communityintegration.fnOpenMessageBox instead","1.0.0");dj.community.communityintegration.fnOpenMessageBox(targetElement,URI,rowKey);}
function SetMostFocus(){dojo.deprecated("SetMostFocus","use dj.community.communityintegration.SetMostFocus instead","1.0.0");dj.community.communityintegration.SetMostFocus();}
function ReportTopic1(ajaxFunction){dojo.deprecated("ReportTopic1","use dj.community.communityintegration.ReportTopic1 instead","1.0.0");dj.community.communityintegration.ReportTopic1(ajaxFunction);}
function fnCloseMessage(Rowkey){dojo.deprecated("fnCloseMessage","use dj.community.communityintegration.fnCloseMessage instead","1.0.0");dj.community.communityintegration.fnCloseMessage(Rowkey);}
function fnCloseMessageSent(Rowkey){dojo.deprecated("fnCloseMessageSent","use dj.community.communityintegration.fnCloseMessageSent instead","1.0.0");dj.community.communityintegration.fnCloseMessageSent(Rowkey);}
function fnCloseConnectionSent(Rowkey){dojo.deprecated("fnCloseConnectionSent","use dj.community.communityintegration.fnCloseConnectionSent instead","1.0.0");dj.community.communityintegration.fnCloseConnectionSent(Rowkey);}
function ReportComment(siteroot,CommentId){dojo.deprecated("ReportComment","use dj.community.communityintegration.ReportComment instead","1.0.0");dj.community.communityintegration.ReportComment(siteroot,CommentId);}
function fnSendMessage(siteroot,Rowkey){dojo.deprecated("fnSendMessage","use dj.community.communityintegration.fnSendMessage instead","1.0.0");dj.community.communityintegration.fnSendMessage(siteroot,Rowkey);}
function fnCloseConnect(Rowkey){dojo.deprecated("fnCloseConnect","use dj.community.communityintegration.fnCloseConnect instead","1.0.0");dj.community.communityintegration.fnCloseConnect(Rowkey);}
function fnSendInvite(siteroot,rowKey){dojo.deprecated("fnSendInvite","use dj.community.communityintegration.fnSendInvite instead","1.0.0");dj.community.communityintegration.fnSendInvite(siteroot,rowKey);}
function GotFocus(){dojo.deprecated("GotFocus","use dj.community.communityintegration.GotFocus instead","1.0.0");dj.community.communityintegration.GotFocus();}
function LostFocus(){dojo.deprecated("LostFocus","use dj.community.communityintegration.LostFocus instead","1.0.0");dj.community.communityintegration.LostFocus();}
function fillSubCategoryJS(){dojo.deprecated("fillSubCategoryJS","use dj.community.communityintegration.fillSubCategoryJS instead","1.0.0");dj.community.communityintegration.fillSubCategoryJS();}
function setCategorySubcategory(categoryId,subCategoryId){dojo.deprecated("setCategorySubcategory","use dj.community.communityintegration.setCategorySubcategory instead","1.0.0");dj.community.communityintegration.setCategorySubcategory(categoryId,subCategoryId);}
function SortArticleComments(SBNumber,siteRoot,index,sortId){dojo.deprecated("SortArticleComments","use dj.community.communityintegration.SortArticleComments instead","1.0.0");dj.community.communityintegration.SortArticleComments(SBNumber,siteRoot,index,sortId);}
function fnReplaceHTMLTags(strValue){dojo.deprecated("fnReplaceHTMLTags","use dj.community.communityintegration.fnReplaceHTMLTags instead","1.0.0");return dj.community.communityintegration.fnReplaceHTMLTags(strValue);}
function trim(str){dojo.deprecated("trim","use dj.community.communityintegration.trim instead","1.0.0");return dj.community.communityintegration.trim(str);}
dojo.addOnLoad(function(){if(dojo.byId('hdnValues')){dj.community.communityintegration.fillSubCategoryJS();}});dojo.provide("dj.community.Comments");dojo.require("dj.util.Element");dojo.require("dj.community.feedback");dojo.require("dj.module.facebook.api");dojo.require("dj.util.flash.template");dojo.require("dj.widget.loader.LoginLoader");dojo.require("dj.widget.loader.RegistrationLoader");dj.community.Comments=function(elt,subject,ajaxRoot,contentRoot,replyContainer,options){options=options||{post2facebook:false,locale:""};this.ShowCommentsFancily=dojo.hitch(this,dj.community.Comments.prototype.__ShowCommentsFancily);this.HelpfulComment=dojo.hitch(this,dj.community.Comments.prototype.__HelpfulComment);this._commentsList=document.createElement("div");this._locale=options.locale;this._post2facebook=options.post2facebook;this._state={};this._ajaxRoot=ajaxRoot;this._contentRoot=contentRoot;this._subject=subject;this._reply2Id=0;this._replyLevel=0;this._replyContainer=replyContainer;this._targetContainer=options.targetContainer;this._fnOnNewCommentBox=options.callbackOnNewCommentBox;this._fnOnPostComment=options.callbackOnPostComment;this._fnCommentPageChange=options.callbackOnCommentPageChange;this._ignoreProfileWizard=options.ignoreProfileWizard;};dj.community.Comments.__OnContentLoad=function(){try{dj.util.flash.template.scan();}catch(ex1){console.log("dj.util.flash.template.scan(): "+ex1);}
try{dj.widget.loader.LoginLoader({version:10.12}).init();dj.widget.loader.RegistrationLoader({version:10.12}).init();}catch(ex2){console.log("dj.widget.loader.LoginLoader: "+ex2);}};dj.community.Comments.prototype.CloseArticleCommenting=function(responcecontainer){var args=dojo.mixin({},this._subject);dojo.xhrPost({url:"/community/mdcrpc/comments/CloseArticleForCommenting.sync",postData:dojo.objectToQuery(args),handle:function(response,ioargs){responcecontainer.innerHTML=response;}});};dj.community.Comments.prototype.OpenArticleCommenting=function(responcecontainer){var args=dojo.mixin({},this._subject);dojo.xhrPost({url:"/community/mdcrpc/comments/OpenArticleForCommenting.sync",postData:dojo.objectToQuery(args),handle:function(response,ioargs){responcecontainer.innerHTML=response;}});};dj.community.Comments.prototype.InlineModulePreview=function(moduleReference,target){dojo.xhrPost({url:"/community/mdcrpc/comments/InlineModulePreview.sync",postData:dojo.objectToQuery({modulereference:moduleReference}),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),target,"only");dj.util.flash.template.scan();}});};dj.community.Comments.prototype.SetInlineModuleRef=function(moduleReference){var args=dojo.mixin({modulereference:moduleReference},this._subject);dojo.xhrPost({url:"/community/mdcrpc/comments/SetInlineModuleRef.sync",postData:dojo.objectToQuery(args),handle:function(response,ioargs){if(response){alert(response);}
else{alert("Inline Module Reference is set. Please refresh the page to verify.");}}});};dj.community.Comments.prototype.SetBottomModuleRef=function(moduleReference){dojo.xhrPost({url:"/community/mdcrpc/comments/SetBottomModuleRef.sync",postData:dojo.objectToQuery({modulereference:moduleReference,locale:this._locale}),handle:function(response,ioargs){if(response){alert(response);}
else{alert("Bottom Module Reference is set. Please refresh the page to verify.");}}});};dj.community.Comments.SetCommentFocus=function(){if(dojo.byId('commentBody')){dojo.byId('commentBody').focus();}else if(dojo.byId('topicreplyarea')){window.scrollTo(0,dojo.byId('topicreplyarea').offsetTop);}};dj.community.Comments.ShowInlineMessage=function(eltId,msg){var messageContainer=dojo.byId(eltId);if(messageContainer===null||typeof messageContainer=="undefined"){return;}
messageContainer.innerHTML=msg;if(msg!==""){messageContainer.style.visibility='visible';}else{messageContainer.style.visibility='hidden';}};dj.community.Comments.__ReplaceHtmlTags=function(strValue){strValue=strValue.replace(/</g,'&lt;');strValue=strValue.replace(/>/g,'&gt;');return strValue;};dj.community.Comments.prototype.Post=function Topic_Post(comment,trackReplies,options){options=options||{};var post2facebook=!options.post2facebook?false:options.post2facebook.checked;if(ismember=="False"||isAccountValid=="False"){dojo.byId('ProfileWizard').style.display="block";dojo.byId('hdnCommentId').value=commentEntryId;dojo.byId('hdnCalledMethod').value="ReplyComment";window.scroll(0,0);return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost","");if(comment.length===0){dj.community.Comments.ShowInlineMessage("errorOnPost",dj.community.localPrompt.emptyComment);return false;}
if(comment.length>4000){dj.community.Comments.ShowInlineMessage("errorOnPost",dj.community.localPrompt.limitYourPost+" ["+comment.length+"]");return false;}
comment=dj.community.Comments.__ReplaceHtmlTags(comment);comment=comment.replace(/\n/g,"<br />");if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
var args=dojo.mixin({},{content:comment,reply2id:this._reply2Id,trackReplies:trackReplies},this._subject);var that=this;if(this._reply2Id>1){dojo.xhrPost({url:this._ajaxRoot+"/group/postcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),that._commentsList,"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));that.ShowCommentsFancily(ioargs,json);if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}}});}
else{dojo.xhrPost({url:this._ajaxRoot+"/group/postcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId("topiccomments"),"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dojo.byId('commentBody').value=comment;dj.community.Comments.ShowInlineMessage("errorOnPost",json.errorMsg);return;}
if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}}});}
if(options.post2facebook){options.post2facebook.checked=this._post2facebook;}};dj.community.Comments.prototype.PostArticleComment=function Topic_PostArticleComment(comment,joinCommunity,trackReplies,options){options=options||{};var post2facebook=!options.post2facebook?false:options.post2facebook.checked;var errMsgElm=options.errormsgelm?options.errormsgelm:"errorOnPost";var commentBoxId=options.commentboxid;dj.community.Comments.ShowInlineMessage(errMsgElm,"");if(comment.length===0){dj.community.Comments.ShowInlineMessage(errMsgElm,dj.community.localPrompt.emptyComment);return false;}
if(comment.length>4000){dj.community.Comments.ShowInlineMessage(errMsgElm,dj.community.localPrompt.limitYourPost+" ["+comment.length+"]");return false;}
var text=dj.community.Comments.__ReplaceHtmlTags(comment).replace(/\n/g,"<br />");var args=dojo.mixin({},{content:text,reply2id:this._reply2Id,joinCommunity:joinCommunity,trackReplies:trackReplies,locale:this._locale},this._subject);var that=this;if(this._reply2Id>1){dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/postarticlecomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),that._commentsList,"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage(errMsgElm,json.errorMsg);if(dojo.byId(commentBoxId)){dojo.byId(commentBoxId).value=comment;}}
if(!json.userInfo.isSuspended){that.ShowCommentsFancily(ioargs,json);}
if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}
if(that._fnOnPostComment!==undefined){that._fnOnPostComment(json.success,json.userInfo,json.userInfo.isSuspended);}}});}
else{if(this._targetContainer){dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/postarticlecomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),that._targetContainer,"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage(errMsgElm,json.errorMsg);if(dojo.byId(commentBoxId)){dojo.byId(commentBoxId).value=comment;}}
dj.community.Comments.__OnContentLoad();if(dojo.byId('newcommentarea0')){window.scrollTo(0,dojo.byId('newcommentarea0').offsetTop-200);}
if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}
if(that._fnOnNewCommentBox!==undefined){that._fnOnNewCommentBox();}
if(that._fnOnPostComment!==undefined){that._fnOnPostComment(json.success,json.userInfo,false,json.commentsTotalCount);}
setTimeout(function(){dj.community.feedback.toggleComments('fade_slider',that._ajaxRoot);},0);}});}
else{dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/postarticlecomment.sync",postData:dojo.objectToQuery(args),handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage(errMsgElm,json.errorMsg);if(dojo.byId(commentBoxId)){dojo.byId(commentBoxId).value=comment;}}
if(post2facebook){this.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}
if(this._fnOnPostComment!==undefined){this._fnOnPostComment(json.success,json.userInfo,false,json.commentsTotalCount);}})});}}
if(options.post2facebook){options.post2facebook.checked=this._post2facebook;}
return true;};dj.community.Comments.prototype.__PostArticleCommentFb=function(commentEntryId,comment,href){try{dj.module.facebook.api.postArticleComment({comment:comment,commentPermalink:href,callbackFn:dj.community.Comments.TrackFb,callbackParams:{commentEntryId:commentEntryId,ajaxRoot:this._ajaxRoot}});}catch(e){console.log("dj.module.facebook.api.postArticleComment(): "+ex);}};dj.community.Comments.TrackFb=function(params,fbUid,fbPostId){var args={commentEntryId:params.commentEntryId,fbUid:fbUid,fbPostId:fbPostId};dojo.xhrGet({url:params.ajaxRoot+"/mdcrpc/comments/TrackFb.sync",content:args});};dj.community.Comments.prototype.TrackReplies=function Topic_TrackReplies(commentEntryId){var args={commentEntryId:commentEntryId};var elt=dojo.byId('track'+commentEntryId);dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/trackreplies.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),elt,"only");}});};dj.community.Comments.prototype.TrackRepliesStop=function Topic_TrackRepliesStop(commentEntryId){var args={commentEntryId:commentEntryId};var elt=dojo.byId('track'+commentEntryId);dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/trackrepliesstop.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),elt,"only");}});};dj.community.Comments.prototype.__ShowCommentsFancily=function Comments_ShowCommentsFancily(transport,json){if(!json.success){dj.community.Comments.ShowInlineMessage("errorOnPost",json.errorMsg);}else{dojo.byId('newcommentarea'+this._reply2Id).innerHTML+=this._commentsList.innerHTML.replace('wrote:','replied:');dj.util.Element.show(dojo.byId('newcommentarea'+this._reply2Id).parentNode);if(this._replyContainer!==null){dj.util.Element.hide(this._replyContainer);}
this._replyContainer=dojo.byId('topicreplyarea');this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
dj.util.Element.show(this._replyContainer);if(this._replyLevel>0){if(dojo.byId('track'+json.commentEntryId)){dj.util.Element.hide('track'+json.commentEntryId);}}
dojo.byId('newcommenttitle').innerHTML="Add a Comment";this._reply2Id=0;this._replyLevel=0;}};dj.community.Comments.prototype.OpenReplyBox=function Topic_OpenReplyBox(targetElement,commentEntryId,reply2Name){if(isLoggedIn=="False"){RedirectToLogin();}
else if(ismember=="False"||isAccountValid=="False"){dojo.byId('ProfileWizard').style.display="block";dojo.byId('hdnCommentId').value=commentEntryId;dojo.byId('hdnCalledMethod').value="ReplyComment";window.scroll(0,0);return false;}
else{if(dojo.byId('isGroupMember').value!='Active'){dojo.byId('joinGroup'+commentEntryId).style.display='block';return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost","");this._reply2Id=commentEntryId;dj.community.Comments.prototype.ReplyBox(targetElement,commentEntryId,reply2Name);}};dj.community.Comments.prototype.ReplyBox=function Topic_ReplyBox(targetElement,commentEntryId,reply2Name,replyLevel){if(!this._ignoreProfileWizard&&(ismember=="False"||isAccountValid=="False")){dojo.byId('ProfileWizard').style.display="block";dojo.byId('hdnCommentId').value=commentEntryId;dojo.byId('hdnCalledMethod').value="ReplyComment";window.scroll(0,0);return false;}
this.CancelEditComment();dj.community.Comments.ShowInlineMessage("errorOnPost","");this._reply2Id=commentEntryId;this._replyLevel=replyLevel;this._replyContainer=dojo.byId(targetElement);this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
dj.util.Element.show(this._replyContainer);try{if(replyLevel>0){dj.util.Element.hide(dojo.query('#trackreply','newcomment')[0]);}else{dj.util.Element.show(dojo.query('#trackreply','newcomment')[0]);}}catch(e){}
if(reply2Name){dj.util.Element.hide(dojo.query('._add_a_comment','newcommenttitle')[0]);dj.util.Element.show(dojo.query('._reply_a_comment','newcommenttitle')[0]);dojo.query('._reply_a_comment ._commenter','newcommenttitle')[0].innerHTML=reply2Name;}else{dj.util.Element.show(dojo.query('._add_a_comment','newcommenttitle')[0]);dj.util.Element.hide(dojo.query('._reply_a_comment','newcommenttitle')[0]);}
if(dojo.byId('commentBody')){dojo.byId('commentBody').focus();}
else{var elementPos=dojo.position(dojo.byId('newcomment'),true);if(elementPos){window.scrollTo(0,elementPos.y);}}};dj.community.Comments.prototype.EditComment=function Topic_EditComment(commentEntryId){this.CancelEditComment();var args={commentEntryId:commentEntryId,locale:this._locale};dojo.byId('newcomment').style.display='none';var commentEntryElt=dojo.byId('commententry'+commentEntryId);var bodyElt;if(commentEntryElt){bodyElt=commentEntryElt;}
if(bodyElt){dojo.byId('editcomment'+commentEntryId).style.display='none';this._bubbleContentHeight=bodyElt.offsetHeight;dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/editcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),bodyElt,"only");}});}};dj.community.Comments.prototype.ReportComment=function(siteroot,commentId){dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/report.sync",postData:dojo.objectToQuery({commentId:commentId,locale:this._locale}),load:function(data,ioargs){dojo.byId("reportcomment"+commentId).innerHTML=data;}});};dj.community.Comments.prototype.RemoveCommentByGroupOwner=function(commentId,groupName){if(!confirm('Are you sure you wish to remove the comment?')){return;}
dojo.xhrPost({url:this._ajaxRoot+"/group/removecommentbygroupowner.sync",postData:dojo.objectToQuery({commentId:commentId,groupName:groupName}),handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(json.totalcnt<=0){return;}
dojo.fadeOut({node:'comment'+commentId,duration:500,onEnd:function(){dj.util.Element.hide('comment'+commentId);}}).play();}});};dj.community.Comments.prototype.PostEditComment=function Topic_PostEditComment(comment,commentEntryId){comment=dj.community.Comments.__ReplaceHtmlTags(comment);comment=comment.replace(/\n/g,"<br />");if(comment===''){dj.community.Comments.ShowInlineMessage("errorOnEditPost",dj.community.localPrompt.emptyComment);return false;}else if(comment.length>4000){dj.community.Comments.ShowInlineMessage("errorOnEditPost",dj.community.localPrompt.limitYourPost+" ["+comment.length+"]");return false;}
var args=dojo.mixin({},{content:comment},this._subject,{commentEntryId:commentEntryId,locale:this._locale});var tempDiv=document.createElement("div");dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/posteditcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){tempDiv.innerHTML=data.replace(/^\s*/,"");},handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage("errorOnEditPost",json.errorMsg);}else{dojo.byId('commententry'+commentEntryId).innerHTML=tempDiv.innerHTML;dojo.byId('newcomment').style.display='';if(this._replyContainer!==null){dj.util.Element.hide(this._replyContainer);}
this._replyContainer=dojo.byId('topicreplyarea');this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
dj.util.Element.show(this._replyContainer);dojo.byId('newcommenttitle').innerHTML="Add a Comment";this._reply2Id=0;}})});};dj.community.Comments.SortComments=function(groupName,topicName,index,sortId){dojo.byId('sortId').value=sortId;dojo.xhrPost({url:vw_siteroot+"/group/sortComment.sync",postData:dojo.objectToQuery({groupname:groupName,topicname:topicName,index:index,sortIndex:sortId}),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId("topiccomments"),"only");}});};dj.community.Comments.prototype.CancelEditComment=function Topic_CancelEditComment(){var prevEditcomment=dojo.byId('commentarea');if(!prevEditcomment){return;}
var commentEntryId=document.getElementById('EditcommentEntryId').value;dojo.byId('newcomment').style.display='';if(this._replyContainer!==null&&this._replyContainer!==undefined){this._replyContainer.style.display='none';}
this._replyContainer=dojo.byId('topicreplyarea');this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
this._replyContainer.style.display='block';dojo.byId('newcommenttitle').innerHTML="Add a Comment";this._reply2Id=0;dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/canceleditcomment.sync",postData:dojo.objectToQuery({commentEntryId:commentEntryId,locale:this._locale}),load:function(data,ioargs){dojo.byId('commententry'+commentEntryId).innerHTML=data.replace(/^\s*/,"");}});};dj.community.Comments.prototype.__HelpfulComment=function(commentEntryId){dj.community.Comments.HelpfulComment(this._ajaxRoot,commentEntryId,this._locale);};dj.community.Comments.HelpfulComment=function(ajaxroot,commentEntryId,locale){var args={locale:locale,commentEntryId:commentEntryId};var elt=dojo.byId('numhelpful'+commentEntryId);dojo.xhrPost({url:ajaxroot+"/components/comments/helpfulcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),elt,"only");}});};dj.community.Comments.prototype.GetArticlecommentsInitialPage=function Topic_GetArticleInitialPage(){this._commentId="";var results=unescape(window.location.href).match(/commentId=(\d+)/);if(results&&(results.length==2)){this._commentId=results[1];}
var args=dojo.mixin({},this._subject,{commentEntryId:this._commentId,locale:this._locale});dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/GetArticlecommentsInitialPage.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),this._targetContainer,"only");}),handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));dj.community.Comments.__OnContentLoad();if(this._fnOnNewCommentBox!==undefined){this._fnOnNewCommentBox(json.commentsTotalCount);}
setTimeout(dojo.hitch(this,function(){dj.community.feedback.toggleComments('fade_slider',this._ajaxRoot);}),0);if(this._commentId!==""){if(dojo.byId('commententry'+this._commentId)){var elementPos=dojo.position(dojo.byId('commententry'+this._commentId),true);if(elementPos){window.scrollTo(0,elementPos.y);}}
this._commentId="";}})});};dj.community.Comments.prototype.GetArticlecommentsPage=function Topic_GetArticlecommentsPage(indx,sortIndex){if(sortIndex===undefined){sortIndex=1;if(dojo.byId('sortId')){sortIndex=dojo.byId('sortId').value;}
if(sortIndex===null||sortIndex===''){sortIndex=1;}}
var args=dojo.mixin({pageNumber:indx,sortIndex:sortIndex,locale:this._locale},this._subject);dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/GetArticleComments.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),this._targetContainer,"only");}),handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));window.scrollTo(0,dojo.byId('top-of-comments').offsetTop);dj.community.Comments.__OnContentLoad();if(this._fnOnNewCommentBox!==undefined){this._fnOnNewCommentBox(json.commentsTotalCount);}
try{setTimeout(dojo.hitch(this,function(){dj.community.feedback.toggleComments('fade_slider',this._ajaxRoot);}),0);}catch(e){}
if(this._fnCommentPageChange!==undefined){this._fnCommentPageChange();}})});};dj.community.Comments.prototype.ScrollToElementId=function Topic_ScrollToElementId(elementId){var element=dojo.byId(elementId);if(element===null){return;}
window.scrollTo(0,element.offsetTop);};dj.community.Comments.prototype.GoToMostRecentComment=function Topic_GoToMostRecentComment(sbnumber,indx){var siteroot=this._ajaxRoot;var sortIndex=dojo.byId('sortId').value;if(sortIndex===null||sortIndex===''){sortIndex=1;}
var iIndex=0;if(sortIndex==1){iIndex=indx;}
else if(sortIndex==2)
{iIndex=1;}
dojo.xhrPost({url:siteroot+"/public/ArticleComments.html",postData:dojo.objectToQuery({SBNumber:sbnumber,index:iIndex,sortIndex:sortIndex}),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),this._targetContainer,"only");}),handle:function(response,ioargs){if(sortIndex===1||sortIndex==='1'){var anchor_node=dojo.byId('newcommentarea0');if(anchor_node){window.scrollTo(0,anchor_node.offsetTop-200);}}}});};dojo.provide("dj.community.ArticleComments");dojo.require("dj.util.Element");dojo.require("dj.community.Subject");dojo.require("dj.community.Comments");dojo.getObject("dj.community",true);dj.community.theTopic=undefined;dj.community.localPrompt={emptyComment:"Please enter your comment and then click post.",limitYourPost:"Please limit your post to 4000 characters.",whatIsIt:"What's this?",closeDialog:"Close"};dj.community.ArticleComments=function(sbNumber,articleName,fullsiteroot,contentroot,onGetCommentsCount,onPostComment,isOpinion,onCommentPageChange,options){options=options||{istopic:false,isexpertblog:false,tags:'',href:'',forcemembership:false,locale:''};this._fullSiteRoot=fullsiteroot;this._contenRoot=contentroot;this._forceMembership=options.forcemembership;this._locale=options.locale;var subjectType="story";if(options.istopic){subjectType="grouptopic";}
else if(isOpinion){subjectType="opinion";}
else if(options.isexpertblog){subjectType="expertblog";}
this._subject=new dj.community.Subject(sbNumber,articleName,options.href,subjectType,options.tags,options.locale);this._onGetCommentsCount=onGetCommentsCount;this._onPostComment=onPostComment;this._onCommentPageChange=onCommentPageChange;this._userInfo=undefined;this._totalCommentsCount=undefined;this.__Init();};dj.community.ArticleComments.prototype.__Init=function(){var updateDiv=document.createElement("div");var args={locale:this._locale};args=dojo.mixin(args,this._subject);dojo.xhrPost({url:this._fullSiteRoot+"/mdcrpc/comments/GetArticleCommentPopupBox.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),updateDiv,"only");}),handle:dojo.hitch(this,function(response,ioargs){var json=null;var fragment=dojo.query('#_json',updateDiv);if(fragment.length==1){json=eval('('+fragment[0].innerHTML+')');}
if(!json){json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));}
this._userInfo=json.userInfo;if(json.localPrompt){dj.community.localPrompt=json.localPrompt;}
document.body.appendChild(updateDiv);if(dojo.byId('cmd0404174609')){dojo.connect(dojo.byId('cmd0404174609'),'onclick',dj.community.HideMembershipDialog);}
if(dojo.byId('cmd0406115509')){dojo.connect(dojo.byId('cmd0406115509'),'onclick',dojo.hitch(this,this.__PostAndConfirmJoin));}
if(dojo.byId('cmd0406115609')){dojo.connect(dojo.byId('cmd0406115609'),'onclick',dj.community.HideMembershipDialog);}
if(dojo.byId('cmd0406115709')){dojo.connect(dojo.byId('cmd0406115709'),'onclick',dj.community.HideMembershipDialog);}
this._totalCommentsCount=json.commentCount;if(this._onGetCommentsCount){this._onGetCommentsCount(json.commentCount);}})});dj.community.theTopic=new dj.community.Comments('synccomments',this._subject,this._fullSiteRoot,this._contenRoot,dojo.byId('topicreplyarea'),{locale:this._locale,ignoreProfileWizard:true,callbackOnNewCommentBox:dojo.hitch(this,this.__BindCommentBoxOnCommentsTab),callbackOnPostComment:dojo.hitch(this,this.__OnPostComment),callbackOnCommentPageChange:this._onCommentPageChange});dj.community.theTopic.HelpfulComment=dojo.hitch(this,dj.community.ArticleComments.prototype.__HelpfulComment);};dj.community.ArticleComments.prototype.GetCommentBox=function(targetContainer,slimversion){if(targetContainer===undefined){targetContainer=this._commentBoxDiv;}
this._commentBoxDiv=targetContainer;var args={slimversion:slimversion?true:false,locale:this._locale};args=dojo.mixin(args,this._subject);dojo.xhrPost({url:this._fullSiteRoot+"/mdcrpc/comments/GetArticleCommentBox.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId(targetContainer),"only");}),handle:dojo.hitch(this,function(data,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));dj.community.Comments.__OnContentLoad();this.__OnGetCommentBox(ioargs,json);})});};dj.community.ArticleComments.prototype.GetComments=function(targetContainer){dj.community.theTopic=new dj.community.Comments('synccomments',this._subject,this._fullSiteRoot,this._contenRoot,dojo.byId('topicreplyarea'),{locale:this._locale,targetContainer:targetContainer,ignoreProfileWizard:true,callbackOnNewCommentBox:dojo.hitch(this,this.__BindCommentBoxOnCommentsTab),callbackOnPostComment:dojo.hitch(this,this.__OnPostComment),callbackOnCommentPageChange:this._onCommentPageChange});dj.community.theTopic.HelpfulComment=dojo.hitch(this,dj.community.ArticleComments.prototype.__HelpfulComment);dj.community.theTopic.GetArticlecommentsInitialPage();};dj.community.ArticleComments.prototype.__OnGetCommentBox=function(transport,json){if(dojo.byId('commentbox0817091638')&&dojo.byId('slimbox0817091645')){dj.util.Element.hide('commentbox0817091638');}
if(!dojo.byId('cmd0409091704')){return;}
dojo.connect(dojo.byId('cmd0409091704'),'onclick',dojo.hitch(this,function(){if(this._onPostComment){this._onPostComment();}}));dojo.connect(dojo.byId('clearCommentBody0'),'onclick',function(){if(!dojo.byId('commentBody0')){return;}
dojo.byId('commentBody0').value='';dojo.byId('commentBody0').focus();dj.community.Comments.ShowInlineMessage("errorOnPost0","");});dojo.connect(dojo.byId('postComment0'),'onclick',dojo.hitch(this,function(event){if(!dojo.byId('commentBody0')){return;}
dj.community.Comments.ShowInlineMessage("errorOnPost0","");if(dojo.byId('commentBody0').value.length===0){dj.community.Comments.ShowInlineMessage("errorOnPost0",dj.community.localPrompt.emptyComment);return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost0","");this._currentCommentBox=dojo.byId('commentBody0');this._currentTrackReply=dojo.byId('cbxtrackreply0');this._currentPost2Facebook=dojo.byId('cbxfb0');this.__PostArticleComment(event.target);}));};dj.community.ArticleComments.prototype.__BindCommentBoxOnCommentsTab=function(total_comments_count){if(dojo.byId('cmd0406091327')){dojo.attr("cmd0406091327","onclick","");dojo.connect(dojo.byId('cmd0406091327'),'onclick',dojo.hitch(this,function(event){dj.community.Comments.ShowInlineMessage("errorOnPost","");if(dojo.byId('commentBody').value.length===0){dj.community.Comments.ShowInlineMessage("errorOnPost",dj.community.localPrompt.emptyComment);return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost","");this._currentCommentBox=dojo.byId('commentBody');this._currentTrackReply=dojo.byId('cbxtrackreply');this._currentPost2Facebook=dojo.byId('cbxfb');this.__PostArticleComment(event.target);}));}
if(total_comments_count!==undefined){this._totalCommentsCount=total_comments_count;if(this._onGetCommentsCount){this._onGetCommentsCount(this._totalCommentsCount);}}};dj.community.ArticleComments.prototype.__HelpfulComment=function(commentEntryId){if(this._userInfo.isMember){dj.community.theTopic.__HelpfulComment(commentEntryId);}
else{dj.community.ShowMembershipDialog(dojo.byId('numhelpful'+commentEntryId),true,dojo.hitch(this,function(){dj.community.theTopic.__HelpfulComment(commentEntryId);dj.community.HideMembershipDialog();this._userInfo.isMember=true;}));}};dj.community.ArticleComments.prototype.__PostArticleComment=function(clicked){if(this._userInfo.isMember){this.__CommentPost(false);}
else{var forceMembership=(this._userInfo.Status=="subscriber"&&!this._forceMembership);dj.community.ShowMembershipDialog(this._currentCommentBox,forceMembership,dojo.hitch(this,this.__PostAndJoin));}};dj.community.ShowMembershipDialog=function(relativeElement,forceMembership,callback){if(callback&&dojo.byId('cmd0404174509')){dojo.connect(dojo.byId('cmd0404174509'),'onclick',callback);}
if(!forceMembership){dj.util.Element.show("commentpopup");}
else{dj.util.Element.show("commentpopup");}};dj.community.HideMembershipDialog=function(){dj.util.Element.hide("commentpopup");};dj.community.ArticleComments.prototype.__PostAndJoin=function(){this.__CommentPost(true);};dj.community.ArticleComments.prototype.__PostAndConfirmJoin=function(){this.__CommentPost(dojo.byId("chkBecomeMember").checked);};dj.community.ArticleComments.prototype.__CommentPost=function(joinCommunity){dj.util.Element.hide("commentpopup");var errMsgElm=this._currentCommentBox.id=='commentBody0'?'errorOnPost0':null;var txt=(dojo.attr(this._currentCommentBox,'tooltip')==this._currentCommentBox.value?'':this._currentCommentBox.value);var success=dj.community.theTopic.PostArticleComment(txt,joinCommunity,(this._currentTrackReply?this._currentTrackReply.checked:false),{errormsgelm:errMsgElm,commentboxid:this._currentCommentBox.id,post2facebook:this._currentPost2Facebook});if(!success){return;}
if(!this._userInfo.isMember){this._userInfo.isMember=joinCommunity;}
this._currentCommentBox.value='';if(this._currentTrackReply){this._currentTrackReply.checked=false;}
this._currentCommentBox.focus();};dj.community.ArticleComments.prototype.__OnPostComment=function(success,userInfo,reloadComments,commentsTotalCount){if(userInfo!==undefined&&userInfo.isSuspended){this.GetCommentBox();if(reloadComments!==undefined&&reloadComments){dj.community.theTopic.GetArticlecommentsInitialPage();}
return;}
if(!success){return;}
if(commentsTotalCount===undefined){this._totalCommentsCount++;}else{this._totalCommentsCount=commentsTotalCount;}
if(this._onGetCommentsCount){this._onGetCommentsCount(this._totalCommentsCount);}
if(this._currentCommentBox.id=='commentBody0'){if(this._onPostComment){this._onPostComment(dojo.byId('newcommentarea0')?'newcommentarea0':undefined);}}};dojo.provide("dj.util.ie9.pin");
dojo.require("dj.util.Tracking");

dj.util.ie9.pin = {
  siteMode : function() {
    var returnMode="";
    try {
      if (window.external.msIsSiteMode()) {
        returnMode="pinned";
      }
      else {
        returnMode="pinnable";
      }
      
    }
    catch(ex) {
      returnMode="notpinnable";
    }
    return returnMode;
  }
};

dojo.provide("dj.module.video.taboolaVideo");dj.module.video.taboolaVideo={loaderscript:"http://cdn.taboolasyndication.com/libtrc/wsj-wsj/loader.js",count:0,init:function(a){that=this;console.log("taboolaVideo {init} count: "+that.count);if(!that.ifEmpty(a.loaderscript))that.loaderscript=a.loaderscript;try{if(that.count==0){var b=document.createElement("script");b.type="text/javascript";b.src=that.loaderscript;if(a.async!=="hide")b.async=true;document.body.appendChild(b);window._taboola=window._taboola||[];b={};if(that.ifEmpty(a.pagemod))b.home=a.pagetype;else b[a.pagemod]=a.pagetype;that.ifEmpty(a.trackingcode)||(b.tracking=a.trackingcode);_taboola.push(b);that.loadModule(a);that.count=1}else that.loadModule(a)}catch(c){console.log("{lazyLoadTaboola} "+c)}},loadModule:function(a){that=this;window._taboola=window._taboola||[];var b={mode:a.mod,placement:a.placement,container:a.taboolacontent};that.ifEmpty(a.linktarget)||(b.link_target=a.linktarget);that.ifEmpty(a.moduletrackingcode)||(b.tracking=a.moduletrackingcode);a=_taboola.push(b);console.log("{loadModule} "+a+" : "+b)},notifyTaboola:function(a,b,c,e){that=this;try{that.ifEmpty(c)||(c="false");console.log(" {notifyTaboola} "+a+" : "+b+" : "+e+" : "+c+" : "+that.count);if(that.count==0){var d=document.createElement("script");d.type="text/javascript";d.src=that.loaderscript;document.body.appendChild(d);that.loadVideo(a,b,e,c);that.count=1}else that.loadVideo(a,b,e,c)}catch(f){console.log("{notifyTaboola} "+f)}},notifyDynamicLoad:function(a,b,c,e){that=this;window._taboola=window._taboola||[];that.ifEmpty(e)||(e="videoPlay");a={notify:e,id:a,url:b};that.ifEmpty(c)||(a.tracking=c);c=_taboola.push(a);console.log(" {notifyDynamicLoad} :"+c+" : "+a)},loadLoaderJs:function(a,b,c,e,d,f){that=this;if(!that.ifEmpty(d))that.loaderscript=d;d=document.createElement("script");d.type="text/javascript";d.src=that.loaderscript;if(f!=="hide")d.async=true;document.body.appendChild(d);that.count=1;window._taboola=window._taboola||[];f={};if(!that.ifEmpty(a)&&!ifEmpty(b))f[a]=b;else f.video="unknown";if(that.ifEmpty(e))f.visible="false";else f[visible]=e;that.ifEmpty(c)||(f[tracking]=c);a=_taboola.push(f);console.log(" {loadLoaderJs} :"+a+" : "+f)},loadVideo:function(a,b,c,e){that=this;window._taboola=window._taboola||[];var d={video:a};that.ifEmpty(c)||(d.video_source=c);that.ifEmpty(e)||(d.visible=e);that.ifEmpty(b)||(d.tracking=b);b=_taboola.push(d);console.log(" loadVideo:: response: "+b+" : "+a+" : "+d+" : "+c+" : "+e)},ifEmpty:function(a){return a!==null&&a!==undefined&&a!==""?false:true}};dojo.provide("dj.widget.video.model.PlayerEvents");dj.widget.video.model.PlayerEvents={playVideo:"onPlayVideo",pauseVideo:"onPauseVideo",unpauseVideo:"onUnpauseVideo",getSeek:"onGetSeek",stopVideo:"onStopVideo",createAdvertisement:"onCreateAdvertisement",openMicroPopUpPlayer:"onOpenMicroPopUpPlayer",openPopUpPlayer:"onOpenPopUpPlayer",openEmbedPopup:"onOpenEmbedPopup",continueLoadVideo:"onContinueLoadVideo",playNextVideo:"onPlayNextVideo"};dojo.provide("dj.widget.video.model.PlayerTypes");(dj.widget.video.model.PlayerTypes={MicroPlayer:{width:272,height:153,swfFile:"WSJMediaPlayer.swf"},MicroPlayerHP:{width:264,height:149,swfFile:"WSJMediaPlayer.swf"},MicroPlayerE:{width:360,height:203,swfFile:"WSJMediaPlayer.swf"},MicroPlayerF:{width:512,height:288,swfFile:"WSJMediaPlayer.swf"},MainPlayer:{width:512,height:363,swfFile:"WSJMediaPlayer.swf"},MainPlayerG:{width:548,height:311,swfFile:"WSJMediaPlayer.swf"},AdPlayer:{width:336,height:280,swfFile:"adPlayer.swf"}}).prototype={};dojo.provide("dj.widget.video.model.SWFPlayer");(dj.widget.video.model.SWFPlayer=function(){this.objName="undefined";this.containerID=this.swfURL=this.id="";this.height=this.width=0;this.containermodule=this.videoGUID="";this.flashVersion="9.0.0";this.allowPlayerPopup=1;this.hideTools=0;this.plyMediaEnabled=1;this.host="video.wsj.com";this.allowScriptAccess="always";this.windowMode="opaque";this.playNextVideo=this.continueLoadVideo=this.openEmbedPopup=this.openPopUpPlayer=this.createAdvertisement=this.stopVideo=this.getSeek=this.unpauseVideo=this.pauseVideo=this.playVideo=this.eventNamespace=this.configURL="";this.chainVideos=1;this.enableVideoModuleChaining=0}).prototype={};dojo.provide("dj.widget.video.view.BasePlayer");dojo.declare("dj.widget.video.view.BasePlayer",null,{constructor:function(a){this.controller=null;this.configuration={name:"",preloaderClassName:"videoObjectLoading"};dojo.mixin(this.configuration,a);this.playerCreated=false},init:function(a){this.controller=a},render:function(){console.error("{BasePlayer} 'render' must be overritten")},openPopUpPlayer:function(){console.error("{BasePlayer} 'openPopUpPlayer' must be overritten")}});dojo.provide("dj.util.VideoUtils");dojo.require("swfobject.swfobject_2_2.swfobject");(function(){dj.util.VideoUtils={formatDuration:function(a){if(a<60)return"0:"+this.formatSeconds(a);for(var b=0;a>59;){a-=60;b++}return b+":"+this.formatSeconds(a)},formatSeconds:function(a){return a>9?a:"0"+a},nullOrUndefined:function(a){return a===null||a=="undefined"},emptyOrNull:function(a){if(!this.nullOrUndefined(a))return a.length===0;return true},nonSupportingFlashPlayer:function(a){dojo.byId(a).innerHTML='<div class="noFlash"><p>This content can not be displayed because your browser does not support the Adobe Flash player required to view it.</p></div>'},hasValidFlashVersion:function(){var a=swfobject.getFlashPlayerVersion();if(a)return a.major>=9;else{console.error("{VideoUtils} - flashVersion is undefined.");return false}},createSWFPlayer:function(a){if(this.hasValidFlashVersion()){var b={objName:a.objName,allowPlayerPopup:a.allowPlayerPopup,hideTools:a.hideTools,plyMediaEnabled:a.plyMediaEnabled,movieWidth:a.width,movieHeight:a.height,host:a.host,PLAYER_ID:a.id,containermodule:a.containermodule,playVideo:this.addEventNamespace(a.eventNamespace,a.playVideo),pauseVideo:this.addEventNamespace(a.eventNamespace,a.pauseVideo),unpauseVideo:this.addEventNamespace(a.eventNamespace,a.unpauseVideo),getSeek:this.addEventNamespace(a.eventNamespace,a.getSeek),stopVideo:this.addEventNamespace(a.eventNamespace,a.stopVideo),createAdvertisement:this.addEventNamespace(a.eventNamespace,a.createAdvertisement),openPopUpPlayer:this.addEventNamespace(a.eventNamespace,a.openPopUpPlayer),openEmbedPopup:this.addEventNamespace(a.eventNamespace,a.openEmbedPopup),openMicroPopUpPlayer:this.addEventNamespace(a.eventNamespace,a.openMicroPopUpPlayer),continueLoadVideo:this.addEventNamespace(a.eventNamespace,a.continueLoadVideo),playNextVideo:this.addEventNamespace(a.eventNamespace,a.playNextVideo),enableVideoModuleChaining:a.enableVideoModuleChaining};if(a.swfURL=="/media/swf/WSJMediaPlayer.swf"){a.chainVideos=1;var c=dojo.getObject("dj.context.video.chainVideos");if(c!=undefined&&c===false)a.chainVideos=0;b.chainVideos=a.chainVideos}try{swfobject.embedSWF(dj.context.core.cdnPrefix+a.swfURL,a.containerID,a.width,a.height,a.flashVersion,"",b,{allowscriptaccess:a.allowScriptAccess,wmode:"opaque"},{id:a.id})}catch(e){console.error("Error on embending "+e)}}else this.nonSupportingFlashPlayer(a.containerID)},addEventNamespace:function(a,b){return b===null||b===""?b:a+"."+b},popUpPlayer:function(a){var b="/public/page/video-popup.html";if(dj.context.videoCenter.popUpPageURL)b=dj.context.videoCenter.popUpPageURL;dj.context.videoCenter.height&&dj.context.videoCenter.width?window.open(b+"?currentPlayingLocation="+a.playLocation+"&currentlyPlayingCollection="+escape(a.collection)+"&currentlyPlayingVideoId="+a.videoID,"popUpPlayer","height="+dj.context.videoCenter.height+",width="+dj.context.videoCenter.width+",left="+(screen.width-Number(a.width))/2+",top="+(screen.height-Number(a.height))/2+",resizable=no,scrollbars=no,toolbar=no,status=no"):window.open(b+"?currentPlayingLocation="+a.playLocation+"&currentlyPlayingCollection="+escape(a.collection)+"&currentlyPlayingVideoId="+a.videoID,"popUpPlayer","height=840,width=422,left="+
(screen.width-Number(a.width))/2+",top="+(screen.height-Number(a.height))/2+",resizable=yes,scrollbars=no,toolbar=no,status=no")},embedPopUp:function(a){console.log("videoutils embedPopUp.");var b=a.url,c=a.shortUrl;a=a.guidval;a=a.replace("{","");a=a.replace("}","");if(c!==undefined&&c!==null&&""!==c)b=c;c="/public/page/videoembedcode.html";if(dj.context.videoCenter.EmbedPageURL)c=dj.context.videoCenter.EmbedPageURL;window.open(c+"?url="+b+"&guidval="+a,"popUpPlayer","height=372,width=635,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=no,status=no")},isGUID:function(a){return a.match(/{\w{8}-\w{4}-\w{4}-\w{4}-\w{12}}/)},normalizeGuid:function(a){return this.isGUID(a)?a:"{"+a+"}"},omnitureEncoding:function(a,b,c){if(a=="News"){if(b=="Politics"&&c=="s")return"Politics & Campaign";if(this.emptyOrNull(b))return"US"}if(a=="Management"){if(this.emptyOrNull(b)&&c=="c")return"Business";if(this.emptyOrNull(b)&&c=="s")return"Management";if(b=="Business Insight")return c=="c"?"Business":"Business Insight";return"Business"}if(a=="Lifestyle"&&c=="c")return"Life & Style";if(a=="Special Packages"){if(b=="Journal Reports"&&c=="c")return"Special";if(b=="Journal Reports"&&c=="s")return"In-Depth Reports";if(b=="Journal Women"&&c=="c")return"Careers";if(b=="Journal Women"&&c=="s")return"Journal Women"}if(c=="s"&&this.emptyOrNull(b))return a;if(c=="s")return b;if(c=="c")return a},isVideoSupported:function(){if(typeof this._isHtml5==="undefined"){var a=document.createElement("video")||false;this._isH264=(this._isHtml5=a&&typeof a.canPlayType!=="undefined")&&(a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')==="maybe"||a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')==="probably");this._isOgg=this._isHtml5&&(a.canPlayType('video/ogg; codecs="theora, vorbis"')==="maybe"||a.canPlayType('video/ogg; codecs="theora, vorbis"')==="probably")}return this._isHtml5},isOggTheoraVideoSupported:function(){return this.isVideoSupported()&&this._isOgg},isH264BaselineVideoSupported:function(){return this.isVideoSupported()&&this._isH264},callThroughDispatch:function(a,b){var c=dojo.create("a",{is:"false"});dojo.place(c,dojo.body());var e=dj.util.Element.identify(c);dojo.connect(c,"click",function(d){dojo.stopEvent(d);if(c.getAttribute("is")!=="true"){c.setAttribute("is","true");a.call(b)}});setTimeout(dojo.hitch(this,function(){this._doEventDispatch(e)}),400)},_doEventDispatch:function(a){var b;a=dojo.byId(a);if(document.createEvent){b=document.createEvent("MouseEvents");if(b.initMouseEvent)b.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);else b=false}b?a.dispatchEvent(b):a.click&&a.click()}}})();dojo.provide("dj.util.Video");dojo.require("dj.lang");dojo.require("dj.util.Cookie");dojo.require("dj.util.Observer");dojo.require("dj.util.Omniture");dojo.require("dj.util.Page");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.Query");dojo.require("dj.util.Element");(function(){var a=dj.util,b=dj.util.Page,c=new a.Observer(dj.util.Video),e={};a.Video={unpauseVideo:function(d,f){c.fireByName("unpauseVideo",d,f)},pauseVideo:function(d,f){c.fireByName("pauseVideo",d,f)},playVideo:function(d,f){c.fireByName("playVideo",d,f)},getSeek:function(d,f){c.fireByName("getSeek",d,f)},stopVideo:function(d,f){c.fireByName("stopVideo",d,f)},collapsePlayer:function(d,f){c.fireByName("collapsePlayer",d,f)},expandPlayer:function(d,f){c.fireByName("expandPlayer",d,f)},isVideoPlayerCollapsed:function(d){var f=this._getOrCreatePlayer(d);if(f.isCollapsed)return true;var g=a.Cookie.getGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+d)==="yes";g&&this._collapsePlayerCallback(d);f.isCollapsed=g;return f.isCollapsed},subscribe:function(d,f,g){c.subscribeByName(d,f,g)},_getOrCreatePlayer:function(d){e[d]||(e[d]={isCollapsed:false,largestHeight:25,smallestHeight:25});return e[d]},handlePageRefresh:function(){var d=a.Page;this._subOnOff(function(f){try{dojo.query("div [ data-widget-playerid]");var g=true;dojo.forEach(dojo.query("div [ data-widget-playerid]"),function(k){k=dj.util.Element.getData(k,"widget-playerid");if(k!==undefined&&k!==null&&k!==""&&k.indexOf(f)===-1)g=false});g&&d.enableRefresh()}catch(h){console.log("Error while enabling the page refresh"+h);d.enableRefresh()}},function(){d.disableRefresh()})},handleModuleRefresh:function(d,f){f=f==null?"refresh":f;this._subOnOff(function(g){var h=null,k=dojo.byId(g);if(k==null)try{if(navigator.appVersion.indexOf("MSIE 7.")!==-1){var l=dojo.query("."+f);dojo.some(l,function(n){var s=dj.util.Element.getData(n,"widget-playerid");if(s!=null&&s.indexOf(g)!==-1){k=n;return false}})}else k=dojo.query('object param[ value*= "'+g+'"]')[0]}catch(m){}if(k!=null)for(;k.parentNode!=null;){k=k.parentNode;if(dojo.hasClass(k,f)){h=k;break}}if(h!=null){l=null;try{l=dj.util.Element.getData(h,"widget-playerid")}catch(q){}if(l==null||l===""){b.enableModuleRefresh(h.id);dj.module[h.id+"_updater"]&&dj.module[h.id+"_updater"].start()}else if(l.indexOf("||||")===-1&&l==="||"+g+"||"){dojo.attr(h,"data-widget-playerid","");b.enableModuleRefresh(h.id);dj.module[h.id+"_updater"]&&dj.module[h.id+"_updater"].start()}else if(l.indexOf("||||")!==-1){l=l.replace("||"+g+"||","");dojo.attr(h,"data-widget-playerid",l)}}else{b.enableModuleRefresh(d);dj.module[d+"_updater"]&&dj.module[d+"_updater"].start()}},function(g){var h=null,k=dojo.byId(g);if(k==null)try{if(navigator.appVersion.indexOf("MSIE 7.")!==-1){var l=dojo.query("object param");dojo.some(l,function(n){if(n.value!=null&&n.value!=undefined)if(n.value.indexOf(g)!==-1){k=n;return false}})}else k=dojo.query('object param[ value*= "'+g+'"]')[0]}catch(m){}if(k!=null)for(;k.parentNode!=null;){k=k.parentNode;if(dojo.hasClass(k,f)){h=k;break}}if(h!=null){b.disableModuleRefresh(h.id);l=null;try{l=dj.util.Element.getData(h,"widget-playerid")}catch(q){}if(l==null||l==="")dojo.attr(h,"data-widget-playerid","||"+g+"||");else l.indexOf(g)===-1&&dojo.attr(h,"data-widget-playerid",l+"||"+g+"||")}else b.disableModuleRefresh(d)})},handleVideoPlayer:function(){this.subscribe("collapsePlayer",this._collapsePlayerCallback,this);this.subscribe("expandPlayer",this._expandPlayerCallback,this)},_getPlayerAndUpdateHeights:function(d){var f=this._getOrCreatePlayer(d);f.node=dojo.byId(d);f.largestHeight=f.node.height>f.largestHeight?f.node.height:f.largestHeight;f.smallestHeight=f.node.height<f.smallestHeight?f.node.height:f.smallestHeight;return f},_collapsePlayerCallback:function(d){var f=this._getPlayerAndUpdateHeights(d);if(!f.isCollapsed){f.isCollapsed=true;var g=dj.util.Query.up(f.node,"div");g!==dojo.doc&&dojo.style(g,{width:"",height:""});dojo.anim(f.node,{height:{end:f.smallestHeight}});a.Cookie.setGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+d,"yes",1/24)}},_expandPlayerCallback:function(d){var f=this._getPlayerAndUpdateHeights(d);if(f.isCollapsed){f.isCollapsed=false;dojo.anim(f.node,{height:{end:f.largestHeight}});a.Cookie.deleteGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+d)}},handleNewsHubPageRefresh:function(){this.subscribe("stopVideo",function(){location.pathname=location.pathname},this)},_subOnOff:function(d,f){this.subscribe("unpauseVideo",f,this);this.subscribe("pauseVideo",f,this);this.subscribe("playVideo",f,this);this.subscribe("getSeek",f,this);this.subscribe("stopVideo",d,this)},formatduration:function(d){var f=Math.floor(d/60);d=d%60;if(d<10)d="0"+d;return""+f+":"+d},getVideoDetails:function(d){if(!d.id)return"No Id.";var f="/api-video/get_video_info.asp?guid="+d.id;f+=d.fields?"&fields="+d.fields:"&fields=all";dojo.getObject("dj.util.Video.jsonData",true);dj.util.Video.getVideoData(f,{context:this,handleAs:"json",sync:true,responseType:"application/json",callback:function(g){a.Video.handleGetVideoDetails(g,d.id)},errorCallback:function(){console.error("Failed while executing util.Video.getVideoDetails")}});return a.Video.jsonData[d.id]},handleGetVideoDetails:function(d,f){a.Video.jsonData[f]=d},getVideoData:function(d,f){f.responseType=!f.responseType?"text/xml":f.responseType;var g=f.responseType.indexOf("json")>-1;this._sendXhrRequest(d,f,{requestMethod:"GET",handleAs:g?"json":"xml",appendCacheBuster:true,requestHeaders:{Accept:f.responseType},sync:f.sync?true:false})},postVideoData:function(d,f,g){this._sendXhrRequest(d,g,{requestMethod:"POST",content:dojo.toJson(f),requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":"application/json"},sync:g.sync?true:false})},putVideoData:function(d,f,g){this._sendXhrRequest(d,g,{requestMethod:"PUT",content:dojo.toJson(f),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"},sync:g.sync?true:false})},deleteDashboardData:function(d,f,g){this._sendXhrRequest(d,g,{requestMethod:"POST",content:dojo.toJson(f),requestHeaders:{"X-HTTP-Method-Override":"DELETE","Content-Type":"application/json"},sync:g.sync?true:false})},_sendXhrRequest:function(d,f,g){var h=dj.lang.cloneMixin({callback:function(){}},f);f=dj.lang.cloneMixin({requestHeaders:{Accept:"application/json"},handleAs:"json",appendCacheBuster:false,sync:false},g);if(f.appendCacheBuster)d=this._appendCacheBuster(d);return this._getRequestByMethod(f.requestMethod)({url:d,headers:f.requestHeaders,handleAs:f.handleAs,postData:f.content,sync:f.sync,load:function(k,l){h.context?h.callback.apply(h.context,[k,l.xhr,h]):h.callback.apply(this,[k,l.xhr,h])},error:function(k,l){console.error("HTTP status code: %s, response: %o",l.xhr.status,data);typeof h.errorCallback!=="undefined"?h.errorCallback.apply(h.context,[l.xhr.status,l.xhr,h]):h.callback.apply(h.context,[l.xhr.status,l.xhr,h])}})},_appendCacheBuster:function(d){var f=Math.floor(1E7*Math.random());d+=d.indexOf("?")>-1?"&cb="+f:"?cb="+f;return d},_getRequestByMethod:function(d){return d=="GET"?dojo.xhrGet:dojo.xhrPost},getUrlParam:function(d,f){f=f.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var g=RegExp("[\\?&]"+f+"=([^&#]*)").exec(d);return g===null?"":g[1]},nonSupportingFlashPlayer:function(d){dojo.byId(d).innerHTML="<p>This content can not be displayed because your browser does not support the Adobe Flash player required to view it.</p>"},omnitureEncoding:function(d,f,g){if(d=="News"){if(f=="Politics"&&g=="s")return"Politics & Campaign";if(!this.isNotBlankOrNull(f)&&g=="c")return"US";if(!this.isNotBlankOrNull(f)&&g=="s")return"US"}if(d=="Management"){if(!this.isNotBlankOrNull(f)&&g=="c")return"Business";if(!this.isNotBlankOrNull(f)&&g=="s")return"Management";if(f=="Business Insight"&&g=="c")return"Business";if(f=="Business Insight"&&g=="s")return"Business Insight";return"Business"}if(d=="Lifestyle")return"Life & Style";if(d=="Special Packages"){if(f=="Journal Reports"&&g=="c")return"Special";if(f=="Journal Reports"&&g=="s")return"In-Depth Reports";if(f=="Journal Women"&&g=="c")return"Careers";if(f=="Journal Women"&&g=="s")return"Journal Women"}if(g=="s"&&!this.isNotBlankOrNull(f))return d;if(g=="s")return f;if(g=="c")return d},isNotBlankOrNull:function(d){return d!==""&&d!==null&&typeof d!="undefined"},setupConfig:function(){var d={};d.emailURL="http://www.emailthis.clickability.com/et/emailThis?clickMap=create&fb=Y&url=@VIDEO_LINK_URL&title=@VIDEO_TITLE&random=@RANDOM_NUMBER&partnerID=@EMAIL_PARTNER_ID&image=@VIDEO_STILL_URL&expire=&summary=@VIDEO_DESCRIPTION";d.domainName="wsj";d.embedConfigURL="http://wsj.vo.llnwd.net/o28/players/";d.popUpPageUrl="/public/page/video-popup.html";if(dj.context.videoCenter.popUpPageURL)d.popUpPageUrl=dj.context.videoCenter.popUpPageURL;var f=this.getUrlParam(window.location.href,"site"),g="";try{g=dj.context.videoCenter.host}catch(h){console.error("Error while getting site value from context. "+h.message)}d.site=this.isNotBlankOrNull(f)?f:g;d.msrc=this.getUrlParam(window.location.href,"msrc");d.playFromRegisteredVideos=false;d.pageSize=12;d.browsingGroup="collection";d.playingGroup="collection";d.skipCollection=true;d.prop24="";d.prop25="";d.prop27="";try{if(typeof setEdition==="function")d.prop24=setEdition(dj.util.Region.getViewByRegion())}catch(k){console.error("cookie read error while fetching prop24 : "+k)}try{d.prop25=dj.util.Cookie.getCookie("TR")}catch(l){console.error("cookie read error while fetching prop25 : "+l)}try{d.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(m){console.error("cookie read error while fetching cookieUserType : "+
m)}try{dj.util.User.isLoggedIn(function(n){if(n)dj.util.User.isSubLoggedIn(function(s){d.prop27=s?"WSJ_sub_yes":"WSJ_mem_yes"});else d.prop27=d.cookieUserType===null||d.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(q){console.error("cookie read error while fetching prop27")}return d}}})();dojo.provide("dj.util.VideoTracking");dojo.require("dj.util.VideoUtils");dojo.require("dj.util.Tracking");dj.util.VideoTracking={init:function(){if(typeof this.omniture!=="object")this.omniture=dj.util.Tracking.omniture},fire:function(a){try{this.init();var b=this._getOmnitureObject(a),c=this._getCurrentOmnitureObject(b);this._setOmnitureData(b);this._firePixel();this._setOmnitureData(c)}catch(e){console.error("{VideoTracking} ",e)}},_getOmnitureObject:function(a){var b=a.appName.toUpperCase(),c=function(e){return b+"_"+e.join("_")};return{pageName:c(["Video",a.name]),section:"Video",subsection:c([a.section]),atype:c(["Video_Video",a.section]),apage:c(["Video_Video",a.subsection]),aheadline:"video_"+a.name,basesection:c([a.subsection]),abasedocid:a.id,ctype:a.appType,csource:a.provider+" video",caccess:"free",qsymbol:a.adZone}},_getCurrentOmnitureObject:function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c))b[c]=this.omniture.getMetaData(c);return b},_setOmnitureData:function(a){for(var b in a)a.hasOwnProperty(b)&&this.omniture.setMetaData(b,a[b])},_firePixel:function(){this.omniture.firePixel(true)}};dojo.provide("dj.module.videoModule");dojo.require("dj.lang");dojo.require("dj.util.Video");dojo.require("dj.widget.panels.PanelsFactory");dj.module.videoModule={init:function(a){this.cfg=dj.lang.deepMixin({videoModuleContainerId:"videoModule",autonomyVideoClassName:"autonomy_video"},a);a=dojo.byId(this.cfg.videoModuleContainerId);if(a===null)console.log("{VideoModule} is undefined.");else{dojo.hasClass(a,this.cfg.autonomyVideoClassName)&&this._setupAutonomyVideo(a);this._setupVideo(a)}},_setupVideo:function(a){this.panels=dj.widget.panels.PanelsFactory.create(a,{core:{},carousel:{}})},_setupAutonomyVideo:function(a){a=dojo.query(".preview",a);for(var b=null,c=0,e=a.length;c<e;c++){var d=a[c];b=d.id;b=b.split(":")[1].replace(/_/g,"-");b=dj.util.Video.getVideoDetails({id:b,fields:"thumbnailURLSmall"});if(b!=="undefined"){var f="url("+b.thumbnailURLSmall+")";if(f!==null)d.style.backgroundImage=f}else{console.log("getSmallThumnailURL is "+f);d.style.backgroundImage="/img/bb/BB_DBlogo.gif"}}}};dojo.provide("dj.widget.video.VideoCenter");dojo.require("dj.lang");dojo.require("dj.util.Ads");dojo.require("dj.util.Cookie");dojo.require("dj.util.Omniture");dojo.require("dj.util.Region");dojo.require("dj.util.Tracking");dojo.require("dj.util.User");dojo.require("dj.util.Video");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.getObject("dj.context.video",true);dojo.declare("dj.widget.video.VideoCenter",null,{constructor:function(a,b){this.version="1.0.2";this.videoUtil=dj.util.Video;this.usrActnHash={"":this.handleResponse,toBrowse:this.handleBrowsingResults,toSearch:this.handleSearchResults,current:this.handleCurrent,next:this.handleNext};this.microPlayers=[];this.microPlayersObjects={};this.videoIdMicroPlayerIdMap={};this.popUpWindow="";this.flashPlayerPath=dj.context.core.cdnPrefix+"/media/swf/";this.collectionsXMLPath="/static_html_files/";this.videoCenterPageUrl="/video-center";this.popUpPageUrl="/public/page/video-popup.html";this.objName=b;this.videoPlayerDivId="video_player";this.sideNavUlId="video_sidenav";this.topNavUlId="video_topnav";this.nextVideoDivId="next_video";this.videoResultsDivId="video_results";this.searchDivId="video_search";this.advertisementDivId="advertisement";this.collectionsSelectId="collectionsSelectId";this.videoSummaryDivId="video_headline";this.registeredVideosDivId="registered_videos";if(this.videoUtil.isNotBlankOrNull(a)){this.videoPlayerDivId=a.videoPlayerDivId?a.videoPlayerDivId:"video_player";this.sideNavUlId=a.sideNavUlId?a.sideNavUlId:"video_sidenav";this.topNavUlId=a.topNavUlId?a.topNavUlId:"video_topnav";this.nextVideoDivId=a.nextVideoDivId?a.nextVideoDivId:"next_video";this.videoResultsDivId=a.videoResultsDivId?a.videoResultsDivId:"video_results";this.searchDivId=a.searchDivId?a.searchDivId:"video_search";this.advertisementDivId=a.advertisementDivId?a.advertisementDivId:"advertisement";this.videoSummaryDivId=a.videoSummaryDivId?a.videoSummaryDivId:"video_headline";this.registeredVideosDivId=a.registeredVideosDivId?a.registeredVideosDivId:""}this.xmlDoc="";this.defaultCollectionName="News";this.rssUrlsObject={};this.contentUrlsObject={};this.collectionNamesArray=[];this.subcollectionsObject={};this.urlKeysCollectionMap={};this.urlKeysSubCollectionMap={};this.currentlyPlayingVideoId="";this.currentlyPlayingVideoIds=[];this.visibleSubCollectionId=this.visibleCollectionId=this.nextVideoId=this.currentlyPlayingSubCollection=this.currentlyPlayingCollection="";this.sortOrder="relevancy";this.currentSearchText="";this.isVideoResultsInSideNav=false;this.currentPlayingJsonObject={};this.currentBrowsingJsonObject={};this.currentSearchJsonObject={};this.currentVideoDetailsJsonObject={};this.nextVideoDetailsJsonObject={};this.registeredVideos=[];this.registeredVideosIds=[];this.cookieUserType=this.bookMarkedLocation=this.bookMarkedId=this.sourceApplicationName=this.userAction=this.relatedVideosCollection="";dj.lang.mixin(this,this.videoUtil.setupConfig())},loadVideo:function(a,b,c){console.info("video.js v"+this.version);if(this.videoUtil.isNotBlankOrNull(c))this.domainName=c;this.sourceApplicationName=b;if(this.videoUtil.isNotBlankOrNull(a))this.currentlyPlayingVideoId=a.indexOf("{")==-1?"{"+a+"}":a;swfobject.getFlashPlayerVersion().major>=9?this.createFlashPlayer():dj.util.Video.nonSupportingFlashPlayer(this.videoPlayerDivId)},continueLoadVideo:function(){this.loadCollectionsDoc(this,this.handleLoadVideo)},handleLoadVideo:function(a,b){this.xmlDoc=b.responseXML.documentElement;this.parseInformationFromXmlDoc();if(this.sourceApplicationName=="articlePage"){var c=this.visibleCollectionId="";if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingVideoId))c=this.registeredVideos[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)];else if(this.videoUtil.isNotBlankOrNull(this.bookMarkedId)){this.currentlyPlayingVideoId=this.bookMarkedId;c=this.registeredVideos[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)];c.seekTime=this.bookMarkedLocation}else{c=this.registeredVideos[0];this.currentlyPlayingVideoId=c.id}this.playVideoByParam(c);this.relatedVideosCollection=this.videoUtil.isNotBlankOrNull(this.registeredVideos[0]["wsj-section"])?this.registeredVideos[0]["wsj-section"]:this.defaultCollectionName;this.currentlyPlayingCollection=this.registeredVideos[0]["wsj-section"];if(this.currentlyPlayingCollection=="Lifestyle")this.currentlyPlayingCollection="Life & Style";this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",this,this.finishHandleLoadVideo)}else{if(typeof AT_VARS!="undefined"&&AT_VARS.baseDocId)this.currentlyPlayingVideoId="{"+AT_VARS.baseDocId+"}";if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingVideoId)){this.playVideoByVideoId(this.currentlyPlayingVideoId);this.currentlyPlayingCollection=this.currentVideoDetailsJsonObject["wsj-section"];this.currentlyPlayingSubCollection=this.currentVideoDetailsJsonObject["wsj-subsection"];if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.currentlyPlayingCollection=this.visibleCollectionId=this.collectionNameForSubcollection(this.currentlyPlayingSubCollection);this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingSubCollection])+"&count=60","",this,this.finishHandleLoadVideo)}else{if(!this.videoUtil.isNotBlankOrNull(this.currentlyPlayingCollection))this.currentlyPlayingCollection=this.defaultCollectionName;this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",this,this.finishHandleLoadVideo)}}else{c=window.location.pathname;this.currentlyPlayingCollection=this.defaultCollectionName;if(c.indexOf(".")!=-1){c=c.split(".")[0].split("/").pop();if(this.urlKeysCollectionMap[c])this.currentlyPlayingCollection=this.urlKeysCollectionMap[c];if(this.urlKeysSubCollectionMap[c]){this.currentlyPlayingSubCollection=this.urlKeysSubCollectionMap[c];this.currentlyPlayingCollection=this.visibleCollectionId=this.collectionNameForSubcollection(this.currentlyPlayingSubCollection)}}c=dojo.hitch(this,function(){this.currentlyPlayingVideoId=this.currentPlayingJsonObject.items[0].id;this.playVideoByVideoId(this.currentlyPlayingVideoId);this.finishHandleLoadVideo()});this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingSubCollection])+"&count=60","",null,c):this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",null,c)}}},finishHandleLoadVideo:function(){this.populateSideNav();this.populateTopNav();if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.updateSideNavAppearance("subcollection",this.currentlyPlayingSubCollection);this.visibleSubCollectionId=this.currentlyPlayingSubCollection;this.playingGroup=this.browsingGroup="subcollection"}else{this.updateSideNavAppearance("collection",this.currentlyPlayingCollection);this.visibleCollectionId=this.currentlyPlayingCollection}this.currentBrowsingJsonObject=this.currentPlayingJsonObject;if(this.sourceApplicationName=="articlePage"&&this.registeredVideosIds.length>0){this.createRegisteredVideosThumbnails();this.updateVideoThumbnailVisual("","reg"+this.currentlyPlayingVideoId)}this.updateTopNavAppearance("",this.currentlyPlayingCollection);this.createNextVideo();this.createSearch();this.createAdvertisementFramework();this.populateMoreVideos(1);this.loadPagination(1);this.updateRssFeed(this.visibleSubCollectionId!==""?this.visibleSubCollectionId:this.visibleCollectionId)},validateContentUrl:function(a){if(this.videoUtil.isNotBlankOrNull(a))return a;else{this.currentlyPlayingCollection=this.defaultCollectionName;return this.contentUrlsObject[this.defaultCollectionName]}},createAdvertisementFramework:function(){if(this.advertisementDivId)if(swfobject.getFlashPlayerVersion().major>=9){var a={w:"336",h:"280"};swfobject.embedSWF(this.flashPlayerPath+"adPlayer.swf",this.advertisementDivId,a.w,a.h,"9.0.0","",{objName:this.getName(),movieWidth:a.w,movieHeight:a.h,host:location.host},{allowscriptaccess:"always",wmode:"opaque"},{})}else dj.util.Video.nonSupportingFlashPlayer(this.advertisementDivId)},collectionNameForSubcollection:function(a){for(var b=0,c=this.collectionNamesArray.length;b<c;++b)if(this.subcollectionsObject[this.collectionNamesArray[b]].indexOf(a)!=-1)return this.collectionNamesArray[b]},pauseMicroPlayers:function(){try{for(var a=0,b=this.microPlayers.length;a<b;++a)swfobject.getObjectById(this.microPlayers[a]).pauseVideo()}catch(c){console.error("Error while pausing microPlayers. "+c.message)}},setBookMark:function(){try{this.bookMarkedId=this.currentlyPlayingVideoId;this.bookMarkedLocation=Math.floor(swfobject.getObjectById("flashPlayer").getSeek());swfobject.getObjectById("flashPlayer").pauseVideo()}catch(a){console.error("Error while setting the bookmark. "+a.message)}},updateVideoThumbnailVisual:function(a,b){if(a!==""&&dojo.byId("li_"+a))dojo.byId("li_"+a).className="";if(b!==""&&dojo.byId("li_"+b))dojo.byId("li_"+b).className="nowPlaying"},parseInformationFromXmlDoc:function(){for(var a=this.xmlDoc.getElementsByTagName("collection"),b=0,c=a.length;b<c;++b){var e=a[b];this.urlKeysCollectionMap[e.getAttribute("urlkey")]=e.getAttribute("name");this.contentUrlsObject[e.getAttribute("name")]=e.getAttribute("contenturl");this.rssUrlsObject[e.getAttribute("name")]=e.getAttribute("rssurl");this.collectionNamesArray[this.collectionNamesArray.length]=e.getAttribute("name");for(var d=e.getElementsByTagName("subcollection"),f=[],g=0,h=d.length;g<h;++g){var k=d[g];this.urlKeysSubCollectionMap[k.getAttribute("urlkey")]=k.getAttribute("name");this.contentUrlsObject[k.getAttribute("name")]=k.getAttribute("contenturl");this.rssUrlsObject[k.getAttribute("name")]=k.getAttribute("rssurl");f[g]=k.getAttribute("name")}this.subcollectionsObject[e.getAttribute("name")]=f}},createFlashPlayer:function(){if(dojo.byId(this.videoPlayerDivId))try{var a={w:"512",h:"363"};swfobject.embedSWF(this.flashPlayerPath+"main.swf",this.videoPlayerDivId,a.w,a.h,"9.0.0","",{objName:this.getName(),allowPlayerPopup:"1",plyMediaEnabled:"1",movieWidth:a.w,movieHeight:a.h,host:location.host},{allowscriptaccess:"always",wmode:"opaque"},{id:"flashPlayer"})}catch(b){console.error("Error occured createFlashPlayer.."+
b.message);dojo.byId(this.videoPlayerDivId).innerHTML="Couldn't load the flash player. \n Error message is: "+b.message}},convertCurrentPlayingJsonToIdsArray:function(){this.currentlyPlayingVideoIds=[];if(this.currentPlayingJsonObject.items.length>0)for(var a=0,b=this.currentPlayingJsonObject.items.length;a<b;++a)this.currentlyPlayingVideoIds[a]=this.currentPlayingJsonObject.items[a].id},populateVideoSummary:function(a,b,c){if(dojo.byId(this.videoSummaryDivId)){var e="";try{e+="<h2>"+a+" <small>"+
c.split(" ")[0]+"</small>";e+="</h2>";e+="<p>"+b+"</p>"}catch(d){console.error("Error occured in populateVideoSummary."+d.message);e+="Couldn't get video summary."}dojo.byId(this.videoSummaryDivId).innerHTML=e}},createAdvertisement:function(a,b){try{swfobject.getObjectById(this.advertisementDivId).loadAd(a,b)}catch(c){console.error("Error while loading ad in createAdvertisement : "+c)}},createNextVideo:function(){var a="Loading...";try{this.nextVideoId=this.getNextVideoId();if(this.nextVideoId!=="")this.getVideos("/api-video/get_video_info.asp?guid="+this.nextVideoId+"&fields=all","next");else a="No more videos."}catch(b){console.error("Error occured while executing createNextVideo() - "+b.message);a+="Couldn't determine next video details."}if(dojo.byId(this.nextVideoDivId))dojo.byId(this.nextVideoDivId).innerHTML=a},populateNextVideo:function(){var a="";try{var b=this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.currentlyPlayingSubCollection:this.currentlyPlayingCollection;a+=this.currentlyPlayingCollection=="Search Results"?"<h3>Next in Video "+this.currentlyPlayingCollection+"</h3>":"<h3>Next in "+b+" Video</h3>";a+='<ul class="newsItem video">';a+="<li>";a+='<a href="javascript:'+this.getName()+".nextVideoThumbnailClicked('"+this.nextVideoDetailsJsonObject.id+'\')" style="background-image: url('+this.nextVideoDetailsJsonObject.thumbnailURL+')" class="preview"><span>&nbsp;</span></a>';a+='<h2><a href="javascript:'+this.getName()+".nextVideoThumbnailClicked('"+this.nextVideoDetailsJsonObject.id+"')\">"+this.nextVideoDetailsJsonObject.name+"</a></h2>";var c=Math.floor(this.nextVideoDetailsJsonObject.duration/60),e=this.nextVideoDetailsJsonObject.duration%60;if(e<10)e="0"+e;a+="<small>"+c+":"+e+"</small>";a+="<p>"+this.nextVideoDetailsJsonObject.description+"</p>";a+="</li>";a+="</ul>"}catch(d){console.error("Error occured while executing populateNextVideo() - "+d.message);a+="Couldn't populate next video details."}if(dojo.byId(this.nextVideoDivId))dojo.byId(this.nextVideoDivId).innerHTML=a},nextVideoThumbnailClicked:function(a){this.userAction="";this.populateMoreVideos(1);this.loadPagination(1);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,a);this.currentlyPlayingVideoId=a;this.playVideoByVideoId(a);this.createNextVideo();this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.updateSideNavAppearance("subcollection",this.currentlyPlayingSubCollection):this.updateSideNavAppearance("collection",this.currentlyPlayingCollection)},createSearch:function(){var a="";a+='<form id="searchForm" onSubmit="javascript:'+this.getName()+'.searchButtonClicked();return false;" class="" method="post" accept-charset="utf-8">';a+="<fieldset>";a+="<legend>Search Videos</legend>";a+='<div class="ctl">';a+='<label for="frmSearchSectCtl01">Search Videos</label>';a+='<input type="text" name="frmSearchSectCtl01" value="Search Video" id="frmSearchSectCtl01" class="text" onFocus="'+this.getName()+'.searchInputBoxFocused();"/>';a+="</div>";a+='<div class="ctl">';a+='<label for="frmSearchSectSub">Search</label>';a+='<button id="searchButton" type="submit">Search</button>';a+="</div>";a+="</fieldset>";a+="</form>";if(dojo.byId(this.searchDivId))dojo.byId(this.searchDivId).innerHTML=a},searchInputBoxFocused:function(){dojo.byId("frmSearchSectCtl01").value="";dojo.byId("searchForm").className=""},searchButtonClicked:function(){var a=dojo.byId("frmSearchSectCtl01").value.replace(/^\s+|\s+$/,"");if(a===""){dojo.byId("searchForm").className="search_error";dojo.byId("frmSearchSectCtl01").value="Please enter search terms";dojo.byId("searchButton").focus();return false}this.currentSearchText=a;this.sortOrder="relevancy";if(!this.isVideoResultsInSideNav){this.insertVideoResultsInSideNav();this.isVideoResultsInSideNav=true}this.updateVideoResultsInSideNav(this.currentSearchText);this.updateSideNavAppearance("collection","Search Results");this.performSearch("/api-video/find_all_videos.asp?type=wsj-fulltext&query="+a);dojo.byId("searchButton").focus()},insertVideoResultsInSideNav:function(){var a="";a+='<li id="Search Results" class="noSubCollection">';a+="</li>";a+=dojo.byId(this.sideNavUlId).innerHTML;dojo.byId(this.sideNavUlId).innerHTML=a},updateVideoResultsInSideNav:function(a){this.contentUrlsObject["Search Results"]="/api-video/find_all_videos.asp?type=wsj-fulltext&query="+a+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection";a="";a+='<a id="a_Search Results" class="" href="javascript:'+this.getName()+".sideNavClicked('collection','Search Results');\">";a+="Search Results</a>";dojo.byId("Search Results").innerHTML=a},performSearch:function(a){this.userAction="toSearch";dojo.byId(this.videoResultsDivId).innerHTML='<p class="noResults"> Loading ... </p>';this.getVideos(a+"&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection&count=60",this.userAction)},loadPagination:function(a){var b="";if(this.userAction=="toBrowse"){if(typeof this.currentBrowsingJsonObject!="undefined")b=this.currentBrowsingJsonObject.items}else if(this.userAction=="toSearch"){if(typeof this.currentSearchJsonObject!="undefined")b=this.currentSearchJsonObject.items}else b=this.currentPlayingJsonObject.items;a=Number(a);b=Math.max(Math.floor(b.length/this.pageSize),Math.ceil(b.length/this.pageSize));var c="";c+=a==1?'<li id="previous" class="listFirst"><span>Previous</span></li>':'<li id="previous" class="listFirst"><a href="javascript:'+this.getName()+".paginationClicked('"+(a-1)+"')\">Previous</a></li>";for(var e=1;e<=b;e++)c+=a==e?"<li><span>"+e+"</span></li>":'<li><a href="javascript:'+this.getName()+".paginationClicked('"+
e+"')\" >"+e+"</a></li>";c+=a>=b?'<li id="next"><span>Next</span></li>':'<li id="next"><a href="javascript:'+this.getName()+".paginationClicked('"+(a+1)+"')\">Next</a></li>";dojo.byId("pagination").innerHTML=c},paginationClicked:function(a){this.populateMoreVideos(a);this.loadPagination(a);this.updateRssFeed(this.visibleSubCollectionId!==""?this.visibleSubCollectionId:this.visibleCollectionId)},getVideos:function(a,b,c,e){var d=dojo.hitch(this,function(g,h,k,l,m){setTimeout(this.getVideos(h,k,l,m,g),1E4)}),f=this;dj.util.Video.getVideoData(a,{handleAs:"json",responseType:"application/json",callback:function(g){f.usrActnHash[b].apply(f,[g]);if(e)c?e.apply(c):e()},errorCallback:function(g){console.warn("faled to getVideos:"+g+", fetching "+a);d(g,a,b,c,e)}})},handleResponse:function(a){this.currentPlayingJsonObject=a;this.convertCurrentPlayingJsonToIdsArray()},handleBrowsingResults:function(a){this.currentBrowsingJsonObject=a;this.populateMoreVideos(1);this.loadPagination(1);this.updateRssFeed(this.visibleSubCollectionId!==""?this.visibleSubCollectionId:this.visibleCollectionId)},handleSearchResults:function(a){this.currentSearchJsonObject=a;this.populateMoreVideos(1);this.loadPagination(1)},handleCurrent:function(a){this.currentVideoDetailsJsonObject=a;this.currentlyPlayingCollection=this.currentVideoDetailsJsonObject["wsj-section"];this.currentlyPlayingSubCollection=this.currentVideoDetailsJsonObject["wsj-subsection"];this.playVideoByParam(this.currentVideoDetailsJsonObject);this.populateVideoSummary(this.currentVideoDetailsJsonObject.name,this.currentVideoDetailsJsonObject.description,this.currentVideoDetailsJsonObject.formattedCreationDate)},handleNext:function(a){this.nextVideoDetailsJsonObject=a;this.populateNextVideo()},populateSideNav:function(){for(var a="",b=this.xmlDoc.getElementsByTagName("collection"),c=0,e=b.length;c<e;++c){var d=b[c],f=d.getElementsByTagName("subcollection"),g=f.length;a+=g>0?'<li class="expand" id="'+d.getAttribute("name")+'"><a id="a_'+d.getAttribute("name")+'" class="" href="javascript:'+this.getName()+".sideNavClicked('"+d.nodeName+"','"+d.getAttribute("name")+"');\">"+d.getAttribute("name")+"</a>":'<li class="noSubCollection" id="'+d.getAttribute("name")+'"><a id="a_'+d.getAttribute("name")+'" class="" href="javascript:'+this.getName()+".sideNavClicked('"+d.nodeName+"','"+d.getAttribute("name")+"');\">"+d.getAttribute("name")+"</a>";if(g>0){a+="<ul id=Sub"+d.getAttribute("name")+">";d=0;for(g=f.length;d<g;++d){var h=f[d];a+='<li><a id="a_'+h.getAttribute("name")+'" class="current" href="javascript:'+
this.getName()+".sideNavClicked('"+h.nodeName+"','"+h.getAttribute("name")+"');\">"+h.getAttribute("name")+"</a></li>"}a+="</ul>"}a+="</li>"}dojo.byId(this.sideNavUlId).innerHTML=a},populateTopNav:function(){if(dojo.byId(this.topNavUlId)){for(var a="",b=this.xmlDoc.getElementsByTagName("collection"),c=0,e=b.length;c<e;++c){var d=b[c],f=d.getAttribute("name");if(f!="Most Popular Today"&&f!="Management"&&f!="Special Packages"){var g=f;g="navlink_"+g.toLowerCase().replace(/\s+/g,"_");a+=c=="1"?'<li class="listFirst">':"<li>";a+="<a class="+g+' id="a_topnav_'+f+'" href="javascript:'+this.getName()+".topNavClicked('"+d.nodeName+"','"+f+"');\">"+f+"</a>";a+="</li>"}}dojo.byId(this.topNavUlId).innerHTML=a}},topNavClicked:function(a,b){this.userAction="";this.updateSideNavAppearance(a,b);this.updateTopNavAppearance(a,b);this.currentlyPlayingCollection=b;this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+"&count=60","",this,this.handleTopNavGetVideos)},handleTopNavGetVideos:function(){this.visibleCollectionId=this.currentlyPlayingCollection;this.currentBrowsingJsonObject=this.currentPlayingJsonObject;this.currentlyPlayingVideoId=this.currentPlayingJsonObject.items[0].id;this.playVideoByVideoId(this.currentlyPlayingVideoId);this.populateMoreVideos(1);this.loadPagination(1);this.playingGroup=this.browsingGroup="collection";this.createNextVideo()},updateTopNavAppearance:function(a,b){var c=this.currentlyPlayingCollection;if(c=="Lifestyle")c="Life & Style";if(dojo.byId("a_topnav_"+c)){var e=dojo.byId("a_topnav_"+
c).className.replace("selected ","");dojo.byId("a_topnav_"+c).className=e}if(dojo.byId("a_topnav_"+b)){c="selected navlink_"+b.toLowerCase().replace(/\s+/g,"_");dojo.byId("a_topnav_"+b).className=c}},sideNavClicked:function(a,b){this.userAction="";if(this.videoUtil.isNotBlankOrNull(this.contentUrlsObject[b])){this.browsingGroup=a;if(b=="Search Results"){this.userAction="toSearch";this.sortOrder="relevancy"}else if(a=="subcollection"&&b!=this.currentlyPlayingSubCollection||a=="collection"&&b!=this.currentlyPlayingCollection)this.userAction="toBrowse";this.updateSideNavAppearance(a,b);dojo.byId(this.videoResultsDivId).innerHTML='<p class="noResults"> Loading ... </p>';if(this.videoUtil.isNotBlankOrNull(this.userAction))this.getVideos(this.contentUrlsObject[b]+"&count=60",this.userAction);else{this.populateMoreVideos(1);this.loadPagination(1)}}else this.updateSideNavAppearance(a,b)},searchLinkClicked:function(a,b){this.sortOrder=b;this.performSearch(a)},populateMoreVideos:function(a){var b="";if(this.userAction=="toBrowse"){if(typeof this.currentBrowsingJsonObject!="undefined")b=this.currentBrowsingJsonObject.items}else if(this.userAction=="toSearch"){if(typeof this.currentSearchJsonObject!="undefined")b=this.currentSearchJsonObject.items}else b=this.currentPlayingJsonObject.items;var c=(a-1)*12,e=Math.min(a*12-1,b.length-1);a="";if(this.userAction=="toSearch"&&b.length>0){a+='<ul class="sort"><li class="listFirst">Sort by:</li>';var d="/api-video/find_all_videos.asp?type=wsj-fulltext&query="+this.currentSearchText;if(this.sortOrder=="relevancy"){a+='<li class="selected"><span>relevance</span></li>';a+='<li class="listLast"><a href="javascript:'+this.getName()+".searchLinkClicked('"+d+"&sort=date+desc','date')\">Date</a></li>"}else{a+='<li><a href="javascript:'+this.getName()+".searchLinkClicked('"+d+"&sort=relevancy','relevancy')\">Relevance</a></li>";a+='<li class="listLast selected"><span>Date</span></li>'}a+="</ul>";a+='<p class="resultsLabel">'+(c+1)+" - "+(e+1)+" results out of "+b.length+" for: "+this.currentSearchText+"</p>"}if(this.userAction=="toSearch"&&b.length===0){a+='<p class="noResults"> No content matches your search terms. Please try again. </p>';dojo.byId(this.videoResultsDivId).innerHTML=a;return false}a+='<ul class="newsItem video videoListMed">';for(c=c;c<e+1;c++){d=b[c];a+='<li id="li_'+d.id+'" class="">';a+='<a href="javascript:'+this.getName()+".videoThumbnailClicked('"+d.id+'\')" id="'+d.id+'" style="background-image: url('+unescape(d.thumbnailURL)+');" class="preview"><span>&nbsp;</span></a>';a+='<h2><a href="javascript:'+this.getName()+".videoThumbnailClicked('"+d.id+"')\">"+d.name+"</a></h2>";var f=Math.floor(d.duration/60),g=d.duration%60;if(g<10)g="0"+g;a+="<small>"+f+":"+g+"</small>";if(this.videoUtil.isNotBlankOrNull(d.formattedCreationDate))a+="<small> "+d.formattedCreationDate.split(" ")[0]+"</small>";a+="</li>";if((c+1)%4===0)a+='<li class="rowEnd"></li>'}a+="</ul>";a+='<ul id="pagination" class="pagination">';a+="</ul>";if(this.userAction!="toSearch"){b=this.videoUtil.isNotBlankOrNull(this.visibleSubCollectionId)?this.visibleSubCollectionId:this.visibleCollectionId;a+='<a target="_blank" id="rssFeed" class="rss" href="">'+
b+" Video Feed</a>"}dojo.byId(this.videoResultsDivId).innerHTML=a;this.playFromRegisteredVideos||this.updateVideoThumbnailVisual("",this.currentlyPlayingVideoId)},updateRssFeed:function(a){if(dojo.byId("rssFeed"))dojo.byId("rssFeed").href=this.rssUrlsObject[a]},videoThumbnailClicked:function(a){var b="";if(this.sourceApplicationName=="articlePage"){this.playFromRegisteredVideos=false;this.updateVideoThumbnailVisual("reg"+this.currentlyPlayingVideoId,"");b=this.videoUtil.getVideoDetails({id:a,fields:"linkRelativeURL,wsj-section"})}if(b!==""&&(this.relatedVideosCollection!=b["wsj-section"]||this.visibleCollectionId=="Search Results"))window.location.href=b.linkRelativeURL+".html";else{this.playingGroup=this.browsingGroup;if(this.userAction=="toSearch")this.currentPlayingJsonObject=this.currentSearchJsonObject;else if(this.userAction=="toBrowse")this.currentPlayingJsonObject=this.currentBrowsingJsonObject;this.convertCurrentPlayingJsonToIdsArray();this.updateTopNavAppearance("",this.visibleCollectionId);this.currentlyPlayingCollection=this.visibleCollectionId;this.currentlyPlayingSubCollection=this.visibleSubCollectionId;this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,a);this.currentlyPlayingVideoId=a;this.playVideoByVideoId(a);this.createNextVideo()}dojo.byId("flashPlayer")&&window.scrollTo(0,dojo.position(dojo.byId("flashPlayer"),true).y)},playNextVideo:function(){if(this.nextVideoId!==""){this.updateVideoThumbnailVisual("reg"+this.currentlyPlayingVideoId,"reg"+this.nextVideoDetailsJsonObject.id);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,this.nextVideoDetailsJsonObject.id);this.currentlyPlayingVideoId=this.nextVideoDetailsJsonObject.id;this.playVideoByParam(this.nextVideoDetailsJsonObject);this.populateVideoSummary(this.nextVideoDetailsJsonObject.name,this.nextVideoDetailsJsonObject.description,this.nextVideoDetailsJsonObject.formattedCreationDate);this.createNextVideo()}},getNextVideoId:function(){if(this.sourceApplicationName=="articlePage"){if(this.playFromRegisteredVideos&&this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)<this.registeredVideosIds.length-1)return this.registeredVideosIds[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)+1];if(this.playFromRegisteredVideos&&this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)==this.registeredVideosIds.length-1){this.playFromRegisteredVideos=false;return this.currentlyPlayingVideoIds[0]}if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)<this.currentlyPlayingVideoIds.length-1)return this.currentlyPlayingVideoIds[this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)+
1];if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==this.currentlyPlayingVideoIds.length-1)return""}else{if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==-1)return this.currentlyPlayingVideoIds[0];if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)<this.currentlyPlayingVideoIds.length-1)return this.currentlyPlayingVideoIds[this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)+1];if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==this.currentlyPlayingVideoIds.length-1){if(this.currentlyPlayingCollection=="Search Results")return"";if(this.playingGroup!==""&&this.playingGroup=="collection")return this.getVideoIdFromNextCollection();if(this.playingGroup!==""&&this.playingGroup=="subcollection")return this.getVideoIdFromNextSubCollection()}}},getVideoIdFromNextSubCollection:function(){var a=this.subcollectionsObject[this.currentlyPlayingCollection];if(a.indexOf(this.currentlyPlayingSubCollection)!=a.length-1){this.currentlyPlayingSubCollection=a[a.indexOf(this.currentlyPlayingSubCollection)+1];this.getVideos(this.contentUrlsObject[this.currentlyPlayingSubCollection]+"&count=60","",this,handleGetVideoIdFromNextSubColection)}else{this.currentlyPlayingSubCollection="";return this.getVideoIdFromNextCollection()}},handleGetVideoIdFromNextSubColection:function(){return this.currentPlayingJsonObject.items.length===0?this.getVideoIdFromNextSubCollection():this.currentPlayingJsonObject.items[0].id},getVideoIdFromNextCollection:function(){if(this.collectionNamesArray.indexOf(this.currentlyPlayingCollection)!=this.collectionNamesArray.length-1){if(this.skipCollection)this.currentlyPlayingCollection=this.collectionNamesArray[this.collectionNamesArray.indexOf(this.currentlyPlayingCollection)+1];this.skipCollection=true;this.getVideos(this.contentUrlsObject[this.currentlyPlayingCollection]+"&count=60","",this,handleGetVideoIdFromNextCollection)}else{this.currentlyPlayingCollection=this.defaultCollectionName;this.skipCollection=false;return this.getVideoIdFromNextCollection()}},handleGetVideoIdFromNextCollection:function(){return this.currentPlayingJsonObject.items.length===0?this.getVideoIdFromNextCollection():this.currentPlayingJsonObject.items[0].id},loadCollectionsDoc:function(a,b){dj.util.Video.getVideoData(this.collectionsXMLPath+"video-collections.xml",{context:a,callback:b,responseType:"text/xml",errorCallback:function(){console.error("Failure while loading video Collection xml.")}})},updateSideNavAppearance:function(a,b){if(this.visibleSubCollectionId!=="")if(dojo.byId("a_"+this.visibleSubCollectionId))if(dojo.byId("a_"+this.visibleSubCollectionId).className=="subcollection-selected")dojo.byId("a_"+this.visibleSubCollectionId).className="current";if(a=="collection"){if(this.visibleCollectionId!==""){var c=dojo.byId(this.visibleCollectionId),e=dojo.byId("a_"+this.visibleCollectionId);if(c.className=="expanded")c.className="expand";else if(c.className!="expand")c.className="noSubCollection";e.className=""}if(dojo.byId(b).className=="expand"){dojo.byId(b).className="expanded";dojo.byId("a_"+b).className="collection-selected"}else{dojo.byId(b).className="noSubCollection-expanded";dojo.byId("a_"+b).className="selected"}this.visibleCollectionId=b;this.visibleSubCollectionId=""}if(a=="subcollection"){if(this.videoUtil.isNotBlankOrNull(dojo.byId("a_"+b)))dojo.byId("a_"+b).className="subcollection-selected";if(this.videoUtil.isNotBlankOrNull(dojo.byId(this.visibleCollectionId)))dojo.byId(this.visibleCollectionId).className="expanded";if(this.videoUtil.isNotBlankOrNull(dojo.byId("a_"+this.visibleCollectionId)))dojo.byId("a_"+this.visibleCollectionId).className="";this.visibleSubCollectionId=b}},getName:function(){return this.objName},playVideoByVideoId:function(a){this.getVideos("/api-video/get_video_info.asp?guid="+a+"&fields=all","current")},playVideoByParam:function(a){var b=(new dj.util.Ads).getRegisteredAdsZone(""),c=this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.currentlyPlayingSubCollection:this.currentlyPlayingCollection;if(b!="default"&&b!="")a.adZone=b;a.lineup=c;a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt="frmt=2;";a.playerName=this.sourceApplicationName=="articlePage"?"video_articletab":"video_videocenter";a.embedPlayerURL=this.flashPlayerPath+"main.swf";a.embedConfigURL=this.embedConfigURL;a.embedPlayerID="1000";a.embedName="flashPlayer";a.embedBaseURL=this.flashPlayerPath;a.embedHeight=363;a.embedWidth=512;a.larsID=91;a.larsAdTrackingID=1259;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop10=this.videoUtil.getUrlParam(window.location.href,"mod");a.campaign=this.videoUtil.getUrlParam(window.location.href,"mod");a.prop11=this.videoUtil.getUrlParam(window.location.href,"reflink");a.prop19=this.sourceApplicationName=="articlePage"?"video_tab":"video";a.prop24=this.prop24;a.prop25=this.prop25;a.prop27=this.prop27;b=this.videoUtil.omnitureEncoding(this.currentlyPlayingCollection,this.currentlyPlayingSubCollection,"s");c=this.videoUtil.omnitureEncoding(this.currentlyPlayingCollection,this.currentlyPlayingSubCollection,"c");a.prop2="WSJ_"+c;a.prop3="WSJ_Video_Video_"+c;a.prop22="WSJ_Video_Video_"+b;a.prop26="WSJ_"+b;a.emailURL=this.emailURL;swfobject.getObjectById("flashPlayer").playVideo(dojo.toJson(a))},openPopUpPlayer:function(){var a=Math.floor(swfobject.getObjectById("flashPlayer").getSeek()),b=this.currentlyPlayingCollection;if(b=="Special Packages"||b=="Search Results")b=this.currentVideoDetailsJsonObject["wsj-section"];this.popUpWindow=window.open(this.popUpPageUrl+"?currentPlayingLocation="+a+"&currentlyPlayingCollection="+escape(b)+"&currentlyPlayingVideoId="+this.currentlyPlayingVideoId,"popUpPlayer","height=840,width=422,left="+(screen.width-Number("422"))/2+",top="+(screen.height-Number("840"))/2+",resizable=yes,scrollbars=no,toolbar=no,status=no")},focusPopUp:function(){this.popUpWindow&&this.popUpWindow.focus()},createRegisteredVideosThumbnails:function(){if(this.registeredVideosIds.length>0){for(var a="",b=0,c=this.registeredVideosIds.length;b<c;++b){var e=this.registeredVideos[b];if(e){a+='<li id="li_reg'+e.id+'" class="">';a+='<a href="javascript:'+this.getName()+".regVideoThumbnailClicked('"+
e.id+"','"+unescape(e.videoURL)+'\')" id="'+e.id+'" style="background-image: url('+unescape(e.thumbnailURL)+');" class="preview"><span>&nbsp;</span></a>';a+='<h2><a href="javascript:'+this.getName()+".regVideoThumbnailClicked('"+e.id+"','"+unescape(e.videoURL)+"')\">"+e.name+"</a></h2>";var d=Math.floor(e.duration/60);e=e.duration%60;if(e<10)e="0"+e;a+="<small>"+d+":"+e+"</small>";a+="</li>";if((b+1)%4===0)a+='<li class="rowEnd"></li>'}}dojo.byId(this.registeredVideosDivId).innerHTML=a}},regVideoThumbnailClicked:function(a){this.playFromRegisteredVideos=true;this.updateVideoThumbnailVisual("reg"+this.currentlyPlayingVideoId,"reg"+a);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,"");this.currentlyPlayingVideoId=a;this.playVideoByVideoId(a);this.createNextVideo()},registerVideo:function(a){this.playFromRegisteredVideos=true;if(a.indexOf("{")==-1)a="{"+a+"}";if(dojo.indexOf(this.registeredVideosIds,a)==-1){this.registeredVideosIds[this.registeredVideosIds.length]=a;this.registeredVideos[this.registeredVideos.length]=this.videoUtil.getVideoDetails({id:a,fields:"all"})}},loadSoloVideo:function(a,b){if(a.indexOf("{")==-1)a="{"+a+"}";var c="MicroPlayer_"+Math.floor(Math.random()*1E6);this.microPlayers[this.microPlayers.length]=c;this.videoIdMicroPlayerIdMap[a]=c;if(!dj.context.video)dj.context.video={};if(!dj.context.video.soloVideos)dj.context.video.soloVideos=[];dj.context.video.soloVideos[a]=this;if(swfobject.getFlashPlayerVersion().major>=9){var e={w:"272",h:"180"};swfobject.embedSWF(this.flashPlayerPath+"microPlayer.swf",b,e.w,e.h,"9.0.0","",{objName:"dummy",videoGUID:a,allowPlayerPopup:"1",plyMediaEnabled:"1",movieWidth:e.w,movieHeight:e.h,host:location.host},{allowscriptaccess:"always",wmode:"opaque"},{id:c})}else dj.util.Video.nonSupportingFlashPlayer(b)},getJSON:function(a){var b="/api-video/get_video_info.asp?guid="+a;b+="&fields=all";dj.util.Video.getVideoData(b,{context:this,handleAs:"json",sync:true,responseType:"application/json",callback:this.handleGetJSON,errorCallback:function(){console.error("Failed while executing video.VideoCenter.getJSON")}});this.microPlayersObjects[a]=this.jsonData;return dojo.toJson(this.jsonData)},handleGetJSON:function(a){this.jsonData=a;a=(new dj.util.Ads).getRegisteredAdsZone("");if(a!="default"&&a!="")this.jsonData.adZone=a;this.jsonData.emailPartnerID=110626;this.jsonData.site=this.site;this.jsonData.msrc=this.msrc;this.jsonData.adFrmt="frmt=0;";this.jsonData.playerName="video_articleembed";this.jsonData.videoCenterURL="http://"+window.location.host+"/video-center";this.jsonData.embedPlayerURL=this.flashPlayerPath+"microPlayer.swf";this.jsonData.embedConfigURL=this.embedConfigURL;this.jsonData.embedPlayerID="1000";this.jsonData.embedName="microflashPlayer";this.jsonData.embedBaseURL=this.flashPlayerPath;this.jsonData.embedHeight=180;this.jsonData.embedWidth=272;this.jsonData.larsID=91;this.jsonData.larsAdTrackingID=1259;this.jsonData.prop5=window.location.href.split("?")[0];this.jsonData.prop6=window.location.href;this.jsonData.prop10=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.campaign=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.prop11=this.videoUtil.getUrlParam(window.location.href,"reflink");this.jsonData.prop19="video_emb";this.jsonData.prop24=this.prop24;this.jsonData.prop25=this.prop25;this.jsonData.prop27=this.prop27;a=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"s");var b=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"c");this.jsonData.prop2="WSJ_"+b;this.jsonData.prop3="WSJ_Video_Video_"+b;this.jsonData.prop22="WSJ_Video_Video_"+a;this.jsonData.prop26="WSJ_"+a;this.jsonData.emailURL=this.emailURL;a="0";try{if(pID.indexOf("0_0_WH")!=-1)a="1"}catch(c){console.error("pID read error")}this.jsonData.suppressAds=a},updateTitle:function(){var a=dj.lang.query("#videoPlayerDescription h2")[0].innerHTML;a=a.substring(0,a.indexOf("<small>")-1);document.title=document.title.replace("Article",a)}});dojo.declare("dj.widget.video.video",dj.widget.video.VideoCenter,{constructor:function(){dojo.deprecated("dj.widget.video.video","Use dj.widget.video.VideoCenter, remove alias when MST JSEXECs updated","1.0")}});dojo.provide("dj.widget.video.Video");dojo.require("dj.lang");dojo.require("dj.util.Video");dojo.require("dj.util.Ads");dojo.require("swfobject.swfobject_1_5.swfobject");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.video.VideoCenter");dojo.require("dj.util.Element");dojo.getObject("dj.module.video",true);dojo.declare("dj.widget.video.Video",null,{config:{thumbnail:{divclass:"headlineSummary video",onclickprefix:"dj.module.articleVideoPlayer.tabplay(",onclicksuffix:");",hrefprefix:"#articleTabs_video-"},bc:{src:"http://wsj.vo.llnwd.net/o28/plymedia/SWF/BrightPLYembed.swf",flashVars:"playerId=452319854&viewerSecureGatewayURL=https://services.brightcove.com/services/amfgateway&servicesURL=http://services.brightcove.com/services&cdnURL=http://admin.brightcove.com&domain=embed&autoStart=false&showTicker=true&flashId=flashObj&videoId=",base:"http://wsj.vo.llnwd.net/o28/plymedia/SWF",bgcolor:"#000000",name:"BrightPLYembed",pluginspage:"http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash",flashversion:"8"}},constructor:function(a,b,c,e,d){if(a){this.parent=dojo.byId(a);if(typeof dojo.query("div[data-dj-live-widget]",this.parent)[0]==="object")console.info("{Video} %o will be handled by the video.MicroPlayer.",a);else{this.microPlayers=[];this.microPlayersObjects={};this.videoIdMicroPlayerIdMap={};this.videoUtil=dj.util.Video;dj.util.Element.identify(this.parent);c=this.videoUtil.setupConfig();dj.lang.mixin(this,c);this.flashPlayerPath=dj.context.core.cdnPrefix+"/media/swf/";this.parentid=a;if(this.parent){this.v=b;this.w=c=264;this.h=e=254;this.c=d;b&&this.load(b,c,e,d)}else console.log("id "+a+" not found")}}},createwrapper:function(a,b){this.div=dojo.create("div",{id:this.vidid});if(b&&!this.isguid(a)){this.tryw=""+b+"px";this.div.style.width=this.tryw}this.parent.appendChild(this.div)},createvideobc:function(a,b,c,e){dojo.deprecated("dj.widget.video.Video.createvideobc","If brightcove is not supported, remove this method","2.0");this.so=new SWFObject(this.config.bc.src,a,b,c,this.config.bc.flashversion,this.config.bc.bgcolor);this.so.setAttribute("id","video_"+this.vidid);this.so.addParam("base",this.config.bc.base);this.so.addParam("flashVars",this.config.bc.flashVars+a+"&");this.so.addParam("seamlesstabbing","false");this.so.addParam("swLiveConnect","true");this.so.addParam("name",this.config.bc.name);this.so.addParam("pluginspage",this.config.bc.pluginspage);this.so.addParam("wmode","opaque");this.so.write(this.div);e&&this.div.appendChild(dojo.create("p",{"class":"targetCaption",innerHTML:e}))},createvideoguid:function(a){this.loadSoloVideo(a,this.vidid);this.c&&this.parent.appendChild(dojo.create("p",{"class":"targetCaption",innerHTML:this.c}))},createvideo:function(a,b,c,e){this.isguid(a)?this.createvideoguid(a):this.createvideobc(a,b,c,e)},load:function(a,b,c,e){if(!this.div){this.newId();this.createwrapper(a,b,c);this.createvideo(a,b,c,e)}},createthumbnail:function(a){if(this.guidvideo)if(this.guidvideo.details){a||console.warn("no playObserver");var b=dojo.create("div",{"class":"videoTree"});this.div.appendChild(b);var c=dojo.create("div",{"class":"videoFrame"});b.appendChild(c);b=dojo.create("a",{href:"#"});dojo.connect(b,"onclick",this,function(e){a.fire(this.v);dojo.stopEvent(e)});c.appendChild(b);c=dojo.create("img",{src:this.guidvideo.details.thumbnailURLSmall,width:"115",height:"65",alt:"video"});b.appendChild(c);c=dojo.create("span",{"class":"videoBug"});c.innerHTML="&nbsp;";b.appendChild(c);b=dojo.create("h3",{"class":"first"});this.div.appendChild(b);c=dojo.create("a",{href:"#",innerHTML:this.guidvideo.details.name});dojo.connect(c,"onclick",this,function(e){a.fire(this.v);dojo.stopEvent(e)});b.appendChild(c);this.div.appendChild(dojo.create("small",{innerHTML:this.videoUtil.formatduration(this.guidvideo.details.duration)}));this.div.appendChild(dojo.create("p",{"class":"targetCaption",innerHTML:this.guidvideo.details.description}))}else console.error("no guidvideo.details");else console.error("no guidvideo")},loadthumbnail:function(a,b,c,e){this.v=a;if(this.isguid(a)){this.getvideodetails();this.newId();this.createwrapper(a,b,c);this.createthumbnail(e)}else console.error("cannot create tumbnail to old video")},getguidvideo:function(){try{if(!this.guidvideo)this.guidvideo=new dj.widget.video.VideoCenter;return this.guidvideo}catch(a){console.error("could not instantiate dj.widget.video.VideoCenter")}return null},getvideodetails:function(){if(this.getguidvideo())this.guidvideo.details=this.videoUtil.getVideoDetails({id:this.v,fields:"name,id,duration,description,thumbnailURL,thumbnailURLSmall"})},setBookMark:function(){this.getguidvideo()&&this.guidvideo.setBookMark()},pauseMicroPlayer:function(){this.getguidvideo()&&this.guidvideo.pauseMicroPlayers()},isguid:function(a){a=""+a;if(a.substring(0,1)!="{")a="{"+a;return a.substring(0,1)=="{"&&a.substring(9,10)=="-"&&a.substring(14,15)=="-"&&a.substring(19,20)=="-"?true:false},newId:function(){this.vidid="videodiv_"+Math.floor(Math.random()*999999)},loadSoloVideo:function(a,b){var c=this.videoUtil.setupConfig();dj.lang.mixin(this,c);if(a.indexOf("{")==-1)a="{"+a+"}";c="MicroPlayer_"+Math.floor(Math.random()*1E6);this.microPlayers[this.microPlayers.length]=c;this.videoIdMicroPlayerIdMap[a]=c;dojo.getObject("dj.context.video",true);if(!dj.context.video.soloVideos)dj.context.video.soloVideos=[];dj.context.video.soloVideos[a]=this;var e=1,d=dojo.getObject("dj.context.video.chainVideos");if(d!=undefined&&d===false)e=0;if(swfobject.getFlashPlayerVersion().major>=9){d={w:"272",h:"180"};swfobject.embedSWF(this.flashPlayerPath+"microPlayer.swf",b,d.w,d.h,"9.0.0","",{objName:"dummy",videoGUID:a,allowPlayerPopup:"1",plyMediaEnabled:"1",movieWidth:d.w,movieHeight:d.h,host:location.host,chainVideos:e},{allowscriptaccess:"always",wmode:"opaque"},{id:c})}else dj.util.Video.nonSupportingFlashPlayer(b)},openMicroPopUpPlayer:function(a){var b=Math.floor(swfobject.getObjectById(this.videoIdMicroPlayerIdMap[a]).getSeek()),c=this.microPlayersObjects[a]["wsj-section"];if(c=="Lifestyle")c="Life & Style";this.popUpWindow=window.open(this.popUpPageUrl+"?currentPlayingLocation="+b+"&currentlyPlayingCollection="+escape(c)+"&currentlyPlayingVideoId="+a,"popUpPlayer","height=660,width=512,left="+(screen.width-Number("512"))/2+",top="+(screen.height-Number("660"))/2+",resizable=yes,scrollbars=no,toolbar=no,status=no")},getJSON:function(a){var b="/api-video/get_video_info.asp?guid="+a;b+="&fields=all";dj.util.Video.getVideoData(b,{context:this,handleAs:"json",sync:true,responseType:"application/json",callback:this.handleGetJSON,errorCallback:function(){console.error("Failed while executing video.Video.getJSON")}});this.microPlayersObjects[a]=this.jsonData;return dojo.toJson(this.jsonData)},handleGetJSON:function(a){this.jsonData=a;a=(new dj.util.Ads).getRegisteredAdsZone("");if(a!="default"&&a!="")this.jsonData.adZone=a;this.jsonData.emailPartnerID=110626;this.jsonData.site=this.site;this.jsonData.msrc=this.msrc;this.jsonData.adFrmt="frmt=0;";this.jsonData.playerName="video_articleembed";this.jsonData.videoCenterURL="http://"+window.location.host+"/video-center";this.jsonData.embedPlayerURL=this.flashPlayerPath+"microPlayer.swf";this.jsonData.embedConfigURL=this.embedConfigURL;this.jsonData.embedPlayerID="1000";this.jsonData.embedName="microflashPlayer";this.jsonData.embedBaseURL=this.flashPlayerPath;this.jsonData.embedHeight=180;this.jsonData.embedWidth=272;this.jsonData.larsID=91;this.jsonData.larsAdTrackingID=1259;this.jsonData.prop5=window.location.href.split("?")[0];this.jsonData.prop6=window.location.href;this.jsonData.prop10=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.campaign=this.videoUtil.getUrlParam(window.location.href,"mod");this.jsonData.prop11=this.videoUtil.getUrlParam(window.location.href,"reflink");this.jsonData.prop19="video_emb";this.jsonData.prop24=this.prop24;this.jsonData.prop25=this.prop25;this.jsonData.prop27=this.prop27;a=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"s");var b=this.videoUtil.omnitureEncoding(this.jsonData["wsj-section"],this.jsonData["wsj-subsection"],"c");this.jsonData.prop2="WSJ_"+b;this.jsonData.prop3="WSJ_Video_Video_"+b;this.jsonData.prop22="WSJ_Video_Video_"+a;this.jsonData.prop26="WSJ_"+a;this.jsonData.emailURL=this.emailURL;this.jsonData.suppressAds=pID&&pID.indexOf("0_0_WH")!=-1?"1":"0"}});dojo.provide("dj.widget.video.controller.Player");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.Omniture");dojo.require("dj.util.Cookie");dojo.require("dj.util.Page");dojo.require("dj.widget.video.model.PlayerTypes");dojo.require("dj.module.video.taboolaVideo");dojo.require("dj.util.ie9.pin");dojo.provide("dj.util.VideoUtils");dojo.declare("dj.widget.video.controller.Player",null,{DEFAULT_CONFIG:{flashPlayerPath:"/media/swf/",playerType:dj.widget.video.model.PlayerTypes.MainPlayer,containerID:"videoPlayer",descriptionID:"videoPlayerDescription",playerID:"",videoAPIURL:"/api-video/get_video_info.asp",embedConfURL:"http://wsj.vo.llnwd.net/o28/players/",eventNamespace:"",host:location.host,applications:["video","video_popup","video_tab","video_emb","video_home"],applicationID:0,loadWaitTime:1E3,loadWaitCount:10,dataset:{},adFormat:"frmt=2;",videoPageValue:"videoPlay",videotrackId:"",enableVideoModuleChaining:0},constructor:function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoPlayer);this.configuration=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),b);this.videoInformation={};this.view=this.seekTime=null;this.readyForEvents=false;this.playedOn=null;var c=dj.util.Page.getQueryParam("site"),e="";try{e=dj.context.videoCenter.host}catch(d){console.error("{Player} error while getting site value from context. ",d.message)}this.site=c?c:e;this.msrc=dj.util.Page.getQueryParam("msrc")},init:function(a,b,c,e){if(c)this.seekTime=c;this.view=a;if(e&&e!="")this.playedOn=e;this.view.init(this);if(b)e&&e!=""?this.playVideo(b,e):this.playVideo(b);this.loadRetriesLeft=this.configuration.loadWaitCount},playVideo:function(a,b){if(b)this.playedOn=b;this.loadRetriesLeft=this.configuration.loadWaitCount;this.view.renderPreloader&&this.view.renderPreloader();this.queryVideo(a)},queryVideo:function(a){var b=this;dojo.xhrGet({url:this.configuration.videoAPIURL+"?guid="+a+"&fields=all",handleAs:"json",preventCache:true,headers:{Accept:"application/json"},load:function(c){b.videoID=a;b.videoInformation=c;b.render();b.loadVideo();b.observer.fireByName("onVideoLoaded",a,c,b.playedOn);return c},error:function(c){console.error("{Player} could not load video: '%s'. Response: %o",a,c);return c}})},render:function(){return this.view.render()},loadVideo:function(){if(this.loadRetriesLeft==0)console.info("{Player} number of Load Retries expired");else{var a=this;if(this.readyForEvents)this._startPlaying();else{this.loadRetriesLeft--;setTimeout(function(){a.loadVideo()},this.configuration.loadWaitTime)}}},_startPlaying:function(){try{var a=dj.context.core.urlPrefix+"/video/"+this.videoInformation.guid+".html";dj.module.video.taboolaVideo.notifyDynamicLoad(a,a,this.configuration.videotrackId,this.configuration.videoPageValue)}catch(b){console.log("Error while Taboola notification, ignore if not a taboola recommended module: "+b)}this.view.play(this.addVideoParameters(this.videoInformation))},videoPlayed:function(){},videoPaused:function(){},videoUnPaused:function(){},videoPopUp:function(){},getCurrentVideoID:function(){return this.videoID},getVideoData:function(a){return this.videoInformation[a]},addVideoParameters:function(a){try{var b="WSJ_";a||(a={});if(this.seekTime){a.seekTime=this.seekTime;this.seekTime=null}a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt=this.configuration.adFormat;a.playerName=this.view.configuration.name;a.embedPlayerURL=dj.context.core.cdnPrefix+
this.configuration.flashPlayerPath+this.configuration.playerType.swfFile;a.embedConfigURL=this.configuration.embedConfURL;a.embedPlayerID="1000";a.embedName=this.configuration.playerID;a.embedBaseURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath;a.embedHeight=this.configuration.playerType.height;a.embedWidth=this.configuration.playerType.width;a.larsID=91;a.larsAdTrackingID=1259;if(this.configuration.applicationID===3)a.playerName="video_articleembed";if(this.playedOn)a.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");try{a.prop59=dj.util.Cookie.getCookie("referrerURL");if(a.prop59===undefined||""===a.prop59||a.prop59===null){var c=document.referrer;try{if(c!==undefined&&""!==c){c=c.substring(c.indexOf("http://")+7);a.prop59=c.substring(0,c.indexOf("/"))}}catch(e){}}a.prop60=dj.util.Cookie.getCookie("sitereferrer")?dj.util.Cookie.getCookie("sitereferrer"):document.referrer}catch(d){}a.prop62=b+"embed";a.prop48=dj.util.ie9.pin.siteMode();var f=dj.util.Region.getViewByRegion();try{a.prop24=dj.util.Omniture.editionToNameMap[f.toLowerCase()]}catch(g){}a.pageName="WSJLive_Video_article type_"+a.titletag;a.prop1="Video";a.prop13=a.adZone;a.prop20="video_"+a.guid;a.prop21="WSJLive_"+a.author;a.prop23="video_"+a.formattedCreationDate;a.prop27="";try{dj.util.User.isLoggedIn(function(u){if(u)dj.util.User.isSubLoggedIn(function(p){if(p)dj.util.User.hasRole("WSJ-PRO",function(o){if(o){b="WSJPRO_";a.prop27="WSJ_proc_sub_yes"}else dj.util.User.hasRole("WSJ-ENT",function(t){if(t){b="WSJPRO_";a.prop27="WSJ_proe_sub_yes"}else a.prop27="WSJ_sub_yes"})});else a.prop27="WSJ_mem_yes"});else a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(h){try{a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"}catch(k){}}var l=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"s"),m=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"c");a.appName=b.substring(0,b.length-1);a.appType=this.configuration.applications[this.configuration.applicationID];a.section=m;a.subsection=l;a.prop2="WSJLive_"+m;a.prop3="WSJLive_Video_"+m;a.prop4="WSJLive_Video_"+m+"_"+a.titletag+"_"+a.duration;a.prop26="WSJLive_"+l;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop7="off";a.prop8="video_"+a.doctypeID;a.prop9="free";try{a.prop10=dj.util.Page.getQueryParam("mod")&&""!=dj.util.Page.getQueryParam("mod")?dj.util.Page.getQueryParam("mod"):dj.util.Page.getQueryParam("link")}catch(q){}a.campaign=a.prop10;c=document.referrer;a.prop25=dj.util.Cookie.getCookie("TR");try{a.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(n){console.error("cookie read error while fetching cookieUserType : "+n)}var s=typeof pID==="string"&&pID.indexOf("0_0_WH")!=-1?"1":"0";a.suppressAds=s}catch(w){}return a},addVideoParametersOld:function(a){var b="WSJ_";a||(a={});if(this.seekTime){a.seekTime=this.seekTime;this.seekTime=null}a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt=this.configuration.adFormat;a.playerName=this.view.configuration.name;a.embedPlayerURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath+this.configuration.playerType.swfFile;a.embedConfigURL=this.configuration.embedConfURL;a.embedPlayerID="1000";a.embedName=this.configuration.playerID;a.embedBaseURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath;a.embedHeight=this.configuration.playerType.height;a.embedWidth=this.configuration.playerType.width;a.larsID=91;a.larsAdTrackingID=1259;if(this.playedOn)a.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");if(typeof setEdition==="function")a.prop24=setEdition(dj.util.Region.getViewByRegion());a.prop27="";try{dj.util.User.isLoggedIn(function(g){if(g)dj.util.User.isSubLoggedIn(function(h){if(h)dj.util.User.hasRole("WSJ-PRO",function(k){if(k){b="WSJPRO_";a.prop27="WSJ_proc_sub_yes";a.prop8="WSJ Professional Enterprise";a.prop9="premium";a.prop24="Edition_US_Professional_Consumer"}else dj.util.User.hasRole("WSJ-ENT",function(l){if(l){b="WSJPRO_";a.prop27="WSJ_proe_sub_yes";a.prop8="WSJ Professional Enterprise";a.prop9="premium";a.prop24="Edition_US_Professional"}else a.prop27="WSJ_sub_yes"})});else a.prop27="WSJ_mem_yes"});else a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(c){console.info(c)}var e=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"s"),d=dj.util.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"c");a.appName=b.substring(0,b.length-1);a.appType=this.configuration.applications[this.configuration.applicationID];a.section=d;a.subsection=e;a.prop2=b+d;a.prop3=b+"Video_Video_"+d;a.prop22=b+"Video_Video_"+e;a.prop26=b+e;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop10=dj.util.Page.getQueryParam("mod");a.campaign=dj.util.Page.getQueryParam("mod");a.prop11=dj.util.Page.getQueryParam("reflink");a.prop19=a.youtubeID?a.appType+"_youtube":a.appType;a.prop25=dj.util.Cookie.getCookie("TR");try{a.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(f){console.error("cookie read error while fetching cookieUserType : "+
f)}e=typeof pID==="string"&&pID.indexOf("0_0_WH")!=-1?"1":"0";a.suppressAds=e;return a}});dojo.provide("dj.widget.video.controller.MicroPlayer");dojo.require("dj.widget.video.controller.Player");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.Ads");dojo.declare("dj.widget.video.controller.MicroPlayer",dj.widget.video.controller.Player,{constructor:function(){this.configuration.applicationID=3;this._events=dj.widget.video.model.PlayerEvents},init:function(a,b,c,e){this.videoInformation.id=b;if(!e){this._setupFlashToJsListeners();this._setupInternalEvents()}this.inherited(arguments)},getEventNamespace:function(){return"dj.context.video.soloVideos['"+this.videoInformation.id+"']"},subscribeByName:function(a,b,c){this.observer.subscribeByName(a,b,c)},addVideoParameters:function(a){a=this.inherited(arguments);var b=(new dj.util.Ads).getRegisteredAdsZone("");a.adZone=b!="default"&&b!=""?b:a.adZone;a.adFrmt="frmt=0;";a.videoCenterURL="http://"+window.location.host+"/video-center";return a},_setupInternalEvents:function(){this.observer.subscribeByName(this._events.continueLoadVideo,function(){this.readyForEvents=true},this);this.observer.subscribeByName(this._events.openMicroPopUpPlayer,function(){this.view.openPopUpPlayer()},this);this.observer.subscribeByName(this._events.openEmbedPopup,function(){try{console.log("openEmbedPopup event");this.view.openEmbedPopup();return true}catch(a){console.log("Error: openEmbedPopup event")}},this)},_setupFlashToJsListeners:function(){var a=this.observer,b=this._events,c={},e;for(e in b)b.hasOwnProperty(e)&&function(d,f){c[d]=function(){a.fireByName(f)}}(e,b[e]);dojo.getObject("dj.context.video.soloVideos",true);dj.context.video.soloVideos[this.videoInformation.id]=c}});dojo.provide("dj.widget.video.view.Mp4MicroPlayer");dojo.require("dj.widget.video.view.BasePlayer");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.VideoTracking");dojo.declare("dj.widget.video.view.Mp4MicroPlayer",dj.widget.video.view.BasePlayer,{renderPreloader:function(){this.oCnt=dojo.byId(this.controller.configuration.playerID);dojo.addClass(this.oCnt,this.configuration.preloaderClassName)},render:function(){if(!this.playerCreated){this.playerCreated=true;var a=dj.widget.video.model.PlayerEvents;this.controller.observer.fireByName(a.continueLoadVideo);this.controller.observer.fireByName(a.playVideo);this.controller.readyForEvents=true}},play:function(a){dj.util.VideoTracking.fire(a);var b=a.video320kMP4Url;b?setTimeout(function(){document.location=b},500):console.error("{view.MicroPlayer} no videoUri specified")}});dojo.provide("dj.widget.video.view.SwfMicroPlayer");dojo.require("dj.widget.video.view.BasePlayer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.model.SWFPlayer");dojo.declare("dj.widget.video.view.SwfMicroPlayer",dj.widget.video.view.BasePlayer,{renderPreloader:function(){this.oCnt=dojo.byId(this.controller.configuration.playerID);console.log("this.oCnt:"+this.oCnt);console.log("this.configuration.preloaderClassName:"+this.configuration.preloaderClassName);dojo.addClass(this.oCnt,this.configuration.preloaderClassName)},render:function(){if(!this.playerCreated){this.playerCreated=true;var a=this.controller.configuration,b=new dj.widget.video.model.SWFPlayer;b.id=a.playerID;console.log("************ conf.playerID *********** "+a.playerID);b.swfURL=a.flashPlayerPath+a.playerType.swfFile;b.containerID=a.containerID;b.width=a.playerType.width;b.height=a.playerType.height;b.host=a.host;b.allowPlayerPopup=1;if(dj.context.videoCenter.showHideVideoTools)b.hideTools=dj.context.videoCenter.showHideVideoTools;b.eventNamespace=this.controller.getEventNamespace();a=dj.widget.video.model.PlayerEvents;for(var c in a)if(a.hasOwnProperty(c))b[c]=c;this._wrapPlayerInContainer();this._replacePlayerWithSwf(b)}},play:function(a){if((this._playerObject=swfobject.getObjectById(this.controller.configuration.playerID))&&typeof this._playerObject.playVideo=="function"){this._playerObject.playVideo(dojo.toJson(a));this._pollForVideoEvents()}else console.error("{Player} video Player still not loaded")},openPopUpPlayer:function(){dj.util.VideoUtils.popUpPlayer({playLocation:Math.floor(swfobject.getObjectById(this.controller.configuration.playerID).getSeek()),collection:this.controller.getVideoData("wsj-section"),videoID:this.controller.getVideoData("id"),height:this.controller.configuration.playerType.height,width:this.controller.configuration.playerType.width})},openEmbedPopup:function(){console.log("call openEmbedPopup");dj.util.VideoUtils.embedPopUp({url:this.controller.getVideoData("linkURL"),guidval:this.controller.videoID,shortUrl:this.controller.getVideoData("linkShortURL")});return true},_replacePlayerWithSwf:function(a){dj.util.VideoUtils.createSWFPlayer(a)},_wrapPlayerInContainer:function(){var a=dojo.byId(this.controller.configuration.containerID);dojo.position(a);var b=document.createElement("div"),c=dojo.position(a);dojo.style(b,{width:c.w+"px",height:c.h+"px"});dojo.addClass(b,a.className);dojo.place(b,a,"before");dojo.place(a,b,"first")},_pollForVideoEvents:function(){if(!(!this._playerObject||typeof this._playerObject.getSeek!=="function")){var a=dj.widget.video.model.PlayerEvents,b=this,c=this.controller.videoInformation.duration,e=b._playerObject.getSeek()||0,d=3,f=true;clearInterval(this.ival);this.ival=setInterval(function(){if(typeof b._playerObject.getSeek!=="function")clearInterval(b.ival);else{var g=b._playerObject.getSeek(),h=g===e?d+1:0;if(f){f=false;b.controller.observer.fireByName(a.playVideo);console.log("Playing Video")}else d>3&&h==0&&b.controller.observer.fireByName(a.unpauseVideo);d=h;e=g;if(d==3)if(c-e<=1){b.controller.observer.fireByName(a.stopVideo);clearInterval(b.ival)}else b.controller.observer.fireByName(a.pauseVideo)}},250)}},destructor:function(){clearInterval(this.ival)}});dojo.provide("dj.widget.video.view.Html5MicroPlayer");dojo.require("dj.widget.video.view.Mp4MicroPlayer");dojo.provide("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.VideoUtils");dojo.declare("dj.widget.video.view.Html5MicroPlayer",dj.widget.video.view.Mp4MicroPlayer,{play:function(a){var b=a.video320kMP4Url;if(b){this._createVideoObject(a.videoStillURL,b);this._subscribeToVideoEvents();dojo.removeClass(this.oCnt,this.configuration.preloaderClassName);dojo.empty(this.oCnt);dojo.place(this._video,this.oCnt);dj.util.VideoTracking.fire(a);this._playing=false;dj.util.VideoUtils.callThroughDispatch(function(){this._video.play()},this)}else console.error("{view.MicroPlayer} no videoUri specified")},_createVideoObject:function(a,b){var c=dojo.position(this.oCnt);this._video=dojo.create("video",{poster:a,src:b,controls:true,width:c.w,height:c.h})},_subscribeToVideoEvents:function(){var a=dj.widget.video.model.PlayerEvents,b=this.controller.observer;dojo.connect(this._video,"onplay",function(){b.fireByName(a.playVideo)});dojo.connect(this._video,"onpause",function(){b.fireByName(a.pauseVideo)});dojo.connect(this._video,"onended",function(){b.fireByName(a.stopVideo)})}});dojo.provide("dj.widget.video.MicroPlayer");dojo.require("dj.widget.video.controller.MicroPlayer");dojo.require("dj.util.Video");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.view.SwfMicroPlayer");dojo.require("dj.widget.video.view.Mp4MicroPlayer");dojo.require("dj.widget.video.view.Html5MicroPlayer");dojo.declare("dj.widget.video.MicroPlayer",null,{constructor:function(a,b){this.containerId=a;this.dataset=b},loadVideo:function(){this._createView();this._createController();this._connectPageAndControllerEvents();this.dataset.guid=dj.util.VideoUtils.normalizeGuid(this.dataset.guid);this.controller.init(this.view,this.dataset.guid,0)},reloadVideo:function(a){this.dataset=a;this.dataset.guid=dj.util.VideoUtils.normalizeGuid(this.dataset.guid);this.controller.init(this.view,this.dataset.guid,0,true)},_createView:function(){this.view=dj.util.VideoUtils.hasValidFlashVersion()?new dj.widget.video.view.SwfMicroPlayer:dj.util.VideoUtils.isH264BaselineVideoSupported()?new dj.widget.video.view.Html5MicroPlayer:new dj.widget.video.view.Mp4MicroPlayer},_createController:function(){this.controller=new dj.widget.video.controller.MicroPlayer(null,{containerID:this.containerId,playerID:this.containerId,playerType:this._getPlayerType(this.dataset.videoSize),dataset:this.dataset})},_getPlayerType:function(a){return playerType=a==="E"?dj.widget.video.model.PlayerTypes.MicroPlayerE:a==="F"?dj.widget.video.model.PlayerTypes.MicroPlayerF:dj.widget.video.model.PlayerTypes.MicroPlayer},_connectPageAndControllerEvents:function(){var a=this.dataset.guid,b=dj.widget.video.model.PlayerEvents,c=dj.util.Video;this.controller.subscribeByName(b.playVideo,function(){c.playVideo(a)});this.controller.subscribeByName(b.pauseVideo,function(){c.pauseVideo(a)});this.controller.subscribeByName(b.stopVideo,function(){c.stopVideo(a)})},destructor:function(){this.view.destructor()}});dojo.provide("dj.module.video.liveMicroPlayer");dojo.require("dj.util.liveWidget");dojo.require("dj.util.Element");dojo.require("dj.widget.video.MicroPlayer");dj.module.video.liveMicroPlayer={init:function(){if(!this._isInit){this._isInit=true;this._setupLiveWidget()}},destroy:function(){dj.util.liveWidget.unregister("video.MicroPlayer")},_setupLiveWidget:function(){dj.util.liveWidget.register("video.MicroPlayer",function(a,b){dojo.stopEvent(a.event);this._initMicroPlayer(dj.util.Element.identify(a.domNode),b)},this)},_initMicroPlayer:function(a,b){(new dj.widget.video.MicroPlayer(a,b)).loadVideo()}};
dojo.provide("dj.widget.autocomplete.autoCompleteViewTemplate");dj.widget.autocomplete.autoCompleteViewTemplate=function(){this._viewTemplate="";this._viewTemplateConsumers=[];this._isTemplateLoading=this._isTemplateLoaded=false;var a=this;this._templateNodeSelector="#__autocomplete_view_template";this._fetchViewTemplate=function(){var b=dojo.query(a._templateNodeSelector)[0];a._isTemplateLoading=false;a._viewTemplate=b.defaultValue;a._isTemplateLoaded=true;a._handleViewTemplateLoad(b.defaultValue)};this._handleViewTemplateLoad=function(b){for(var c=0,d,e=a._viewTemplateConsumers.length;c<e;c++){d=a._viewTemplateConsumers[c];d.call(d,b)}a._viewTemplateConsumers=[]};return{getTemplate:function(b){if(a._isTemplateLoaded)b.call(b,a._viewTemplate);else{a._viewTemplateConsumers.push(b);if(!a._isTemplateLoading){a._isTemplateLoading=true;a._fetchViewTemplate()}}},setTemplateNodeSelector:function(b){a._templateNodeSelector=b}}}();dojo.provide("dj.widget.autocomplete.LandingPageGenerator");dojo.declare("dj.widget.autocomplete.LandingPageGenerator",[],{constructor:function(a,b,c,d){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,d);this.autoCompleteViewCfg=a;this.suggestionContext=b;this.selectedSuggestionObject=c;this.baseDomain="http://"+document.domain},DEFAULT_CONFIG:{companyResearchBaseUrl:"quotes.f.dev.wsj.com",keywordException:["obama","putin","china","fbi","cia","fda","nano","g20","g-20","bay","egan","acme","gold","cost","gas","beer","drug","oil","dog","cpi","gdp","dna","etf","jazz","etfs","auto","fed","taxes","tax","rome","cdc"]},goToQuotesPage:function(a){if(this.isValidateQuoteSearchBox()){var b=this.suggestionContext.searchText,c=this.isSearchOverride(a);if(typeof a!="undefined"&&(c||!this.isQuoteInput(b)))this.doKeyWordSearch();else if(this.isIndex())this.doRedirectIndexPage();else typeof a=="undefined"||this.isQuoteInput(b)?this.doViewQuote():this.doKeyWordSearch()}},isQuoteInput:function(a){if(a.match(",")){if(dj.module.autocomplete&&dj.module.autocomplete.oldSearchResultArr){a=a.split(",");for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<dj.module.autocomplete.oldSearchResultArr.length;d++){var e=dj.module.autocomplete.oldSearchResultArr[d];e.term==c&&this.isTickerMatch(c,e.resultset)}a.length==b&&this.isTickerMatch(a[a.length-1],dj.module.autocomplete.companiesArray);if(dj.module.autocomplete.multipleTickerCompArr){if(dj.module.autocomplete.multipleTickerCompArr&&dj.module.autocomplete.multipleTickerCompArr.length>0)return true}else return false}}else if(typeof dj.module.autocomplete!="undefined"&&typeof dj.module.autocomplete.companiesArray!="undefined")return this.isTickerMatch();return false},isTickerMatch:function(a,b){if(typeof a=="undefined")a=this.suggestionContext.searchText;if(typeof b=="undefined")b=dj.module.autocomplete.companiesArray;for(var c=0;c<b.length;c++){var d=b[c].ticker;d=d.substring(d.indexOf(":")+1,d.length);if(a.toUpperCase()==d){this.selectedSuggestionObject=b[c];if(!dj.module.autocomplete.multipleTickerCompArr)dj.module.autocomplete.multipleTickerCompArr=[];dj.module.autocomplete.multipleTickerCompArr.push(d,b[c]);return true}}return false},isValidateQuoteSearchBox:function(){var a=false;if(typeof this.suggestionContext.searchText==="undefined")alert("Please Enter a Symbol or Keyword.");else a=true;return a},isSearchOverride:function(){var a=this.suggestionContext.searchText,b=false;a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.replace(/,+/gi,"");for(var c=this._cfg.keywordException.length,d=0;d<c;d++){var e=this._cfg.keywordException[d];e=e.replace(/^\s+|\s+$/g,"").toUpperCase();if(e==a)b=true}return b},doKeyWordSearch:function(a,b){var c=this.suggestionContext.searchText;if(typeof a!="undefined")c=a;c=unescape(c);c=c.replace(/^\"\'\s+|\s+$/g,"").replace(/,$|\.,$/,"");if(typeof b=="undefined")b="DNH_S";c=c.replace(/ /g,"+");var d=dj.context.core.searchAppUrl;if(typeof d=="undefined"||dojo.trim(d)=="")d="/search/term.html?KEYWORDS=";this.doOpenWindow(dj.context.core.urlPrefix.match(/jp(.f.dev|.s.dev|).wsj.com/)?dj.context.core.urlPrefix+d+encodeURIComponent(c)+"&mod="+b:dj.context.core.urlPrefix+d+escape(c)+"&mod="+b)},doPrivateCompaniesSearch:function(a,b){a=a.replace(/ /g,"+");var c=dj.context.core.searchAppUrl;if(typeof c=="undefined"||dojo.trim(c)=="")c="/search/term.html?KEYWORDS=";this.doOpenWindow(dj.context.core.urlPrefix+c+'"'+escape(a)+'"&mod='+b)},doOpenWindow:function(a){if(this.autoCompleteViewCfg.target&&this.autoCompleteViewCfg.target==="_blank")window.open(a);else document.location=a},isIndex:function(){return typeof this.selectedSuggestionObject!="undefined"?this.selectedSuggestionObject.type==="Index":false},isMutualFund:function(){return this.selectedSuggestionObject.type==="Fund"},doRedirectIndexPage:function(){var a=dj.context.core.quotesUrlPrefix,b=this.selectedSuggestionObject.ticker;b=b.substring(b.indexOf(":")+1,b.length);var c=this.selectedSuggestionObject.country;a=c!="US"?a+"/index/"+c+"/"+b+"?mod=DNH_S":a+"/index/"+b+"?mod=DNH_S";a+="?mod=DNH_S_cq";this.doOpenWindow(a)},doViewQuote:function(){if(this.suggestionContext.searchText.match(","))this.doMultipleQuoteSearch();else{var a=dj.context.core.quotesUrlPrefix+"/",b=this.selectedSuggestionObject.ticker;b=b.substring(b.indexOf(":")+1,b.length);b=b.replace(/\./g,"");if(this.selectedSuggestionObject.country==="US")a+=b;else a=a+this.selectedSuggestionObject.country+"/"+this.selectedSuggestionObject.exchangeIsoCode+"/"+b;a+="?mod=DNH_S_cq";this.doOpenWindow(a)}},doMultipleQuoteSearch:function(){var a=this.suggestionContext.searchText.split(","),b="",c="";for(i=0;i<a.length;i++){tempSymb=a[i];tempSymb=dojo.trim(tempSymb);c+="usstock usfund,";b=b+tempSymb+","}b=b.substring(0,b.length-1);c=c.substring(0,c.length-1);b=b.replace(/\+/g,"%2B");b=b.replace(/\./g,"");a=false;if(typeof loggedIn!="undefined")a=loggedIn;this.doOpenWindow(dj.context.core.urlPrefix+(a?"":"/public")+"/quotes/main.html?symbol="+b+"&type="+c+"&mod=DNH_S")},goToTopicsOrPINPage:function(){var a="http://topics.wsj.com/",b="A",c="abc";if(typeof this.selectedSuggestionObject.type!="undefined"){if(this.selectedSuggestionObject.name!=null&this.selectedSuggestionObject.name!=""){b=this.selectedSuggestionObject.name.substring(0,1).toUpperCase();c=this.selectedSuggestionObject.name.replace(/ /g,"-").toLowerCase()}var d=this.selectedSuggestionObject.type;if(d=="company")d="organization";a=a+d+"/"+b+"/"+c+"/"+this.selectedSuggestionObject.code}else if(typeof this.selectedSuggestionObject.fullName!="undefined"){if(this.selectedSuggestionObject.lastName!=null&this.selectedSuggestionObject.lastName!="")b=this.selectedSuggestionObject.lastName.substring(0,1).toUpperCase();if(this.selectedSuggestionObject.fullName!=null&this.selectedSuggestionObject.fullName!="")c=this.selectedSuggestionObject.fullName.replace(/ /g,"-").toLowerCase();a=a+"person/"+b+"/"+c+"/"+this.selectedSuggestionObject.code}a+="?mod=DNH_S_tp";this.doOpenWindow(a)},doFeaturesSearch:function(a){if(typeof a=="undefined")a="DNH_S_features";var b=this.selectedSuggestionObject.url;if(b.indexOf("http")==-1||b.indexOf("http")!=0||b.indexOf("/")==0)b=dj.context.core.urlPrefix+b;b=b.indexOf("?")>-1?b+"&mod="+a:b+"?mod="+a;this.doOpenWindow(b)}});dojo.provide("dj.widget.autocomplete.SuggestCategoryDisplayModel");dojo.require("dj.lang");(dj.widget.autocomplete.SuggestCategoryDisplayModel=function(a){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a)}).prototype={constructor:dj.widget.autocomplete.SuggestCategoryDisplayModel,OPTIONS_CONFIG:{subHeading1:"",subHeading2:"",noOfColumns:1,columnToObjMap:[],maxNoOfSuggestionsToDisplay:5,subHeading1DisplayFlag:false,subHeading2DisplayFlag:false,subHeading1Class:"hdrSearchListComp"},getSubHeading1:function(){return this._options.subHeading1},setSubHeading1:function(a){this._options.subHeading1=a},getSubHeading1Class:function(){return this._options.subHeading1Class},setSubHeading1Class:function(a){this._options.subHeading1Class=a},isSubHeading1Visible:function(){return this._options.subHeading1DisplayFlag},getSubHeading2:function(){return this._options.subHeading2},setSubHeading2:function(a){this._options.subHeading2=a},isSubHeading2Visible:function(){return this._options.subHeading2DisplayFlag},addColumnAccessorMapping:function(a,b){this._validateColumnIndex(a);this._options.columnToObjMap[a]=b},getNumberOfColumns:function(){return this._options.noOfColumns},setNumberOfColumns:function(a){this._options.numberOfColumnsToObjMap=a},getNumberOfColumnsToObjMap:function(){return this._options.noOfColumnsToObjMap},setNumberOfColumnsToObjMap:function(a){this._options.noOfColumnsToObjMap=a},getColumnValueAccessor:function(a){this._validateColumnIndex(a);return this._options.columnToObjMap[a]},getMaxNoOfSuggestionsToDisplay:function(){return this._options.maxNoOfSuggestionsToDisplay},_validateColumnIndex:function(a){if(typeof a!=="number")throw new TypeError("IllegalArgument: expected a positive integer");if(a<0||a>this.getNumberOfColumns()-1)throw new RangeError("Column Index bound[0 "+(this.getNumberOfColumns()-1)+"]");}};dojo.provide("dj.widget.autocomplete.SuggestDataModel");dojo.require("dj.lang");dojo.require("dj.util.Observer");(dj.widget.autocomplete.SuggestDataModel=function(a){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a);this._categorySuggestionsArray=[];for(a=0;a<this._options.noOfCategories;a++)this._categorySuggestionsArray.push([]);this._suggestDataModelListeners=new dj.util.Observer(this);this._suggestSelectionListeners=new dj.util.Observer(this);this._suggestionContext={};this._selectedSuggestion={ctgIndex:-1,ctgItemIndex:-1};this._hasSelectedSuggestion=false}).prototype={OPTIONS_CONFIG:{noOfCategories:1},addSuggestDataModelListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataModelListeners.subscribe(a,a)},removeSuggestDataModelListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataModelListeners.unsubscribe(a)},addSuggestSelectionListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestSelectionListeners.subscribe(a,a)},removeSuggestSelectionListener:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestSelectionListeners.unsubscribe(a)},updateSuggestionContext:function(a){this._suggestionContext=a},getSuggestionContext:function(){return this._suggestionContext},getCategorySuggestions:function(a){this._validateCategoryIndex(a);return this._categorySuggestionsArray[a]},updateCategorySuggestions:function(a,b){this._validateCategoryIndex(a);if(!dojo.isArray(b))throw new TypeError("IllegalArgument: Expected an 2nd argument of type Array");this._categorySuggestionsArray[a]=b;this._suggestDataModelListeners.fire(this,this._suggestionContext,a)},emptyCategorySuggestions:function(a){this._validateCategoryIndex(a);this._categorySuggestionsArray[a]=[]},getCategoryLineItemData:function(a,b){var c=this.getCategorySuggestions(a);if(c.length>b)return c[b];return{}},getNumberOfCategories:function(){return this._options.noOfCategories},getNumberOfCategoryLineItems:function(a){return this.getCategorySuggestions(a).length},_validateCategoryIndex:function(a){if(typeof a!=="number")throw new TypeError("IllegalArgument: expected a positive integer");if(!this._isCategoryIndexInRange(a))throw new RangeError("Category Index bound[0 "+(this.getNumberOfCategories()-1)+"], received "+a);},_isCategoryIndexInRange:function(a){return!(a<0||a>this.getNumberOfCategories()-1)},isEmpty:function(){for(var a=this._categorySuggestionsArray.length,b=0;b<a;b++)if(this._categorySuggestionsArray[b].length>0)return false;return true},clear:function(){for(var a=this.getNumberOfCategories(),b=0;b<a;b++){this.emptyCategorySuggestions(b);this._suggestDataModelListeners.fire(this,this._suggestionContext,b)}this.clearSelection()},clearSelection:function(){this._hasSelectedSuggestion=false;this._selectedSuggestion.ctgIndex=-1;this._selectedSuggestion.ctgItemIndex=-1},hasSelectedSuggestion:function(){return this._hasSelectedSuggestion},selectSuggestion:function(a,b){var c=this._isSelectionChanging(a,b);if(this._isCategoryIndexInRange(a)){if(this.getCategorySuggestions(a).length>b){this._selectedSuggestion.ctgIndex=a;this._selectedSuggestion.ctgItemIndex=b;this._hasSelectedSuggestion=true}}else{this._selectedSuggestion.ctgIndex=a;this._selectedSuggestion.ctgItemIndex=b;this._hasSelectedSuggestion=false}c&&this._fireSelectionChangeEvent()},_isSelectionChanging:function(a,b){if(this._selectedSuggestion.ctgIndex===a&&this._selectedSuggestion.ctgItemIndex===b)return false;return true},getSelectedSuggestion:function(){if(this._hasSelectedSuggestion===true)return this.getCategoryLineItemData(this._selectedSuggestion.ctgIndex,this._selectedSuggestion.ctgItemIndex);return null},getSelectedSuggestionIndices:function(){return dj.lang.clone(this._selectedSuggestion)},selectPreviousSuggestion:function(a){var b;if(this._hasSelectedSuggestion===true){var c=this._selectedSuggestion.ctgIndex,d=this._selectedSuggestion.ctgItemIndex;if(this._selectedSuggestion.ctgItemIndex>0){d--;this.selectSuggestion(c,d)}else for(c--;this._isCategoryIndexInRange(c);){d=this.getNumberOfCategoryLineItems(c)-1;if((b=a.getMaxNoOfSuggestionsToDisplay(c))&&b-1<d)d=b-1;if(d>=0){this.selectSuggestion(c,d);break}else c--}}},selectNextSuggestion:function(a,b){var c=0;if(typeof b!="undefined")c=b;var d=-1;if(this._hasSelectedSuggestion===true){c=this._selectedSuggestion.ctgIndex;d=this._selectedSuggestion.ctgItemIndex}var e=a.getMaxNoOfSuggestionsToDisplay(c);for(d++;this._isCategoryIndexInRange(c);)if(d<this.getNumberOfCategoryLineItems(c)&&d<e){this.selectSuggestion(c,d);break}else{d=0;c++}},_fireSelectionChangeEvent:function(){var a=new dj.widget.autocomplete.SuggestDataModel$DataModelEvent;if(this._hasSelectedSuggestion===true)a.setCurrentSelectionIndices(this._selectedSuggestion.ctgIndex,this._selectedSuggestion.ctgItemIndex);else throw Error("No reason to fire SelectionChangeEvent");this._suggestSelectionListeners.fire(a)}};(dj.widget.autocomplete.SuggestDataModel$DataModelEvent=function(){this._eventName="";this._currentSelectedCategoryLineItemIndex=this._currentSelectedCategoryIndex=-1}).prototype={isSuggestionSelectionChangeEvent:function(){return true},setCurrentSelectionIndices:function(a,b){this._currentSelectedCategoryIndex=a;this._currentSelectedCategoryLineItemIndex=b},getSelectedCategoryIndex:function(){return this._currentSelectedCategoryIndex},getSelectedCategoryLineItemIndex:function(){return this._currentSelectedCategoryLineItemIndex}};dojo.provide("dj.widget.autocomplete.RemoteSuggestDataProvider");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dojo.io.script");(dj.widget.autocomplete.RemoteSuggestDataProvider=function(a){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a);this._suggestDataSubscribers=new dj.util.Observer(this);this._suggestDataUrlBuilder=null;this._urlCallCount=2;this._urlCallStart=0;this._responseErrUrl={}}).prototype={OPTIONS_CONFIG:{},setSuggestDataUrlBuilder:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataUrlBuilder=a},addSuggestDataHandlerClientCallback:function(a){if(typeof a!=="function")throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestDataSubscribers.subscribe(a,a)},getSuggestData:function(a){typeof this._options.product=="undefined"||this._options.product=="PRO"?dj.lang.xhrGet(this._buildDojoRequest(a)):dojo.io.script.get(this._buildDojoRequest(a))},_getSuggestDataUrl:function(a){var b=this._suggestDataUrlBuilder,c="";if(b===null||typeof b!=="function")throw Error("TODO: to be implemented");else c=b.call(b,a);return c},_handleResponse:function(a,b){try{this._suggestDataSubscribers.fire(b,a)}catch(c){typeof console!="undefined"&&typeof console.error!="undefined"&&console.error("Autocomplete Integration client code failed to consume data %o",c)}},_buildDojoRequest:function(a){var b=this,c={url:this._getSuggestDataUrl(a),handleAs:"json",timeout:1E4,headers:{},load:function(d,e){b._handleResponse(d,a,e)},error:function(d,e){b._handleResponse('{"Error":"Message"}',a,e)}};if(typeof this._options.product!="undefined")c.callbackParamName="callback";return c}};dojo.provide("dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider");dojo.require("dj.widget.autocomplete.RemoteSuggestDataProvider");dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider=function(a,b){var c=new dj.widget.autocomplete.RemoteSuggestDataProvider({product:"WSJ"});c.setSuggestDataUrlBuilder(function(j){var k="symbol,private-company";if(j.searchText.length>3)k+=",person,suggested-search-term,topic,omniture-keyword";var n=j.searchText;if(n.match(",")){n=j.searchText.split(",");if(dojo.trim(n[n.length-1])=="")if(n[n.length-2]){n=dojo.trim(n[n.length-2]);if(typeof dj.module.autocomplete!="undefined"&&typeof dj.module.autocomplete.companiesArray!="undefined"){if(!dj.module.autocomplete.oldSearchResultArr)dj.module.autocomplete.oldSearchResultArr=[];dj.module.autocomplete.oldSearchResultArr.push({term:n,resultset:dj.module.autocomplete.companiesArray})}n=n}else n="";else n=dojo.trim(n[n.length-1])}n=encodeURIComponent(n);j="http://services.dowjones.com";if(dj.context.core.urlPrefix)if(dj.context.core.urlPrefix.indexOf("s.dev")!=-1||dj.context.core.urlPrefix.indexOf("f.dev")!=-1)j="http://services-staging.dowjones.com";var t="";if(b.language)t="&ks="+b.language;return j+"/autocomplete/data?q="+n+"&it=fund,exchangetradedfund,stock,Index&count=5&need="+k+t+"&excludeexs=XBUE,XBAH,XCNQ,XTNX,XBOG,XCYS,XCAI,XSTU,XBER,XHAN,XTAE,XAMM,XKAZ,XKUW,XCAS,XMUS,XKAR,XLIM,DSMD,XBSE,XMIC,RTSX,XSAU,XBRA,XLJU,XCOL,PFTS,XADS,XDFM,XCAR,XNSE,MISX"});c.addSuggestDataHandlerClientCallback(function(j,k){var n=a.getSuggestDataModel();n.getSuggestionContext()===j&&dojo.forEach(b.CategoryDisplayConfigs,function(t,f){var h=t.name,o=t.maxNoOfSuggestionsToDisplay;if(h==="suggestedTerms")k.suggestedTerms==null||typeof k.suggestedTerms=="undefined"||k.suggestedTerms.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.suggestedTerms);else if(h==="companies")k.symbols==null||typeof k.symbols=="undefined"||k.symbols.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.symbols);else if(h==="privateCompanies")k.privateCompanies==null||typeof k.privateCompanies=="undefined"||k.privateCompanies.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.privateCompanies);else if(h==="topics"){var p=[];if(k.topics!=null&&typeof k.topics!="undefined"&&k.topics.length!=0)p=k.topics;if(k.people!=null&&typeof k.people!="undefined"&&k.people.length>0){p=[];var q=Math.ceil(o/2),r=Math.floor(o/2),s=k.topics.length,u=k.people.length,v=u<r?o-u:q;v=v>s?s:v;q=s<q?o-s:r;q=q>u?u:q;for(u=0;u<v;u++)p.push(k.topics[u]);for(v=0;v<q;v++)p.push(k.people[v])}n.updateCategorySuggestions(f,p)}else if(h==="keywords")k.keywords==null||typeof k.keywords=="undefined"||k.keywords.length==0?n.updateCategorySuggestions(f,[]):n.updateCategorySuggestions(f,k.keywords)})});var d=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).doFeaturesSearch("DNH_S_features")},e=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).goToQuotesPage()},g=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).goToTopicsOrPINPage()},l=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).doKeyWordSearch(k.keyword,"DNH_S_recent")},m=function(j,k){(new dj.widget.autocomplete.LandingPageGenerator(b,j,k)).doPrivateCompaniesSearch(k.name,"DNH_S_privatecompany")};(function(){c.selectHandlers=[];if(b.categoryTypeArr&&b.categoryTypeArr.length>0)for(var j=0;j<b.categoryTypeArr.length;j++)if(b.categoryTypeArr[j]=="FEATURES")c.selectHandlers.push(d);else if(b.categoryTypeArr[j]=="COMPANIES")c.selectHandlers.push(e);else if(b.categoryTypeArr[j]=="PRIVATE_COMPANIES")c.selectHandlers.push(m);else if(b.categoryTypeArr[j]=="TOPICS")c.selectHandlers.push(g);else b.categoryTypeArr[j]=="KEYWORDS"&&c.selectHandlers.push(l)})();return c};dojo.provide("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.lang");dojo.require("dj.widget.autocomplete.SuggestCategoryDisplayModel");(dj.widget.autocomplete.SuggestDisplayModel=function(a,b){this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,a);this._categoryDisplayModels=b?[]:[new dj.widget.autocomplete.SuggestCategoryDisplayModel];this._footerText=this._headerText="";this._isFooterVisible=this._isHeaderVisible=false}).prototype={constructor:dj.widget.autocomplete.SuggestDisplayModel,OPTIONS_CONFIG:{},getHeaderText:function(){return this._headerText},setHeaderText:function(a){this._headerText=a},isHeaderVisible:function(){return this._isHeaderVisible},setHeaderVisible:function(a){this._isHeaderVisible=a?true:false},getFooterText:function(){return this._footerText},setFooterText:function(a){this._footerText=a},isFooterVisible:function(){return this._isFooterVisible},setFooterVisible:function(a){this._isFooterVisible=a?true:false},addCategoryDisplayModel:function(){var a=null;switch(arguments.length){case 0:throw Error("IllegalArgument: expected atleast one categoryDisplayModel arg");case 1:if(typeof arguments[0]==="string"){a=new dj.widget.autocomplete.SuggestCategoryDisplayModel;a.setSubHeading1(arguments[0]);this._categoryDisplayModels.push(a)}else if(arguments[0].constructor===dj.widget.autocomplete.SuggestCategoryDisplayModel)this._categoryDisplayModels.push(arguments[0]);else throw new TypeError("IllegalArgument: expected instance of string or dj.widget.autocomplete.SuggestCategoryDisplayModel");break;case 2:if(typeof arguments[0]==="string"&&typeof arguments[1]==="string"){a=new dj.widget.autocomplete.SuggestCategoryDisplayModel;a.setSubHeading1(arguments[0]);a.setSubHeading2(arguments[1]);this._categoryDisplayModels.push(a)}break;default:throw Error("Illegal Number of Arguments , supported 1 object or 2 string args");}},removeAllCategories:function(){this._categoryDisplayModels=[]},getNumberOfCategories:function(){return this._categoryDisplayModels.length},getCategorySubHeading1:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getSubHeading1()},isCategorySubHeading1Visible:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].isSubHeading1Visible()},getCategorySubHeading2:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getSubHeading2()},getCategorySubHeading1Class:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getSubHeading1Class()},isCategorySubHeading2Visible:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].isSubHeading2Visible()},getNumberOfColumnsInCategory:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getNumberOfColumns()},getNumberOfColumnsToObjMap:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getNumberOfColumnsToObjMap()},getCategoryColumnValueAccessor:function(a,b){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getColumnValueAccessor(b)},getMaxNoOfSuggestionsToDisplay:function(a){this._validateCategoryIndex(a);return this._categoryDisplayModels[a].getMaxNoOfSuggestionsToDisplay()},_validateCategoryIndex:function(a){if(typeof a!=="number")throw new TypeError("IllegalArgument: expected a positive integer");if(a<0||a>this.getNumberOfCategories()-1)throw new RangeError("Category Index bound[0 "+(this.getNumberOfCategories()-1)+"]");}};dojo.provide("dj.widget.autocomplete.AutoCompleteView");dojo.require("dj.lang");dojo.require("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.widget.autocomplete.autoCompleteViewTemplate");(dj.widget.autocomplete.AutoCompleteView=function(a,b,c){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,b);this._content=this._currentHighlightedItem=this._suggestionsContentNode=this._suggestionsContainer=null;this._suggestionBlocks=[];this._showAllSymbolsAnchorNode=this._suggestFooterNode=null;this._categoryDisplayDataPointsIndex=[];this._suggestDisplayModel=typeof c==="undefined"?new dj.widget.autocomplete.SuggestDisplayModel:c}).prototype={DEFAULT_CONFIG:{},OPTIONS_CONFIG:{},setViewContainer:function(a){this._suggestionsContainer=a},getViewContainer:function(){return this._suggestionsContainer},fetchViewTemplate:function(){var a=this;dj.widget.autocomplete.autoCompleteViewTemplate.getTemplate(function(b){a.handleViewTemplateLoad(b)})},handleViewTemplateLoad:function(a){dojo.query("div.yui-ac-content",this.getViewContainer())[0].innerHTML=a;this._buildCategoryDisplay();this.indexDataPoints()},highlightSuggestion:function(a){this._currentHighlightedItem!==null&&dojo.removeClass(this._currentHighlightedItem,"yui-ac-highlight");this._currentHighlightedItem=a;dojo.addClass(a,"yui-ac-highlight")},highlightSuggestionAt:function(a,b){this.highlightSuggestion(this._categoryDisplayDataPointsIndex[a].listNodes[b])},_buildCategoryDisplay:function(){for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=dojo.query("div.suggestionblockcontainer",this.getViewContainer())[0],c=0;c<a;c++){var d=this._suggestDisplayModel.getNumberOfColumnsInCategory(c),e=null;if(d===4)e=dojo.query("div[class~='suggestionblock'][templateType='C2']",this.getViewContainer())[0];else if(d===1)e=dojo.query("div[class~='suggestionblock'][templateType='C1']",this.getViewContainer())[0];else throw Error("View not supported for more than 2 columns");e=e.cloneNode(true);var g=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(c),l=dojo.query("li",e)[0];l.setAttribute("categoryIndex",c);l.setAttribute("categoryItemIndex",0);for(var m=dojo.query("ul",e)[0],j=1;j<g;j++){var k=l.cloneNode(true);k.setAttribute("categoryItemIndex",j);m.appendChild(k)}e.removeAttribute("templateType");dojo.addClass(e,"concrete");e.setAttribute("categoryIndex",c);g=dojo.query("div.subHeading1",e)[0];if(d===4){d=dojo.query("div.subHeading2",e)[0];d.setAttribute("categoryIndex",c);d.innerHTML=this._suggestDisplayModel.getCategorySubHeading2(c);this._suggestDisplayModel.isCategorySubHeading2Visible(c)&&dojo.removeClass(d,"hidden")}g.innerHTML=this._suggestDisplayModel.getCategorySubHeading1(c);this._suggestDisplayModel.isCategorySubHeading1Visible(c)&&dojo.removeClass(g,"hidden");b.appendChild(e)}a=dojo.query("div.yui-ac-hd",this.getViewContainer())[0];this._suggestDisplayModel.isHeaderVisible()&&dojo.removeClass(a,"hidden");a=dojo.query("div.yui-ac-ft",this.getViewContainer())[0];if(this._suggestDisplayModel.isFooterVisible()){dojo.removeClass(a,"hidden");dojo.query("div.footer",a)[0].innerHTML=this._suggestDisplayModel.getFooterText()}},indexDataPoints:function(){this._content=dojo.query("div[class~='yui-ac-content']",this.getViewContainer())[0];this._suggestionBlocks=dojo.query("div.suggestionblock.concrete",this.getViewContainer());for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=0;b<a;b++){var c=this._suggestDisplayModel.getNumberOfColumnsInCategory(b),d=dojo.query("li",this._suggestionBlocks[b]),e=null;if(c===1){e=dojo.query("span.keywordResult",this._suggestionBlocks[b]);this._categoryDisplayDataPointsIndex.push({listNodes:d,col1Nodes:e})}else if(c===4){e=dojo.query("td.symbolCompleteCol1",this._suggestionBlocks[b]);c=dojo.query("td.symbolCompleteCol2",this._suggestionBlocks[b]);var g=dojo.query("td.symbolCompleteCol3",this._suggestionBlocks[b]),l=dojo.query("td.symbolCompleteCol4",this._suggestionBlocks[b]),m=dojo.query("div.subHeading2",this._suggestionBlocks[b])[0];this._categoryDisplayDataPointsIndex.push({listNodes:d,col1Nodes:e,col2Nodes:c,col3Nodes:g,col4Nodes:l,subHeading2:m})}else throw Error("Data point indexing supported for 1 and 4 columns only");}this._suggestFooterNode=dojo.query("div.footer",this.getViewContainer())[0]},populateCategoryDisplayMetaData:function(a,b,c){if(this._suggestDisplayModel.getNumberOfColumnsInCategory(a)===4)this._categoryDisplayDataPointsIndex[a].subHeading2.innerHTML=this._getCategorySubHeading2(a,b,c)},populateCategoryData:function(a,b,c){var d=this._suggestDisplayModel.getNumberOfColumnsInCategory(c);this.populateCategoryDisplayMetaData(c,a,b);if(d===1)this.populateSingleColumnSuggestions(c,a,b);else if(d===4)this.populateFourColumnSuggestions(c,a,b);else throw Error("View is not supported for more than 4 columns");},populateTwoColumnSuggestions:function(a,b,c){var d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),e=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var l=0;l<d;l++){var m=c[l];if(typeof m=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");var j=m[e];if(typeof j=="undefined")j="-";this._categoryDisplayDataPointsIndex[a].col1Nodes[l].innerHTML=this._getHighlightedSearchTerm(j,b);this._categoryDisplayDataPointsIndex[a].col2Nodes[l].innerHTML=this._getHighlightedSearchTerm(m[g],b)}}}},populateFourColumnSuggestions:function(a,b,c){var d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),e=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1),l=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,2),m=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,3);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var j=0;j<d;j++){var k=c[j];if(typeof k=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[j],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[j],"hidden");var n=k[e];if(typeof n=="undefined")n="-";this._categoryDisplayDataPointsIndex[a].col1Nodes[j].innerHTML=this._getHighlightedSearchTerm(n,b);this._categoryDisplayDataPointsIndex[a].col2Nodes[j].innerHTML=this._getHighlightedSearchTerm(k[g],b);this._categoryDisplayDataPointsIndex[a].col3Nodes[j].innerHTML=this._doExchangeCountryMap(k[l]);this._categoryDisplayDataPointsIndex[a].col4Nodes[j].innerHTML=k[m]}}}},_getHighlightedSearchTerm:function(a,b){return(""+a).replace(RegExp("("+b.searchText+")","i"),'<span class="scResultTerm">$1</span>')},_doExchangeCountryMap:function(a){var b={};b.US="U.S.";b["SAO PAULO"]="Brazil: Bovespa";b.TOR="Canada: Toronto";b.CSEC="Venezuela: Caracas";b.ASX="Australia: Sydney";b.SHSE="China: Shanghai";b.SSE="China: Shenzhen";b.HKSE="Hong Kong";b.TSE="Japan: Tokyo";b.KLSE="Malaysia";b.NZSE="New Zealand: NZX";b.SES="Singapore: SGX";b.TWSE="Taiwan";b.BRUX="Belgium: Brussels";b.COPN="Denmark: OMX";b.TALLINN="Estonia: Tallinn";b.HELS="Finland: Helsinki";b.PARB="France: Paris";b.FRNK="Germany: Frankfurt";b.XETRA="Germany: Xetra";b.REYKJAVIK="Iceland";b.DUBLIN="Ireland: Dublin";b.MILAN="Italy: Milan";b.RIGA="Latvia: Riga";b.LITHUANIA="Lithuania: Vilnius";b.AMS="Netherlands: Amsterdam";b.OSLO="Norway: Oslo";b.SIBE="Spain: Madrid";b.STKM="Sweden: Stockholm";b.ZSE="Switzerland: SWX";b.LONDON="U.K.: London";b.VTX="Switzerland: SWX";b.PINKSH="U.S.: Pink Sheets";b.NNOTC="U.S.: Other OTC";b.NASDBB="U.S.: OTCBB";b.XTSX="Canada: TSX Venture";b.BOMBAY="India: Bombay";b.BSE="Hungary: Budapest";b.LISBON="Portugal: Lisbon";b.SET="Thailand: Bangkok";b.VIENNA="Austria: Vienna";return b[a]},populateSingleColumnSuggestions:function(a,b,c){var d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),e=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var g=0;g<d;g++){var l=c[g];if(typeof l=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");this._categoryDisplayDataPointsIndex[a].col1Nodes[g].innerHTML=this._getHighlightedSearchTerm(l[e],b)}}}},_getCategorySubHeading2:function(a,b){return this._suggestDisplayModel.getCategorySubHeading2(a)+'"'+b.searchText+'"'},show:function(){dojo.removeClass(this.getViewContainer(),"hidden")},hide:function(){dojo.addClass(this.getViewContainer(),"hidden")},isHidden:function(){return dojo.hasClass(this.getViewContainer(),"hidden")},clearSelection:function(){if(this._currentHighlightedItem!==null){dojo.removeClass(this._currentHighlightedItem,"yui-ac-highlight");this._currentHighlightedItem=null}},detach:function(){var a=dojo.query("div.yui-ac-content",this.getViewContainer())[0];this._suggestionsContentNode=dojo.query("div:first-child",a).orphan()[0]},attach:function(){dojo.query("div.yui-ac-content",this.getViewContainer())[0].appendChild(this._suggestionsContentNode)}};dojo.provide("dj.widget.autocomplete.WSJAutoCompleteView");dojo.require("dj.lang");dojo.require("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.widget.autocomplete.autoCompleteViewTemplate");dojo.require("dj.util.Ads");(dj.widget.autocomplete.WSJAutoCompleteView=function(a,b,c){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,b);this._content=this._currentHighlightedItem=this._suggestionsContentNode=this._suggestionsContainer=null;this._suggestionBlocks=[];this._showAllSymbolsAnchorNode=this._suggestFooterNode=null;this._categoryDisplayDataPointsIndex=[];this._suggestDisplayModel=typeof c==="undefined"?new dj.widget.autocomplete.SuggestDisplayModel:c}).prototype={DEFAULT_CONFIG:{},OPTIONS_CONFIG:{},setViewContainer:function(a){this._suggestionsContainer=a},getViewContainer:function(){return this._suggestionsContainer},fetchViewTemplate:function(){var a=this,b=dj.widget.autocomplete.autoCompleteViewTemplate;this._cfg.templateNodeSelector&&b.setTemplateNodeSelector(this._cfg.templateNodeSelector);b.getTemplate(function(c){a.handleViewTemplateLoad(c)})},handleViewTemplateLoad:function(a){dojo.query("div.autocompleteContent",this.getViewContainer())[0].innerHTML=a;this._buildSectionsDisplay();this.createDataPoints()},highlightSuggestion:function(a){this._currentHighlightedItem!==null&&dojo.removeClass(this._currentHighlightedItem,"searchHover");for(var b=dojo.query(".searchHover",this._suggestionsContainer),c=0;c<b.length;c++)dojo.removeClass(b[c],"searchHover");this._currentHighlightedItem=a;dojo.addClass(a,"searchHover")},highlightSuggestionAt:function(a,b){this.highlightSuggestion(this._categoryDisplayDataPointsIndex[a].listNodes[b])},_buildSectionsDisplay:function(){for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=dojo.query("div.dropdownContainerClass",this.getViewContainer())[0],c=0;c<a;c++){var d=this._suggestDisplayModel.getNumberOfColumnsInCategory(c),e=null;if(d===6)e=dojo.query("div[class~='suggestionblock'][templateType='C3']",this.getViewContainer())[0];else if(d===1)e=dojo.query("div[class~='suggestionblock'][templateType='C1']",this.getViewContainer())[0];else throw Error("View not supported for more than 2 columns");d=e.cloneNode(true);e=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(c);var g=dojo.query("li.lineItem",d)[0];g.setAttribute("categoryIndex",c);g.setAttribute("categoryItemIndex",0);var l=dojo.query("ul",d)[0];dojo.addClass(l,this._suggestDisplayModel.getCategorySubHeading1Class(c));for(var m=1;m<e;m++){var j=g.cloneNode(true);j.setAttribute("categoryItemIndex",m);l.appendChild(j)}d.removeAttribute("templateType");dojo.addClass(d,"concrete");d.setAttribute("categoryIndex",c);e=dojo.query("li.hdrSearchListName",d)[0];e.innerHTML=this._suggestDisplayModel.getCategorySubHeading1(c);this._suggestDisplayModel.isCategorySubHeading1Visible(c)?dojo.removeClass(e,"hidden"):dojo.addClass(e,"hidden");b.appendChild(d)}a=dojo.query("div.acHeadline",this.getViewContainer())[0];this._suggestDisplayModel.isHeaderVisible()&&dojo.removeClass(a,"hidden");a=dojo.query("div.acFooter",this.getViewContainer())[0];if(this._suggestDisplayModel.isFooterVisible()){dojo.removeClass(a,"hidden");dojo.query("a.footer",a)[0].innerHTML=this._suggestDisplayModel.getFooterText()}},createDataPoints:function(){this._content=dojo.query("div[class~='autocompleteContent']",this.getViewContainer())[0];this._suggestionBlocks=dojo.query("div.suggestionblock.concrete",this.getViewContainer());for(var a=this._suggestDisplayModel.getNumberOfCategories(),b=0;b<a;b++){var c=this._suggestDisplayModel.getNumberOfColumnsInCategory(b),d=dojo.query("li.lineItem",this._suggestionBlocks[b]),e=null;if(c===1){e=dojo.query("a.searchResult",this._suggestionBlocks[b]);this._categoryDisplayDataPointsIndex.push({listNodes:d,col1Nodes:e})}else if(c===6){d=dojo.query("li.lineItem",this._suggestionBlocks[b]);e=dojo.query("div.searchListCompTicker",this._suggestionBlocks[b]);c=dojo.query("div.searchListCompName",this._suggestionBlocks[b]);var g=dojo.query("div.searchListCompMarkets",this._suggestionBlocks[b]);this._categoryDisplayDataPointsIndex.push({listNodes:d,col1Nodes:e,col2Nodes:c,col3Nodes:g})}else throw Error("Data point indexing supported for 1 and 3 columns only");}this._suggestFooterNode=dojo.query("div.acFooter",this.getViewContainer())[0]},populateCategoryDisplayMetaData:function(){},populateCategoryData:function(a,b,c){for(var d=this._suggestDisplayModel.getNumberOfColumnsInCategory(c),e=dojo.query(".searchHover",this._suggestionsContainer),g=0;g<e.length;g++)dojo.removeClass(e[g],"searchHover");if(d===1)this.populateSingleColumnSuggestions(c,a,b);else if(d===6)this.populateThreeColumnSuggestions(c,a,b);else throw Error("View is not supported for more than 3 columns");},populateTwoColumnSuggestions:function(a,b,c){var d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),e=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var l=0;l<d;l++){var m=c[l];if(typeof m=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[l],"hidden");var j=m[e];if(typeof j=="undefined")j="-";this._categoryDisplayDataPointsIndex[a].col1Nodes[l].innerHTML=this._getHighlightedSearchTerm(j,b);this._categoryDisplayDataPointsIndex[a].col2Nodes[l].innerHTML=this._getHighlightedSearchTerm(m[g],b)}}}},populateThreeColumnSuggestions:function(a,b,c){if(!dj.module.autocomplete)dj.module.autocomplete={};dj.module.autocomplete.companiesArray=c;var d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a),e=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0),g=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,1),l=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,2),m=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,3),j=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,5);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var k=0;k<d;k++){var n=c[k];if(typeof n=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[k],"hidden");else{dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[k],"hidden");this._categoryDisplayDataPointsIndex[a].col1Nodes[k].innerHTML=this._getHighlightedSearchTerm(n[e],b);this._categoryDisplayDataPointsIndex[a].col2Nodes[k].innerHTML=this._getHighlightedSearchTerm(n[g],b);this._categoryDisplayDataPointsIndex[a].col3Nodes[k].innerHTML=n[j]=="Index"?"Index":this._getCountryToDisplay(n[l],n[m])}}}},_getCountryToDisplay:function(a,b){var c=["Fukuoka","Sapporo SE"],d=a;if("CA,CN,DE,US,IN,XE".indexOf(dojo.trim(a))!=-1)d=b;else if(b.indexOf(":")>-1){d=dojo.trim(b.substring(b.indexOf(":")+
1));if(dojo.indexOf(c,d)>-1)d=b;else{d=b.substring(0,b.indexOf(":"));if(d=="Japan")d="Japan:Tokyo"}}else switch(b){case"Sapporo SE":d="Japan: Sapporo";break;case"KRX KOSDAQ":d="South Korea: Kosdaq";break;case"South Korea":d="South Korea: KRX";break;case"JASDAQ":d="Japan: Jasdaq";break;case"Nagoya SE":d="Japan: Nagoya";break;case"Osaka Sec.Ex":d="Japan: Osaka";break;default:d=b}return d},_getHighlightedSearchTerm:function(a,b){return(""+a).replace(RegExp("("+b.searchText+")","i"),'<span class="searchTerm">$1</span>')},_doExchangeCountryMap:function(a){var b={};b.US="U.S.";b["SAO PAULO"]="Brazil: Bovespa";b.TOR="Canada: Toronto";b.CSEC="Venezuela: Caracas";b.ASX="Australia: Sydney";b.SHSE="China: Shanghai";b.SSE="China: Shenzhen";b.HKSE="Hong Kong";b.TSE="Japan: Tokyo";b.KLSE="Malaysia";b.NZSE="New Zealand: NZX";b.SES="Singapore: SGX";b.TWSE="Taiwan";b.BRUX="Belgium: Brussels";b.COPN="Denmark: OMX";b.TALLINN="Estonia: Tallinn";b.HELS="Finland: Helsinki";b.PARB="France: Paris";b.FRNK="Germany: Frankfurt";b.XETRA="Germany: Xetra";b.REYKJAVIK="Iceland";b.DUBLIN="Ireland: Dublin";b.MILAN="Italy: Milan";b.RIGA="Latvia: Riga";b.LITHUANIA="Lithuania: Vilnius";b.AMS="Netherlands: Amsterdam";b.OSLO="Norway: Oslo";b.SIBE="Spain: Madrid";b.STKM="Sweden: Stockholm";b.ZSE="Switzerland: SWX";b.LONDON="U.K.: London";b.VTX="Switzerland: SWX";b.PINKSH="U.S.: Pink Sheets";b.NNOTC="U.S.: Other OTC";b.NASDBB="U.S.: OTCBB";b.XTSX="Canada: TSX Venture";b.BOMBAY="India: Bombay";b.BSE="Hungary: Budapest";b.LISBON="Portugal: Lisbon";b.SET="Thailand: Bangkok";b.VIENNA="Austria: Vienna";return b[a]},populateSingleColumnSuggestions:function(a,b,c){var d=this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(a);this._suggestDisplayModel.getNumberOfColumnsToObjMap(a);var e=this._suggestDisplayModel.getCategoryColumnValueAccessor(a,0);if(c.length===0)dojo.addClass(this._suggestionBlocks[a],"hidden");else{dojo.removeClass(this._suggestionBlocks[a],"hidden");for(var g=0;g<d;g++){var l=c[g];if(typeof l=="undefined")dojo.addClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");else{var m=l[e];if(e=="keyword"&&typeof l[e]!="undefined"){m=decodeURIComponent(m);m=m.replace(/\+/g," ")}if(typeof l[e]=="undefined"&&typeof l.fullName!="undefined"){m=l.fullName;if(typeof l.companyName!="undefined"&&l.companyName!=null&&l.companyName!="")m=m+"<small> from "+l.companyName+"</small>"}dojo.removeClass(this._categoryDisplayDataPointsIndex[a].listNodes[g],"hidden");this._categoryDisplayDataPointsIndex[a].col1Nodes[g].innerHTML=this._getHighlightedSearchTerm(m,b)}}}},_getCategorySubHeading2:function(){return""},show:function(){dojo.removeClass(this.getViewContainer(),"hidden");dojo.addClass(dojo.byId("searchInputEle"),"searchActive");dj.util.Ads().loadAds("SearchSponsorBox",{ordrecalculate:1})},hide:function(){dojo.addClass(this.getViewContainer(),"hidden");dojo.removeClass(dojo.byId("searchInputEle"),"searchActive")},isHidden:function(){return dojo.hasClass(this.getViewContainer(),"hidden")},clearSelection:function(){if(this._currentHighlightedItem!==null){dojo.removeClass(this._currentHighlightedItem,"searchTerm");this._currentHighlightedItem=null}},detach:function(){var a=dojo.query("div.autocompleteContent",this.getViewContainer())[0];this._suggestionsContentNode=dojo.query("div:first-child",a).orphan()[0]},attach:function(){dojo.query("div.autocompleteContent",this.getViewContainer())[0].appendChild(this._suggestionsContentNode)},showInlineErrorMessage:function(){var a=this._cfg.errorMessage;if(a.inline){var b=dojo.byId(a.containerId);dojo.addClass(b,a.className);b.value=a.errorText;b.blur()}},hideInlineErrorMessage:function(){var a=this._cfg.errorMessage,b=dojo.byId(a.containerId);if(dojo.hasClass(b,a.className)){dojo.removeClass(b,a.className);b.value=""}},isInlineErrorMessage:function(){var a=this._cfg.errorMessage,b=dojo.byId(a.containerId);return dojo.hasClass(b,a.className)&&b.value===a.errorText}};dojo.provide("dj.widget.autocomplete.AutoComplete");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.Element");dojo.require("dj.widget.autocomplete.SuggestCategoryDisplayModel");dojo.require("dj.widget.autocomplete.SuggestDisplayModel");dojo.require("dj.widget.autocomplete.SuggestDataModel");(dj.widget.autocomplete.AutoComplete=function(a,b,c){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this._options=dj.lang.cloneMixin(this.OPTIONS_CONFIG,b);this._suggestDataProvider=this._suggestionContextBuilder=this._currentSuggestionContext=this._suggestionsDisplayContainer=null;this._setDefaultSuggestDataProvider();this._suggestionSelectionHandlers=new dj.util.Observer(this);this._footerClickHandlers=new dj.util.Observer(this);this._enterHandler=new dj.util.Observer(this);this._viewEventHandlers=new dj.util.Observer(this);this._lastDataDetchCallId=null;this._suggestViewEventListeners=new dj.util.Observer(this);this._suggestionContextInputEvent=null;a=new dj.widget.autocomplete.SuggestDisplayModel({},true);if(typeof c!=="undefined"){typeof c.Header!=="undefined"&&a.setHeaderText(c.Header);typeof c.HeaderVisible!=="undefined"&&a.setHeaderVisible(c.HeaderVisible);typeof c.Footer!=="undefined"&&a.setFooterText(c.Footer);typeof c.FooterVisible!=="undefined"&&a.setFooterVisible(c.FooterVisible);if(typeof c.CategoryDisplayConfigs!=="undefined"){b=c.CategoryDisplayConfigs;for(var d=0;d<b.length;d++){var e=new dj.widget.autocomplete.SuggestCategoryDisplayModel(b[d]);a.addCategoryDisplayModel(e)}}}if(typeof this._options.product=="undefined"||this._options.product=="PRO"){dojo.require("dj.widget.autocomplete.AutoCompleteView");this._viewInstance=new dj.widget.autocomplete.AutoCompleteView({},{},a)}else if(this._options.product=="WSJ"){dojo.require("dj.widget.autocomplete.WSJAutoCompleteView");var g={};b=c.templateNodeSelector;c=c.errorMessage;if(typeof b!=="undefined"&&b!=="")g.templateNodeSelector=b;if(typeof c!=="undefined"&&c!=="")g.errorMessage=c;this._viewInstance=new dj.widget.autocomplete.WSJAutoCompleteView(g,{},a)}this._dataModelInstance=new dj.widget.autocomplete.SuggestDataModel({noOfCategories:a.getNumberOfCategories()});var l=this;this._dataModelInstance.addSuggestDataModelListener(function(m,j,k){l.onSuggestModelChange(m,j,k)});this._dataModelInstance.addSuggestSelectionListener(function(m){l.onSuggestSelectionChange(m)});this.djLang=dj.lang}).prototype={DEFAULT_CONFIG:{dataFetchDelayMilliSeconds:100},OPTIONS_CONFIG:{tooltipContainer:"autoCompleteList",tooltipContainerClass:".autoCompleteDiv",suggestOnInit:false},_setDefaultSuggestDataProvider:function(){},setSuggestDataProvider:function(a){this._suggestDataProvider=a},setSuggestionContextBuilder:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestionContextBuilder=a},getSuggestDataProvider:function(){return this._suggestDataProvider},getOptionsCfg:function(){return this._options},getSuggestDataModel:function(){return this._dataModelInstance},getCurrentSuggestionContext:function(){return this._currentSuggestionContext},init:function(){var a=this;this._suggestionContextInputEvent=this._addSuggestionContextInputSource();this.keyBoardSuggestionEvent=dj.lang.addLiveEvent(this._options.tooltipTargetClass,"keydown",function(b){a._keyboardSuggestionScroller(b,a._options.tooltipContainer)});this.pageBodyClickEvent=dj.lang.addLiveEvent("body","click",function(b){a._pageBodyClickHandler(b)});this._viewInstance.setViewContainer(this.getSuggestionsDisplayContainer());this._viewInstance.fetchViewTemplate();this.addViewEventListener(function(b,c,d){var e=a._dataModelInstance.getSuggestionContext();if(b==="LINE_ITEM_CLICK"){b=a._dataModelInstance.getCategoryLineItemData(c,d);a._suggestionSelectionHandlers.fire(e,b,c)}else if(b==="FOOTER_CLICK")a._footerClickHandlers.fire(e);else b==="CATEGORY_SUBHEADING2_CLICK"&&a._viewEventHandlers.fire(b,c,d)});this.subscribeToEvents();this._options.suggestOnInit===true&&this._getSuggestions(dojo.query(this._options.tooltipTargetClass))},_addSuggestionContextInputSource:function(){var a=this;return dj.lang.addLiveEvent(this._options.tooltipTargetClass,"keyup",function(b){b.keyCode===40||b.keyCode===38||b.keyCode===13||a._getSuggestions(this)})},_getSuggestions:function(a){this._currentSuggestionContext=a=this.buildSuggestionContext(a);this._dataModelInstance.updateSuggestionContext(a);if(a.searchText.length===0){this._hideView();this._clearSelectedSuggestion();this._clearDataModel()}else this._getData(a)},addSuggestionSelectionHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestionSelectionHandlers.subscribe(a,a)},removeSuggestionSelectionHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestionSelectionHandlers.unsubscribe(a)},addFooterClickHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._footerClickHandlers.subscribe(a,a)},removeFooterClickHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._footerClickHandlers.unsubscribe(a)},addEnterHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._enterHandler.subscribe(a,a)},removeEnterHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._enterHandler.unsubscribe(a)},addViewEventHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._viewEventHandlers.subscribe(a,a)},removeViewEventHandler:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._viewEventHandlers.unsubscribe(a)},getSuggestionsDisplayContainer:function(){return this._suggestionsDisplayContainer===null?dojo.byId(this._options.tooltipContainer):this._suggestionsDisplayContainer},onSuggestModelChange:function(a,b,c){var d=a.getCategorySuggestions(c);a.isEmpty()?this._viewInstance.hide():this._viewInstance.show();this._clearSelectedSuggestion();this._viewInstance.populateCategoryData(b,d,c)},onSuggestSelectionChange:function(a){a.isSuggestionSelectionChangeEvent()&&this._viewInstance.highlightSuggestionAt(a.getSelectedCategoryIndex(),a.getSelectedCategoryLineItemIndex())},buildSuggestionContext:function(a){return this._suggestionContextBuilder===null?{searchText:a.value}:this._suggestionContextBuilder(a.value)},_clearDataModel:function(){this._dataModelInstance.clear()},_hideView:function(){this._viewInstance.hide()},_getData:function(a){var b=this;this._lastDataDetchCallId!==null&&clearTimeout(this._lastDataDetchCallId);this._lastDataDetchCallId=setTimeout(function(){b._suggestDataProvider.getSuggestData(a)},this._cfg.dataFetchDelayMilliSeconds)},_keyboardSuggestionScroller:function(a,b){if(a.keyCode===13)this._enterHandler.fire();else if(a.keyCode===38)this._dataModelInstance.selectPreviousSuggestion(this._viewInstance._suggestDisplayModel,parseInt(c));else if(a.keyCode===40){for(var c=0,d=0;d<dojo.query(".suggestionblock",b).length;d++)if(!dojo.hasClass(dojo.query(".suggestionblock")[d],"hidden")){lineItem=dojo.query(".suggestionblock")[d];c=lineItem.getAttribute("categoryIndex");break}this._dataModelInstance.selectNextSuggestion(this._viewInstance._suggestDisplayModel,parseInt(c))}},_pageBodyClickHandler:function(a){this._viewInstance.isHidden()||dj.util.Element.contains(dojo.query(this._options.tooltipTargetClass)[0],a.clientX,a.clientY)||this._viewInstance.hide()},addViewEventListener:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestViewEventListeners.subscribe(a,a)},removeViewEventListener:function(a){if(!dojo.isFunction(a))throw new TypeError("IllegalArgument: Expected an argument of type function");this._suggestViewEventListeners.unsubscribe(a)},_fireViewEvents:function(a,b){var c=parseInt(b.getAttribute("categoryIndex"),10);c=isNaN(c)?-1:c;var d=parseInt(b.getAttribute("categoryItemIndex"),10);d=isNaN(d)?-1:d;this._suggestViewEventListeners.fire(a,c,d)},subscribeToEvents:function(){var a=this._viewInstance.getViewContainer().id,b="li";if(dojo.query("li.lineItem",a).length>0)b="li.lineItem";b="div[id="+a+"] * "+b;var c=this;this.lineItemClickEvent=this.djLang.addLiveEvent(b,"click",function(){c._selectSuggestion(this);c._fireViewEvents("LINE_ITEM_CLICK",this)});this.lineItemMouseOverEvent=this.djLang.addLiveEvent(b,"mouseover",function(){c._selectSuggestion(this);c._fireViewEvents("LINE_ITEM_MOUSEOVER",this)});b="div.footer";b=dojo.query("div.footer",a).length>0?"div.footer":"div.acFooter";this.footerClickEvent=this.djLang.addLiveEvent("div[id="+a+"] * "+b,"click",function(){c._fireViewEvents("FOOTER_CLICK",this)});this.categorySubheadingClickEvent=this.djLang.addLiveEvent("div[id="+a+"] * div.subHeading2","click",function(){c._fireViewEvents("CATEGORY_SUBHEADING2_CLICK",this)})},_selectSuggestion:function(a){var b=parseInt(a.getAttribute("categoryIndex"),10);b=isNaN(b)?-1:b;a=parseInt(a.getAttribute("categoryItemIndex"),10);a=isNaN(a)?-1:a;this._dataModelInstance.selectSuggestion(b,a)},_clearSelectedSuggestion:function(){this._viewInstance.clearSelection();this._dataModelInstance.clearSelection()},close:function(){this._hideView();this._clearDataModel()},destroy:function(){dj.lang.removeLiveEvent(this._suggestionContextInputEvent);dj.lang.removeLiveEvent(this.keyBoardSuggestionEvent);dj.lang.removeLiveEvent(this.pageBodyClickEvent);dj.lang.removeLiveEvent(this.lineItemClickEvent);dj.lang.removeLiveEvent(this.lineItemMouseOverEvent);dj.lang.removeLiveEvent(this.footerClickEvent);dj.lang.removeLiveEvent(this.categorySubheadingClickEvent);this._suggestionContextInputEvent=null;this.close();this._suggestionsDisplayContainer=null},detach:function(){dj.lang.removeLiveEvent(this._suggestionContextInputEvent);this._suggestionContextInputEvent=null;this.close();this._viewInstance.detach();this._suggestionsDisplayContainer=null},attach:function(a){this._options=dj.lang.cloneMixin(this._options,a);this._viewInstance.setViewContainer(this.getSuggestionsDisplayContainer());this._viewInstance.attach();this._suggestionContextInputEvent=this._addSuggestionContextInputSource()}};dojo.provide("dj.module.ep.globalheader.wsjAutocomplete");dojo.require("dj.lang");dj.module.ep.globalheader.wsjAutocomplete=function(a,b,c,d){this.clearOnFirstClickEvent=this.autoCompleteInitEvent=null;this._inputField=a||"globalHeaderSearchInput";this._activationField=a||"searchBlingBox";var e=this;this._searchContext=dojo.mixin({searchType:"",industryQuery:"",selectedIndustry:"",selectedIndustryName:""},d);this.autoCompleteInitializer=function(){dojo.require("dj.widget.autocomplete.AutoComplete");dojo.require("dj.widget.autocomplete.LandingPageGenerator");dojo.require("dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider");dojo.require("dj.widget.autocomplete.RemoteSuggestDataProvider");var g=dojo.mixin({tooltipTargetClass:'input[id="globalHeaderSearchInput"][class~="hdrSearchInput"]',tooltipContainer:"globalHeaderAutoComplete",tooltipContainerClass:"div[id='globalHeaderAutoComplete'][class~='hdrSearchList']",suggestProvider:undefined,companyResearchBaseUrl:"quotes.f.dev.wsj.com",product:"WSJ"},b),l=g.suggestProvider===undefined||g.suggestProvider===null?false:true,m=dojo.mixin({FooterVisible:true,templateNodeSelector:"#wsj_autocomplete_template",Footer:"View All Search Results &raquo;",categoryTypeArr:["FEATURES","COMPANIES","TOPICS","KEYWORDS"],CategoryDisplayConfigs:[{subHeading1:"COMPANIES",subHeading2:"See all symbol results for ",noOfColumns:6,columnToObjMap:["ticker","company","country","exchange","exchangeIsoCode","type"],subHeading1DisplayFlag:true,subHeading2DisplayFlag:false,name:"companies",maxNoOfSuggestionsToDisplay:5,subHeading1Class:"hdrSearchListComp",noOfColumnsToObjMap:6},{subHeading1:"Recent Searches",subHeading2:"",noOfColumns:1,columnToObjMap:["keyword"],subHeading1DisplayFlag:true,name:"keywords",maxNoOfSuggestionsToDisplay:3,subHeading1Class:"hdrSearchListRecent",noOfColumnsToObjMap:1}]},c),j=new dj.widget.autocomplete.AutoComplete(null,g,m),k=function(f,h,o,p){h=new dj.widget.autocomplete.LandingPageGenerator(m,f,h);p=="FOOTER_CLICK"?h.doKeyWordSearch(f.searchtext):h.goToQuotesPage(true)},n={};if(l){console.debug("Setting suggestProvider to: %o",g.suggestProvider);n=dj.widget.autocomplete.provider[g.suggestProvider](j,m)}else n=dj.widget.autocomplete.provider.MWatchWSJHatSearchProvider(j,m);j.setSuggestDataProvider(n);j.addSuggestionSelectionHandler(function(f,h,o){if(l)n.selectHandlers[o]===null||n.selectHandlers[o]===undefined||n.selectHandlers[o]===-1?k(f,h,o):n.selectHandlers[o](f,h);else k(f,h,o)});j.addFooterClickHandler(function(f){k(f,undefined,undefined,"FOOTER_CLICK")});j.addEnterHandler(function(){t()});j.init();e.clearOnFirstClickEvent=dj.lang.addLiveEvent("#"+e._inputField,"click",function(){var f=dojo.byId(e._inputField);if(dojo.hasClass(f,"unUsed")||dojo.hasClass(f,"searchWsj")){dojo.removeClass(f,"unUsed");dojo.removeClass(f,"searchWsj");if(f.value)f.value=""}for(var h=dojo.query(".searchHover",g.tooltipContainer),o=0;o<h.length;o++)dojo.removeClass(h[o],"searchHover")});e.resetSearchBox=function(){var f=dojo.byId(e._inputField);if(dojo.trim(f.value)===""){dojo.removeClass(f,"searchWsj");dojo.addClass(f,"unUsed");f.value="News, Quotes, Companies, Videos"}};var t=function(){var f=j.getSuggestDataModel(),h=f.getSuggestionContext(),o=f.getSelectedSuggestionIndices().ctgIndex;if(l)if(n.selectHandlers[o]===null||n.selectHandlers[o]===undefined||n.selectHandlers[o]===-1)f.hasSelectedSuggestion()?k(h,f.getSelectedSuggestion(),o):k(h);else n.selectHandlers[o](h,f.getSelectedSuggestion())};dj.lang.addLiveEvent(".hdrSearchBtn","click",t);dojo.disconnect(e.autoCompleteInitEvent)};dojo.removeClass(dojo.byId("searchBlingBox"),"hidden");this.autoCompleteInitEvent=dojo.connect(dojo.byId(this._activationField),"mouseover",this.autoCompleteInitializer);dojo.addOnLoad(function(){})};
hat={init:function(){this.currId=this.getSelectedProduct();this.partyHatMoreDropdown=document.getElementById("partyhat_more_dropdown");this.oHatFBButton=document.getElementById("hat_fb_button");this.oHatTwtButton=document.getElementById("hat_twt_button");if(window.addEventListener){this.partyHatMoreDropdown.addEventListener("click",this.moredropdown,false);typeof this.oHatFBButton!=="undefined"&&this.oHatFBButton&&this.oHatFBButton.addEventListener("click",this.showFacebookOverlay,false);window.addEventListener("click",this.hideOverlays,false);typeof this.oHatTwtButton!=="undefined"&&this.oHatTwtButton&&this.oHatTwtButton.addEventListener("click",this.showTwitterOverlay,false)}else{this.partyHatMoreDropdown.attachEvent("onclick",this.moredropdown);typeof this.oHatFBButton!=="undefined"&&this.oHatFBButton&&this.oHatFBButton.attachEvent("onclick",this.showFacebookOverlay);document.attachEvent("onclick",this.hideOverlays);typeof this.oHatTwtButton!=="undefined"&&this.oHatTwtButton&&this.oHatTwtButton.attachEvent("onclick",this.showTwitterOverlay)}},moredropdown:function(a){hat.hideFacebookOverlay();hat.hideTwitterOverlay();var b=hat.partyHatMoreDropdown.parentNode;if(b.className.match(/hat_dd_selected/))b.className=b.className.replace("hat_dd_selected","");else b.className+=" hat_dd_selected";hat.StopEvent(a)},hideMoreDropdown:function(){var a=hat.partyHatMoreDropdown.parentNode;if(a.className.match(/hat_dd_selected/))a.className=a.className.replace("hat_dd_selected","")},facebookURL:function(){return this.currId.match(/wsj_asia/)?"wsjasia, WSJAsia on Facebook":this.currId.match(/wsj_india/)?"wsjindia, WSJ India on Facebook":this.currId.match(/wsj_gm/)?"pages/The-Wall-Street-Journal-Deutschland/111293262305204, WSJDeutschland auf Facebook,de_DE":this.currId.match(/wsj_eu/)?"pages/The-Wall-Street-Journal-Europe/124739154250536, WSJEurope on Facebook":this.currId.match(/wsjpro_eu/)?"pages/The-Wall-Street-Journal-Europe/124739154250536, WSJEurope on Facebook":this.currId.match(/wsjpro_asia/)?"wsjasia, WSJAsia on Facebook":this.currId.match(/wsj_classroom/)?"wsjclassroom, WSJclassroom on Facebook":this.currId.match(/wsj_kp/)?"pages/WSJ-Korea/273852312731478, WSJ\ud55c\uad6d on Facebook,ko_KR":this.currId.match(/wsj_jp/)?"pages/WSJ-Japan/308413537545,  WSJ \u65e5\u672c\u7248\u306eFacebook\u30da\u30fc\u30b8,ja_JP":this.currId.match(/wsj_id/)?"WSJIndonesia, WSJIndonesia on Facebook":this.currId.match(/wsj_br/)?"wsj, WSJ on Facebook":this.currId.match(/wsj_lat/)?"wsj, WSJ on Facebook":this.currId.match(/wsj/)?"wsj, WSJ on Facebook":this.currId.match(/bol/)?"barronsonline, Barron's on Facebook":this.currId.match(/mw/)?"marketwatch, Marketwatch on Facebook":this.currId.match(/sm/)?"SmartMoney, SmartMoney on Facebook":this.currId.match(/atd/)?"allthingsd, AllThingsD on Facebook":this.currId.match(/fins/)?"FINSfinancecareers,FINS Finance on Facebook|FINStechcareers,FINS Technology on Facebook|FINSsalesmarketingcareers,FINS Sales & Marketing on Facebook":this.currId.match(/fact/)?"DJFactiva,Factiva on Facebook":this.currId.match(/live/)?"wsjlive,WSJLive on Facebook":"wsj, WSJ on Facebook"},showFacebookOverlay:function(a){hat.hideOverlays();this.oHatFBLikeOverlay=document.getElementById("fb_like_overlay");this.oHatFBLikeOverlay.className="hat_overlay hat_overlay_fb";if(!window.frames.facebook_iframe){var b=hat.facebookURL().split("|");fbULEle=document.createElement("ul");for(var c=0;c<b.length;c++){var d=b[c].split(","),e=hat.createLIElement(d[1],"hat_fb_icon");d=hat.createIFRAMEElement("facebook_iframe",d[2]?"http://www.facebook.com/plugins/like.php?href=http://www.facebook.com/"+
d[0]+"&action=recommend&layout=button_count&send=false&show_faces=false&width=90&locale="+d[2]:"http://www.facebook.com/plugins/like.php?href=http://www.facebook.com/"+d[0]+"&action=recommend&layout=button_count&send=false&show_faces=false&width=90",200,21);e.appendChild(d);fbULEle.appendChild(e)}this.oHatFBLikeOverlay.appendChild(fbULEle)}hat.StopEvent(a)},createLIElement:function(a,b){var c=document.createElement("li");h4Ele=document.createElement("h4");c.appendChild(h4Ele);SpanEle=document.createElement("span");SpanEle.className="icon";SpanEle.setAttribute("id",b);h4Ele.appendChild(SpanEle);strNode=document.createTextNode(a);h4Ele.appendChild(strNode);return c},createIFRAMEElement:function(a,b,c,d){var e=document.createElement("IFRAME");e.setAttribute("name",a);e.setAttribute("id",a);e.setAttribute("src",b);e.setAttribute("frameBorder",0);e.style.width=c+"px";e.setAttribute("allowtransparency","true");e.setAttribute("scrolling","no");e.style.height=d+"px";return e},hideFacebookOverlay:function(){this.oHatFBLikeOverlay=document.getElementById("fb_like_overlay");if(typeof this.oHatFBLikeOverlay!=="undefined"&&this.oHatFBLikeOverlay)this.oHatFBLikeOverlay.className="hat_overlay hat_overlay_fb hidden"},twitterURL:function(){return this.currId.match(/wsj_eu/)?"wsjeurope, WSJEurope on Twitter":this.currId.match(/wsj_india/)?"wsjindia, WSJ India on Twitter":this.currId.match(/wsj_gm/)?"WSJDeutschland, WSJDeutschland auf Twitter,de":this.currId.match(/wsjpro_eu/)?"wsjeurope, WSJEurope on Twitter":this.currId.match(/wsjpro_asia/)?"wsjasia, WSJAsia on Twitter":this.currId.match(/wsj_classroom/)?"wsjclassroom, WSJclassroom on Twitter":this.currId.match(/wsj_pro/)?"wsj, WSJ on Twitter":this.currId.match(/wsj_jp/)?"WSJJapan, WSJJapan on Twitter":this.currId.match(/wsj_ch/)?"wsjchina, WSJChina on Twitter":this.currId.match(/wsj_asia/)?"wsjasia, WSJAsia on Twitter":this.currId.match(/wsj_kp/)?"wsjkorea1, WSJ\ud55c\uad6d on Twitter,ko":this.currId.match(/wsj_id/)?"wsjindonesia, WSJIndonesia on Twitter":this.currId.match(/wsj_sp/)?"WSJAmericas, WSJAmericas on Twitter":this.currId.match(/wsj_br/)?"WSJPortugues, WSJPortugues on Twitter":this.currId.match(/wsj_lat/)?"WSJAmericas, WSJAmericas on Twitter":this.currId.match(/wsj/)?"wsj, WSJ on Twitter":this.currId.match(/bol/)?"barronsonline, Barron's on Twitter":this.currId.match(/mw/)?"MarketWatch, MarketWatch on Twitter":this.currId.match(/sm/)?"SmartMoney, SmartMoney on Twitter":this.currId.match(/atd/)?"allthingsd, AllThingsD on Twitter":this.currId.match(/fins/)?"FINSider,FINS Finance Careers on Twitter|techFINSider,FINS Technology Careers on Twitter|salesFINSider,FINS Sales Careers on Twitter":this.currId.match(/fact/)?"factiva,Factiva on Twitter":this.currId.match(/live/)?"WSJVideo,WSJVideo on Twitter":"wsj, WSJ on Twitter"},showTwitterOverlay:function(a){hat.hideOverlays();this.oHatTwtLikeOverlay=document.getElementById("twitter_overlay");this.oHatTwtLikeOverlay.className="hat_overlay hat_overlay_twitter";if(!window.frames.twitter_iframe){var b=hat.twitterURL().split("|");twULEle=document.createElement("ul");for(var c=0;c<b.length;c++){var d=b[c].split(","),e=hat.createLIElement(d[1],"hat_twt_icon");d=d[2]?"http://platform.twitter.com/widgets/follow_button.html?screen_name="+d[0]+"&show_count=true&show_screen_name=true&lang="+d[2]:"http://platform.twitter.com/widgets/follow_button.html?screen_name="+d[0]+"&show_count=true&show_screen_name=true";var f=hat.createIFRAMEElement("twitter_iframe",d,250,21);f.setAttribute("src",d);e.appendChild(f);twULEle.appendChild(e)}this.oHatTwtLikeOverlay.appendChild(twULEle)}hat.StopEvent(a)},hideTwitterOverlay:function(){this.oHatTwtLikeOverlay=document.getElementById("twitter_overlay");if(typeof this.oHatTwtLikeOverlay!=="undefined"&&this.oHatTwtLikeOverlay)this.oHatTwtLikeOverlay.className="hat_overlay hat_overlay_twitter hidden"},getSelectedProduct:function(){var a=document.getElementById("hattabs").children;for(i=0;i<a.length;i++)if(a[i].className.match(/current/))return a[i].id;return"hat_tab_wsj"},StopEvent:function(a){if(!a)if(window.event)a=window.event;else return;if(a.cancelBubble!=null)a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();if(window.event)a.returnValue=false;if(a.cancel!=null)a.cancel=true},hideOverlays:function(){hat.hideFacebookOverlay();hat.hideTwitterOverlay();hat.hideMoreDropdown()}};hat.init();dojo.provide("dj.widget.networkHat.infocomplete");function InfoComplete(){this.autoComplete=this.dataSource=null;this.count=0;this.allowexchanges=this.allowsymboltypes=this.allowcountries=this.domain="";this.currentQueryHasResultMatch=false;this.lastExactResult="";this.exactMatches=[];this.lastExactMatchResultSet=[];this.keyword=this.symbol=null}function autoCompleteTrim(a){return a.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1")}
InfoComplete.prototype.Setup=function(a){var b,c;if(!(typeof a=="undefined"||a===null)){b=0;for(c=a.sections.length;b<c;b++){var d=a.sections[b].dataSource.server;if(typeof d=="undefined"||d===null||d==="")return}document.getElementsByTagName("BODY");this.count=a.count;this.dataSource=[];b=0;for(c=a.sections.length;b<c;b++){d=a.sections[b];if(d.type=="keyword")this.keyword=b;else if(d.type=="symbol")this.symbol=b;var e=new YAHOO.widget.DS_XHR(d.dataSource.server,d.dataSource.schema);e.responseType=d.dataSource.responseType;e.scriptQueryAppend=d.dataSource.scriptQueryAppend;e.index=b;e.dataErrorEvent.subscribe(this.handleError,e);this.dataSource[b]=e}this.autoComplete=new YAHOO.widget.MultiAutoComplete(a.inputId,a.containerId,this.dataSource);this.count=a.count;this.autoComplete.autoHighlight=false;this.autoComplete.maxResultsDisplayed=a.count;this.autoComplete.queryDelay=a.delay;this.autoComplete.allowBrowserAutocomplete=false;this.autoComplete.typeAhead=true;this.autoComplete.animVert=false;this.autoComplete.animHoriz=false;this.autoComplete.delimChar=",";this.autoComplete.setHeader('Choose a quote match or "GO" to get quote news');this.autoComplete.setFooter("Separate multiple symbols with commas (,)");this.autoComplete.formatResult=function(f,k,p){return a.sections[p].formatFunc(f,k,p,this)};this.autoComplete.dataReturnEvent.subscribe(this.checkResultsForExactMatch,this.autoComplete,this);this.autoComplete.textboxKeyEvent.subscribe(this.checkPastExactResults,this.autoComplete,this)}};InfoComplete.prototype.getFirstDelimChar=function(){if(this.autoComplete.delimChar&&this.autoComplete.delimChar.length>0)return this.autoComplete.delimChar[0];return""};InfoComplete.prototype.isSymbolMatch=function(){var a=this.getFirstDelimChar();if(this.currentQueryHasResultMatch===true&&this.lastExactResult.toUpperCase()==autoCompleteTrim(this.autoComplete._oTextbox.value).replace(/,$|\.,$/,"").toUpperCase())return true;a=this.autoComplete._oTextbox.value.split(a);for(var b=0;b<this.exactMatches.length;b++)for(var c=0;c<a.length;c++)if(this.exactMatches[b]==a[c])return true;return this.doesListHaveMatch(0)};InfoComplete.prototype.handleError=function(a,b){var c=b[1];c._populateStaging&&c._populateStaging("null",null,c,b[0].index)};InfoComplete.prototype.checkPastExactResults=function(a,b){if("function"==typeof this.getFirstDelimChar){var c=this.getFirstDelimChar();if(b[0]._oTextbox.value.length>0&&b[0]._oTextbox.value.lastIndexOf(c)==b[0]._oTextbox.value.length-1&&this.currentQueryHasResultMatch){if(this.exactMatches.length>0)for(c=0;c<this.exactMatches.length;c++)if(this.exactMatches[c]==this.lastExactResult)return;this.exactMatches.push(this.lastExactResult);this.lastExactMatchResultSet.push(this.getLastMatchResultset(0,this.lastExactResult))}}};InfoComplete.prototype.checkResultsForExactMatch=function(a,b){if(!(!b||b.length<4||b[3]>0)){var c=this.getFirstDelimChar(),d=b[2],e=b[0]._oTextbox.value;if(e.indexOf(c)>0){e=e.split(c);e=autoCompleteTrim(e[e.length-1])}if(d&&d.length>0)for(c=0;c<d.length;c++)if(d[c]&&d[c][0]!==null){var f=d[c][0];if(e.toUpperCase()==f.toUpperCase()){this.currentQueryHasResultMatch=true;this.lastExactResult=e;return}}this.currentQueryHasResultMatch=false}};InfoComplete.prototype.doesListHaveMatch=function(a){var b=this.getFirstDelimChar(),c=this.autoComplete.getListItems(),d=autoCompleteTrim(this.autoComplete._oTextbox.value).replace(/,$|\.,$/,"");if(d.indexOf(b)>0){d=d.split(b);d=autoCompleteTrim(d[d.length-1])}if(a<c.length){a=c[a];for(c=0;c<a.length;c++)if(a[c]&&a[c]._oResultData)if(d.toUpperCase()==a[c]._oResultData[0].toUpperCase())return true}return false};InfoComplete.prototype.getLastMatchResultset=function(a,b){var c=this.getFirstDelimChar(),d=this.autoComplete.getListItems();if(b.indexOf(c)>0){c=b.split(c);b=autoCompleteTrim(c[c.length-1])}if(a<d.length){d=d[a];for(c=0;c<d.length;c++)if(d[c]&&d[c]._oResultData)if(b.toUpperCase()==d[c]._oResultData[0].toUpperCase())return d[c]._oResultData}return null};function param(){this.array=Array(1);this.setValue=function(a){this.array[0]=a};this.getValue=function(){return this.array[0]}}
function InstallLibrary(a){a=a||window;a.symbolComplete=new InfoComplete;a.InfoComplete=new InfoComplete}InstallLibrary();dojo.provide("dj.widget.networkHat.RCLogin");dojo.require("dj.util.queryParam");dojo.require("dj.util.Cookie");dj.widget.networkHat.RCLogin={init:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this.pageLoaded()},DEFAULT_CONFIG:{loginInfoDiv:"riskComplianceLogInInfoDivId",loginInfoClose:".riskComplianceLogInClose",riskTabInHat:"hat_tab_risk",hatTabWithRiskSelected:"hat_div",cookie:{name:"RnC",on:"1",off:"0",ttl:365}},pageLoaded:function(){dojo.addClass(dojo.byId(this._cfg.hatTabWithRiskSelected),"RiskLogIn");if(!this.isCookieSet()){this.showMarketingDialog();dojo.query(this._cfg.loginInfoClose).connect("click",this,function(){this.closeMarketingDialog()})}},showMarketingDialog:function(){dojo.removeClass(dojo.byId(this._cfg.loginInfoDiv),"hidden")},closeMarketingDialog:function(){dojo.addClass(dojo.byId(this._cfg.loginInfoDiv),"hidden");this.dropCookie()},isCookieSet:function(){var a=this._cfg.cookie;return dj.util.Cookie.getGroupCookie("DJCOOKIE",a.name)===a.on},dropCookie:function(){var a=this._cfg.cookie;dj.util.Cookie.setGroupCookie("DJCOOKIE",a.name,a.on,a.ttl)}};dojo.provide("dj.widget.networkHat.AutoComplete");dojo.require("dj.widget.networkHat.infocomplete");dojo.require("dj.lang");dojo.getObject("dj.context.networkHat",true);(function(){var a=dj.widget.networkHat;(a.AutoComplete=function(){this.d=document;this.cdnDomain=dj.context.core.cdnPrefix;this.uP="";if(typeof uP!="undefined")this.uP=uP;var b=new Date;b=""+b.getFullYear()+(b.getMonth()+1)+b.getDate();this.jScript=this.d.location.host.indexOf("s.dev")!=-1||this.d.location.host.indexOf("idev")!=-1?this.uP+"/djscript/j_networkHat-"+b+".js":this.cdnDomain+"/djscript/j_networkHat-"+b+".js";this.d.getElementsByTagName("div")[0].className.indexOf("subType-subscribed");this.inputDefaultText="News, Quotes, Companies, Videos";if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.inputDefaultText!==undefined)this.inputDefaultText=dj.autocompletesearch.inputDefaultText;b=dojo.byId("hat_div");this.oHatInput=dojo.byId("hat_input_auto");dojo.query(".hat_select",b);if(dojo.isIE&&(this.d.domain.indexOf("ds.sat.wsj.com")!=-1||this.d.domain.indexOf("ds.wsj.com")!=-1))dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");this.onfocusLoad=dojo.connect(this.oHatInput,"onfocus",this,this.onHatLoad);this.onmouseoverLoad=dojo.connect(this.oHatInput,"onmouseover",this,this.onHatLoad);this.onclickClear=dojo.connect(this.oHatInput,"onclick",this,this.clearField);this.onkeydownClear=dojo.connect(this.oHatInput,"onkeydown",this,this.clearField);if(this.oHatInput.value!==""&&this.oHatInput.value!=this.inputDefaultText||dj.context.networkHat.jnetworkHatJsLoaded)this.onHatLoad();this.setFieldDefault()}).prototype={setFieldDefault:function(){if(this.oHatInput.value===""){this.oHatInput.value=this.inputDefaultText;dojo.addClass(this.oHatInput,"unUsed")}},clearField:function(){this.stopObservingClick();if(dojo.hasClass(this.oHatInput,"unUsed"))this.oHatInput.value="";dojo.removeClass(this.oHatInput,"unUsed")},stopObservingClick:function(){dojo.disconnect(this.onclickClear);dojo.disconnect(this.onkeydownClear)},onHatLoad:function(){dojo.disconnect(this.onfocusLoad);dojo.disconnect(this.onmouseoverLoad);if(dj.context.networkHat.jnetworkHatJsLoaded)this.initInfoComplete();else{var b;if(!this.d.getElementsByTagName("head")){b=new Element("head");this.d.getElementsByTagName("body")[0].appendChild(b)}this.jsNode=this.loadAutoCompleteScript(this.jScript)}},loadAutoCompleteScript:function(b){var c=this.d.createElement("script");c.type="text/javascript";c.src=b;if(this.d.getElementsByTagName("head").length===0){b=this.d.createElement("head");this.d.getElementsByTagName("html")[0].appendChild(b)}this.d.getElementsByTagName("head")[0].appendChild(c);return c},initInfoComplete:function(){if(dojo.isIE&&(this.d.domain.indexOf("ds.sat.wsj.com")!=-1||this.d.domain.indexOf("ds.wsj.com")!=-1))dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");initInfoCompleteNew();this.stopObservingClick();dojo.connect(this.oHatInput,"onfocus",null,function(){this.style.backgroundImage="url('http://s.wsj.net/img/b.gif')";searchFieldOnFocus(this);setFocused(this)});dojo.connect(this.oHatInput,"onkeypress",null,function(){showHideCRDrpdwn("hide")});dojo.connect(this.oHatInput,"onblur",null,function(){showHideCRDrpdwn("show")});var b=this.oHatInput.value;if(InfoComplete.autoComplete.dataSources&&InfoComplete.autoComplete.dataSources.length>=2)InfoComplete.autoComplete.dataSources[InfoComplete.keyword].scriptQueryParam="query";b&&b!=this.inputDefaultText&&InfoComplete.autoComplete.sendQuery(b)}}})();dojo.provide("dj.widget.networkHat.FactivaLogin");dojo.require("dj.util.queryParam");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dj.widget.networkHat.FactivaLogin={init:function(a,b){function c(f,k){dojo.byId(f).href=k}var d=dj.util.queryParam.getQueryStrParams(),e=this.CONFIG=dojo.mixin({useridemail:function(f,k){dojo.byId(f).value=k},regurl:c,forgoturl:c,enableurl:c,loginurl:function(f,k){dojo.byId(f).action=k},getFactivaOpen:"factivaLogInGet",getFactivaClose:"factivaLogInClose",getFactivaPopout:"factivaLogInInfo",twitterAndFacebook:false,cookie:{name:"FLMD",on:"1",off:"0",ttl:365},weekend:{hideContentBucket:"#headerContentBucket",showContentBucket:"#headerContentBucket_factiva",qualifier:"pageType-weekend"}},a);for(id in d)e[id]&&e[id](id,d[id]);dojo.connect(dojo.byId(e.getFactivaClose),"click",this,function(f){dojo.stopEvent(f);this.closeMarketingDialog()});if(e.twitterAndFacebook){dojo.require("dj.widget.networkHat.hat");hat.init()}this.isCookieSet()||this.showMarketingDialog();typeof b!=="undefined"&&b!==null&&this.inDateRange(b)&&dj.util.User.isLoggedIn(dojo.hitch(this,function(f){f&&this.switchWeekendContentBucket()}))},showMarketingDialog:function(){dojo.removeClass(dojo.byId(this.CONFIG.getFactivaPopout),"hidden")},closeMarketingDialog:function(){dojo.addClass(dojo.byId(this.CONFIG.getFactivaPopout),"hidden");this.dropCookie()},isCookieSet:function(){var a=this.CONFIG.cookie;return dj.util.Cookie.getGroupCookie("DJCOOKIE",a.name)===a.on},dropCookie:function(){var a=this.CONFIG.cookie;dj.util.Cookie.setGroupCookie("DJCOOKIE",a.name,a.on,a.ttl)},switchWeekendContentBucket:function(){var a=this.CONFIG.weekend;dojo.query(a.hideContentBucket).forEach(function(b){dojo.addClass(b,"hidden")});dojo.query(a.showContentBucket).forEach(function(b){dojo.removeClass(b,"hidden")})},inDateRange:function(a){if(typeof serverTime==="undefined"||serverTime===null)serverTime=new Date;var b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][serverTime.getDay()];a=a.split(",");for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e===b)return true;else{var f=e.split("-");if(f[0]===b){e=f.length<2||f[1]===""?0:parseInt(f[1],10);f=f.length<3||f[2]===""?2359:parseInt(f[2],10);var k=serverTime.getHours(),p=serverTime.getMinutes();k=parseInt("".concat(k).concat((p<10?"0":"")+p),10);if(k<=f&&k>=e)return true}}}return false}};
dojo.provide("dj.module.electionEmailSignUp");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dj.module.electionEmailSignUp={init:function(){this.oContainers=dojo.query("ul#electionEmList li a.electionsBtnEmailSignup");this.oContainers.forEach(function(el){this.initializeContainer(el);},this);},initializeContainer:function(oContainer){if(oContainer!==null){this.setUpControllers(oContainer);}},setUpControllers:function(oContainer){var that=this;dojo.connect(oContainer,"onclick",this,function(ev){dojo.stopEvent(ev);this.signUp(oContainer,oContainer.id);});},signUp:function(oContainer,newsletterId){this.signUpUrl="/emailservice/email-signup";this.userLoginName="";var that=this;dj.util.User.getUserId(function(userId){that.userLoginName=userId;});this.oEmail=dojo.query(".electionsUserEmail")[0];dj.util.User.renderEmailAddress(this.oEmail);this.userEmail=this.oEmail.innerHTML;this.postBody=this.buildPostBody(newsletterId);this.request=dojo.xhrPost({url:this.signUpUrl,postData:that.postBody,handleAs:"xml",headers:{"Content-Type":"text/xml"},error:function(error,ioArgs){if(409==ioArgs.xhr.status){that.showError();}else if(ioArgs.xhr.status>500&&ioArgs.xhr.status<600){that.showContent();console.error("{emailSignUp} error %s - server error",ioArgs.xhr.status);}},load:function(data,ioArgs){that.showSuccess(newsletterId);}});},buildPostBody:function(newsletterId){var isReg=false;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){if(!subLoggedIn){isReg=true;}});}});var isEnt=false;dj.util.User.hasRole('WSJ-ENT',function(hasRole){if(hasRole){isEnt=true;}});var isCfo=false;dj.util.User.hasRole('WSJ-CFO-PRO',function(hasRole){if(hasRole){isCfo=true;}});dj.util.User.hasRole('WSJ-ENT-CFO',function(hasRole){if(hasRole){isCfo=true;}});dj.util.User.hasRole('WSJ-CFO-PRO-TRIAL',function(hasRole){if(hasRole){isCfo=true;}});var isPro=false;dj.util.User.hasRole('WSJ-PRO',function(hasRole){if(hasRole){isPro=true;}});var x=[];x[x.length]="<customer>";x[x.length]="<login-name>"+this.userLoginName+"</login-name>";x[x.length]="<contacts class=\"java.util.ArrayList\">";x[x.length]="<contact><last-modified-by>"+this.userLoginName+"</last-modified-by><contact-address>"+this.userEmail+"</contact-address><contact-status>V</contact-status>";x[x.length]="<bulk-emails class=\"java.util.ArrayList\">";x[x.length]="<bulk-email><opt-in-flag>1</opt-in-flag><email-type-id>"+newsletterId+"</email-type-id></bulk-email>";x[x.length]="</bulk-emails>";x[x.length]="</contact>";x[x.length]="</contacts>";x[x.length]="<products class=\"java.util.ArrayList\">";if(isEnt){x[x.length]="<product><id>501</id><name>WSJ ENT</name><description>WSJ Enterprise Product</description></product>";}else if(isReg){x[x.length]="<product><id>301</id><name>WSJ</name><description>WSJ Email Product</description></product>";}else if(isCfo){x[x.length]="<product><id>101</id><name>WSJ</name><description>CFO Professional Product</description></product>";}else if(isPro){x[x.length]="<product><id>821</id><name>WSJ</name><description>WSJ Professional Product</description></product>";}else{x[x.length]="<product><id>2</id><name>WSJ</name><description>WSJ Email Product</description></product>";}
x[x.length]="</products>";x[x.length]="</customer>";x=x.join('\n');return x;},showSuccess:function(newsletterId){dojo.addClass(dojo.byId(newsletterId),"hidden");dojo.removeClass(dojo.byId(newsletterId+"electionsSignedUp"),"hidden");},showError:function(){this.userEmail="";console.log("error");},showContent:function(){console.log("error - server error");}};dojo.provide("dj.module.electionToolbar");dojo.require("dj.lang");dojo.require("dj.util.Element");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.User");dj.module.electionToolbar={init:function(customConfig){this._cfg={urlPath:"/public/page",toolBarFBButton:"#tbar_fb_button",toolBarTwtButton:"#tbar_twt_button",toolBarEmailButton:"#tbar_email_button",toolBarFBOverlay:"fbOverlay",toolBarTwtOverlay:"twtOverlay",toolBarEmailOverlay:"emailOverlay",toolBarFBShareCount:"electionShareCountFB",toolBarTwtShareCount:"electionShareCountTwt",toolBarFaceBookIframe:"facebook_iframe",toolBarTwtIframe:"twt_iframe",toolBarOverlayClose:".electionsToolbarShareClose",toolBarUSDropdown:"#electionsmnIndicator",toolBarUSDropdownMoreIn:"#electionmnMoreIn",toolBarUSDropDownContainer:"electionDropdown",toolBarUSDropdownHTMLContainer:"dropdown_result"};if(customConfig){this._cfg=dojo.mixin(this._cfg,customConfig);}
this.userLoginName="";this.addEvents();},addEvents:function(){var that=this;dj.lang.addLiveEvent(this._cfg.toolBarFBButton,"click",function(event){dojo.stopEvent(event);that.closeTwtOverlay();that.closeEmailOverlay();that.closeMoreDropDown();dojo.removeClass(dojo.byId(that._cfg.toolBarFBOverlay),"hidden");var overlay=dojo.byId(that._cfg.toolBarFBShareCount);if(!window.frames[that._cfg.toolBarFaceBookIframe]){that.createIFRAME(that._cfg.toolBarFaceBookIframe,"http://www.facebook.com/plugins/like.php?href=http://online.wsj.com/public/page/news-politics-campaign.html&action=recommend&layout=button_count&send=false&show_faces=false&width=90",overlay,"100px");}});dj.lang.addLiveEvent(this._cfg.toolBarTwtButton,"click",function(event){dojo.stopEvent(event);that.closeFBOverlay();that.closeEmailOverlay();that.closeMoreDropDown();dojo.removeClass(dojo.byId(that._cfg.toolBarTwtOverlay),"hidden");var overlay=dojo.byId(that._cfg.toolBarTwtShareCount);if(!window.frames[that._cfg.toolBarTwtIframe]){that.createIFRAME(that._cfg.toolBarTwtIframe,"http://platform.twitter.com/widgets/follow_button.html?screen_name=WSJPolitics&amp;show_count=true&amp;show_screen_name=true",overlay,"230px");}});dj.lang.addLiveEvent(this._cfg.toolBarEmailButton,"click",function(event){dojo.stopEvent(event);that.closeFBOverlay();that.closeTwtOverlay();that.closeMoreDropDown();dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){dojo.removeClass(dojo.byId(that._cfg.toolBarEmailOverlay),"hidden");dojo.removeClass(dojo.byId("electionEmList"),"hidden");});}else{dojo.removeClass(dojo.byId(that._cfg.toolBarEmailOverlay),"hidden");if(dojo.byId("emMsg")==null||dojo.byId("emMsg")==undefined){var overlayelement=dojo.byId("emailOverlay");var caption=dojo.create("p",{"class":"emMsg",id:"emMsg",innerHTML:"Please <a href='http://online.wsj.com/login'>LOGIN</a> or <a href='https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aaaibmyv'>SUBSCRIBE</a> to sign up for WSJ Election newsletters."});overlayelement.appendChild(caption);}}});});dj.lang.addLiveEvent(this._cfg.toolBarOverlayClose,"click",function(event){dojo.stopEvent(event);that.closeFBOverlay();that.closeTwtOverlay();that.closeEmailOverlay();});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdown,"mouseover",function(event){trimmedContainer=dojo.trim(dojo.byId(that._cfg.toolBarUSDropdownHTMLContainer).innerHTML);if(trimmedContainer.length==0){that.getUSDropdownHTML();}});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdownMoreIn,"mouseover",function(event){trimmedContainer=dojo.trim(dojo.byId(that._cfg.toolBarUSDropdownHTMLContainer).innerHTML);if(trimmedContainer.length==0){that.getUSDropdownHTML();}});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdown,"click",function(event){that.closeFBOverlay();that.closeTwtOverlay();that.closeEmailOverlay();that.updateMoreDropDownClassName();dojo.stopEvent(event);});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdownMoreIn,"click",function(event){that.closeFBOverlay();that.closeTwtOverlay();that.closeEmailOverlay();that.updateMoreDropDownClassName();dojo.stopEvent(event);});dojo.connect(document,"onclick",this,function(event){var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#fbOverlay")[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(!dojo.hasClass(that._cfg.toolBarFBOverlay,"hidden")){that.closeFBOverlay();dojo.stopEvent(event);}}
var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#twtOverlay")[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(!dojo.hasClass(that._cfg.toolBarTwtOverlay,"hidden")){that.closeTwtOverlay();dojo.stopEvent(event);}}
var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#emailOverlay")[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(!dojo.hasClass(that._cfg.toolBarEmailOverlay,"hidden")){that.closeEmailOverlay();dojo.stopEvent(event);}}
var moreInDropDownContainter=dojo.query("#election2012MainNav ul li div#dropdown_result div.wsjmn_dropdownPanel div.wsjmn_dropdownContent")[0];if(typeof moreInDropDownContainter!=="undefined"&&moreInDropDownContainter){var isPointerinModalContainer=dj.util.Element.contains(moreInDropDownContainter,event.clientX,event.clientY);if(isPointerinModalContainer===false){if(dojo.hasClass(that._cfg.toolBarUSDropDownContainer,"wsjmnExt_ddState-expanded")){var selElement=dojo.byId(this._cfg.toolBarUSDropDownContainer);selElement.className=selElement.className.replace("wsjmnExt_ddState-expanded","wsjmnExt_ddState-collapsed");dojo.stopEvent(event);}}}});},createIFRAME:function(name,src,overlay,width){var ifrm=dojo.create('iframe',{"id":name,"src":src,"name":name,"height":"20px","width":width,"scrolling":"no","frameBorder":"0","allowtransparency":"true"});overlay.appendChild(ifrm);},getUSDropdownHTML:function(){dojo.xhrGet({url:this._cfg.urlPath+"/0_0_WG_HeaderOne_Dropdown-na-us.html?path=false&business=false",headers:{Accept:'application/html'},handleAs:"text",load:function(response,ioArgs){dojo.byId("dropdown_result").innerHTML=response;dojo.query('#dropdown_result .wsjmn_dropdown_container .mn_dropdownTitlebar .mndType-more .mnText .mnLabel')[0].innerHTML="MORE IN U.S.";dojo.query('#dropdown_result .wsjmn_dropdown_container .mn_dropdownTitlebar .mndType-more .mnText .mnLabel')[0].id="electionmnMoreIn";dojo.query('#dropdown_result .wsjmn_dropdown_container .mn_dropdownTitlebar .mndType-more .mnIndicator')[0].id="electionsmnIndicator";},error:function(response,ioArgs){console.error("HTTP status code: ",ioArgs.xhr.status);}});},closeFBOverlay:function(){dojo.addClass(dojo.byId(this._cfg.toolBarFBOverlay),"hidden");},closeTwtOverlay:function(){dojo.addClass(dojo.byId(this._cfg.toolBarTwtOverlay),"hidden");},closeEmailOverlay:function(){dojo.addClass(dojo.byId(this._cfg.toolBarEmailOverlay),"hidden");},updateMoreDropDownClassName:function(){var selElement=dojo.byId(this._cfg.toolBarUSDropDownContainer);if(selElement.className.match(/wsjmnExt_ddState-expanded/)){selElement.className="wsjmn_dropdownTree wsjmnExt_ddState-collapsed wsjmn_dropdownName-us";}else if(selElement.className.match(/wsjmnExt_ddState-collapsed/)){selElement.className="wsjmn_dropdownTree wsjmnExt_ddState-expanded wsjmn_dropdownName-us";}},closeMoreDropDown:function(){var selElement=dojo.byId(this._cfg.toolBarUSDropDownContainer);if(dojo.byId(this._cfg.toolBarUSDropDownContainer).className.match(/wsjmnExt_ddState-expanded/)){selElement.className=selElement.className.replace("wsjmnExt_ddState-expanded","wsjmnExt_ddState-collapsed");}}};dojo.provide("dj.module.electionSlimBar");dojo.require("dj.lang");dojo.require("dj.util.Element");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dojo.date");dojo.require("dojo.date.locale");dj.module.electionSlimBar={init:function(customConfig){this._cfg={urlPath:"/public/page",toolBarFBShareCount:"electionShareCountFB",toolBarTwtShareCount:"electionShareCountTwt",toolBarFaceBookIframe:"facebook_iframe",toolBarTwtIframe:"twt_iframe",toolBarOverlayClose:".electionsToolbarShareClose",toolBarSocialOverlay:"tbar_social_button",toolBarSocialButton:"#tbar_social_button"};if(customConfig){this._cfg=dojo.mixin(this._cfg,customConfig);}
this.addEvents();},addEvents:function(){var that=this;dj.lang.addLiveEvent(this._cfg.toolBarSocialButton,"click",function(event){dojo.stopEvent(event);if(dojo.hasClass(that._cfg.toolBarSocialOverlay,"popOpen")){that.closeSocialOverlay();}else{dojo.addClass(dojo.byId(that._cfg.toolBarSocialOverlay),"popC popOpen");var overlay=dojo.byId(that._cfg.toolBarFBShareCount);if(!window.frames[that._cfg.toolBarFaceBookIframe]){that.createIFRAME(that._cfg.toolBarFaceBookIframe,"http://www.facebook.com/plugins/like.php?href=http://online.wsj.com/public/page/news-politics-campaign.html&action=like&layout=button_count&send=false&show_faces=false&width=100",overlay,"100px");}
var overlaytw=dojo.byId(that._cfg.toolBarTwtShareCount);if(!window.frames[that._cfg.toolBarTwtIframe]){that.createIFRAME(that._cfg.toolBarTwtIframe,"http://platform.twitter.com/widgets/follow_button.html?screen_name=WSJPolitics&amp;show_count=false&amp;show_screen_name=true",overlaytw,"300px");}}});dojo.connect(document,"onclick",this,function(event){var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#"+that._cfg.toolBarSocialOverlay)[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(dojo.hasClass(that._cfg.toolBarSocialOverlay,"popOpen")){that.closeSocialOverlay();dojo.stopEvent(event);}}});},createIFRAME:function(name,src,overlay,width){var ifrm=dojo.create('iframe',{"id":name,"src":src,"name":name,"height":"20px","width":width,"scrolling":"no","frameBorder":"0","allowtransparency":"true"});overlay.appendChild(ifrm);},closeSocialOverlay:function(){dojo.removeClass(dojo.byId(this._cfg.toolBarSocialOverlay),"popOpen");dojo.addClass(dojo.byId(this._cfg.toolBarSocialOverlay),"popC popClosed");},SLIDER_CONFIG:{chip:"",version:2.8,TTL:"1m",param:"",sliderRefreshTimer:65000,presidentJsonPageURL:"/public/npage/0_0_WP_elections_presidentFeed",senateHouseJsonPageURL:"/public/npage/0_0_WP_elections_senateHouseFeed",sliderContainerDiv:"electionSliderDivId",maxCacheDurationSeconds:0,cIdPres:"pres",cIdSenat:"senat",presidentURL:"/projectsDomain/live/elections2012/pres_summary.json",senateHouseURL:"/projectsDomain/live/elections2012/congressresults.json",showNetOnSenate:true,showNetOnHouse:true,randomVersion:false,removeLoadingSign:10000,modValue:60},refreshSliderContents:function(sliderConfig){dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");this.sliderConfig=dojo.mixin(this.SLIDER_CONFIG,sliderConfig);this.refreshSliderData();setTimeout(dojo.hitch(this,this.hideLoadingSign),this.sliderConfig.removeLoadingSign,null);},setDataRefreshTimer:function(){setTimeout(dojo.hitch(this,this.refreshSliderData),this.sliderConfig.sliderRefreshTimer,null);},setDataAjaxTimer:function(){setTimeout(dojo.hitch(this,this.ajaxSliderData),this.sliderConfig.sliderRefreshTimer,null);},refreshSliderData:function(){this.refreshPresidentData();this.refreshSenateHouseData();this.setDataRefreshTimer();},ajaxSliderContents:function(sliderConfig){dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");this.sliderConfig=dojo.mixin(this.SLIDER_CONFIG,sliderConfig);this.setDataAjaxTimer();},ajaxSliderData:function(){this.ajaxPresidentData();this.ajaxSenateHouseData();this.setDataAjaxTimer();},ajaxPresidentData:function(){var xhrArgs=({url:this.sliderConfig.presidentURL,preventCache:true,handleAs:"json",load:dojo.hitch(this,function(response){if(response!=null&&typeof response!="undefined"){this.updatePresidentData(response);}}),error:function(error){console.log("president data couldnt be loaded "+error);}});var deferred=dojo.xhrGet(xhrArgs);},ajaxSenateHouseData:function(){var xhrArgs=({url:this.sliderConfig.senateHouseURL,preventCache:true,handleAs:"json",load:dojo.hitch(this,function(response){if(response!=null&&typeof response!="undefined"){this.updateSenateHouseData(response);}}),error:function(error){console.log("senate House data couldnt be loaded "+error);}});var deferred=dojo.xhrGet(xhrArgs);},refreshPresidentData:function(){console.log("refreshing slider president");if(this.sliderConfig.randomVersion){this.sliderConfig.version=(Math.floor((new Date().getTime())/60000))%this.sliderConfig.modValue;}
this.presidentloader=new dj.widget.fragmentloader.FragmentJSONLoader(this.sliderConfig.presidentJsonPageURL+this.sliderConfig.chip+".html"+this.sliderConfig.param,this.sliderConfig.version,{cId:this.sliderConfig.cIdPres,TTL:this.sliderConfig.TTL,maxCacheDurationSeconds:this.sliderConfig.maxCacheDurationSeconds});this._connectToPresidentLoaderEvents();this.presidentloader.load();},refreshSenateHouseData:function(){console.log("refreshing slider house");this.senateHouseLoader=new dj.widget.fragmentloader.FragmentJSONLoader(this.sliderConfig.senateHouseJsonPageURL+this.sliderConfig.chip+".html"+this.sliderConfig.param,this.sliderConfig.version,{cId:this.sliderConfig.cIdSenat,TTL:this.sliderConfig.TTL,maxCacheDurationSeconds:this.sliderConfig.maxCacheDurationSeconds});this._connectToSenateHouseLoaderEvents();this.senateHouseLoader.load();},_connectToSenateHouseLoaderEvents:function(){dojo.connect(this.senateHouseLoader,"onLoadJson",dojo.hitch(this,function(data){var senHouseData=dojo.fromJson(data.jsonFile.data);this.updateSenateHouseData(senHouseData);this.hideLoadingSign();}))},updateSenateHouseData:function(senHouseData){var senateData=senHouseData.results.S;var senateDataArr=senateData.party;for(var j=0;j<senateDataArr.length;j++){partyInfo=senateDataArr[j];if(partyInfo.title=="Dem"){var senateDemTrendArr=partyInfo.trend;for(var t=0;t<senateDemTrendArr.length;t++){if(senateDemTrendArr[t].name=="Won"){var sDemWonVal=senateDemTrendArr[t].value;try{var sDemWonValNum=parseInt(sDemWonVal,10);}catch(e){sDemWonValNum=0;console.log("error converting to num"+e)};var sDemWonVal=sDemWonValNum+30;break;}}
var sDemNcTrendArr=partyInfo.NetChange.trend;for(var n=0;n<sDemNcTrendArr.length;n++){var sDemNcTrendIns=sDemNcTrendArr[n];if(sDemNcTrendIns.name=="Winners"){var sDemNcWinnersVal=sDemNcTrendIns.value;break;}}}
if(partyInfo.title=="GOP"){var senateRepubTrendArr=partyInfo.trend;for(var r=0;r<senateRepubTrendArr.length;r++){if(senateRepubTrendArr[r].name=="Won"){var sRepubWonVal=senateRepubTrendArr[r].value;try{var sRepubWonValNum=parseInt(sRepubWonVal,10);}catch(e){sRepubWonValNum=0;console.log("error converting to num"+e)};var sRepubWonVal=sRepubWonValNum+37;break;}}
var sRepubNcTrendArr=partyInfo.NetChange.trend;for(var rn=0;rn<sRepubNcTrendArr.length;rn++){var sRepubNcTrendIns=sRepubNcTrendArr[rn];if(sRepubNcTrendIns.name=="Winners"){var sRepubNcWinnersVal=sRepubNcTrendIns.value;break;}}}
if(partyInfo.title=="Others"){var senateOthersTrendArr=partyInfo.trend;for(var so=0;so<senateOthersTrendArr.length;so++){if(senateOthersTrendArr[so].name=="Won"){var sOthersWonVal=senateOthersTrendArr[so].value;break;}}}}
var sDemWonValTotal=sDemWonVal;try{var sOthersWonValNum=parseInt(sOthersWonVal,10);}catch(e){sOthersWonValNum=0;console.log("error converting to num"+e)};if(sOthersWonValNum>0){try{var sDemWonValNum=parseInt(sDemWonVal,10);}catch(e){sDemWonValNum=0;console.log("error converting to num"+e)};try{var sOthersWonValNum=parseInt(sOthersWonVal,10);}catch(e){sOthersWonValNum=0;console.log("error converting to num"+e)};var sDemWonValTotal=sDemWonValNum+sOthersWonValNum;}
var house=senHouseData.results.H;var houseArr=house.party;for(var hi=0;hi<houseArr.length;hi++){var partyInfo=houseArr[hi];if(partyInfo.title=="Dem"){var houseDemTrendArr=partyInfo.trend;for(var hr=0;hr<houseDemTrendArr.length;hr++){if(houseDemTrendArr[hr].name=="Won"){var hDemWonVal=houseDemTrendArr[hr].value;break;}}
var hDemNcTrendArr=partyInfo.NetChange.trend;for(var ho=0;ho<hDemNcTrendArr.length;hDemNcTrendArr++){var hDemNcTrendIns=hDemNcTrendArr[ho];if(hDemNcTrendIns.name=="Winners"){var hDemNcWinnersVal=hDemNcTrendIns.value;break;}}}
if(partyInfo.title=="GOP"){var houseRepubTrendArr=partyInfo.trend;for(var rt=0;rt<houseRepubTrendArr.length;rt++){if(houseRepubTrendArr[rt].name=="Won"){var hRepubWonVal=houseRepubTrendArr[rt].value;break;}}
var hRepubNcTrendArr=partyInfo.NetChange.trend;for(var rn=0;rn<hRepubNcTrendArr.length;rn++){var hRepubNcTrendIns=hRepubNcTrendArr[rn];if(hRepubNcTrendIns.name=="Winners"){var hRepubNcWinnersVal=hRepubNcTrendIns.value;break;}}}
if(partyInfo.title=="Others"){var houseOthersTrendArr=partyInfo.trend;for(var hot=0;hot<houseOthersTrendArr.length;hot++){if(houseOthersTrendArr[hot].name=="Won"){var hOthersWonVal=houseOthersTrendArr[hot].value;break;}}}}
var hRepubWonValTotal=hRepubWonVal;try{var hOthersWonValNum=parseInt(hOthersWonVal,10);}catch(e){hOthersWonValNum=0;console.log("error converting to num"+e)};if(hOthersWonValNum>0){try{var hRepubWonValNum=parseInt(hRepubWonVal,10);}catch(e){hRepubWonValNum=0;console.log("error converting to num"+e)};if(hOthersWonValNum>0){var hRepubWonValTotal=hRepubWonValNum+hOthersWonValNum;}}
var senateTotalVotes=100;var houseTotalVotes=435;var sliderContainerDivEle=dojo.byId(this.sliderConfig.sliderContainerDiv);var sDemWonValTotalArr=dojo.query("#sDemWonValTotalId",sliderContainerDivEle);if(sDemWonValTotalArr.length>0){sDemWonValTotalArr[0].innerHTML=sDemWonValTotal;}
if(this.sliderConfig.showNetOnSenate){var sDemNcWinnersValArr=dojo.query("#sDemNcWinnersValId",sliderContainerDivEle);if(sDemNcWinnersValArr.length>0){sDemNcWinnersValArr[0].innerHTML="Net "+sDemNcWinnersVal;}}
try{var sDemWonValNum=parseInt(sDemWonVal,10);}catch(e){sDemWonValNum=0;console.log("error converting to num"+e)};var sDenWonWidthPctIdArr=dojo.query("#sDenWonWidthPctId",sliderContainerDivEle);if(sDemWonValNum>0){var sDemWonPct=sDemWonValNum*100/senateTotalVotes;if(sDenWonWidthPctIdArr.length>0){sDenWonWidthPctIdArr[0].style.width=sDemWonPct+"%";}}else{if(sDenWonWidthPctIdArr.length>0){sDenWonWidthPctIdArr[0].style.width="0%";}}
try{var sOthersWonValNum=parseInt(sOthersWonVal,10);}catch(e){sOthersWonValNum=0;console.log("error converting to num"+e)};var sOthersWonValStylePctArr=dojo.query("#sOthersWonValStylePct",sliderContainerDivEle);if(sOthersWonValNum>0){sOthersWonValNum=sOthersWonValNum*100/senateTotalVotes;if(sOthersWonValStylePctArr.length>0){sOthersWonValStylePctArr[0].style.width=sOthersWonValNum+"%";sOthersWonValStylePctArr[0].style.left=sDemWonPct+"%";}}else{if(sOthersWonValStylePctArr.length>0){sOthersWonValStylePctArr[0].style.width="0%";sOthersWonValStylePctArr[0].style.left=sDemWonPct+"%";}}
try{var sRepubWonValNum=parseInt(sRepubWonVal,10);}catch(e){sRepubWonValNum=0;console.log("error converting to num"+e)};var sRepubWonWidthPctIdArr=dojo.query("#sRepubWonWidthPctId",sliderContainerDivEle);if(sRepubWonValNum>0){var sRepubWonValNum=sRepubWonValNum*100/senateTotalVotes;if(sRepubWonWidthPctIdArr.length>0){sRepubWonWidthPctIdArr[0].style.width=sRepubWonValNum+"%";}}else{if(sRepubWonWidthPctIdArr.length>0){sRepubWonWidthPctIdArr[0].style.width="0%";}}
var sRepubWonValIdArr=dojo.query("#sRepubWonValId",sliderContainerDivEle);if(sRepubWonValIdArr.length>0){sRepubWonValIdArr[0].innerHTML=sRepubWonVal;}
if(this.sliderConfig.showNetOnSenate){var sRepubNcWinnersValIdArr=dojo.query("#sRepubNcWinnersValId",sliderContainerDivEle);if(sRepubNcWinnersValIdArr.length>0){sRepubNcWinnersValIdArr[0].innerHTML="Net "+sRepubNcWinnersVal;}}
var hDemWonValIdArr=dojo.query("#hDemWonValId",sliderContainerDivEle);if(hDemWonValIdArr.length>0){hDemWonValIdArr[0].innerHTML=hDemWonVal;}
if(this.sliderConfig.showNetOnHouse){var hDemNcWinnersValIdArr=dojo.query("#hDemNcWinnersValId",sliderContainerDivEle);if(hDemNcWinnersValIdArr.length>0){hDemNcWinnersValIdArr[0].innerHTML="Net "+hDemNcWinnersVal;}}
try{var hDemWonValNum=parseInt(hDemWonVal,10);}catch(e){hDemWonValNum=0;console.log("error converting to num"+e)};var hDemWonWidthPctIdArr=dojo.query("#hDemWonWidthPctId",sliderContainerDivEle);if(hDemWonValNum>0){var hDemWonValNum=hDemWonValNum*100/houseTotalVotes;if(hDemWonWidthPctIdArr.length>0){hDemWonWidthPctIdArr[0].style.width=hDemWonValNum+"%";}}else{if(hDemWonWidthPctIdArr.length>0){hDemWonWidthPctIdArr[0].style.width="0%";}}
try{var hRepubWonValNum=parseInt(hRepubWonVal,10);}catch(e){hRepubWonValNum=0;console.log("error converting to num"+e)};if(hRepubWonValNum>0){var hRepubWonValNum=hRepubWonValNum*100/houseTotalVotes;}
try{var hOthersWonValNum=parseInt(hOthersWonVal,10);}catch(e){hOthersWonValNum=0;console.log("error converting to num"+e)};var hRepubWonStylePctIdArr=dojo.query("#hRepubWonStylePctId",sliderContainerDivEle);if(hOthersWonValNum>0){var hOthersWonValNum=hOthersWonValNum*100/houseTotalVotes;if(hRepubWonStylePctIdArr.length>0){hRepubWonStylePctIdArr[0].style.width=hOthersWonValNum+"%";hRepubWonStylePctIdArr[0].style.right=hRepubWonValNum+"%";}}else{if(hRepubWonStylePctIdArr.length>0){hRepubWonStylePctIdArr[0].style.width="0%";hRepubWonStylePctIdArr[0].style.right=hRepubWonValNum+"%";}}
var hRepubWonWidthPctIdArr=dojo.query("#hRepubWonWidthPctId",sliderContainerDivEle);if(hRepubWonWidthPctIdArr.length>0){hRepubWonWidthPctIdArr[0].style.width=hRepubWonValNum+"%";}
var hRepubWonValTotalIdArr=dojo.query("#hRepubWonValTotalId",sliderContainerDivEle);if(hRepubWonValTotalIdArr.length>0){hRepubWonValTotalIdArr[0].innerHTML=hRepubWonValTotal;}
var hRepubNcWinnersValIdArr=dojo.query("#hRepubNcWinnersValId",sliderContainerDivEle);if(hRepubNcWinnersValIdArr.length>0){hRepubNcWinnersValIdArr[0].innerHTML="Net "+hRepubNcWinnersVal;}},_connectToPresidentLoaderEvents:function(){dojo.connect(this.presidentloader,"onLoadJson",dojo.hitch(this,function(data){var presData=dojo.fromJson(data.jsonFile.data);this.updatePresidentData(presData);}))},updatePresidentData:function(presData){try{var presidentTotalVotes=538;var precinctsPct=presData.results.PrecinctsPct;var sliderTS=presData.results.wsjtimestamp;var candArr=presData.results.Cand;for(var i=0;i<candArr.length;i++){if(candArr[i].party=="Dem"){var demPopVote=candArr[i].PopVote;var demWinner=candArr[i].Winner;var demPopPct=candArr[i].PopPct;var demElectWon=candArr[i].ElectWon;}else if(candArr[i].party=="GOP"){var repubPopVote=candArr[i].PopVote;var repubWinner=candArr[i].Winner;var repubPopPct=candArr[i].PopPct;var repubElectWon=candArr[i].ElectWon;}}
try{var precinctsPctNum=parseInt(precinctsPct,10);}catch(e){precinctsPctNum=0;console.log("error converting to num"+e)};try{var demPopVoteNum=parseInt(demPopVote,10);}catch(e){demPopVoteNum=0;console.log("error converting to num"+e)};try{var repubPopVoteNum=parseInt(repubPopVote,10);}catch(e){repubPopVoteNum=0;console.log("error converting to num"+e)};try{var demElectWonNum=parseInt(demElectWon,10);}catch(e){demElectWonNum=0;console.log("error converting to num"+e)};try{var repubElectWonNum=parseInt(repubElectWon,10);}catch(e){repubElectWonNum=0;console.log("error converting to num"+e)};var totalPopVote=0;if(precinctsPctNum==0){totalPopVote=demPopVoteNum+repubPopVoteNum;if(totalPopVote>0){precinctsPct="Less than 1% of precincts reporting";}}else{precinctsPct=precinctsPct+"% of precincts reporting"}
var sliderContainerDivEle=dojo.byId(this.sliderConfig.sliderContainerDiv);if(sliderContainerDivEle!=null&&typeof sliderContainerDivEle!="undefined"){var demPopPctEleArr=dojo.query("#demPopPctId",sliderContainerDivEle);if(demPopPctEleArr.length>0){demPopPctEleArr[0].innerHTML=demPopPct+"%";}
if(demWinner=="X"){var demWinnerDivArr=dojo.query("#demWinnerDiv",sliderContainerDivEle);if(demWinnerDivArr.length>0){var demWinnerTickArr=dojo.query("#demWinnerTickId",sliderContainerDivEle);if(demWinnerTickArr.length>0){dojo.removeClass(demWinnerTickArr[0],"hidden");}else{var spanEle=dojo.create("span",{"id":"demWinnerTickId","class":"elGFlag winnerDem color_sd"},demWinnerDivArr[0],"first");spanEle.innerHTML='Winner<span class="winnerSym"></span></span>';}}}else{var demWinnerTickDivArr=dojo.query("#demWinnerTickId",sliderContainerDivEle);if(demWinnerTickDivArr.length>0){dojo.addClass(demWinnerTickDivArr[0],"hidden");}}
var demElectWonArr=dojo.query("#demElectWonId",sliderContainerDivEle);if(demElectWonArr.length>0){demElectWonArr[0].innerHTML=demElectWon;}
var demWonWidthPercentIdArr=dojo.query("#demWonWidthPercentId",sliderContainerDivEle);if(demElectWonNum>0){demElectWonPct=demElectWonNum*100/presidentTotalVotes;if(demWonWidthPercentIdArr.length>0){demWonWidthPercentIdArr[0].style.width=demElectWonPct+"%";}}else{if(demWonWidthPercentIdArr.length>0){demWonWidthPercentIdArr[0].style.width="0%";}}
var repubWonWidthPercentIdArr=dojo.query("#repubWonWidthPercentId",sliderContainerDivEle);if(repubElectWonNum>0){repubElectWonPct=repubElectWonNum*100/presidentTotalVotes;if(repubWonWidthPercentIdArr.length>0){repubWonWidthPercentIdArr[0].style.width=repubElectWonPct+"%";}}else{if(repubWonWidthPercentIdArr.length>0){repubWonWidthPercentIdArr[0].style.width="0%";}}
var repubPopPctArr=dojo.query("#repubPopPctId",sliderContainerDivEle);if(repubPopPctArr.length>0){repubPopPctArr[0].innerHTML=repubPopPct+"%";}
if(repubWinner=="X"){var repubPopPctEleArr=dojo.query("#repubWinnerDiv",sliderContainerDivEle);if(repubPopPctEleArr.length>0){var repubWinnerTickArr=dojo.query("#repubWinnerTickId",sliderContainerDivEle);if(repubWinnerTickArr.length>0){dojo.removeClass(repubWinnerTickArr[0],"hidden");}else{var spanEle1=dojo.create("span",{"id":"repubWinnerTickId","class":"elGFlag winnerRep color_sr"},repubPopPctEleArr[0],"first");spanEle1.innerHTML='Winner<span class="winnerSym"></span></span>';}}}else{var repubWinnerTickIdEleArr=dojo.query("#repubWinnerTickId",sliderContainerDivEle);if(repubWinnerTickIdEleArr.length>0){dojo.addClass(repubWinnerTickIdEleArr[0],"hidden");}}
var repubElectWonArr=dojo.query("#repubElectWonId",sliderContainerDivEle);if(repubElectWonArr.length>0){repubElectWonArr[0].innerHTML=repubElectWon;}
var precinctsPctArr=dojo.query("#precinctsPctId",sliderContainerDivEle);if(precinctsPctArr.length>0){precinctsPctArr[0].innerHTML=precinctsPct;}
try{var tIndex=sliderTS.indexOf("T");var dateVar=sliderTS.substring(0,tIndex);var dateSplitArr=dateVar.split("-");var timeVar=sliderTS.substring(tIndex+1);var timeSplitArr=timeVar.split(":");dt=new Date(dateSplitArr[0],dateSplitArr[1],dateSplitArr[2],timeSplitArr[0],timeSplitArr[1],timeSplitArr[2]);var formattedTime=dojo.date.locale.format(dt,{timePattern:"h:mma",selector:"time"});if(formattedTime.indexOf("PM")>-1){formattedTime=formattedTime.replace("PM"," p.m.");}else if(formattedTime.indexOf("AM")>-1){formattedTime=formattedTime.replace("AM"," a.m.");}
formattedTime=formattedTime+" ET";var sliderTimeEle=dojo.byId("sliderTimeId");sliderTimeEle.innerHTML=formattedTime;}catch(e1){console.log("error in formatting date"+e1);}}}catch(e2){console.log("error in pres data"+e2);}},hideLoadingSign:function(){var divEle=dojo.byId("electionToolBar2012Div");if(divEle!=null&&typeof divEle!="undefined"){if(dojo.hasClass(divEle,"elTLoading")){dojo.removeClass(divEle,"elTLoading");}}}};
dojo.provide("dj.module.browserPhaseout");dojo.declare("dj.module.browserPhaseout",null,{constructor:function(a){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,a);this._duc=dj.util.Cookie},DEFAULT_CONFIG:{djCookieName:"DJCOOKIE",djSessionName:"DJSESSION",bannerDivIdClass:"ie6banner",bannerDivId:"ie6bannerDiv",cookieName:"NoIE6Banner",phaseoutBr:"IE",brVersion:6},init:function(){this._cfg.phaseoutBr==="IE"&&dojo.isIE<=this._cfg.brVersion&&this.displayOrhideMessage()},displayOrhideMessage:function(){var a=this._duc.getGroupCookie(this._cfg.djSessionName,this._cfg.cookieName),b=this._duc.getGroupCookie(this._cfg.djCookieName,this._cfg.cookieName);this.hiddenClassName=this._cfg.bannerDivIdClass+" hidden";this.upgradeDiv=dojo.byId(this._cfg.bannerDivId);if(this.upgradeDiv!==null)if(a||b)this.upgradeDiv.className=this.hiddenClassName;else{this.displayBrowserImage();this.makeConnections()}},displayBrowserImage:function(){var a=[];dojo.query("#bList .b_li").forEach(function(f,g){a[g]=f.innerHTML});var b=0,c=a.length,e=(new Date).getMilliseconds();dojo.query("#bList .b_li").forEach(function(f){b=e%c--;f.innerHTML=a[b];a.splice(b,1)});this.upgradeDiv.className=this._cfg.bannerDivIdClass},makeConnections:function(){var a=this;dojo.connect(dojo.byId("actClose"),"onclick",function(){a.upgradeDiv.className=a.hiddenClassName;var b=dojo.byId("inputCheck");typeof b!="undefined"&&b.checked?dj.util.Cookie.setGroupCookie(a._cfg.djCookieName,a._cfg.cookieName,"Y",365):dj.util.Cookie.setGroupCookie(a._cfg.djSessionName,a._cfg.cookieName,"Y")})},openPopup:function(a,b,c){if(typeof b==="undefined")b=600;if(typeof c==="undefined")c=600;window.open(a,"browserDownload","width="+b+",height= "+c+",resizable=1,scrollbars=1,location=0,status=0")}});dojo.provide("dj.module.fbLikeButton");dj.module.fbLikeButton={init:function(a){window.fbAsyncInit=function(){FB.init({appId:a,xfbml:true});if(dj.lang.query(".aToolType-fbLike iframe")[0]!=null&&AT_VARS.articleType.indexOf("Infogrfx")==0)dj.lang.query(".aToolType-fbLike iframe")[0].src=dj.lang.query(".aToolType-fbLike iframe")[0].src+"&colorscheme=dark"};(function(){var b=document.createElement("script");b.async=true;b.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";document.getElementById("fb-root").appendChild(b)})()}};dojo.provide("dj.module.trafficTransit");dj.module.trafficTransit={init:function(){this.startAddress=dojo.byId("startAddress");this.endAddress=dojo.byId("endAddress");this.setEvent()},setEvent:function(){var a=this;dojo.connect(this.startAddress,"onfocus",this,function(b){b=b.srcElement||b.target;if(b.value===b.defaultValue){b.value="";dojo.removeClass(a.startAddress,"unUsed")}});dojo.connect(this.startAddress,"onblur",this,function(b){b=b.srcElement||b.target;if(b.value===""){b.value=b.defaultValue;dojo.addClass(a.startAddress,"unUsed")}});dojo.connect(this.endAddress,"onfocus",this,function(b){b=b.srcElement||b.target;if(b.value===b.defaultValue){b.value="";dojo.removeClass(a.endAddress,"unUsed")}});dojo.connect(this.endAddress,"onblur",this,function(b){b=b.srcElement||b.target;if(b.value===""){b.value=b.defaultValue;dojo.addClass(a.endAddress,"unUsed")}})}};dojo.provide("dj.module.carouselSection");dojo.require("dj.widget.panels.virtual.Carousel");dojo.addOnLoad(function(){dj.module.carouselSection=dj.widget.panels.PanelsFactory.create("carouselSection",{core:{panelGroup:".newsItem",panel:"li",paginationContainer:".pagination",viewport:2},carousel:{prevButton:".nav-inline .prev",nextButton:".nav-inline .next"},rotator:{rotateTime:10}})});dojo.provide("dj.module.chartbeat");dojo.require("dj.util.io");dj.module.chartbeat={init:function(){var a="",b=dojo.query("link[rel = canonical]");if(b.length>0)a=b[0].href?b[0].href:"";b=dj.context.core.urlPrefix;if(a.indexOf("http://kr.wsj.com/")!=-1)b="http://kr.wsj.com";else if(a.indexOf("http://indo.wsj.com/")!=-1)b="http://indo.wsj.com";var c=a.indexOf(".com")+4;a=a.substring(c);b=b.substring(7);if(typeof s!="undefined"&&typeof s.prop2!="undefined"){var e=s.prop2;if(e!="undefined")if(e.indexOf("WSJ_")<0)e="WSJ_"+e}window._sf_async_config={uid:8900,domain:b,path:a,sections:e};window._sf_endpt=(new Date).getTime();dj.util.io.insertScriptAsync(("https:"==document.location.protocol?"https://s3.amazonaws.com/":"http://")+"static.chartbeat.com/js/chartbeat.js")}};dojo.provide("dj.module.loomia");dojo.require("dj.util.Page");dj.module.loomia={init:function(){window.L_VARS={publisher_key:6563391702,guid:typeof s!="undefined"?s.prop20:"",anchor:"loomia_display",zone:10};dj.util.Page.addScript("http://widget-cache.loomia.com/js/onewidget_clix.js")}};dojo.provide("dj.module.metaWeb");dojo.require("dj.lang");dj.module.metaWeb={init:function(){var a=dj.lang,b=dojo.byId("suggest-input");b.value="Enter title, actor or director";dojo.connect(b,"onmouseover",this,this.addSuggest);var c=a.addLiveEvent("#suggest-input","click",function(){b.value="";a.removeLiveEvent(c)},this)},addSuggest:function(){if(!this.isJsAdded){var a=document,b=a.getElementsByTagName("head")[0],c=dojo.create("script",{src:"http://wfilm.freebaseapps.com/freebase_suggest_v2_min_js"});b.appendChild(c);b=dojo.create("link",{type:"text/css",rel:"stylesheet",href:"http://wfilm.freebaseapps.com/freebase_suggest_css"});if(a.getElementsByTagName("head").length===0){c=dojo.create("head");a.getElementsByTagName("html")[0].appendChild(c)}a.getElementsByTagName("head")[0].appendChild(b);this.isJsAdded=true}}};dojo.provide("dj.module.mostPopularTab");dojo.require("dj.widget.panels.virtual.Tabs");dj.module.mostPopularTab={init:function(a){var b=["mostRead","mostEmailed","mostPopularVideo","mostCommented","mostSearched"],c={core:{panelPrefix:"mostPopularTab_panel_",panels:b},tabs:{tabPrefix:"mostPopularTab_tab_",tabOnStyle:"selectedTab",tabOffStyle:"deselected"}};if(a)c.core=dojo.mixin(c.core,a);this.pnl=dj.widget.panels.PanelsFactory.create("mostPopularTab",c);c={core:{panelPrefix:"mostPopularTab_rssPanel_",panels:b,controller:this.pnl}};if(a)c.core=dojo.mixin(c.core,a);this.pnlRss=dj.widget.panels.PanelsFactory.create("mostPopularTab",c)}};dojo.provide("dj.module.newsTicker");dojo.require("dj.widget.panels.virtual.Carousel");dj.module.newsTicker={init:function(a){if(typeof this.ticker=="object")this.ticker.update();else this.ticker=this.createTicker(a)},createTicker:function(a){a=dojo.deepMixin({container:"newsTicker",assassinContainer:"topBanner",containerClass:"headlineSummary newsTicker newsTickerBg"},a);var b=dojo.byId(a.container);b.className=a.containerClass;return dj.widget.panels.PanelsFactory.create(b,{carousel:{type:"circular",prevButtonEnabledStyle:"",nextButtonEnabledStyle:""},rotator:{rotateTime:8}})}};dojo.provide("dj.module.rssBlogTimes");dojo.require("dj.util.Element");dj.module.rssBlogTimes={init:function(a){a=dojo.query(a);if(a.length===0)console.log("{dj.module.xslTimestamp} no timestamps found.");else for(var b=0,c;c=a[b++];){c=dj.util.Element.cleanWhitespace(c);var e=this.calculateDuration(dojo.trim(c.innerHTML));dojo.empty(c);c.innerHTML=e}},calculateDuration:function(a){a=new Date(a);var b=Math.ceil((new Date).getTime()-a.getTime());b=Math.ceil(b/6E4);var c="";if(b<1)c="1 min ago";else if(b<59)c="6 mins ago";else if(b>60&&b<240){b="";b=a.getHours()<=12?" am":" pm";c=a.getHours()+":"+a.getMinutes()+b}return c===""?null:c}};dojo.provide("dj.module.featuredListings");dojo.require("dj.lang");dojo.require("dj.util.AddressParser");(function(){dj.module.featuredListings={init:function(a){this.config={mod:"WSJ_NycArea_Properties_search"};this.formEl=dojo.byId("property-search-form-01");this.submitEl=dojo.query("input",this.formEl)[1];this.addressDefaultVal="City/State/Zip";this.addressEl=dojo.query("input",this.formEl)[0];dojo.mixin(this.config,a);this._load()},_load:function(){this.setInputDefault(this.addressEl);this.submitForm()},getValues:function(){var a=this.addressEl.value,b=dojo.query("select",this.formEl)[0].value;a=dj.util.AddressParser.parse(a,true);return{city:a.city,state:a.state,zip:a.zipCode,maxPrice:b}},setInputDefault:function(a){var b=this;dojo.connect(a,"onblur",this,function(c){c=c.srcElement||c.target;if(c.value==="")c.value=b.addressDefaultVal});dojo.connect(a,"onfocus",this,function(c){c=c.srcElement||c.target;if(c.value===c.defaultValue)c.value=""})},submitForm:function(){var a=this;dojo.connect(this.submitEl,"click",function(b){dj.lang.stopEvent(b);b=a.getValues();window.location="http://realestate.wsj.com/properties/search/results.php"+
("?qTerms=sell&qSearchTab=sell&qAction=search&qCity="+b.city+"&qState="+b.state+"&qZip="+b.zip+"&qMaxPrice="+b.maxPrice+"&mod="+a.config.mod)})}}})();dojo.provide("dj.module.propertySearchAsia");dojo.require("dj.lang");dojo.getObject("parser",true);_djl=dj.lang;dj.module.propertySearchAsia={init:function(a){var b={searchType:"property"};_djl.deepMixin(b,a);this.configuration=b;this.countryType=0;this.sponsorLinkPlaceHolder=dojo.byId("sponsorLink");this.errorMessagePlaceHolder=dojo.byId("errorMessage");this.priceRange=dojo.byId("rePriceRange");this.propertySearchForm=dojo.byId("property-search-form");this.submitButton=dojo.byId("reAction");this.countryField=dojo.byId("reCountry");this.minPriceField=dojo.byId("reMinPrice");this.maxPriceField=dojo.byId("reMaxPrice");this.liveResultsDiv=dojo.byId("reLiveResultsDiv");this.transactionType="sell";if(this.configuration.searchType=="commercial")this.transactionType="FSFL";else{this.fillPrices(this.minPriceField,"Min");this.fillPrices(this.maxPriceField,"Max")}this.setEvent();this.getLiveResults()},setEvent:function(){_djl.addLiveEvent(".toptabs","click",function(a){var b=a.srcElement||a.target;dojo.stopEvent(a);this.setTabSelected(b.parentNode);this.getLiveResults()},this);dojo.connect(this.minPriceField,"onchange",this,function(){this.getLiveResults()});dojo.connect(this.maxPriceField,"onchange",this,function(){this.getLiveResults()});dojo.connect(this.countryField,"onchange",this,function(){this.getLiveResults()});dojo.connect(this.submitButton,"onclick",this,function(a){dojo.stopEvent(a);this.submitForm()})},getLiveResults:function(){this.identifySearchProvider();if(this.countryType==1)this.displayLiveResults();else this.liveResultsDiv.innerHTML=""},fillPrices:function(a,b){var c=["500,000","600,000","700,000","800,000","900,000","1,000,000","1,500,000","2,000,000","2,500,000","3,000,000","3,500,000","4,000,000","4,500,000","5,000,000","6,000,000","7,000,000","8,000,000","9,000,000","10,000,000+"],e=["1,000","2,000","3,000","4,000","5,000","6,000","7,000","8,000","9,000","10,000","20,000","30,000","40,000","50,000","60,000","70,000","80,000","90,000","100,000","150,000","200,000","250,000"],f=[];if(this.transactionType=="rent")f=e;else if(this.transactionType=="sell")f=c;c=a.options.length=0;e="";var g=null;c="";e=" "+b+" Price ($)";g=document.createElement("option");g.text=e;g.value=c;a.options.add(g);for(var h=0;h<f.length;h++){c=f[h].replace(",","").replace(",","");e=" $"+f[h];g=document.createElement("option");g.text=e;g.value=c;a.options.add(g)}},setTabSelected:function(a){for(var b=_djl.query(".toptabs"),c=b.length-1;c>=0;c--)dojo.removeClass(b[c],"selected");dojo.addClass(a,"selected");this.errorMessagePlaceHolder.innerHTML="";this.transactionType=a.id;this.fillPrices(this.minPriceField,"Min");this.fillPrices(this.maxPriceField,"Max");if(a.id=="foreclosures"&&this.priceRange){this.priceRange.style.display="none";this.sponsorLinkPlaceHolder.style.display="none"}else if(this.priceRange){this.priceRange.style.display="block";this.sponsorLinkPlaceHolder.style.display="block"}},hasDefaultValue:function(a){return a.value===a.defaultValue},hasDefaultValueOrEmpty:function(a){return this.hasDefaultValue(a)||a.value==""},clearAndNormalize:function(a){a=a.replace(/,/g," ");a=a.replace(/[^a-zA-Z 0-9]+/g,"");return a=a.toLowerCase()},buildLocationStringForProperty:function(){var a={url:null,error:null},b="sell",c="qCountry",e="qMinPrice",f="qMaxPrice",g="qSearchTab";if(this.transactionType=="rent")b="rent";b="?qTerms="+b;if(this.countryType=="1"){c="Location";e="PriceMin";f="PriceMax";g="ListType";this.transactionType=="rent"||this.transactionType=="2"?this.transactionType="2":this.transactionType=1;this.propertySearchForm.action="http://wsj.propgoluxury.com/EN/Properties/";b+="&SubLocation=0&City=&Currency=33"}else{b+="&qAction=search";if(this.transactionType=="foreclosures")b+="&qAuction=1";this.propertySearchForm.action="http://realestate.wsj.com/properties/search/results.php"}b+="&"+g+"="+this.transactionType;this.hasDefaultValueOrEmpty(this.countryField)||(b+="&"+c+"="+this.countryValue);b+=this.hasDefaultValueOrEmpty(this.minPriceField)?"&"+e+"=":this.minPriceField.value=="10000000+"?"&"+e+"=10000000":"&"+e+"="+this.minPriceField.value;b+=this.hasDefaultValueOrEmpty(this.maxPriceField)||this.maxPriceField.value=="10000000+"?"&"+f+"=":"&"+f+"="+this.maxPriceField.value;a.url=b;return a},identifySearchProvider:function(){this.countryValue=this.countryField.value;if(this.countryValue=="China"||this.countryValue=="Fiji"||this.countryValue=="Hong Kong"||this.countryValue=="Indonesia"||this.countryValue=="Japan"||this.countryValue=="Malaysia"||this.countryValue=="SaintBarthelemy"||this.countryValue=="Singapore"||this.countryValue=="Thailand"||this.countryValue=="Vietnam"){this.countryType="1";switch(this.countryValue){case"China":this.countryValue="1500";break;case"Fiji":this.countryValue="2500";break;case"Hong Kong":this.countryValue="9300";break;case"Indonesia":this.countryValue="3600";break;case"Japan":this.countryValue="4200";break;case"Malaysia":this.countryValue="4700";break;case"SaintBarthelemy":this.countryValue="7300";break;case"Singapore":this.countryValue="9500";break;case"Thailand":this.countryValue="7700";break;case"Vietnam":this.countryValue="8900"}}else this.countryType=0},displayLiveResults:function(){var a="/PropGo"+
this.buildLocationStringForProperty().url,b=this.liveResultsDiv;dojo.xhrGet({url:a,handleAs:"text",timeout:4500,load:function(c){b.innerHTML="Live Results : "+c;return c}})},submitForm:function(){this.identifySearchProvider();var a=this.buildLocationStringForProperty(),b=this.propertySearchForm.action;if(a.error)this.errorMessagePlaceHolder.innerHTML="<p>"+a.error+"</p>";else window.location.href=b+a.url}};dojo.provide("dj.module.emailSignUp");dojo.require("dj.util.Query");dojo.require("dj.util.Region");dojo.require("dj.util.User");dj.module.emailSignUp={init:function(){if(this.isPartner=dojo.hasClass(document.getElementsByTagName("div")[0],"subType-partner")){this.oEmailSignUpNonSub=dojo.byId("emailSignUpNonSub");this.oEmailSignUpNonSub.getElementsByTagName("a")[0].href="/pznsetup/pub/email/setup.html"}this.oContainers=dojo.query("div.emailSignUp");this.oContainers.forEach(function(a){this.initializeContainer(a)},this)},initializeContainer:function(a){if(a!==null){this.setUpControllers(a);dj.util.Query.down(a,".userLoginName").setAttribute("id","emailFNameLName");dj.util.User.renderCallsign("emailFNameLName");this.setSpanishTexts(a)}},setSpanishTexts:function(a){if(dj.util.Query.down(a,"h3").innerHTML.indexOf("Spanish")!==-1){dj.util.Query.down(a,"h3").innerHTML="Bolet&iacute;n de Noticias WSJ Americas";dj.util.Query.down(a,"p").innerHTML="Suscr&iacute;base al bolet&iacute;n de The Wall Street Journal Americas para recibir en su email una selecci&oacute;n diaria de las principales noticias, an&aacute;lisis, columnas y video en espa&ntilde;ol.";var b=dj.util.Query.down(a,".successMessage p strong").innerHTML;dj.util.Query.down(a,".successMessage p").innerHTML="Gracias <strong>"+b+"!</strong><br/>Usted recibir&aacute; el <span class='displayNames'>Bolet\ufffdn de Noticias de WSJ Americas</span>en su bandeja de entrada."}},setUpControllers:function(a){var b=dj.util.Region.getViewByRegion();this.oemailSignUpSubmit=dj.util.Query.down(a,".emailSignUpSubmit");var c=dj.util.Query.up(this.oemailSignUpSubmit,"span");if(b=="germany"&&c!==dojo.doc&&dojo.hasClass(c,"visibility-onlyUnSubNotReg"))dojo.addClass(this.oemailSignUpSubmit,"registerUserClass");else{dojo.connect(this.oemailSignUpSubmit,"onclick",this,function(e){dojo.stopEvent(e);this.signUp(a)});dojo.connect(dj.util.Query.down(a,".txtEmail"),"onclick",null,function(){this.value=""})}},signUp:function(a){this.oContent=dj.util.Query.down(a,".mainContent");this.oContentForm=dj.util.Query.down(this.oContent,"form");this.oMessageSuccess=dj.util.Query.down(a,".successMessage");this.oMessageError=dj.util.Query.down(this.oContent,".errorMessage");this.oemailSignUpSubmit=dj.util.Query.down(a,".emailSignUpSubmit");this.txtEmail=dj.util.Query.down(a,".txtEmail");this.hiddenClass="hidden";this.signUpUrl="/emailservice/email-signup";this.userLoginName="";var b=this;dj.util.User.getUserId(function(c){b.userLoginName=c});this.oEmail=dj.util.Query.down(a,".userEmail");console.info("email signup - email address div element is "+this.oEmail);dj.util.User.renderEmailAddress(this.oEmail);this.userEmail=this.oEmail.innerHTML;console.info("email signup - email address is "+this.userEmail);this.displayNames="";if(this.txtEmail.value===""||this.txtEmail.value==="Please enter your email")this.txtEmail.value="Please enter your email";else{this.postBody=this.buildPostBody();if(this.displayNames!==""){this.displayNames+="&nbsp;";this.request=dojo.xhrPost({url:this.signUpUrl,postData:b.postBody,handleAs:"xml",headers:{"Content-Type":"text/xml"},error:function(c,e){if(409==e.xhr.status)b.showError();else if(e.xhr.status>500&&e.xhr.status<600){b.showContent();console.error("{emailSignUp} error %s - server error",e.xhr.status)}},load:function(){b.showSuccess(a)}})}}},buildPostBody:function(){if(this.txtEmail.value!=="Enter Your Email Address")this.userEmail=this.txtEmail.value;var a=false;dj.util.User.isLoggedIn(function(l){l&&dj.util.User.isSubLoggedIn(function(m){m||(a=true)})});var b=false;dj.util.User.hasRole("WSJ-ENT",function(l){if(l)b=true});var c=false;dj.util.User.hasRole("WSJ-CFO-PRO",function(l){if(l)c=true});dj.util.User.hasRole("WSJ-ENT-CFO",function(l){if(l)c=true});dj.util.User.hasRole("WSJ-CFO-PRO-TRIAL",function(l){if(l)c=true});var e=false;dj.util.User.hasRole("WSJ-PRO",function(l){if(l)e=true});var f=dj.util.Region.getViewByRegion(),g=[];g[g.length]="<customer>";g[g.length]="<login-name>"+this.userLoginName+"</login-name>";g[g.length]='<contacts class="java.util.ArrayList">';g[g.length]="<contact><last-modified-by>"+this.userLoginName+"</last-modified-by><contact-address>"+this.userEmail+"</contact-address><contact-status>V</contact-status>";g[g.length]='<bulk-emails class="java.util.ArrayList">';var h=dojo.formToObject(this.oContentForm),j;for(j in h)if(h.hasOwnProperty(j))if(j.indexOf("checkbox")===0){var k=h[j];if(h[j]==="88")if(f==="europe")k="169";else if(f==="asia")k="167";else{if(f==="asia,india")k="172"}else if(h[j]==="89")if(f==="europe")k="170";else if(f==="asia")k="168";else if(f==="asia,india")k="173";g[g.length]="<bulk-email><opt-in-flag>1</opt-in-flag><email-type-id>"+
k+"</email-type-id></bulk-email>";if(k=h["displayName"+h[j]]){if(k.indexOf("In Spanish")!==-1)k="Bolet&iacute;n de Noticias de WSJ Americas";this.displayNames=this.displayNames===""?k:this.displayNames+" and "+k}}g[g.length]="</bulk-emails>";g[g.length]="</contact>";g[g.length]="</contacts>";g[g.length]='<products class="java.util.ArrayList">';g[g.length]=b?"<product><id>501</id><name>WSJ ENT</name><description>WSJ Enterprise Product</description></product>":a?"<product><id>301</id><name>WSJ</name><description>WSJ Email Product</description></product>":c?"<product><id>101</id><name>WSJ</name><description>CFO Professional Product</description></product>":e?"<product><id>821</id><name>WSJ</name><description>WSJ Professional Product</description></product>":"<product><id>2</id><name>WSJ</name><description>WSJ Email Product</description></product>";g[g.length]="</products>";g[g.length]="</customer>";return g=g.join("\n")},showSuccess:function(a){dojo.query(".userLoginName",a).forEach(function(b){b.innerHTML=dj.util.Query.down(dojo.query("div.emailSignUp")[0],".userLoginName").innerHTML;console.info("name is "+b.innerHTML)});dojo.query(".displayNames",a).forEach(function(b){b.innerHTML=this.displayNames},this);dojo.addClass(this.oContent,this.hiddenClass);dojo.addClass(this.oMessageError,this.hiddenClass);dojo.removeClass(this.oMessageSuccess,this.hiddenClass)},showError:function(){this.userEmail="";dojo.removeClass(this.oContent,this.hiddenClass);dojo.addClass(this.oMessageSuccess,this.hiddenClass);dojo.removeClass(this.oMessageError,this.hiddenClass)},showContent:function(){dojo.addClass(this.oMessageSuccess,this.hiddenClass);dojo.addClass(this.oMessageError,this.hiddenClass);dojo.removeClass(this.oContent,this.hiddenClass)}};dojo.provide("dj.module.newsReel");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Page");dojo.require("dj.widget.panels.virtual.Carousel");dj.module.newsReel={REEL_STATE:{FULL:0,COLLAPSED:1,SMALL:2},reelState:0,reelHeight:0,isAnimation:false,cfg:{reelOpenClass:"reelState-open",reelClosedClass:"reelState-closed",btnSelectedClass:"selected",stateCookieName:"newsReel_state",currentArticleClass:"currentArticle",currentPointerClass:"current",newsReelPointerClass:".newsreelPointer",reelLoadedClass:"reelState-loaded"},oCnt:null,cntId:null,init:function(a,b){this.oCnt=dojo.byId(a);if(this.oCnt===null)throw Error("{newsReel} container is not located.");dojo.addClass(this.oCnt,this.cfg.reelLoadedClass);this.currentArticle=null;this.reelState=this.REEL_STATE.FULL;this.reel=this.initReel(this.oCnt);if(!(typeof b==="undefined"||b===null||b===""))try{this.initNewsReelAds(b,this.oCnt)}catch(c){console.error("{newsReel} ads error: "+c)}},setId:function(a){this.cntId=a},update:function(){this.init(this.cntId);return this},initReel:function(a){var b=dj.widget.panels.PanelsFactory.create(a,{core:{panelGroup:"#newsReelContent > .reelContentTree .unitList",panel:"li",viewArea:4},carousel:{navContainer:".reelNav",prevButton:".newsreel_prev",nextButton:".newsreel_next",type:"circular"}}),c=this._setCurrentPanelActive(a);if(c===null)return b;this.reelPtrCnt=dojo.query(this.cfg.newsReelPointerClass,a)[0];a=dojo.query(".newsreel_pointer_container li",this.reelPtrCnt);dojo.addClass(a[c],this.cfg.currentPointerClass);if(dojo.query(".unit.sponsor").children().first()[0]){var e=a[0];a=e.parentNode;e=dojo.create(e.tagName,{className:e.className,innerHTML:e.innerHTML});a.appendChild(e)}dj.widget.panels.PanelsFactory.create(this.reelPtrCnt,{core:{panelGroup:".newsreel_pointer_container",panel:"li",viewArea:4,controller:b},carousel:{type:"circular"}});if(b.getNumberOfPanels()>3)try{var f=b.getById(c).getPosition();b.setActiveByPosition(f+1)}catch(g){console.error("{newsReel} cannot scroll to invalid panel id: "+c)}return b},_setCurrentPanelActive:function(a){var b=typeof AT_VARS==="object"&&AT_VARS.baseDocId?AT_VARS.baseDocId:dj.util.Page.getQueryParam("baseDocId"),c=null,e=this;dojo.query("#newsReelContent > .reelContentTree .unitList .unit",a).forEach(function(f,g){var h=dojo.query("a",f)[0];if(typeof h!=="undefined"&&h.href!==null&&h.href.indexOf(b)!==-1){c=g;dojo.addClass(dojo.byId(f),e.cfg.currentPointerClass)}});return c},initNewsReelAds:function(a,b){dojo.query("#newsReelContent .newsReelAd",b).forEach(function(c){dj.widget.ad.AdManager.loadAds(a,{id:c.getAttribute("id")})})}};dojo.provide("dj.module.articleFreeRegScrim");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.util.Element");dojo.require("dj.util.Query");dojo.require("dj.util.Url");dj.module.articleFreeRegScrim={init:function(){var a=this;dj.util.User.isLoggedIn(function(b){b||document.location.href.indexOf(".wsj.com/article")!==-1&&a.checkReferrerSite()})},checkReferrerSite:function(a){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);a=dj.util.Cookie.getGroupCookie("DJSESSION","FREEREGSCRIMCOUNT");var b=document.referrer;if(a==null&&isTrial==="true"&&b.indexOf("google")>0)a=0;if((a!==""||a!==null)&&a=="0"&&isFree==="true"&&isTrial==="false"&&b.indexOf("wsj.com/article")>0){a=1;this.setupArticleFreeRegScrim()}dj.util.Cookie.setGroupCookie("DJSESSION","FREEREGSCRIMCOUNT",a)},DEFAULT_CONFIG:{y:null,z:null},setupArticleFreeRegScrim:function(){dojo.position("article_story_body",true);var a=dojo.byId("fr_confirm").innerHTML,b="";b=a.match(/id=\"/g)?a.replace(/id=\"/g,'id="artScrim_'):a.replace(/id=/g,"id=artScrim_");a='<div id="pmArticleFreereg" class="pmArticleFreereg" style="position:absolute;top:95px;left:0px;display:none;z-index: 1"><a id="close-btn" href="#" onclick="dj.module.articleFreeRegScrim.setupArticleCloseFreeReg(); return false">Close [x]</a><h2 id="regFormhTag">Sign up in seconds to gain <em>FREE access</em> to exclusive WSJ.com tools & features:</h2><ul id="pmArticleFreereg-bullets"  class="pmArticleFreereg-bullets"><li>Setup and manage your portfolio</li><li>Personalize your own news page</li><li>Receive and manage newsletters</li><li>Join the Journal Community</li></ul><div id="insetForm" class="inset inset-form"><div style="display: none;" name="fr_confirm" id="artScrim_fr_confirm" class="fr_content fr_confirm">'+
b+'</div><div id="artScrim_fr_content" class="fr_content">';b=dojo.byId("article_story_body").innerHTML;var c=dojo.query(".fr_formElements")[0].innerHTML,e="";e=c.match(/id=\"/g)?c.replace(/id=\"/g,'id="artScrim_'):c.replace(/id=/g,"id=artScrim_");e=e.replace("<p>Please register to gain free access to WSJ tools.</p>","");e=e.replace("connectLinks-note-collapsed","connectLinks-note-collapsed hidden");dojo.byId("article_story_body").innerHTML=b+a+'<div class="fr_formElements">'+e+"</div></div></div></div>";this.displayDiv("pmArticleFreereg");this.oRegisterScrim_module=dj.lang.byId("pmArticleFreereg");this.oErrorScrimCount=0;this.http_requestScrim=false;this.oRegFieldScrimErrorMsgsValue="";this.oregFieldScrimErrorMsg=dj.lang.byId("artScrim_oregFieldErrorMsg");this.oFr_text=dj.lang.byId("insetForm");this.oFr_confirm=dj.lang.byId("artScrim_fr_confirm");this.oFr_content=dj.lang.byId("artScrim_fr_content");this.oFreeRegistrationScrim_form=dj.lang.byId("artScrim_freeRegistration_form");this.oFreeregScrimemailerrormsg=dj.lang.byId("artScrim_freeregemailerrormsg");this.oFreeregScrimusererrormsg=dj.lang.byId("artScrim_freeregusererrormsg");this.oFreeRegScrimServiceErrorMsg=dj.lang.byId("artScrim_freeRegServiceErrorMsg");this.oFreeRegScrimSubButton=dj.lang.byId("artScrim_freeRegSubButton");this.oFreeRegScrimEmail=dj.lang.byId("artScrim_regemail");this.regScrimErrorCode=["userName-exists","userName-required","userName-invalid","firstName-required","firstName-invalid","lastName-required","lastName-invalid","emailAddress-exists","emailAddress-required","emailAddress-invalid","password-required","password-invalid","passwordConfirmation-invalid","userName-unique","emailAddress-unique","passwordConfirmation-required"];this.regErrorScrimValue=["Please enter your First Name.","Please enter your Last Name.","Please enter a valid email address.","Please create a Password.","Please confirm Password.","The email addresses do not match. Please re-enter both.","Passwords do not match.","Password must be 5-15 characters in length.","Confirm Password must be 5-15 characters in length.","","","Please Confirm Email.","First name contains invalid characters.","Last name contains invalid characters."];this.regFieldName=["artScrim_firstNameReg","artScrim_lastNameReg","artScrim_emailAddressReg","artScrim_passwordReg","artScrim_passwordConfirmationReg","artScrim_emailAddressConfirmationReg","artScrim_passwordConfirmationReg","artScrim_passwordReg","passwordConfirmationReg","artScrim_sendEmailsReg","artScrim_jcommunityReg","artScrim_emailAddressConfirmationReg","artScrim_firstNameReg","artScrim_lastNameReg","artScrim_companySizeReg"];this.attachScrimEvents();this.setFreeRegScrimOmnitureCall(1);this.freeRegScrimResetForm()},setupArticleCloseFreeReg:function(){dojo.addClass(dojo.byId("pmArticleFreereg"),"hidden")},setFreeRegScrimOmnitureCall:function(a){if(a===undefined)a=1;if(a==1){setMetaData("pageName","WSJ_Reg_FreeRegScrimForm");setMetaData("atype","WSJ_Customer Resources_Reg_FreeRegScrimForm")}else if(a==2){setMetaData("pageName","WSJ_Reg_FreeRegScrimThankYou");setMetaData("atype","WSJ_Customer Resources_Reg_FreeRegScrimThankYou")}setMetaData("primaryproduct","Online Journal");setMetaData("ctype","marketing and support");setMetaData("qsymbol","");setMetaData("aheadline","");setMetaData("apage","WSJ_Customer Resources_Reg_FreeRegScrimForm");setMetaData("section","Customer Resources");setMetaData("subsection","WSJ Registration");setMetaData("basesection","WSJ_Customer Resources_Registration_FreeRet");setMetaData("csource","Customer Resources");setMetaData("apage","WSJ_Customer Resources_Registration_FreeRet");dj.util.Tracking.omniture.firePixel(true)},attachScrimEvents:function(){var a=dojo.query("input[type=text]",this.oFreeRegistrationScrim_form),b=dojo.query("input[type=password]",this.oFreeRegistrationScrim_form);a.forEach(function(c){dojo.connect(c,"onfocus",this,function(){this.checkFreeRegScrimFocus(c.name)})},this);a.forEach(function(c){dojo.connect(c,"onblur",this,function(){this.checkFreeRegScrimFieldBlur(c.name)})},this);b.forEach(function(c){dojo.connect(c,"onfocus",this,function(){this.checkFreeRegScrimFocus(c.name)})},this);b.forEach(function(c){dojo.connect(c,"onblur",this,function(){this.checkFreeRegScrimFieldBlur(c.name)})},this);this.oimagefields=dojo.query("input[type=image]",this.oFreeRegistrationScrim_form);this.oimagefields.forEach(function(c){dojo.connect(c,"onclick",this,function(){this.submitregScrimForm()})},this);this.okButtonClicked=dojo.query("input[class=okButton]",this.oFreeRegConfirm);this.okButtonClicked.forEach(function(c){dojo.connect(c,"onclick",this,function(){this.setupArticleCloseFreeReg();this.closeRegScrimSuccessBlock()})},this)},displayDiv:function(a){this.VarX=dojo.byId(a);this.VarX.style.zIndex=1E9;this.VarX.style.display="block"},freeRegScrimResetForm:function(){this.closeRegScrimOtherBlock(1);this.oFreeRegistrationScrim_form.reset();dj.util.Element.hide(this.oFr_confirm);dj.util.Element.hide(this.oregFieldScrimErrorMsg);this.oRegFieldScrimErrorMsgsValue="";this.oFreeRegScrimSubButton.disabled=false;dj.util.Element.hide(this.oFreeregScrimemailerrormsg);dj.util.Element.hide(this.oFreeRegScrimServiceErrorMsg);dj.util.Element.hide(this.oFreeregScrimusererrormsg);this.oFreeRegistrationScrim_form[this.regFieldName[0]].style.backgroundColor="#ffffff";this.oFreeRegistrationScrim_form[this.regFieldName[1]].style.backgroundColor="#ffffff";this.oFreeRegistrationScrim_form[this.regFieldName[2]].style.backgroundColor="#ffffff";this.oFreeRegistrationScrim_form[this.regFieldName[3]].style.backgroundColor="#ffffff";this.oFreeRegistrationScrim_form[this.regFieldName[4]].style.backgroundColor="#ffffff";this.oFreeRegistrationScrim_form[this.regFieldName[5]].style.backgroundColor="#ffffff"},closeRegScrimSuccessBlock:function(){dj.util.Element.hide("regFormhTag");dj.util.Element.hide("pmArticleFreereg-bullets");this.setFreeRegScrimOmnitureCall(2)},closeRegScrimOtherBlock:function(a){if(a===1){dj.util.Element.show(this.oRegisterScrim_module);dj.util.Element.show(this.oFr_text);dj.util.Element.hide(this.oFr_confirm)}a===2&&dj.util.Element.hide(this.oRegisterScrim_module)},checkFreeRegScrimFieldBlur:function(a){this.ofieldName=this.oFreeRegistrationScrim_form[a];this.ofieldValue=this.ofieldName.value;if(/^\s*$/.test(this.ofieldValue)){this.oErrorScrimCount=1;this.oFreeRegScrimSubButton.disabled=false}else{this.ofieldName.style.color="#000000";this.ofieldName.style.backgroundColor="#ffffff";this.ofieldName.value=dojo.trim(this.ofieldValue)}},checkFreeRegBlur:function(a){this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[a]];this.ofieldValue=this.ofieldName.value;if(/^\s*$/.test(this.ofieldValue)){this.changeFieldValue(a);this.oErrorScrimCount=1;this.oFreeRegScrimSubButton.disabled=false}else{this.ofieldName.style.color="#000000";this.ofieldName.style.backgroundColor="#ffffff";this.ofieldName.value=dojo.trim(this.ofieldValue)}},checkFreeRegScrimFocus:function(a){this.ofieldName=this.oFreeRegistrationScrim_form[a];this.ofieldName.style.color="#000000";this.ofieldName.style.backgroundColor="#ffffff"},compareFreeRegEmail:function(){this.oEmailfieldValue=this.oFreeRegistrationScrim_form[this.regFieldName[2]].value;this.oEmailfieldConfValue=this.oFreeRegistrationScrim_form[this.regFieldName[5]].value;if(this.oEmailfieldValue!=""&&this.oEmailfieldConfValue!=""&&this.oEmailfieldValue!==this.oEmailfieldConfValue){this.changeFieldValue(5);this.oFreeRegScrimSubButton.disabled=false;this.oErrorScrimCount=1}},compareFreeRegPassword:function(){this.oPassfieldValue=this.oFreeRegistrationScrim_form[this.regFieldName[3]].value;this.oCPassfieldValue=this.oFreeRegistrationScrim_form[this.regFieldName[4]].value;if(this.oPassfieldValue!==this.oCPassfieldValue){this.changeFieldValue(6);this.oFreeRegScrimSubButton.disabled=false;this.oErrorScrimCount=1}},changeFieldValue:function(a){dj.util.Element.show(this.oregFieldScrimErrorMsg);this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[a]];this.oRegFieldScrimErrorMsgsValue+=" "+this.regErrorScrimValue[a];this.ofieldName.style.color="#ff0000";this.ofieldName.style.backgroundColor="#fff28d"},responseErrorData:function(a){var b=0,c=a.profile.errors;a=c.emailAddress;var e=c.userName,f=c.firstName,g=c.lastName,h=c.password;c=c.passwordConfirmation;if(a!==null&&a!==undefined)if(this.regScrimErrorCode[7]===a||this.regScrimErrorCode[14]===a){dj.util.Element.show(this.oFreeregScrimemailerrormsg);this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[2]];this.ofieldName.style.backgroundColor="#fff28d"}else{this.changeFieldValue(2);b=1}if(e!==null&&e!==undefined)if(this.regScrimErrorCode[0]===e||this.regScrimErrorCode[13]===e){dj.util.Element.show(this.oFreeregScrimusererrormsg);this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[5]];this.ofieldName.style.backgroundColor="#fff28d"}else{this.changeFieldValue(5);b=1}if(f!==null&&f!==undefined){this.changeFieldValue(0);b=1}if(g!==null&&g!==undefined){this.changeFieldValue(1);b=1}if(h!==null&&h!==undefined){h===this.regScrimErrorCode[11]?this.changeFieldValue(7):this.changeFieldValue(3);b=1}if(c!==null&&c!==undefined){c===this.regScrimErrorCode[12]?this.changeFieldValue(8):this.changeFieldValue(4);b=1}if(b===1){dj.util.Element.show(this.oregFieldScrimErrorMsg);this.oregFieldScrimErrorMsg.innerHTML="<p>"+this.oRegFieldScrimErrorMsgsValue+"</p>"}},freeRegScrimRequest:function(){this.ofirstName=this.oFreeRegistrationScrim_form[this.regFieldName[0]].value;this.olastName=this.oFreeRegistrationScrim_form[this.regFieldName[1]].value;this.oemailName=this.oFreeRegistrationScrim_form[this.regFieldName[2]].value;this.opassName=this.oFreeRegistrationScrim_form[this.regFieldName[3]].value;this.ocpassName=this.oFreeRegistrationScrim_form[this.regFieldName[4]].value;this.oemailConfName=this.oFreeRegistrationScrim_form[this.regFieldName[5]].value;this.oFeatureEmail=true;this.oCommunityProfile=this.oFreeRegistrationScrim_form[this.regFieldName[10]].checked;this.ocompanySize=this.oFreeRegistrationScrim_form[this.regFieldName[14]].value;this.data=this.ocompanySize.length===0||this.ocompanySize===null?{"profile.firstName":this.ofirstName,"profile.lastName":this.olastName,"profile.emailAddress":this.oemailName.toLowerCase(),"profile.password":this.opassName,"profile.passwordConfirmation":this.ocpassName,"service.templateCode":"WSJ","service.registrationType":"FREE_REGISTRATION","profile.options.returnLink":window.location.href,"profile.options.featureEmailOptIn":this.oFeatureEmail,"profile.trackingCode":"FREEREGSCRIM"}:{"profile.firstName":this.ofirstName,"profile.lastName":this.olastName,"profile.emailAddress":this.oemailName.toLowerCase(),"profile.password":this.opassName,"profile.passwordConfirmation":this.ocpassName,"service.templateCode":"WSJ","service.registrationType":"FREE_REGISTRATION","profile.options.returnLink":window.location.href,"profile.options.featureEmailOptIn":this.oFeatureEmail,"profile.demographics.questionId1":this.opassQuestion,"profile.demographics.answer1":this.ocompanySize,"profile.trackingCode":"FREEREGSCRIM"};var a=this;dojo.xhrPost({url:"/epiton/registration/v2/profile",handleAs:"json",headers:{Accept:"application/json"},postData:dojo.objectToQuery(this.data),handle:function(b,c){if(c.xhr.status===200){a.oFreeRegScrimEmail.innerHTML=a.oemailName;dojo.addClass(dojo.byId("pmArticleFreereg"),"confirmation-page");dj.util.Element.hide("regFormhTag");dj.util.Element.hide("pmArticleFreereg-bullets");dj.util.Element.hide(a.oFr_content);dj.util.Element.show(a.oFr_confirm)}else if(c.xhr.status===412){var e=eval("("+c.xhr.responseText+")");a.oFreeRegScrimSubButton.disabled=false;a.responseErrorData(e)}else{a.oFreeRegScrimSubButton.disabled=false;dj.util.Element.show(a.oFreeRegScrimServiceErrorMsg)}}})},submitregScrimForm:function(){this.oErrorScrimCount=0;this.oRegFieldScrimErrorMsgsValue="";dj.util.Element.hide(this.oFreeregScrimemailerrormsg);dj.util.Element.hide(this.oFreeregScrimusererrormsg);dj.util.Element.hide(this.oFreeRegScrimServiceErrorMsg);this.oFreeRegScrimSubButton.disabled=true;this.checkFreeRegBlur(0);this.checkFreeRegBlur(1);this.checkFreeRegBlur(2);this.checkFreeRegBlur(11);this.checkFreeRegBlur(3);this.checkFreeRegBlur(4);this.compareFreeRegEmail();this.compareFreeRegPassword();if(this.oErrorScrimCount===0)this.oRegFieldScrimErrorMsgsValue="";if(this.oErrorScrimCount>0){this.oregFieldScrimErrorMsg.innerHTML="<p>"+this.oRegFieldScrimErrorMsgsValue+"</p>";dj.util.Element.show(this.oregFieldScrimErrorMsg);this.oFreeRegScrimSubButton.disabled=false}else{this.oFreeRegScrimSubButton.disabled=true;dj.util.Element.hide(this.oregFieldScrimErrorMsg);this.oRegFieldScrimErrorMsgsValue="";this.oregFieldScrimErrorMsg.innerHTML="";this.freeRegScrimRequest()}return false}};dojo.provide("dj.module.globalHeader");dojo.deprecated("dj.module.globalHeader","use the one in the 'header' bundle","0.7");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");dj.module.globalHeader=function(){var a={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/page/asia_in_todays_paper.html?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/page/europe_in_todays_paper.html?mod=WSJ_formfactor",US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter"};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(this.cfg.HEADER_CONTAINER_CLASS)[0];this.editionDropdownSetUp();this.displaySubSection();this.displayTimeStamp();var c=this;this.currRegion=dj.util.Region.getViewByRegion();this.concatURL="";this.concatURL=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;dj.util.User.isLoggedIn(function(g){if(g){c.displaySubscriberDetails();c.setupLogout()}else{c.setupLogin();c.ofreereg=dojo.query(c.cfg.FREE_REG_CLASS,c.oHeader)[0];g=dojo.query("#register_module",c.ofreereg)[0];dojo.style(g,{display:"none"});dojo.style(c.ofreereg,{display:"block"});c.oSubscriberLogin=dojo.query(c.cfg.SUBSCRIBER_LOGIN_CLASS,c.oHeader)[0];g=dojo.query(".login_module",c.oSubscriberLogin)[0];dojo.style(g,{display:"none"});dojo.style(c.oSubscriberLogin,{display:"block"});c.oHeaderPromo=dojo.query(c.cfg.HEADER_PROMO_CLASS,c.oHeader)[0];dojo.style(c.oHeaderPromo,{display:"block"})}});this.highlightFormFactorLinks();this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];var e=this.cfg.LOGGED_IN_TODAYS_PAPER_URL;b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_ASIA;var f=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_EUROPE;if(this.currRegion=="asia"||this.currRegion=="asia,india")e=b;else if(this.currRegion=="europe")e=f;this.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+e:e;c=this;dj.util.User.isSubLoggedIn(function(g){if(!g)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+"/public"+e:"/public"+e})},toggleDropdownClass:function(){var b=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;if(dojo.hasClass(this.oLocDropDownContainer,b)){dojo.removeClass(this.oLocDropDownContainer,b);dojo.addClass(this.oLocDropDownContainer,c)}else dojo.hasClass(this.oLocDropDownContainer,c)&&dojo.addClass(this.oLocDropDownContainer,b)},editionDropdownSetUp:function(){var b=this;this.oLocationNav=dojo.query(this.cfg.LOCATION_NAV_CLASS,this.oHeader)[0];var c=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,e=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME,f=this.cfg.US_EDITION_LINK_CLASS;f=this.cfg.US_EDITION_LINK_CLASS;var g=this.cfg.EU_EDITION_LINK_CLASS,h=this.cfg.IN_EDITION_LINK_CLASS,j=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var k=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.osectionFooterSub=dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();var l="";this.tempConcatURL=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;this.isMDCPageFlag=document.location.href!==null&&document.location.href!==""&&document.location.href.indexOf(k)!==-1;this.oUsEdition!==null&&dojo.connect(this.oUsEdition,"onclick",this,function(m){dojo.stopEvent(m);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href});this.oUsEditionFooter!==null&&dojo.connect(this.oUsEditionFooter,"onclick",this,function(m){dojo.stopEvent(m);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href});this.oEuEdition!==null&&dojo.connect(this.oEuEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.isMDCPageFlag?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365)}});this.oInEdition!==null&&dojo.connect(this.oInEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.isMDCPageFlag?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365)}});this.oAsiaEdition!==null&&dojo.connect(this.oAsiaEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.isMDCPageFlag?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365)}});this.oChiEdition!==null&&dojo.connect(this.oChiEdition,"onclick",this,function(m){dojo.stopEvent(m);window.open(this.oChiEdition.href)});this.oSpaEdition!==null&&dojo.connect(this.oSpaEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.oSpaEdition.href});this.oPorEdition!==null&&dojo.connect(this.oPorEdition,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.oPorEdition.href});this.osectionFooterSub!==null&&dojo.connect(this.osectionFooterSub,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.osectionFooterSub.href});this.osectionFooterNonSub!==null&&dojo.connect(this.osectionFooterNonSub,"onclick",this,function(m){dojo.stopEvent(m);window.location=this.osectionFooterNonSub.href});if(this.currRegion=="asia"){l="Asia Edition";this.oSelectedEdition=dojo.query(j,this.oHeader)[0]}else if(this.currRegion=="asia,india"){l="Asia Edition";this.oSelectedEdition=dojo.query(h,this.oHeader)[0]}else if(this.currRegion=="europe"){l="Europe Edition";this.oSelectedEdition=dojo.query(g,this.oHeader)[0]}else{l="U.S. Edition";this.oSelectedEdition=dojo.query(f,this.oHeader)[0]}dojo.addClass(this.oSelectedEdition,"selected");this.oCurrentEdition.innerHTML=l;this.oFormFactorContainer=dojo.byId("formFactorContainer");dojo.style(this.oFormFactorContainer,{display:""});this.oLocDropDownContainer=dojo.byId("locNavContainer");dojo.style(this.oLocDropDownContainer,{display:""});if(this.oLocDropDownContainer!==null){dojo.connect(this.oLocationNav,"onclick",this,function(m){dojo.stopEvent(m);if(dojo.hasClass(b.oLocDropDownContainer,c)){dojo.removeClass(b.oLocDropDownContainer,c);dojo.addClass(b.oLocDropDownContainer,e)}else if(dojo.hasClass(b.oLocDropDownContainer,e)){dojo.removeClass(b.oLocDropDownContainer,e);dojo.addClass(b.oLocDropDownContainer,c)}});dojo.connect(document,"onclick",this,function(m){if(dj.util.Element.contains(this.oLocDropDownContainer,m.clientX,m.clientY)==false)if(dojo.hasClass(this.oLocDropDownContainer,e)){dojo.removeClass(this.oLocDropDownContainer,e);dojo.addClass(this.oLocDropDownContainer,c)}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(m){if(m){dojo.style(b.oSectionFooterNonSub,{display:"none"});dojo.style(b.oSectionFooterSub,{display:""})}else{dojo.style(b.oSectionFooterNonSub,{display:""});dojo.style(b.oSectionFooterSub,{display:"none"})}})}},displayTimeStamp:function(){this.oTimestamp=dojo.query(this.cfg.TIMESTAMP_CLASS,this.oHeader)[0];if(typeof pDate!=="undefined"&&this.oTimestamp!==null)this.oTimestamp.innerHTML=window.pStl=="renovation"?dj.util.Date.displayTime(pDate,pDateinGMT):pDate},displaySubSection:function(){this.oCurrentSubSection=dojo.query(this.cfg.CURRENT_SUBSECTION_DISPLAY_CLASS,this.oHeader)[0];if(typeof globalHeaderPageTitle!=="undefined"&&globalHeaderPageTitle!==null&&globalHeaderPageTitle!==""){this.oCurrentSubSection.innerHTML=globalHeaderPageTitle;this._delayedFadeInSubSection()}},_delayedFadeInSubSection:function(){setTimeout(dojo.hitch(this,function(){dojo.style(this.oCurrentSubSection,{display:"inline",opacity:0});dojo.fadeIn({node:this.oCurrentSubSection,duration:this.cfg.WSJ_LOGO_FADE_APPEAR_DURATION*1E3}).play()}),this.cfg.WSJ_LOGO_DELAY_DURATION)},displaySubscriberDetails:function(){dj.util.User.renderCallsign(this.cfg.USER_NAME_ELEMENT_ID);this.setupSubscriberLinks();this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];var b=this;dj.util.User.isSubLoggedIn(function(c){if(c)b.setupMessageCenter();else{b.setUpMJLinksForReg();dojo.style(b.oMessageCenterLink,{display:"none"})}});this.oSubscriberDetails=dojo.byId(this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID);dojo.removeClass(this.oSubscriberDetails,"hidden")},setUpMJLinksForReg:function(){this.oFooter=dojo.query(this.cfg.FOOTER_CONTAINER_CLASS)[0];var b=this.cfg.MOJ_LINK_URL,c=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(c,this.oHeader)[0];this.oMojLinkFooter=dojo.query(c,this.oFooter)[0];if(typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""){this.oMojLinkHeader.href="http://"+gcDomain+b;this.oMojLinkFooter.href="http://"+gcDomain+b}else{this.oMojLinkHeader.href=b;this.oMojLinkFooter.href=b}},setupSubscriberLinks:function(){this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];var b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL,c=this;dj.util.User.isSubLoggedIn(function(e){if(e)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+b:b})},setupMessageCenter:function(){this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];this.oMessageCount=dojo.query(this.cfg.MESSAGE_COUNT_CLASS,this.oHeader)[0];var b=this,c=function(f){if(f==="-1")dojo.style(b.oMessageCenterLink,{display:"none"});else b.oMessageCount.innerHTML=f},e=dj.util.Cookie.getCookie("msgCount");e===null?dojo.xhrPost({url:this.cfg.MESSAGE_CENTER_POST_URL,load:function(f){e=f.MessagesCount;f=f.Status;dj.util.Cookie.setCookie("msgCount",e,5/24/60);dj.util.Cookie.setCookie("userStatus",f,5/24/60);c(e)},error:function(f,g){console.error("Exception occured while posting posting Ajax Request: %s",g)}}):c(e)},setupLogin:function(){this.oUserName=dojo.byId(this.cfg.LOGIN_USERNAME_ELEMENT_ID);this.oPassword=dojo.byId(this.cfg.LOGIN_PASSWORD_ELEMENT_ID);this.oLoginImg=dojo.byId(this.cfg.LOGIN_BUTTON_ELEMENT_ID);this.oLoginForm=dojo.byId(this.cfg.LOGIN_FORM_ID);this.oLoginForm.reset();this.oPageUrl=dojo.byId(this.cfg.PAGE_URL_ELEMENT_ID);var b=this;if(this.oPageUrl!==null){var c=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID,e=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,f=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,g=this.cfg.MDC_PAGE_PID,h;h=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var j;var k=j=dojo.isIE?window.location.href:document.location.href;if(typeof pID!=="undefined"){k=pID===c?h+this.cfg.HOMEPAGE_SUBSCRIBER_URL:pID===f?h+"/email":pID===e?h+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===g?h+this.cfg.MDC_LINK_URL:j;if(dojo.isIE)document.login_form.url.value=k;else this.oPageUrl.value=k}if(this.oUserName!==null){dojo.connect(this.oUserName,"onfocus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"onclick",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}if(this.oPassword!==null){dojo.connect(this.oPassword,"onfocus",this,function(){dj.util.Form.clearValue(b.oPassword,"Password");this.oPassword.type="password"});dojo.connect(this.oPassword,"onclick",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")});dojo.connect(this.oPassword,"onchange",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")})}dojo.isIE&&dojo.connect(this.oLoginImg,"onclick",this,function(){document.login_form.url.value=j;console.log("coming in to img onlick in IE"+j);this.oLoginForm.submit()});dojo.connect(this.oPassword,"onkeypress",this,function(l){l=l.keyCode||l.which;if(dojo.isIE)if(l==Event.KEY_RETURN){document.login_form.url.value=j;this.oLoginForm.submit()}})}},setupLogout:function(){this.oLogout=dojo.byId(this.cfg.LOGOUT_LINK_ELEMENT_ID);this.oLogout!==null&&dojo.connect(this.oLogout,"onclick",this,function(b){dojo.stopEvent(b);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE=;path=/;domain=.wsj.com;expires=Thu, 01-Jan-1970 00:00:01 GMT";window.location=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"})},highlightFormFactorLinks:function(){this.oTodaysPaperLinkContainer=dojo.query(this.cfg.TODAYS_PAPER_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oVideoLinkContainer=dojo.query(this.cfg.VIDEO_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oBlogsLinkContainer=dojo.query(this.cfg.BLOGS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oColumnsLinkContainer=dojo.query(this.cfg.COLUMNS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oInteractiveGraphicsLinkContainer=dojo.query(this.cfg.INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oTopicsLinkContainer=dojo.query(this.cfg.TOPICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oCommunityForumsLinkContainer=dojo.query(this.cfg.COMMUNITY_FORUMS_LINK_CONTAINER_CLASS,this.oHeader)[0];var b=this.cfg.TODAYS_PAPER_PID,c=this.cfg.TODAYS_PAPER_US_NONSUB_PID,e=this.cfg.TODAYS_PAPER_EUROPE_NONSUB_PID,f=this.cfg.TODAYS_PAPER_ASIA_NONSUB_PID,g=this.cfg.TODAYS_PAPER_US_PID,h=this.cfg.TODAYS_PAPER_EUROPE_PID,j=this.cfg.TODAYS_PAPER_ASIA_PID,k=this.cfg.TODAYS_PAPER_PAST_EDITIONS_PID,l=this.cfg.TODAYS_PAPER_INDEX_BIZ_PID,m=this.cfg.TODAYS_PAPER_INDEX_PEOPLE_PID,q=this.cfg.TODAYS_PAPER_CORRECTIONS_PID,n=this.cfg.VIDEO_PID,o=this.cfg.INTERACTIVE_GRAPHICS_PID,r=this.cfg.TOPICS_PID,u=this.cfg.COLUMNS_PID,v=this.cfg.BLOGS_PID,w=document.location.host+this.cfg.COMMUNITY_HIGHLIGHT_COMPARE_URL,p=this.cfg.FORUMS_HIGHLIGHT_COMPARE_URL;if(typeof pID!=="undefined")if(pID.indexOf(b)==0||pID===c||pID===e||pID===f||pID===g||pID===h||pID===j||pID===k||pID===l||pID===m||pID===q)dojo.addClass(this.oTodaysPaperLinkContainer,"selected");else if(pID===n)dojo.addClass(this.oVideoLinkContainer,"selected");else if(pID===o)dojo.addClass(this.oInteractiveGraphicsLinkContainer,"selected");else if(pID===u)dojo.addClass(this.oColumnsLinkContainer,"selected");else if(pID===v)dojo.addClass(this.oBlogsLinkContainer,"selected");else pID===r&&dojo.addClass(this.oTopicsLinkContainer,"selected");if(document.location.href!==null&&document.location.href!==""&&document.location.href.indexOf(w)!==-1||document.location.href.indexOf(p)!==-1)dojo.addClass(this.oCommunityForumsLinkContainer,"selected")}}}();dojo.provide("dj.module.showSectionAndTicker");dojo.require("dj.module.newsTicker");dj.module.showSectionAndTicker={init:function(){this.sectPan=dj.module.carouselSection.panels;this.newsPan=dj.module.newsTicker.ticker;!this.sectPan||!this.newsPan?console.warn("{showSectionAndTicker} either (or both) of the carousels is not found"):this.bind()},bind:function(){var a=0,b=this.sectPan,c=this.newsPan,e=b.model.getNumberOfPanels();c.model.setRotationState(0);b.model.addChangeListener("success",function(f){f.getPosition()==e&&a++;if(f.getPosition()==1&&a>0){b.model.setRotationState(0);c.model.setRotationState(1)}});b.model.addChangeListener("rotationStateSuccess",function(f){f==0?c.model.setRotationState(1):c.model.setRotationState(0)})}};
dojo.provide("dj.module.dashboard.DashboardExpletives");dj.module.dashboard.expletives=["ahole","fuck","dickface","b!tch","fatboner","hitlery","pinksock","dirtysanchez","dirty-sanchez","pink.sock","gooks","horseshit","tableofwisdom.com","fuckers","bullshit","bullshiter","a.s.s.h.o.l.e","jackasses","erwin.rommel","f.u.c.k.i.n.g.","a$$","cr\*p","a$$wipe","repuglican","s.c.r.e.w.","aarghasm","scum","fuckit","aasman","fucku","f-u-c-k","f\*uck","null","dooche","dumbass","ipenis","pussies","stfu","fucktard","shitting","s.h.i.t","shites","shite","c.u.n.t.s","pusssy","moron's","moron","morons","d\*mn","f.ucked","sht","f\*ck","fuckyou","fuc\*","p\*ssy","sh\*t","pigfucking","scumsucking","phuque","shiiiit","buttfucked","goldtradercomments.blogspot.com","milf","wtf","libtard","shat","krap","dumbocrats","obaminables","fugers","www.anoox.com/blog/real_news","www.anoox.com","obminable","fu@ked","a-s-s","obamanible","mc*w*a*r!","dumbocrat","m.i.l.f","dipshit","repugnants","fucksticks","mclame","tur.d","niggers","buttkissing","obaminable","demonrats","bullshiite","bullsh\*t","www.yousearchengine.com","retardado","gawdamn","macclame","fagots","repig","dickwad","motherfuckers","unfuckingbelievable","obamacrimes.com","dogfucking","fuckthesouth.com","phucking","a$$holes","http://www.easystockalerts.com","smegma","www.scottpodcast.com","democrap","www.stockgravity.com","www.proloanmods.com","a$$clowns","www.aaronabed.com","wingnuts","http://www.quickstubs.com","www.quickstubs.com","quickstubs.com","www.debtchallenges.com","debtchallenges.com","www.blackjfk.com","octaroon","idiot","www.saadvisory.com","seismicstocktrading.com","repukes","www.joesixpack.me","whoredog","dipsh*t","poorbrokesoul","demorat","pusified","ribono","@ss","www.dollartalk.net","www.usmegatrends.blogspot.com","aholez","alhambrainvestments.com","asses","www.swanconsultinginc.com","dumbacrats","honkeys","jagoff","http://www.places2network.com","schit","schmuck","r-tards","http://tinyurl.com/6kp4bp","http://tinyurl.com","http://www.prisonplanet.com/ex-isi-chief-gul-exposes-911-inside-job.html","goddamn","$h!t","goddamned","b@astards","b@stard","krapp","fuked","sh8","holysh8","@ssh0les","bull*hit","shi*ter","cr#p","crappy","$hit","f*cked","fag","fag1t","faget","fagg1t","faggit","faggot","fagit","fags","fagz","faig","faigs","schwartzenigger","biatchys","s-h-i-t","q-u-e-e-r","felch","f.ucking","felching","unfucking","shittibank","fucker","fuckinfuckhead","fucking","fucks","fuckstain","fucktwat","fuckwit","fuk","fukah","fuken","fuker","fukin","fukk","fukkah","fukken","fukker","fukkin","fucked","pigfart","g00k","shitheads","gayboy","gaygirl","billionairecupid.com","d-bags","dbags","h00r","h0ar","obamanation","h0re","c_r_a_p","hell","honkies","honky","hoor","hoore","democraps","phuckers","tuurds","cocksucking","jackass","jack-ass","jackoff","jack-off","jap","japs","jerkass","jerk-ass","jerk-off","jerkoff","jisim","w-e-t-b-a-c-k","jizm","cocksuckers","fvck","http://www.theoffshorebankaccount.com","clusterf*ck","knobcheese","knobz","washingfuckington","http://www.economicreality.net/money.htm","www.easystockalerts.com","easystockalerts.com","kunt","kunts","kuntz","www.mimarker.net","retardicans","repug","http://www.fakepaycheckstub.com","www.fakepaycheckstub.com","lezzian","lipshits","lipshitz","fakepaycheckstub.com","manpiss","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","fukn","bitching","a$$es","mosshead","otha-fucker","motha-fuker","motha-fukkah","motha-fukker","mother-fucker","mother-fukah","mother-fuker","mother-fukkah","mother-fukker","motherfucking","mother-fucking","mutha-fucker","mutha-fukah","mutha-fuker","mutha fukkah","mutha-fukker","n1gr","niggar","nigger","niggra","nigguh","nigur","niiger","niigr","packi","packie","packy","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","phuc","phuk","phuker","phukker","piss","polac","polack","polak","poonani","poopshoot","poop-shoot","ppopchute","pr1c","pr1ck","pr1k","prick","pussee","queer","queers","queerz","qweers","qweerz","qweir","retard","rimmer","tard","scank","schlong","semen","santorum","sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","she-male","shitchute","shit-chute","shiteater","shit-eater","shithead","shit-head","shits","shitshute","shit-shute","shitter","shitty","shity","shitz","shyt","shyte","shytty","shyty","skanck","skank","skankee","skankey","skanks","skanky","sluts","slutty","slutz","son-of-a-bitch","scumbags","bullshiit","libloons","dubmassss","f_uc-kin","shiit","c.rap","p.iss","tit","son-of-a-b.itch","titz","turd","turds","turdz","gtfo","twats","twatz","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","a.s.s.l.i.c.k.e.r.","b.a.s.t.a.r.d","scumball","pissing","w0p","wanker","wankers","wankerz","wetback","wet-back","wetbacks","wetbackz","wet-backs","wet-backz","wh00r","wh0re","dickhead","mccdong","whore","whores","whorez","libterd","whorze","demon'rats","wop","wops","wopz","http://logicstudio8.blogspot.com/","www.buymyhousebeforethebanktakesit.com.","buymyhousebeforethebanktakesit.com.","www.derivativescollapse.com","dotcom","shitload","www.palestine-info.co.uk/","pink-sock","clusterphuc","ass","fucken","libturd","www.smartstops.net","azzholes","slimebags","slimebag","dirtbag","fart","fuking","p#ss","anus","biotches","boobs","m0r0n","fuckage","h-o-n-k-y","fuckkk","c.u.n.t.","f-ing","cornholed","fuctard","mcwar","oblahblah","mcshit","http://www.debtchallenges.com","http://blog.tradingideas.in/","infotips@yahoo.com","dirtbags","azzes","goddam","bimbo","chick","doodoohead","www.themastertrader.net","monoprice.com","http://www.dollartalk.net","shlt","dumbasses","phucked","http://www.jewwatch.com/","shiti","www.yourgold.com","www.peacecorps.gov/","douche","http://www.smartstops.net","pendejo","repugnantcans","www.fakepaycheckstubs.com","truemetalprices.com","omfg","www.usbailout.com","www.insuredira.com","www.economicvesuvius.blogspot.com","anoox","reptards","jackoffs","http://www.moorelandrey.com/ml/scottckinsel","clusterfuk","putz","tirds","tird","a$$*oles","anilingus","bitchers","jewliani","jeweliani","assrammer","scumbag","b17ch","b1tch","bastard","bi7ch","buttholesurfers","beaner","a$$wipes","butt-pirate","c0ck","mfucking","cawk","repugs","chink","fuckups","horse$hit","stupidass","clits","cum","d4mn","daygo","dego","dildo","pissit","pissaway","fukking","ejackulate","fuckin","shyste","faen","phaggot","mcclame","fatass","fcuk","blowjobs","faggots","felcher","ficken","flikker","foreskin","fubar","lmfao","fux0r","shitstorm","gook","pisses","h0r","h4x0r","http://www.buymyhousebeforethebanktakesit.com.","pissed","honkey","hore","paki","http://alhambrainvestments.com/blog/","injun","jism","jizz","kawk","kike","alhambrainvestments.com/blog/","kraut","http://davronstaffing.blogspot.com/","kuk","kuksuger","www.blackfdr.com","http://freetradingquiz.com/","l3itch","a-holes","lesbo","motherfucker","mofo","nigga","nutsack","phuck","poontsee","shitt","pusse","pussy","puta","puto","shemale","slut","spic","splooge","suka","teets","tits","twat","whoar","shit","aholes","anuz","anusranger","anus-ranger","arschloch","arsez","arsewit","arsewitts","ash0le","ash0les","f.u.c.k.","asholes","ass-monkey","assbitch","assface","assfucker","assh0le","assh0lez","asshat","asshole","assholes","assholz","asslick","assmaster","assmonkey","ass-rammer","asswipe","asswipes","asswipez","asswiper","asswipers","asswiperz","azzhole","bassterds","bastards","bastardz","basterds","basterdz","biatch","bitch","bitches","blow-job","blowjob","boffing","bollocks","boll\*cks","boner","bugger","bulldyke","bumboy","bunghole","butthole","buttmuncher","buttwipe","c0cks","c0k","carpet-muncher","cawks","clit","cnts","cntz","cock","cockhead","cock-head","cocklick","cocks","cocksucker","cock-sucker","coon","crap","cumsucker","cunilingus","cunt","cuntlick","cunts","cuntz","damn","dicklick","dild0","dild0s","dildos","dilld0","dilld0s","douchebag","dyke"];dojo.provide("dj.util.dashboard");dojo.require("dj.lang");dj.util.dashboard={getDashboardData:function(url,params){params.responseType=(!params.responseType)?"application/json":params.responseType;var isResponseJson=(params.responseType.indexOf("json")>-1);this._sendXhrRequest(url,params,{requestMethod:"GET",handleAs:(isResponseJson)?"json":"text",appendCacheBuster:true,requestHeaders:{"Accept":params.responseType}});},postDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"POST",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":"application/json"}});},putDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"PUT",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"}});},deleteDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"POST",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"DELETE","Content-Type":"application/json"}});},_sendXhrRequest:function(requestUrl,userParams,requestOptions){var params=dj.lang.cloneMixin({callback:function(){}},userParams);var options=dj.lang.cloneMixin({requestHeaders:{"Accept":"application/json"},handleAs:"json",appendCacheBuster:false},requestOptions);if(options.appendCacheBuster){requestUrl=this._appendCacheBuster(requestUrl);}
var xhrReq=this._getRequestByMethod(options.requestMethod);var deferred=xhrReq({url:requestUrl,headers:options.requestHeaders,handleAs:options.handleAs,postData:options.content,load:function(data,ioargs){params.callback.apply(params.context,[data,ioargs.xhr,params]);},error:function(data,ioargs){console.error("HTTP status code: %s, response: %o",ioargs.xhr.status,data);if(typeof params.errorCallback!=="undefined"){params.errorCallback.apply(params.context,[data.status,ioargs.xhr,params]);}else{params.callback.apply(params.context,[data.status,ioargs.xhr,params]);}}});return deferred;},_appendCacheBuster:function(requestUrl){var cb=(Math.floor(10000000*Math.random()));requestUrl+=(requestUrl.indexOf('?')>-1)?("&cb="+cb):("?cb="+cb);return requestUrl;},_getRequestByMethod:function(requestMethod){return(requestMethod=="GET")?dojo.xhrGet:dojo.xhrPost;}};dojo.provide("dj.service.dashboard.DashboardService");dojo.require("dj.util.dashboard");dojo.require("dj.util.Observer");dojo.require("dj.util.User");if(typeof dj=="undefined"){dj={};}
if(typeof dj.service=="undefined"){dj.service={};}
if(typeof dj.service.dashboard=="undefined"){dj.service.dashboard={};}
if(typeof dj.widget=="undefined"){dj.widget={};}
if(typeof dj.widget.dashboard=="undefined"){dj.widget.dashboard={};}
(function(){var _du=dj.util;var _dsd=dj.service.dashboard;var _dwd=dj.widget.dashboard;var _dud=_du.dashboard;(_dwd.DashboardService=function(cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._responses={};this._responsePending={};this._postResponses={};this._postResponsePending={};this._subscribed={};this._updateObservers={};this._updateCallbacks={};this._loaded=false;this._dataObserver=new _du.Observer();}).prototype={DEFAULT_CONFIG:{},subscribeFeed:function(name,key,callback,context){this._dataObserver.subscribeByName(this.getFeedId(name,key),callback,context);},getFeedId:function(name,key){return name+":"+key;},getFeed:function(name,key,url,criteria){this._performUuidSubstitution1(this._getFeedWithUser,this,name,key,url,criteria);},_getFeedWithUser:function(name,key,url,criteria){var feedName=name||null;var feedKey=key||null;var feedId=this.getFeedId(feedName,feedKey);if(this._responses[feedId]&&typeof criteria==="undefined"){this.fireFeed(name,key,this._responses[feedId]);return;}
var c=criteria||null;if(!this._responsePending[feedId]){var feedUrl=url;this._responses[feedId]=null;this._responsePending[feedId]=true;_dud.getDashboardData(feedUrl,{callback:this.handleFeed,context:this,feedName:feedName,feedKey:feedKey,url:feedUrl,criteria:c});}},handleFeed:function(response,ioArgs,params){this._responses[this.getFeedId(params.feedName,params.feedKey)]=response;this.fireFeed(params.feedName,params.feedKey,response,params.criteria);},fireFeed:function(name,key,response,criteria){this._responsePending[this.getFeedId(name,key)]=false;this._dataObserver.fireByName(this.getFeedId(name,key),key,response,criteria);},reloadFeed:function(name,key,url,criteria){this._performUuidSubstitution1(this._reloadFeedWithUser,this,name,key,url,criteria);},_reloadFeedWithUser:function(name,key,url,criteria){this._responses[this.getFeedId(name,key)]=null;this.getFeed(name,key,url,criteria);},doPost:function(name,key,url,postData,callback,context,methodOverride){this._performUuidSubstitution2(this._doPostWithUser,this,name,key,url,postData,callback,context,methodOverride);},_doPostWithUser:function(thisObj,name,key,url,postData,callback,context,methodOverride){var postName=name;var postKey=key||null;var method=methodOverride||"post";thisObj._postResponses[thisObj.getFeedId(name,key)]=null;thisObj._postResponsePending[thisObj.getFeedId(name,key)]=true;thisObj._subscribeUpdateObserver(name,key,callback,context);var params={callback:thisObj.handlePost,errorCallback:thisObj.handlePost,context:thisObj,postName:name,postKey:postKey,url:url};if(method=="put"){_dud.putDashboardData(url,postData,params);}else if(method=="delete"){_dud.deleteDashboardData(url,postData,params);}else{_dud.postDashboardData(url,postData,params);}},handlePost:function(response,ioArgs,params){var postName=params.postName;var postKey=params.postKey;this._postResponses[this.getFeedId(params.postName,params.postKey)]=response;this.firePost(params.postName,params.postKey,response);},handlePostError:function(response,ioArgs,params){console.error("Dashboard Service post error :"+ioArgs);},firePost:function(name,key,response){this._postResponsePending[this.getFeedId(name,key)]=false;this._fireUpdateObserver(name,key,key,response);this._unsubscribeUpdateObserver(name,key);},doPut:function(name,key,url,postData,callback,context){this._performUuidSubstitution2(this._doPutWithUser,this,name,key,url,postData,callback,context);},_doPutWithUser:function(thisObj,name,key,url,postData,callback,context,methodOverride){thisObj.doPost(name,key,url,postData,callback,context,"put");},doDelete:function(name,key,url,postData,callback,context){this._performUuidSubstitution2(this._doDeleteWithUser,this,name,key,url,postData,callback,context);},_doDeleteWithUser:function(thisObj,name,key,url,postData,callback,context,methodOverride){thisObj.doPost(name,key,url,postData,callback,context,"delete");},_subscribeUpdateObserver:function(name,key,callback,context){var feedId=this.getFeedId(name,key);var updateObserver=this._updateObservers[feedId];if(!updateObserver){updateObserver=new _du.Observer();this._updateObservers[feedId]=updateObserver;this._updateCallbacks[feedId]=callback;updateObserver.subscribe(callback,context);}},_fireUpdateObserver:function(name,key){var updateObserver=this._updateObservers[this.getFeedId(name,key)];if(updateObserver){var fireParams=[];for(var i=2,arg,len=arguments.length;i<len;i++){fireParams.push(arguments[i]);}
updateObserver.fire.apply(updateObserver,fireParams);}},_unsubscribeUpdateObserver:function(name,key){var feedId=this.getFeedId(name,key);this._updateObservers[feedId]=null;},_performUuidSubstitution1:function(callback,context,name,key,url,criteria){var that=this;if(this.uuid){callback.apply(context,[name,key,that._substituteMacros(url),criteria]);}else{var that=this;dj.util.User.getUserId(function(uuidVal){that.uuid=uuidVal;callback.apply(context,[name,key,that._substituteMacros(url),criteria]);});}},_performUuidSubstitution2:function(callback,thisObj,name,key,url,postData,callbk,context,methodOverride){var that=this;if(this.uuid){callback.apply(context,[thisObj,name,key,that._substituteMacros(url),postData,callbk,context,methodOverride]);}else{var that=this;dj.util.User.getUserId(function(uuidVal){that.uuid=uuidVal;callback.apply(context,[thisObj,name,key,that._substituteMacros(url),postData,callbk,context,methodOverride]);});}},_substituteMacros:function(url){url=url.replace('$userName$',this.uuid);return url;}};dj.service.dashboard.DashboardService=new _dwd.DashboardService();}());dojo.provide("dj.service.dashboard.DashboardPZNServiceFactory");dojo.require("dj.service.dashboard.DashboardService");dojo.require("dj.util.User");dojo.require("jkl.jkl-parsexml");(function(){var _du=dj.util;var _dsd=dj.service.dashboard;var _dwd=dj.widget.dashboard;var _dud=_du.dashboard;var _ctx=dj.context;(_dwd.DashboardPZNService=function(cfg){this._serviceWidget=null;this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._responsePending={};this._subscribed={};this._allFolders=null;this._userFolders={};this._userPortfolioQuotes={};this._mostRecentArticles={};this._globalPref={};this._email={};this._updateObservers={};this._updateCallbacks={};this._serviceWidget=_dsd.DashboardService;this._dataObserver=new _du.Observer();}).prototype={DEFAULT_CONFIG:{serviceUrls:{"mostRecentArticles":"/WSJDBFeeds/service.svc/TopArticles/$userName$/5","mostRecentPZNOverview":"/pznusersvc/view/getUserPagination/mostRecentOverview","topNewsOverview":"/pznusersvc/view/getUserPagination/topNewsArticlesOverview","companiesOverview":"/pznusersvc/view/getUserPagination/companiesArticlesOverview","industriesOverview":"/pznusersvc/view/getUserPagination/industriesArticlesOverview","sectionsOverview":"/pznusersvc/view/getUserPagination/sectionsArticlesOverview","columnsOverview":"/pznusersvc/view/getUserPagination/columnsArticlesOverview","editorsPickOverview":"/pznusersvc/view/getUserPagination/editorsPickArticlesOverview","updateUser":"/pznusersvc/update/updateUser/version/2","marketData":"/pznusersvc/view/getUser/indexes/userName","allIndustries":"/pznusersvc/view/getAll/industries","allSections":"/pznusersvc/view/getAll/sections","allColumns":"/pznusersvc/view/getAll/columnists","allTopNews":"/pznusersvc/view/getAll/topNews","allIndexes":"/pznusersvc/view/getAll/indexes","allCompanies":"/pznusersvc/view/getAll/companies","quote":"/quote/quote","globalPref":"/pznusersvc/view/getUser/defaultFolders/version/2","email":"/pznusersvc/view/getUser/EmailInfo","updatePmProfile":"/epsvcs/update/userProfile","updateEmail":"/pznusersvc/update/updateUser/EmailInfo","welcomeMsg":"/pznusersvc/view/getUser/userFlags","portfolioList":"/pznusersvc/view/getPortfolios/"},xhtmlServiceUrls:{"companies":"/fragment/0_0_WM_1034_companies_update.html","industries":"/fragment/0_0_WM_1033_industries_update.html","sections":"/fragment/0_0_WM_1031_sections_update.html","columns":"/fragment/0_0_WM_1032_columns_update.html","topNews":"/fragment/0_0_WM_1036_topNews_update.html","mostRecent":"/fragment/0_0_WM_1035_mostRecent_update.html","editorsPick":"/fragment/0_0_WM_1037_EditorPicks_update.html","mostRecentSaved":"/fragment/0_0_WM_1060_mjDockSaved.html","userSaved":"/fragment/0_0_WM_1060_mjDockSavedColl.html","mjDockSavedNav":"/fragment/0_0_WM_1060_mjDockSavedNav.html","mjDockCompany_News":"/fragment/0_0_WM_1055_mjDockCompany_News.html","mjDockIndustry_News":"/fragment/0_0_WM_1055_mjDockIndustry_News.html","mjDockTopics":"/fragment/0_0_WM_1055_mjDockTopics.html","mjDockColumns":"/fragment/0_0_WM_1055_mjDockColumns.html","mjDockTop_News":"/fragment/0_0_WM_1055_mjDockTop_News.html","mjDockMost_Recent":"/fragment/0_0_WM_1055_mjDockMost_Recent.html","mjDockEditors_Pick":"/fragment/0_0_WM_1055_mjDockEditors_Pick.html","mjDocktabCompanies":"/fragment/0_0_WM_1055_mjDocktabCompanies.html","mjDocktabIndustries":"/fragment/0_0_WM_1055_mjDocktabIndustries.html","pmDocktabCompanies":"/fragment/0_0_EM_1055_mjDocktabCompanies.html","pmDocktabIndustries":"/fragment/0_0_EM_1055_mjDocktabIndustries.html","pmDockTopics":"/fragment/0_0_EM_1055_mjDockTopics.html","pmDockColumns":"/fragment/0_0_EM_1055_mjDockColumns.html","pmDockTop_News":"/fragment/0_0_EM_1055_mjDockTop_News.html","pmDockMost_Recent":"/fragment/0_0_EM_1055_mjDockMost_Recent.html","pmDockEditors_Pick":"/fragment/0_0_EM_1055_mjDockEditors_Pick.html","mjDockMostRecentSaved":"/fragment/0_0_EM_1055_mjDocktabSaved.html","mjDockKeywordAlerts":"/fragment/0_0_EM_1055_mjDocktabKeywordAlerts.html"},pznCollectionUrl:["/page/mj-companies.html","/page/mj-industries.html","/page/mj-sections.html","/page/mj-columnists.html","/page/mj-topnews.html","/page/mj-mostrecent.html","/page/mj-editorspick.html","/page/my-journal-setup.html","/page/my-journal-main.html"],pznSingleCollectionUrl:["/page/mj-companies.html?collection=","/page/mj-industries.html?collection=","/page/mj-sections.html?collection=","/page/mj-columnists.html?collection=","/page/mj-topnews.html?collection="],pznCollectionEditUrl:["/page/mj-companies.html?editMode=yes","/page/mj-industries.html?editMode=yes","/page/mj-sections.html?editMode=yes","/page/mj-columnists.html?editMode=yes","/page/mj-topnews.html?editMode=yes","/page/mj-mostrecent.html?editMode=yes","/page/mj-editorspick.html?editMode=yes"],pznDisplayValues:["Companies","Industries","WSJ Sections","WSJ Columns","Top News from Today\'s Paper","Most Recent","Top News","Most Recent in all Collections","Editors' Picks","Markets","Portfolio"],pznCollectionDatabaseValue:["Company News","Industry News","Topics","Columns","Top News","Most Recent","Editors Pick"],pznDisplayTitle:["Companies","Industries","Sections","Columns","Top News","Most Recent","Editors Pick"],pznCommanValues:["Settings","Collapse","Sort","Save","Hide Module","My Journal Preferences","Cancel","Expand"],otherDefaultVisibleFolders:"Portfolio~",pagePathValue:"/page",mjVersion:"/version/2?loc=mj"},getPznCollectionUrl:function(){return this._cfg.pznCollectionUrl;},getPagePathValue:function(){return this._cfg.pagePathValue;},getPznSingleCollectionUrl:function(){return this._cfg.pznSingleCollectionUrl;},getPznCollectionEditUrl:function(){return this._cfg.pznCollectionEditUrl;},getPznDisplayValues:function(){return this._cfg.pznDisplayValues;},getPznCollectionDatabaseValue:function(){return this._cfg.pznCollectionDatabaseValue;},getPznCommanValues:function(){return this._cfg.pznCommanValues;},getOtherDefaultVisibleFolders:function(){return this._cfg.otherDefaultVisibleFolders;},getPznDisplayTitle:function(){return this._cfg.pznDisplayTitle;},searchIndustriesArticles:function(folderId,criteria,callback,context){var name="industryArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.industriesOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchIndustryArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchIndustryArticles:function(folderId,data,criteria){var name="industryArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchCompaniesArticles:function(folderId,criteria,callback,context){var name="companyArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.companiesOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchCompaniesArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchCompaniesArticles:function(folderId,data,criteria){var name="companyArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchTopNewsArticles:function(folderId,criteria,callback,context){var name="topNewsArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.topNewsOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchTopNewsArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchTopNewsArticles:function(folderId,data,criteria){var name="topNewsArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchSectionsArticles:function(folderId,criteria,callback,context){var name="sectionArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.sectionsOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchSectionsArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchSectionsArticles:function(folderId,data,criteria){var name="sectionArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchColumnsArticles:function(folderId,criteria,callback,context){var name="columnsArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.columnsOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchColumnsArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchColumnsArticles:function(folderId,data,criteria){var name="columnsArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchRecentArticles:function(folderId,criteria,callback,context){var name="mostRecentPZNArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.mostRecentPZNOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchRecentArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchRecentArticles:function(folderId,data,criteria){var name="mostRecentPZNArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchEditorsPickArticles:function(folderId,criteria,callback,context){var name="editorsPickArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.editorsPickOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchEditorsPickArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchEditorsPickArticles:function(folderId,data,criteria){var name="editorsPickArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},updateIndustries:function(industries,callback,context){if(typeof industries!="string"){var industries=industries.join("~");}
var name="UpdateIndustries";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"industries":industries};this._serviceWidget.doPost(name,industries,url,postData,this.handleUpdateIndustries,this);},handleUpdateIndustries:function(industries,data){var name="UpdateIndustries";this._fireUpdateObserver(name,industries,data);this._unsubscribeUpdateObserver(name);},updateSections:function(sections,callback,context){if(typeof sections!="string"){var sections=sections.join("~");}
var name="UpdateSections";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"topics":sections};this._serviceWidget.doPost(name,sections,url,postData,this.handleUpdateSections,this);},handleUpdateSections:function(sections,data){var name="UpdateSections";this._fireUpdateObserver(name,sections,data);this._unsubscribeUpdateObserver(name);},updateColumns:function(columns,callback,context){if(typeof columns!="string"){var columns=columns.join("~");}
var name="UpdateColumns";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"columns":columns};this._serviceWidget.doPost(name,columns,url,postData,this.handleUpdateColumns,this);},handleUpdateColumns:function(columns,data){var name="UpdateColumns";this._fireUpdateObserver(name,columns,data);this._unsubscribeUpdateObserver(name);},updateTopNews:function(topNews,callback,context){if(typeof topNews!="string"){var topNews=topNews.join("~");}
var name="UpdateTopNews";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"topNews":topNews};this._serviceWidget.doPost(name,topNews,url,postData,this.handleUpdateTopNews,this);},handleUpdateTopNews:function(topNews,data){var name="UpdateTopNews";this._fireUpdateObserver(name,topNews,data);this._unsubscribeUpdateObserver(name);},subscribeMarketData:function(callback,context){var name="marketData";var url=this._cfg.serviceUrls.marketData;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleMarketData,this);this._serviceWidget.getFeed(name,"all",url);},handleMarketData:function(key,data){var name="marketData";this._dataObserver.fireByName(name,data);},subscribeMostRecentArticles:function(callback,context){var name="mostRecentArticles";var url=this._cfg.serviceUrls.mostRecentArticles;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleMostRecentArticles,this);var criteria={"mostRecentArticles":"all"};this._serviceWidget.getFeed(name,"all",url,criteria);},handleMostRecentArticles:function(key,data,criteria){var name="mostRecentArticles";var response={"Criteria":criteria,"Results":data};this._mostRecentArticles=response;this._dataObserver.fireByName(name,response);},subscribeGlobalPref:function(callback,context){var name="globalPref";var url=this._cfg.serviceUrls.globalPref;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGlobalPref,this);var criteria={"globalPref":"all"};this._serviceWidget.getFeed(name,"all",url,criteria);},handleGlobalPref:function(key,data,criteria){var name="globalPref";var response={"Criteria":criteria,"Results":data};this._globalPref=response;this._dataObserver.fireByName(name,response);},subscribeEmail:function(callback,context){var name="email";var url=this._cfg.serviceUrls.email;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleEmail,this);var criteria={"globalPref":"all"};this._serviceWidget.getFeed(name,"all",url,criteria);},handleEmail:function(key,data,criteria){var name="email";var response={"Criteria":criteria,"Results":data};this._email=response;this._dataObserver.fireByName(name,response);},getXhtmlModule:function(params,callback,context){var name="XHTML"+params.type;if(typeof params.url!=="undefined"){var url=params.url.toString();}else{var url=this._cfg.xhtmlServiceUrls[params.type];}
this._subscribeUpdateObserver(name,callback,context);var newParams={};newParams.responseType='text/html';newParams.type=params.type;newParams.callback=this.handleXhtmlModule;newParams.errorCallback=this.handleXhtmlModule;newParams.context=this;_dud.getDashboardData(url,newParams);},handleXhtmlModule:function(response,ioArgs,params){var name="XHTML"+params.type;this._fireUpdateObserver(name,response);this._unsubscribeUpdateObserver(name);},updateShowhideFolder:function(showFolders,callback,context){if(typeof showFolders!="string"){var showFolders=showFolders.join("~");}
var name="updateShowhideFolder";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"ShowFolder":showFolders};this._serviceWidget.doPost(name,showFolders,url,postData,this._handleUpdateShowhideFolder,this);},_handleUpdateShowhideFolder:function(showFolders,data){var name="updateShowhideFolder";this._fireUpdateObserver(name,showFolders,data);this._unsubscribeUpdateObserver(name);},updateEmail:function(delopt,callback,context){if(typeof delopt!="string"){var delopt=delopt.join("~");}
var name="updateEmail";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateEmail;var postData={"deliveryOptions":delopt};this._serviceWidget.doPost(name,delopt,url,postData,this._handleUpdateEmail,this);},_handleUpdateEmail:function(delopt,data){var name="updateEmail";this._fireUpdateObserver(name,delopt,data);this._unsubscribeUpdateObserver(name);},getQuoteData:function(symbols,callback,context){if(typeof symbols==="string"){symbols=symbols.split('~');}else if(typeof symbols==="undefined"){return;}
var name="quoteData";var url=this._cfg.serviceUrls.quote;this._subscribeUpdateObserver(name,callback,context);var symbolQS="?";for(var s=0;s<symbols.length&&(symbol=symbols[s]);s++){if(s>0){symbolQS+="&";}
symbolQS+="symbol="+symbol;if(symbol.indexOf(".")>-1&&symbol.indexOf(".")!=symbol.length-1){symbolQS+="&type=djn";}
else{symbolQS+="&type=usstocks";}}
url+=symbolQS;var xml=new JKL.ParseXML(url);var that=this;xml.async(function(data){that.handleQuoteData(data);});xml.parse();},handleQuoteData:function(data){var name="quoteData";this._fireUpdateObserver(name,data);this._unsubscribeUpdateObserver(name);},subscribeUserPortfolioQuotes:function(portfolioId,callback,context){var name="userPortfolioQuotes:"+portfolioId;var url=this._cfg.serviceUrls.portfolioList+portfolioId;this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed("userPortfolioQuotes",portfolioId,this.handleUserPortfolioQuotes,this);this._subscribed[name]=true;}
var criteria={"p_id":portfolioId};this._serviceWidget.getFeed("userPortfolioQuotes",portfolioId,url,criteria);},handleUserPortfolioQuotes:function(portfolioId,data,criteria){var name="userPortfolioQuotes";var response={"Criteria":criteria,"Results":data};this._userPortfolioQuotes[name+":"+portfolioId]=response;this._dataObserver.fireByName(name+":"+portfolioId,portfolioId,response);},getAllIndustries:function(callback,context){var name="allIndustries";var url=this._cfg.serviceUrls.allIndustries;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllIndustries,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllIndustries:function(key,data){var name="allIndustries";this._dataObserver.fireByName(name,data);},getAllCompanies:function(callback,context){var name="allCompanies";var url=this._cfg.serviceUrls.allCompanies;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllCompanies,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllCompanies:function(key,data){var name="allCompanies";this._dataObserver.fireByName(name,data);},getAllSections:function(callback,context){var name="allSections";var url=this._cfg.serviceUrls.allSections;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllSections,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllSections:function(key,data){var name="allSections";this._dataObserver.fireByName(name,data);},getAllColumns:function(callback,context){var name="allColumns";var url=this._cfg.serviceUrls.allColumns;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllColumns,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllColumns:function(key,data){var name="allColumns";this._dataObserver.fireByName(name,data);},getAllIndexes:function(callback,context){var name="allIndexes";var url=this._cfg.serviceUrls.allIndexes;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllIndexes,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllIndexes:function(key,data){var name="allIndexes";this._dataObserver.fireByName(name,data);},getAllTopNews:function(callback,context){var name="allTopNews";var url=this._cfg.serviceUrls.allTopNews;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllTopNews,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllTopNews:function(key,data){var name="allTopNews";this._dataObserver.fireByName(name,data);},updatePZNCollection:function(postDataValues,callback,context){var name="UpdatePZNCollection";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;this._serviceWidget.doPost(name,"all",url,postDataValues,this.handlePZNCollection,this);},handlePZNCollection:function(data){var name="UpdatePZNCollection";this._fireUpdateObserver(name,"all",data);this._unsubscribeUpdateObserver(name);},updatePremium:function(postDataValues,callback,context,check){if(typeof check==='undefined'){check="all";}
var name="UpdatePremium"+check;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updatePmProfile;this._serviceWidget.doPost(name,check,url,postDataValues,this.handlePremium,this);},handlePremium:function(key,data){var name="UpdatePremium"+key;this._fireUpdateObserver(name,"all",data);this._unsubscribeUpdateObserver(name);},getDockWelMsg:function(callback,context){var name="DockWelMsg";var url="/epsvcs/view/personal/user/settings?profileType=dockMsg";this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleDockWelMsg,this);this._serviceWidget.getFeed(name,"all",url);},handleDockWelMsg:function(key,data){var name="DockWelMsg";this._dataObserver.fireByName(name,data);},getCIWelMsg:function(callback,context){var name="CIWelMsg";var url="/epsvcs/view/personal/user/settings?profileType=ci_msg";this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleCIWelMsg,this);this._serviceWidget.getFeed(name,"all",url);},handleCIWelMsg:function(key,data){var name="CIWelMsg";this._dataObserver.fireByName(name,data);},getWelcomeMessages:function(callback,context){var name="welcomeMessages";var url=this._cfg.serviceUrls.welcomeMsg;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleWelcomeMessages,this);this._serviceWidget.getFeed(name,"all",url);},handleWelcomeMessages:function(key,data){var name="welcomeMessages";this._dataObserver.fireByName(name,data);},getDisplayViewCode:function(_mjView,_saveSetting,_cancelEditing,saveButton,cancelButton,_mjViewValue,restoreCheck,restoreButton,_dockView,_dockViewValue){var _pm=false;var dockViewValue="0";if(typeof _dockView!=='undefined'){_pm=true;dockViewValue=_dockViewValue;}
var resphtml=[];if(restoreCheck=="Restore"){resphtml[resphtml.length]=['<div class="mjFilterContent restoreDefault sixColumn"><ul class="buttonBar">','<li class="button buttonType-hide"><a href="#" id="',restoreButton,'">RESTORE DEFAULTS</a></li></ul>','<p>This action will overwrite your current selections.</p></div>'].join("");}
if(_mjView=="_mjCompanyNews"){resphtml[resphtml.length]=['<div class="mod_setDisplay"><div class="setDisplay noDisplay bottomBorder">'].join("");}
else{resphtml[resphtml.length]=['<div class="mod_setDisplay"><h4>Set Display: <span>Choose how you see your content for this collection.</span>','</h4><div class="setDisplay bottomBorder">'].join("");if(_pm){resphtml[resphtml.length]=['<ul class="headline">','<li><h4>Within My News</h4></li><li class="divider"><h4>Within My Toolbar</h4></li></ul>'].join("");}else{resphtml[resphtml.length]=['<ul class="headline"><li><h4>Within My Journal</h4></li></ul>'].join("");}
resphtml[resphtml.length]=['<ul class="summaryText">'].join("");if(_mjViewValue=="1"){resphtml[resphtml.length]=['<li><input type="radio" checked="checked" value="layout" name="myJournal" id="',_mjView,'"/>','<label for="myJournalSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" value="list" name="myJournal" id="myJournalHeadline"/>','<label for="myJournalHeadline">Headlines Only</label></li>'].join("");}else{resphtml[resphtml.length]=['<li><input type="radio" value="layout" name="myJournal" id="',_mjView,'"/>','<label for="myJournalSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" value="list" checked="checked" name="myJournal" id="myJournalHeadline"/>','<label for="myJournalHeadline">Headlines Only</label></li>'].join("");}
if(_pm){if(dockViewValue=="1"){resphtml[resphtml.length]=['<li class="divider"><input type="radio" checked="checked" name="myToolbar" id="',_dockView,'"/>','<label for="myToolbarSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" name="myToolbar" />','<label for="myToolbarHeadline">Headlines Only</label></li>'].join("");}else{resphtml[resphtml.length]=['<li class="divider"><input type="radio" name="myToolbar" id="',_dockView,'"/>','<label for="myToolbarSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" name="myToolbar" checked="checked"/>','<label for="myToolbarHeadline">Headlines Only</label></li>'].join("");}}
resphtml[resphtml.length]=['</ul>'].join("");if(_pm){resphtml[resphtml.length]=['<ul class="summaryText"><li><img src="/img/icon_headlinesummary.gif" alt="Headlines only" title="Headlines Only"/></li>','<li><img src="/img/icon_headline.gif" alt="Headlines only" title="Headlines Only"/></li>','<li class="divider"><img src="/img/icon_headlinesummary.gif" alt="Headlines only" title="Headlines Only"/></li>','<li><img src="/img/icon_headline.gif" alt="Headlines only" title="Headlines Only"/></li></ul>'].join("");}else{resphtml[resphtml.length]=['<ul class="summaryText"><li><img src="/img/icon_headlinesummary.gif" alt="Headlines only" title="Headlines Only"/></li>','<li><img src="/img/icon_headline.gif" alt="Headlines only" title="Headlines Only"/></li></ul>'].join("");}}
resphtml[resphtml.length]=['</div><div class="editOps"><ul class="buttonBar"><li class="button buttonType-save">','<a href="#" id="',_saveSetting,'" class="',_saveSetting,'">',saveButton,'</a></li>','<li class="nonbutton linkType-cancel"><a href="#" id="',_cancelEditing,'">',cancelButton,'</a></li></ul></div></div>'].join("");return resphtml.join("");},_subscribeUpdateObserver:function(name,callback,context){var updateObserver=this._updateObservers[name];if(!updateObserver){updateObserver=new _du.Observer();this._updateObservers[name]=updateObserver;this._updateCallbacks[name]=callback;updateObserver.subscribe(callback,context);}},_fireUpdateObserver:function(name){var updateObserver=this._updateObservers[name];if(updateObserver){var fireParams=[];for(var i=1,arg,len=arguments.length;i<len;i++){fireParams.push(arguments[i]);}
updateObserver.fire.apply(updateObserver,fireParams);}},_unsubscribeUpdateObserver:function(name){this._updateObservers[name]=null;}};_dsd.DashboardPZNServiceFactory={getPZNServiceInstance:function(callback,context){if(dj.service.dashboard.DashboardPZNService){callback.apply(context,[dj.service.dashboard.DashboardPZNService]);}else if(this.pznSvcInstanceObserver){this._subscribePznSvcInstanceObserver(callback,context);}else{this._subscribePznSvcInstanceObserver(callback,context);var that=this;dj.util.User.hasRole("WSJ-PRO",function(hasPRORole){if(hasPRORole){that.createPZNServiceInstance(hasPRORole);}else{dj.util.User.hasRole("WSJ-ENT",function(hasENTRole){that.createPZNServiceInstance(hasENTRole);});}});}},createPZNServiceInstance:function(hasENTORPRORole){if(hasENTORPRORole){dj.service.dashboard.DashboardPZNService=new _dwd.DashboardPZNService({"pznCollectionUrl":["/professional-page/mj-companies.html","/professional-page/mj-industries.html","/professional-page/mj-sections.html","/professional-page/mj-columnists.html","/professional-page/mj-topnews.html","/professional-page/mj-mostrecent.html","/professional-page/mj-editorspick.html","/professional-page/my-journal-setup.html","/professional-page/my-journal-main.shtml"],"pznSingleCollectionUrl":["/professional-page/mj-companies.html?collection=","/professional-page/mj-industries.html?collection=","/professional-page/mj-sections.html?collection=","/professional-page/mj-columnists.html?collection=","/professional-page/mj-topnews.html?collection="],"pznCollectionEditUrl":["/professional-page/mj-companies.html?editMode=yes","/professional-page/mj-industries.html?editMode=yes","/professional-page/mj-sections.html?editMode=yes","/professional-page/mj-columnists.html?editMode=yes","/professional-page/mj-topnews.html?editMode=yes","/professional-page/mj-mostrecent.html?editMode=yes","/professional-page/mj-editorspick.html?editMode=yes"],"pagePathValue":"/professional-page","mjVersion":"/version/3?loc=mj&dedupe=true",xhtmlServiceUrls:{"companies":"/professional-npage/0_0_EM_1034_companies_update.html","industries":"/professional-npage/0_0_EM_1033_industries_update.html","sections":"/professional-npage/0_0_EM_1031_sections_update.html","columns":"/professional-npage/0_0_EM_1032_columns_update.html","topNews":"/professional-npage/0_0_EM_1036_topNews_update.html","mostRecent":"/professional-npage/0_0_EM_1035_mostRecent_update.html","editorsPick":"/professional-npage/0_0_EM_1037_EditorPicks_update.html","mostRecentSaved":"/professional-npage/0_0_EM_1060_mjDockSaved.html","userSaved":"/professional-npage/0_0_EM_1060_mjDockSavedColl.html","mjDockSavedNav":"/professional-npage/0_0_EM_1060_mjDockSavedNav.html","mjDockCompany_News":"/professional-npage/0_0_EM_1055_mjDockCompany_News.html","mjDockIndustry_News":"/professional-npage/0_0_EM_1055_mjDockIndustry_News.html","mjDockTopics":"/professional-npage/0_0_EM_1055_mjDockTopics.html","mjDockColumns":"/professional-npage/0_0_EM_1055_mjDockColumns.html","mjDockTop_News":"/professional-npage/0_0_EM_1055_mjDockTop_News.html","mjDockMost_Recent":"/professional-npage/0_0_EM_1055_mjDockMost_Recent.html","mjDockEditors_Pick":"/professional-npage/0_0_EM_1055_mjDockEditors_Pick.html","mjDocktabCompanies":"/professional-npage/0_0_EM_1055_mjDocktabCompanies.html","mjDocktabIndustries":"/professional-npage/0_0_EM_1055_mjDocktabIndustries.html","pmDocktabCompanies":"/professional-npage/0_0_EM_1055_mjDocktabCompanies.html","pmDocktabIndustries":"/professional-npage/0_0_EM_1055_mjDocktabIndustries.html","mjDockMostRecentSaved":"/professional-npage/0_0_EM_1055_mjDocktabSaved.html","mjDockKeywordAlerts":"/professional-npage/0_0_EM_1055_mjDocktabKeywordAlerts.html","mjDockMarkets":"/professional-npage/0_0_EM_1055_mjDocktabMarkets.html"},serviceUrls:{"updatePmProfile":"/epsvcs/update/userProfile"}});}else{dj.service.dashboard.DashboardPZNService=new _dwd.DashboardPZNService();}
this._firePznSvcInstanceObserver();},_subscribePznSvcInstanceObserver:function(callback,context){if(!this.pznSvcInstanceObserver){this.pznSvcInstanceObserver=new _du.Observer();}
this.pznSvcInstanceObserver.subscribe(callback,context);},_firePznSvcInstanceObserver:function(){if(this.pznSvcInstanceObserver){this.pznSvcInstanceObserver.fire();}}};}());dojo.provide("dj.service.dashboard.DashboardFolderService");dojo.require("dj.service.dashboard.DashboardPZNServiceFactory");dojo.require("dj.service.dashboard.DashboardService");dojo.require("dj.module.dashboard.DashboardExpletives");if(typeof dj=="undefined"){dj={};}
if(typeof dj.widget=="undefined"){dj.widget={};}
if(typeof dj.widget.dashboard=="undefined"){dj.widget.dashboard={};}
if(typeof dj.service=="undefined"){dj.service={};}
if(typeof dj.service.dashboard=="undefined"){dj.service.dashboard={};}
(function(){var _du=dj.util;var _dsd=dj.service.dashboard;var _dwd=dj.widget.dashboard;var _dud=_du.dashboard;var _ctx=dj.context;(_dwd.DashboardFolderService=function(cfg){this._serviceWidget=null;this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._responsePending={};this._subscribed={};this._allFolders=null;this._folderContacts=null;this._allFolderContacts=null;this._allFolderFreqContacts=null;this._defaultFolder=null;this._userFolders={};this.initServices();this._updateObservers={};this._updateCallbacks={};this._dataObserver=new _du.Observer();}).prototype={DEFAULT_CONFIG:{serviceUrls:{"defaultFolders":"/pznusersvc/view/getUser/defaultFolders/version/2","userFolders":"/WSJDBFolders/service.svc/Folders/User/userName/FolderTitle","userFoldersOnCreate":"/WSJDBFolders/service.svc/Folders/User/userName/LatestFirst","userFolder":"/WSJDBFolders/service.svc/Folders/userName","folderFeed":"/pznusersvc/getFolders/userName/","folderFeedPage":"/pznusersvc/view/dash/FeedPage/version/2/","topArticlesFolder":"/pznusersvc/view/dash/TopArticlesPage/version/2","folderPrefs":"/WSJDBFolders/service.svc/FolderPrefs/userName","article":"/WSJDBFeeds/service.svc/Article","articleTypesCount":"/WSJDBFeeds/service.svc/ArticleTypesCount/userName","updateUser":"/pznusersvc/update/updateUser/userName","articles":"/WSJDBFeeds/service.svc/Articles/userName","folderContacts":"/WSJDBFolders/service.svc/Folder/","modifyFolderContacts":"/WSJDBFolders/service.svc/Folder/Contacts","allUserContacts":"/WSJDBFolders/service.svc/User/Contacts","frequentUserContacts":"/WSJDBFolders/service.svc/User/Contacts/Frequent","mostRecentSettings":"/WSJDBFolders/service.svc/UserPrefs","deleteAlertFolder":"/epsvco/profile/v1/Alert/format/xml/id/","updateAlertMjDockView":"/epsvco/profile/v1/Profile"},folderProps:['Y','User','Default','System','Quick Save'],pznFolderNames:['Companies','Industries','Sections','Columnists','Markets','Portfolio','Quick Save','Top News'],colBlankError:"Please enter a name for your new Collection.",colMaxCharError:"Please enter a name for your Collection less than 30 characters",colValidError:"Text includes invalid characters: Only use letters, numbers and . , - _",colLimitError:"Limit reached: Please remove a collection before adding another.",colDuplicateError:"Collection already exists. Please enter a new name.",inappNameError:"Please refrain from using inappropriate vocabulary."},initServices:function(){_dsd.DashboardPZNServiceFactory.getPZNServiceInstance(this.handleInitServices,this);},handleInitServices:function(_pznServiceWidget){this._serviceWidget=_dsd.DashboardService;this._pznServiceWidgetDFS=(_pznServiceWidget)?_pznServiceWidget:_dsd.DashboardPZNService;this._collVisibility=this._pznServiceWidgetDFS.getOtherDefaultVisibleFolders();},getFolderProps:function(){return this._cfg.folderProps;},getPznFolderNames:function(){return this._cfg.pznFolderNames;},getAllUserFolders:function(){return this._allFolders;},articleTimestampFormat:function(newsArticleDate){if(newsArticleDate===""){return newsArticleDate;}
newsArticleDate=newsArticleDate.replace("PM","");newsArticleDate=newsArticleDate.replace("AM","");newsArticleDate=newsArticleDate.replace("pm","");newsArticleDate=newsArticleDate.replace("am","");newsArticleDate=new Date(newsArticleDate);var todaysDate=new Date();if(todaysDate.getDate()===newsArticleDate.getDate()&&todaysDate.getMonth()===newsArticleDate.getMonth()){var newsArticleHrs=newsArticleDate.getHours();if(newsArticleHrs>=12){var amOrPmVal=" p.m.";newsArticleHrs=12-newsArticleHrs;if(newsArticleHrs<0)newsArticleHrs=-newsArticleHrs;}else{var amOrPmVal=" a.m.";}
if(newsArticleHrs===0)newsArticleHrs="12";var newsArticleMins=newsArticleDate.getMinutes();if(newsArticleMins<10){newsArticleMins="0"+newsArticleMins;}
newsArticleDate=newsArticleHrs+":"+newsArticleMins+amOrPmVal;}else{var newsArticleDay=newsArticleDate.getDate();var newsArticleMonth=newsArticleDate.getMonth()+1;newsArticleDate=newsArticleMonth+"/"+newsArticleDay;}
return newsArticleDate;},typeOfResult:function(obj){if(typeof(obj)=="object"){if(obj.length){return"array";}else{return"object";}}else{return typeof(obj);}},validateCollectionName:function(type,foldername,id,foldernames,totalUserCollection){var _djl=dj.lang;var el=dojo.byId(id);foldername=foldername.replace(/^\s+|\s+$/g,'').toLowerCase();if(typeof dj.module.dashboard.expletives!=='undefined'){var cursewords=dj.module.dashboard.expletives;var _icheck=0;var nameval=foldername.replace(/ /g,"");while(cursewords[_icheck]){var curseWord=cursewords[_icheck];if(nameval==curseWord){el.innerHTML=this._cfg.inappNameError;el.style.display="block";return false;};_icheck++;}}
if(typeof totalUserCollection!=='undefined'){if(totalUserCollection>20){el.innerHTML=this._cfg.colLimitError;el.style.display="block";return false;}}
if(typeof foldernames!=='undefined'){var _check=0;if(type==="new"){while(foldernames[_check]){if(foldername===foldernames[_check].FolderTitle.toLowerCase()){el.innerHTML=this._cfg.colDuplicateError;el.style.display="block";return false;}
_check++;}}else{var _check=0;var _folderId=type.replace("User","");while(foldernames[_check]){if(foldername==(foldernames[_check].FolderTitle.toLowerCase())&&foldernames[_check].FolderID!=_folderId){el.innerHTML=this._cfg.colDuplicateError;el.style.display="block";return false;}
_check++;}}}
if(""===foldername){el.innerHTML=this._cfg.colBlankError;el.style.display="block";return false;}
if("most recent"==foldername||"quick save"==foldername){dojo.byId(id).innerHTML=this._cfg.colDuplicateError;el.style.display="block";return false;}
if(foldername.length>30){el.innerHTML=this._cfg.colMaxCharError;el.style.display="block";return false;}
el.style.display="none";var invalidChars="~?!#$%&*()\"||<>=+;:][{}/\\";for(var count=0,len=invalidChars.length;count<len;count++){var badChar=invalidChars.charAt(count);if(foldername.indexOf(badChar,0)>-1){el.innerHTML=this._cfg.colValidError;el.style.display="block";return false;}}
return true;},subscribeUserFolders:function(callback,context,firstViewMode){var name="userFolders";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleUserFolders,this);this._subscribed[name]=true;}
if(firstViewMode){this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.userFoldersOnCreate);}else{this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.userFolders);}},handleUserFolders:function(key,data){var name="userFolders";this._allFolders=data;this._dataObserver.fireByName(name,data);},subscribeDefaultFolders:function(callback,context){var name="defaultFolders";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleDefaultFolders,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.defaultFolders);},handleDefaultFolders:function(key,data){var name="defaultFolders";this._allFolders=data;this._defaultFolder=data;var folderdata=this._defaultFolder.Folders;if((typeof folderdata!=='undefined')){var _check=0;while(folderdata[_check]){if("Y"==folderdata[_check].Visibility){this._collVisibility+=folderdata[_check].FolderTitle+"~";}
_check++;}}
this._dataObserver.fireByName(name,data);},reloadUserFolders:function(){var name="userFolders";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.userFolders);},subscribeUserFolder:function(folderId,callback,context){var name="folderArticles";var url=this._cfg.serviceUrls.folderFeed+folderId;this._dataObserver.subscribeByName(name+":"+folderId,callback,context);if(!this._subscribed["folderArticles:"+folderId]){this._serviceWidget.subscribeFeed("folderArticles",folderId,this.handleUserFolder,this);this._subscribed["folderArticles:"+folderId]=true;}
var criteria={FolderID:folderId};this._serviceWidget.getFeed("folderArticles",folderId,url,criteria);},searchUserFolder:function(folderId,criteria,callback,context){var name="folderArticles";if(folderId===""){folderId="MostRecent";}
criteria.FolderID=folderId;this._dataObserver.subscribeByName("folderArticles:"+folderId,callback,context);if(folderId==="MostRecent"){var url=this._cfg.serviceUrls.topArticlesFolder;url+='/'+(criteria.from||0)+'/'+(criteria.NoOfRecords||100)+'/'
+(criteria.fromDate||'09-01-1980')+'/'+(criteria.ContentType||'null');}else{var url=this._cfg.serviceUrls.folderFeedPage+folderId;url+='/'+(criteria.from||0)+'/'+(criteria.NoOfRecords||100)+'/'
+(criteria.OrderColumn||'DateAdded')+'/'+(criteria.OrderBy||'Desc')+'/'
+(criteria.ContentType||'null');}
this._userFolders["Folder:"+criteria.FolderID]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleUserFolder,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},reloadFolder:function(folderId){var name="userFolders";this._serviceWidget.reloadFeed(name,folderId,this._cfg.serviceUrls.folderFeedPage+folderId);},handleUserFolder:function(key,data,criteria){var name="folderArticles";var response={"Criteria":criteria,"Results":data};this._userFolders[name+":"+criteria.FolderID]=response;this._dataObserver.fireByName(name+":"+criteria.FolderID,criteria.FolderID,response);},createUserFolder:function(folderName,mjView,dockView,callback,context){var name="CreateUserFolder";if(!mjView){mjView="Layout";}
if(!dockView){dockView="Layout";}
this._subscribeUpdateObserver(name+":"+folderName,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[{"FolderID":"0","FolderTitle":folderName,"MJView":mjView,"DockView":dockView,"FolderType":"User"}];this._serviceWidget.doPut(name,folderName,url,postData,this.handleCreateUserFolder,this);},handleCreateUserFolder:function(folderName,data){var name="CreateUserFolder";this._fireUpdateObserver(name+":"+folderName,folderName,data);this._unsubscribeUpdateObserver(name+":"+folderName);},renameUserFolder:function(folderId,newFolderName,callback,context){var name="RenameUserFolder";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[{"FolderID":folderId,"FolderTitle":newFolderName,"FolderType":"User"}];this._serviceWidget.doPost(name,folderId,url,postData,this.handleRenameUserFolder,this);},handleRenameUserFolder:function(folderId,data){var name="RenameUserFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},updateUserFolderInfo:function(folderId,folderObj,callback,context){var name="UpdateUserFolderInfo";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[folderObj];this._serviceWidget.doPost(name,folderId,url,postData,this.handleUpdateUserFolderInfo,this);},handleUpdateUserFolderInfo:function(folderId,data){var name="UpdateUserFolderInfo";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},updateUserAlertInfo:function(alertObj,callback,context){var name="UpdateUserAlertInfo";var alertId=alertObj.id;this._subscribeUpdateObserver(name+":"+alertId,callback,context);var url=this._cfg.serviceUrls.updateAlertMjDockView;var postData={"profileType":"alertView","profileName":alertId,"params":[{"mj":alertObj.mjView},{"dock":alertObj.dockView}]};this._serviceWidget.doPost(name,alertId,url,postData,this.handleUpdateUserAlertInfo,this);},handleUpdateUserAlertInfo:function(alertId,data){var name="UpdateUserAlertInfo";this._fireUpdateObserver(name+":"+alertId,alertId,data);this._unsubscribeUpdateObserver(name+":"+alertId);},updateUserFolderPreferences:function(folderId,newPrefs,callback,context){var name="UpdateUserFolderPrefs";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.folderPrefs;var prefInit={"FolderID":folderId};var newFolderPrefs=dj.lang.cloneMixin(prefInit,newPrefs);var postData=[newFolderPrefs];this._serviceWidget.doPost(name,folderId,url,postData,this.handleUpdateUserFolderPreferences,this);},handleUpdateUserFolderPreferences:function(folderId,data){var name="UpdateUserFolderPrefs";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteUserFolder:function(folderId,callback,context){var name="DeleteUserFolder";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[{"FolderID":folderId,"FolderType":"User"}];this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteUserFolder,this);},handleDeleteUserFolder:function(folderId,data){var name="DeleteUserFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteUserAlert:function(alertId,callback,context){var name="DeleteUserAlert";this._subscribeUpdateObserver(name+":"+alertId,callback,context);var url=this._cfg.serviceUrls.deleteAlertFolder+alertId;var postData={};this._serviceWidget.doDelete(name,alertId,url,postData,this.handleDeleteUserAlert,this);},handleDeleteUserAlert:function(alertId,data){var name="DeleteUserAlert";this._fireUpdateObserver(name+":"+alertId,alertId,data);this._unsubscribeUpdateObserver(name+":"+alertId);},moveFolder:function(key,fromIndex,toIndex){},addArticleToFolder:function(folderId,articleObject,callback,context){if(!articleObject){return;}
var name="AddArticleToFolder";var url=this._cfg.serviceUrls.article;this._subscribeUpdateObserver(name+":"+folderId,callback,context);articleObject.FolderItemID="0";articleObject.DateAdded="";if(!articleObject.ContentType){articleObject.ContentType="Article";}
var postData=[articleObject];this._serviceWidget.doPut(name,folderId,url,postData,this.handleAddArticleToFolder,this);},handleAddArticleToFolder:function(folderId,data){var name="AddArticleToFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteArticleFromFolder:function(folderId,folderItemId,callback,context){var name="DeleteArticleFromFolder";var url=this._cfg.serviceUrls.article;this._subscribeUpdateObserver(name+":"+folderId,callback,context);var articleObject={};articleObject.FolderID=folderId;articleObject.FolderItemID=folderItemId;var postData=[articleObject];this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteArticleFromFolder,this);},handleDeleteArticleFromFolder:function(folderId,data){var name="DeleteArticleFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},subscribeArticleTypeCounts:function(daysToInclude,callback,context){var name="ArticleTypeCounts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleArticleTypeCounts,this);this._subscribed[name]=true;}
this.getArticleTypeCounts(daysToInclude);},handleArticleTypeCounts:function(daysToInclude,data){var name="ArticleTypeCounts";this._dataObserver.fireByName(name,daysToInclude,data);},buildArticleTypeDate:function(daysToInclude){var timeframe=1;if(typeof daysToInclude!=="undefined"){timeframe=daysToInclude;}
var todaydate=new Date();var newDate=new Date(todaydate.getTime()-(timeframe*24*60*60*1000));var dateValue=(newDate.getMonth()+1)+"-"+newDate.getDate()+"-"+newDate.getFullYear();return dateValue;},getArticleTypeCounts:function(daysToInclude){var name="ArticleTypeCounts";var url=this._cfg.serviceUrls.articleTypesCount+"/"+this.buildArticleTypeDate(daysToInclude);this._serviceWidget.getFeed(name,"all",url);},reloadArticleTypeCounts:function(daysToInclude){var name="ArticleTypeCounts";var url=this._cfg.serviceUrls.articleTypesCount+"/"+this.buildArticleTypeDate(daysToInclude);this._serviceWidget.reloadFeed(name,"all",url,{daysToInclude:daysToInclude});},getFolderVisibility:function(id,check){if(check=="remove"){this._collVisibility=this._collVisibility.replace(id,"");}else{this._collVisibility=this._collVisibility.replace(id,"");this._collVisibility=this._collVisibility+id;}
if(this._collVisibility=="Portfolio~"){if(dojo.byId("allMojHidden")){dojo.removeClass(dojo.byId("allMojHidden"),"hidden");dojo.addClass(dojo.byId("sort_button"),"hidden");}}
return this._collVisibility;},updatePZNVisibility:function(folderId,check,callback,context){var name="UpdatePZNVisibility";var folderlist=this.getFolderVisibility();this._subscribeUpdateObserver(name,callback,context);if(check=="Y"){folderlist=folderlist.replace(folderId+"~","");folderlist=folderlist+(folderId+"~");}else{folderlist=folderlist.replace(folderId+"~","");}
var url=this._cfg.serviceUrls.updateUser;var postData=[{"ShowFolder":folderlist}];this._serviceWidget.doPost(name,"all",url,postData,this.handlePZNVisibility,this);},handlePZNVisibility:function(folderId,data){var name="UpdatePZNVisibility";this._fireUpdateObserver(name,folderId,data);this._unsubscribeUpdateObserver(name);},deleteAllArticleFromFolder:function(folderId,callback,context){var name="DeleteAllArticleFromFolder";var url=this._cfg.serviceUrls.articles;this._subscribeUpdateObserver(name+":"+folderId,callback,context);var postData=[{"FolderID":folderId}];this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteAllArticleFromFolder,this);},handleDeleteAllArticleFromFolder:function(folderId,data){var name="DeleteAllArticleFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},_subscribeUpdateObserver:function(name,callback,context){var updateObserver=this._updateObservers[name];if(!updateObserver){updateObserver=new _du.Observer();this._updateObservers[name]=updateObserver;this._updateCallbacks[name]=callback;updateObserver.subscribe(callback,context);}},addContactsToFolder:function(folderId,contactObject,callback,context){if(!folderId){return;}
var name="AddContactsToFolder";var url=this._cfg.serviceUrls.modifyFolderContacts;this._subscribeUpdateObserver(name+":"+folderId,callback,context);var postData=contactObject;this._serviceWidget.doPut(name,folderId,url,postData,this.handleAddContactsToFolder,this);},handleAddContactsToFolder:function(folderId,data){var name="AddContactsToFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},updateFolderContacts:function(folderId,contactObject,callback,context){var name="UpdateFolderContacts";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.modifyFolderContacts;contactObject.ContactID="";contactObject.FirstName="";contactObject.LastName="";var postData=[contactObject];this._serviceWidget.doPost(name,folderId,url,postData,this.handleUpdateFolderContacts,this);},handleUpdateFolderContacts:function(folderId,data){var name="UpdateFolderContacts";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteContactsFromFolder:function(folderId,contactObject,callback,context){var name="DeleteContactsFromFolder";var url=this._cfg.serviceUrls.modifyFolderContacts;this._subscribeUpdateObserver(name+":"+folderId,callback,context);contactObject.FirstName="";contactObject.LastName="";var postData=contactObject;this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteContactsFromFolder,this);},handleDeleteContactsFromFolder:function(folderId,data){var name="DeleteContactsFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteAllContactsFromFolder:function(folderId,callback,context){var name="DeleteAllContactsFromFolder";var url=this._cfg.serviceUrls.folderContacts+folderId+'/Contacts';this._subscribeUpdateObserver(name+":"+folderId,callback,context);this._serviceWidget.doDelete(name,folderId,url,"",this.handleDeleteAllContactsFromFolder,this);},handleDeleteAllContactsFromFolder:function(folderId,data){var name="DeleteAllContactsFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},subscribeFolderContacts:function(folderId,callback,context){var name="foldersContacts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleFolderContacts,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.folderContacts+folderId+'/Contacts');},handleFolderContacts:function(folderId,data){var name="foldersContacts";this._folderContacts=data;this._dataObserver.fireByName(name,data);},reloadFolderContacts:function(folderId){var name="foldersContacts";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.folderContacts+folderId+'/Contacts');},subscribeAllUserContacts:function(callback,context){var name="allUserContacts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleAllUserContacts,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.allUserContacts);},handleAllUserContacts:function(key,data){var name="allUserContacts";this._allFolderContacts=data;this._dataObserver.fireByName(name,data);},reloadAllUserContacts:function(){var name="allUserContacts";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.allUserContacts);},subscribeFrequentUserContacts:function(callback,context){var name="frequentUserContacts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleFrequentUserContacts,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.frequentUserContacts);},handleFrequentUserContacts:function(key,data){var name="frequentUserContacts";this._allFolderFreqContacts=data;this._dataObserver.fireByName(name,data);},reloadFrequentUserContacts:function(){var name="frequentUserContacts";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.frequentUserContacts);},updateMostRecentView:function(mjView,dockView,callback,context){var name="UpdateMostRecentView";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.mostRecentSettings;var postData={"MJView":mjView,"DockView":dockView};this._serviceWidget.doPost(name,"all",url,postData,this.handleUpdateMostRecentView,this);},handleUpdateMostRecentView:function(data){var name="UpdateMostRecentView";this._fireUpdateObserver(name,data);this._unsubscribeUpdateObserver(name);},handleSearchClick:function(eventid){var id=eventid;var firstInt=id.indexOf(":");var secInt=id.indexOf(":",firstInt+1);var lastInt=id.indexOf(":",secInt+1);var _code=id.substring(firstInt+1,secInt);var _id=id.substring(secInt+1,lastInt);var _desc=unescape(id.substring(lastInt+1));var _entityObj=new dj.module.ep.search.SearchEntity({code:_code,id:_id,description:_desc});var _contextObj=new dj.module.ep.search.SearchDataBean();_contextObj.add(_entityObj);var _service=dj.module.ep.search.searchService;_service.postQuery(_contextObj);},getWrappedFolderTitle:function(folderNameStr){var invalidChars="~?!#$%&*()\"||<>=+;:][{}/\\";for(var count=0,len=invalidChars.length;count<len;count++){var badChar=invalidChars.charAt(count);if(folderNameStr.indexOf(badChar,0)>-1){return folderNameStr;}}
var folderNameSplit=folderNameStr.split(" ");var tempStr="";for(i=0;i<folderNameSplit.length;i++){if(folderNameSplit[i].length>15){if(tempStr!=""){tempStr=tempStr+" "+folderNameSplit[i].substring(0,15)+"-<br/>"
+folderNameSplit[i].substring(15,folderNameSplit[i].length);}else{tempStr=folderNameSplit[i].substring(0,15)+"-<br/>"
+folderNameSplit[i].substring(15,folderNameSplit[i].length);}}else{if(tempStr!=""){tempStr=tempStr+" "+folderNameSplit[i];}else{tempStr=folderNameSplit[i];}}}
if(tempStr!==""){folderNameStr=tempStr;}
return folderNameStr;},_fireUpdateObserver:function(name){var updateObserver=this._updateObservers[name];if(updateObserver){var fireParams=[];for(var i=1,arg,len=arguments.length;i<len;i++){fireParams.push(arguments[i]);}
updateObserver.fire.apply(updateObserver,fireParams);}},_unsubscribeUpdateObserver:function(name){this._updateObservers[name]=null;},searchDeepDiveCompanies:function(code,id,desc,metadata,query){var _entityObj=null;if(id!=null||id!=undefined){_entityObj=this.getCompEntityObj(code,id,unescape(desc));}
var _contextObj=new dj.module.ep.search.SearchDataBean({baselineQuery:unescape(query),baselineQueryMetaData:metadata,sortbyValue:dj.module.ep.search.SearchDataBean.searchConstants.sortbyArrivalTime,searchType:dj.module.ep.search.SearchDataBean.searchConstants.deepDive,queryType:dj.module.ep.search.SearchDataBean.searchConstants.simpleTraditionalQuery});if(id!=null||id!=undefined){_contextObj.add(_entityObj);}
var _service=dj.module.ep.search.searchService;_service.postQuery(_contextObj);},getCompEntityObj:function(code,id,desc){var _entityObj=new dj.module.ep.search.SearchEntity({code:code,id:id,description:desc});return _entityObj;},setIndustryDate:function(){var that=this;var i=0;while(dojo.query('.pubTimeStamp')[i]){if(dojo.query('.pubTimeStamp')[i].style.display==="none"){dojo.query('.pubTimeStamp')[i].innerHTML=this.formatToHDate(dojo.query('.pubTimeStamp')[i].innerHTML);dojo.query('.pubTimeStamp')[i].style.display='inline';}
i++;}},formatToHDate:function(pubTimeStamp){if(!pubTimeStamp||pubTimeStamp==="")return"";var that=this;var currDate=new Date();var Y=currDate.getFullYear();var M=currDate.getMonth()+1;if(M<10)M='0'+M;var E=currDate.getDate();if(E<10)E='0'+E;var cDate=M+'/'+E+'/'+Y;var pY=pubTimeStamp.substring(0,4);var pM=pubTimeStamp.substring(5,7);var pE=pubTimeStamp.substring(8,10);var pDate=pM+'/'+pE+'/'+pY;if(cDate===pDate){var pTime=pubTimeStamp.substring(11,16);var pHr=pTime.substring(0,2);var pMi=pTime.substring(3,5);if(pHr>=12){pHr=12-pHr;if(pHr<0)pHr=-pHr;if(pHr===0)pHr="12";pTime=pHr+':'+pMi+' p.m.';}else{if(pHr.substring(0,1)==='0'){pHr=pHr.substring(1,pHr.length);}
pTime=pHr+':'+pMi+' a.m.';}
return pTime;}else{return pDate;}}};dj.service.dashboard.DashboardFolderService=new _dwd.DashboardFolderService();}());dojo.provide("dj.widget.dashboard.DashboardSaveTo");dojo.require("dj.service.dashboard.DashboardFolderService");dojo.require("dj.service.dashboard.DashboardPZNServiceFactory");dojo.require("dj.util.Element");dojo.require("dj.util.Query");dojo.require("dj.util.User");dojo.getObject("dj.module.dashboard",true);(function(){var _dwd=dj.widget.dashboard;var _dsd=dj.service.dashboard;(_dwd.DashboardSaveTo=function(id,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._id=null;this._serviceWidget=null;if(typeof id!=="undefined"){this.id=id;}
this.initServices();this._dud=dj.util.dashboard;}).prototype={DEFAULT_CONFIG:{mjSaveToWidgetInstance:"Article",mjSaveToWidgetArticle:"Article",mjSaveToWidgetSearch:"Search",mjSaveToWidgetMJLanding:"MyJournalLanding",mjSaveToWidgetMJDetails:"MyJournalDetails",mjLandingContBlock:"mjReorderContainer",mjDetailsContBlock:"hideArticlesDiv",mjDockBarBlock:"pmDock",mjDockBarContBlock:".cnt_DockbarClass",mjSearchPremiumContBlock:"djsResultsPanel",mjSearchContBlock:"ARTICLESEARCHRESULTS",mjAtagsLookUpBlock:"document",mjQuickSaveLookUpClass:"mjQuickSave",mjMoreLookUpClass:"mjDropdown",mjNewCollectionDefaultText:"My New Collection",mjListCollectionMode:"list",mjNewCollectionMode:"new",mjNewFolderCreatedMode:"newFolderCreated",mjSaveCollectionMode:"save",mjLoginCollectionMode:"login",mjSaveDropdownMainBlock:"mjsave_dropdown_block",mjMoreLink:"widget.mjsave_more",mjMoreSaveThisLink:"widget.mjsave_more_savethis",mjMoreSavedLink:"widget.mjsave_more_saved",mjQuickSaveLink:"widget.mjsave_quicksave",mjQuickSaveThisLink:"widget.mjsave_quicksave_savethis",mjQuickSaveSavedLink:"widget.mjsave_saved",mjItemBlock:".mjItemMain",mjItemLink:".mjLinkItem",mjItemDesc:".mjItemDesc",mjItemDate:".mjItemDate",mjItemSource:".mjItemSource",mjItemSourceCode:".mjItemSourceCode",mjSaveDropdownCollList:"mjsave_mycoll_collection_list",mjUserCollectionType:"User",mjSystemCollectionType:"System",mjSaveToPrefix:"saveToFolder#",mjSaveError:"mjsave_error",mjsaveNewCollSubmit:"mjsaveNewCollSubmit",mjsaveNewCollCancel:"mjsaveNewCollCancel",mjAddCollLink:"mjsave_addcoll_link",mjNewCollField:"new-collection",mjSaveToNewPromoText:"mjsave_promotext",mjSiteWideDock:"false"},initServices:function(){_dsd.DashboardPZNServiceFactory.getPZNServiceInstance(this.initialize,this);},initialize:function(_pznServiceWidget){this._pznServiceWidget=(_pznServiceWidget)?_pznServiceWidget:_dsd.DashboardPZNService;this._serviceWidget=_dsd.DashboardFolderService;this._pagePathValue=this._pznServiceWidget.getPagePathValue();this.initialLoad=true;this.selfReloadDone="false";if(this._cfg.mjSaveToWidgetInstance==="IntroMJ"||this._cfg.mjSaveToWidgetInstance==="IntroSaved"){var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(!isLoggedIn){that.setupLoginOrRegister(that._cfg.mjSaveToWidgetInstance);}});return;}
if(window.location.href.indexOf("/article/")!==-1){this._cfg.mjSaveToWidgetInstance=this._cfg.mjSaveToWidgetArticle;this._cfg.mjSiteWideDock="false";}else if(window.location.href.indexOf("/my-")!==-1||window.location.href.indexOf("/mj-")!==-1){this._cfg.mjSiteWideDock="false";if(window.location.href.indexOf("my-journal-main")!==-1){this._cfg.mjSaveToWidgetInstance=this._cfg.mjSaveToWidgetMJLanding;}}
if(this._cfg.mjSiteWideDock==="false"){this.setUpSaveToObservers();}else{this.setUpSaveToObservers(dojo.byId(this._cfg.mjDockBarBlock));}
var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){that.setupNewCollectionObservers();}else{that.setupLoginOrRegister();}});this.oMjSaveDropDownContainer=dojo.byId(this._cfg.mjSaveDropdownMainBlock);dojo.connect(document,"onclick",this,function(event){if(this.oMjSaveDropDownContainer.innerHTML!==""){var isMousePointerinModalContainer=dj.util.Element.contains(this.oMjSaveDropDownContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer==false){this.restoreDefaultState();}}});if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){dj.module.articleTabs.panels.addChangeListener("success",function(){this.restoreDefaultState();},this);}},setUpSaveToObservers:function(containerNode){if((window.location.href.indexOf("/professional-search/")!==-1||window.location.href.indexOf("/professional-industry/")!==-1)&&containerNode!==dojo.byId(this._cfg.mjDockBarBlock)){return;}
var startPoint=eval(this._cfg.mjAtagsLookUpBlock);if(containerNode){startPoint=containerNode;}
var tdTags=dojo.query("td",startPoint);if(dojo.isIE<7){if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding){var divTags=dojo.query("div",startPoint);for(var i=0;i<divTags.length;i++){if(divTags[i].className.indexOf("newsFunc")!==-1){this.divTag=divTags[i];var divtag=dojo.byId(this.divTag);dojo.connect(divtag,"mouseover",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(dojo.byId(this._cfg.mjLandingContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else{var possibleContainers=dojo.query(this._cfg.mjItemBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOver=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOver!=="undefined"){if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}
if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed");}
dojo.addClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}});var div=dojo.byId(this.divtag);dojo.connect(div,"onmouseout",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(dojo.byId(this._cfg.mjLandingContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else{var possibleContainers=dojo.query(this._cfg.mjItemBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOut=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOut!=="undefined"){if(dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover");}
if(!dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed")){dojo.addClass(saveToObjMouseOut,"IE6ddStandardCollapsed");}}});}}}}
if(dojo.isIE<7){if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){for(var i=0;i<tdTags.length;i++){if(tdTags[i].className.indexOf("mjArticleAction")!==-1){this.tdTag=tdTags[i];if(this.tdTag&&this.tdTag.innerHTML!==""){var td=dojo.byId(this.tdTag);dojo.connect(td,"onmouseover",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJLanding){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJDetails){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDetailsContBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOver=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOver!=="undefined"){if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}
if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed");}
dojo.addClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}});var td=dojo.byId(this.tdTag);dojo.connect(td,"onmouseout",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJLanding){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJDetails){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDetailsContBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOut=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOut!=="undefined"){if(dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover");}
if(!dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed")){dojo.addClass(saveToObjMouseOut,"IE6ddStandardCollapsed");}}});}}}}}
if(window.location.href.indexOf("/professional-search/")===-1&&window.location.href.indexOf("/professional-industry/")===-1){if(this.eventConnections){dojo.forEach(this.eventConnections,dojo.disconnect);}
this.eventConnections=[];var aTags=dojo.query("a",startPoint);for(var i=0;i<aTags.length;i++){if(aTags[i].className.indexOf(this._cfg.mjQuickSaveLookUpClass)!==-1){this.aTag=aTags[i];this.eventConnections.push(dojo.connect(this.aTag,"onclick",this,function(event){dojo.stopEvent(event);if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=="undefined"){dojo.addClass(sharedrpDwn,"collapsed");dojo.removeClass(sharedrpDwn,"expanded");}}
if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
var saveToObj=srcElement.offsetParent;if(dojo.isIE===7){saveToObj=srcElement.offsetParent.offsetParent.offsetParent;}
if(dojo.isIE<7||(dojo.isIE===7&&this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetSearch)){saveToObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(saveToObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(saveToObj,dojo.query(this._cfg.mjSearchPremiumContBlock)[0])){this.searchPremiumInstance=true;}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(saveToObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails||this.collectionMode===this._cfg.mjLoginCollectionMode||this.dockbarInstance)&&!this.searchPremiumInstance){if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
this.quickSaveModeBlk=false;console.log("superImposeBlock..");this.superImposeBlock(saveToObj,"false");}else{this.currQuickSaveObj=saveToObj;this.quickSaveModeBlk=true;if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}else{this.superImposeBlock(this.currQuickSaveObj,"true");}}}));}
if(aTags[i].className.indexOf(this._cfg.mjMoreLookUpClass)!==-1){this.aTag=aTags[i];this.eventConnections.push(dojo.connect(this.aTag,"onclick",this,function(event){dojo.stopEvent(event);this.quickSaveModeBlk=false;if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=='undefined'){dojo.addClass(sharedrpDwn,'collapsed');dojo.removeClass(sharedrpDwn,'expanded');}}
if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
var moreObj=srcElement.offsetParent;if(dojo.isIE===7){moreObj=srcElement.offsetParent.offsetParent.offsetParent;}
if(dojo.isIE<7||(dojo.isIE===7&&this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetSearch)){moreObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(moreObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(moreObj,this._cfg.mjSearchPremiumContBlock)){this.searchPremiumInstance=true;}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(moreObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
console.log("superImposeBlock");this.superImposeBlock(moreObj,"false");}));}}}else{dj.lang.addLiveEvent(".mjQuickSave","click",function(ev){dojo.stopEvent(ev);if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=='undefined'){dojo.addClass(sharedrpDwn,'collapsed');dojo.removeClass(sharedrpDwn,'expanded');}}
var srcElement=(ev.target||ev.srcElement);var saveToObj=srcElement.offsetParent;if(dojo.isIE===7){saveToObj=srcElement.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(saveToObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(saveToObj,this._cfg.mjSearchPremiumContBlock)){this.searchPremiumInstance=true;}
if(this.searchPremiumInstance){if(dojo.isIE<7){saveToObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(saveToObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails||this.collectionMode===this._cfg.mjLoginCollectionMode||this.dockbarInstance)&&!this.searchPremiumInstance){if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
this.quickSaveModeBlk=false;console.log("superImposeBlock.");this.superImposeBlock(saveToObj,"false");}else{this.currQuickSaveObj=saveToObj;this.quickSaveModeBlk=true;if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}else{this.superImposeBlock(this.currQuickSaveObj,"true");}}},this);dj.lang.addLiveEvent(".mjDropdown","click",function(ev){dojo.stopEvent(ev);this.quickSaveModeBlk=false;if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=='undefined'){dojo.addClass(sharedrpDwn,'collapsed');dojo.removeClass(sharedrpDwn,'expanded');}}
if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
var srcElement=(ev.target||ev.srcElement);var moreObj=srcElement.offsetParent;if(dojo.isIE===7){moreObj=srcElement.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(moreObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(moreObj,dojo.byId(this._cfg.mjSearchPremiumContBlock))){this.searchPremiumInstance=true;}
if(this.searchPremiumInstance){if(dojo.isIE<7){moreObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(moreObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
console.log("superImposeBlock...");this.superImposeBlock(moreObj,"false");},this);}},toggleSaveToDropdown:function(saveToObj,saveToShowClass,saveToHideClass){if(saveToObj){if(dojo.hasClass(saveToObj,saveToHideClass)){dojo.removeClass(saveToObj,saveToHideClass);}
if(!dojo.hasClass(saveToObj,saveToShowClass)){dojo.addClass(saveToObj,saveToShowClass);}}},toggleSaveToPanel:function(saveToShowClass){this.saveToPanelObj=dojo.byId("saveToDropdownPanel");if(!dojo.hasClass(this.saveToPanelObj,saveToShowClass)){dojo.addClass(this.saveToPanelObj,saveToShowClass);}
if(saveToShowClass==="ddPanelState-MyCollections"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-NewCollection");dojo.removeClass(this.saveToPanelObj,"ddPanelState-SaveConfirmation");dojo.removeClass(this.saveToPanelObj,"ddPanelState-Login");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="ddPanelState-NewCollection"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-MyCollections");dojo.removeClass(this.saveToPanelObj,"ddPanelState-SaveConfirmation");dojo.removeClass(this.saveToPanelObj,"ddPanelState-Login");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="ddPanelState-SaveConfirmation"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-NewCollection");dojo.removeClass(this.saveToPanelObj,"ddPanelState-MyCollections");dojo.removeClass(this.saveToPanelObj,"ddPanelState-Login");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="ddPanelState-Login"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-NewCollection");dojo.removeClass(this.saveToPanelObj,"ddPanelState-SaveConfirmation");dojo.removeClass(this.saveToPanelObj,"ddPanelState-MyCollections");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="errorDisplay-On"){dojo.addClass(this.saveToPanelObj,saveToShowClass);}else if(saveToShowClass==="errorDisplay-Off"){dojo.removeClass(this.saveToPanelObj,saveToShowClass);}},superImposeBlock:function(parentObj,quickSaveMode){this.selfReloadDone="false";this.actualTargetObj=parentObj.parentNode;console.log("parentObj "+parentObj.innerHTML);this.currentPanelObj=dj.util.Query.next(parentObj);if(this.currentPanelObj===null||this.currentPanelObj===undefined)return;if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(quickSaveMode!=="true"){if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.collectionMode===this._cfg.mjNewFolderCreatedMode){this.setupSaveToCollectionList();}}
if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}}else{var qsFolderId=this.quickSaveFolderId;this.userSaveToExistingCollSave("",qsFolderId);}}
if(typeof this.mjDynamicWidgetObj==='undefined'){this.mjDynamicWidgetObj=dojo.byId(this._cfg.mjSaveDropdownMainBlock);this.prevMJObj=dojo.clone(this.mjDynamicWidgetObj);}else{if(this.mjDynamicWidgetObj.innerHTML===""){var mjSaveDiv=document.createElement('div');mjSaveDiv.id=this._cfg.mjSaveDropdownMainBlock;mjSaveDiv.className='dropdown_container dropdownType-standard expanded';mjSaveDiv.innerHTML=this.prevMJObj.innerHTML;document.body.appendChild(mjSaveDiv);this.mjDynamicWidgetObj=dojo.byId(this._cfg.mjSaveDropdownMainBlock);this.setupCollectionObservers();this.oMjSaveDropDownContainer=this.mjDynamicWidgetObj;}}
var dynamicWidgetParent=this.mjDynamicWidgetObj.parentNode;if(dynamicWidgetParent!==null){dynamicWidgetParent.removeChild(this.mjDynamicWidgetObj);}
if(this.currentPanelObj!=null&&this.mjDynamicWidgetObj.innerHTML===""){this.currentPanelObj.appendChild(mjSaveDiv);}else if(this.currentPanelObj!=null){this.currentPanelObj.appendChild(this.mjDynamicWidgetObj);}
if(this.collectionMode===this._cfg.mjLoginCollectionMode){this.toggleSaveToPanel("ddPanelState-Login");}else if(quickSaveMode==="true"){this.toggleSaveToPanel("ddPanelState-SaveConfirmation");}else{this.toggleSaveToPanel("ddPanelState-MyCollections");}
if(typeof this.lastAccessedId=='undefined'){this.lastAccessedId=this.actualTargetObj;}else if(this.lastAccessedId!==this.actualTargetObj){this.restoreDefaultState(this.lastAccessedId);this.lastAccessedId=this.actualTargetObj;}
this.toggleSaveToDropdown(this.actualTargetObj,"ddState-expanded","ddState-collapsed");var quickSaveCaseType=this._cfg.mjQuickSaveLink;var moreCaseType=this._cfg.mjMoreLink;if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetArticle||this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch||this.searchPremiumInstance){quickSaveCaseType=this._cfg.mjQuickSaveThisLink;moreCaseType=this._cfg.mjMoreSaveThisLink;if(quickSaveMode!=="true"){this.toggleSaveToBar('ddState-saveThis');}else{this.toggleSaveToBar('ddState-saved');}}else{this.toggleSaveToBar('ddState-saveTo');}
if(quickSaveMode==="true"){quickSaveCaseType=this._cfg.mjQuickSaveSavedLink;moreCaseType=this._cfg.mjMoreSavedLink;}
this.widgetQuickSaveObj=eval(document.getElementById(quickSaveCaseType));this.widgetMoreObj=eval(document.getElementById(moreCaseType));if(!this.quickSaveModeBlk){dojo.connect(this.widgetMoreObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.alreadyClosed=true;this.defaultSuperImposeAndClose();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});dojo.connect(this.widgetQuickSaveObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.alreadyClosed=true;this.defaultSuperImposeAndClose();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});}else{dojo.connect(this.widgetQuickSaveObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.restoreDefaultState();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});dojo.connect(this.widgetMoreObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.restoreDefaultState();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});}
this.currentSaveToInstance();},toggleSaveToBar:function(saveBarClass){this.saveToBarObj=dojo.byId("saveToTopBar");if(!dojo.hasClass(this.saveToBarObj,saveBarClass)){dojo.addClass(this.saveToBarObj,saveBarClass);}
if(saveBarClass==="ddState-saveTo"){dojo.removeClass(this.saveToBarObj,"ddState-saveThis");dojo.removeClass(this.saveToBarObj,"ddState-saved");}else if(saveBarClass==="ddState-saveThis"){dojo.removeClass(this.saveToBarObj,"ddState-saveTo");dojo.removeClass(this.saveToBarObj,"ddState-saved");}else if(saveBarClass==="ddState-saved"){dojo.removeClass(this.saveToBarObj,"ddState-saveTo");dojo.removeClass(this.saveToBarObj,"ddState-saveThis");}},defaultSuperImposeAndClose:function(checkClosed){if(!checkClosed||checkClosed&&!this.alreadyClosed){this.restoreDefaultState();if(checkClosed){this.alreadyClosed=true;}}},currentSaveToInstance:function(){if(this._cfg.mjSaveToWidgetInstance!==this._cfg.mjSaveToWidgetSearch){if(typeof this.saveToAdBox==='undefined'){this.saveToAdBox=dojo.byId('SaveToSponsorBox');}
if(this.saveToAdBox){if(this.saveToAdBox.innerHTML===""){}}}},closeDeletePopUps:function(){var startPoint=dojo.byId("hideArticlesDiv");if(startPoint){var divTags=dojo.query("div",startPoint);var delpop=dojo.query(".deletePopup","hideArticlesDiv")[0];if(typeof delpop!=="undefined"){this.deletePopUp=delpop.id;var _prevDeleteRow="currentRow"+this.deletePopUp;dojo.util.Element.toggleHiddenClass(this.deletePopUp);dojo.removeClass(_prevDeleteRow,"dialogShow");dojo.removeClass(this.deletePopUp,"deletePopUp");}}},setupNewCollectionObservers:function(){this.newCollLink=dojo.byId(this._cfg.mjAddCollLink);dojo.connect(this.newCollLink,"onclick",this,function(ev){dojo.stopEvent(ev);this.setupNewCollectionPopUp();});this.saveNewColl=dojo.byId(this._cfg.mjsaveNewCollSubmit);dojo.connect(this.saveNewColl,"onclick",this,function(ev){dojo.stopEvent(ev);this.userSaveToNewCollSave(ev);});this.cancelNewColl=dojo.byId(this._cfg.mjsaveNewCollCancel);dojo.connect(this.cancelNewColl,"onclick",this,function(ev){dojo.stopEvent(ev);this.userSaveToNewCollCancel(ev);});},setupNewCollectionPopUp:function(){this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");this.oFolderName=dojo.byId(this._cfg.mjNewCollField);this.oFolderName.value="";dojo.connect(this.oFolderName,"focus",this,function(ev){dojo.stopEvent(ev);dj.util.Form.clearValue(this.oFolderName,'');});dojo.connect(this.oFolderName,"onclick",this,function(ev){dojo.stopEvent(ev);dj.util.Form.clearValue(this.oFolderName,'');});dojo.connect(this.oFolderName,"onkeypress",this,function(ev){var cKeyCode=ev.keyCode||ev.which;if(dojo.isIE<7){if(cKeyCode==Event.KEY_RETURN){this.userSaveToNewCollSave(ev);}}});this.toggleSaveToPanel("ddPanelState-NewCollection");},userSaveToExistingCollSave:function(event,folderId){if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(!folderId||folderId==""){var folderId=(srcElement.id).substring(srcElement.id.indexOf('#')+1,srcElement.id.length);}
var artUrl=(typeof this.currentUrl=='undefined')?"":this.currentUrl;var artTitle="";var artDesc="";var artContentID="";var artContentType="Article";var artSource="WSJ";var artSourceCode="WSJO";var artDate="";if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetArticle&&!this.dockbarInstance&&!this.searchPremiumInstance){if(typeof AT_VARS!='undefined'){artTitle=AT_VARS.articleHeadline;artDesc=unescape(AT_VARS.bodyText);artContentID=AT_VARS.baseDocId;if(typeof AT_VARS.publicationDate!=='undefined'){artDate=AT_VARS.publicationDate;}
if(typeof AT_VARS.publicationName!=='undefined'){artSource=AT_VARS.publicationName;}
if(typeof AT_VARS.articleSourceCode!=='undefined'){artSourceCode=AT_VARS.articleSourceCode;}
artUrl=window.location.href;}}else{if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch){if(dojo.byId(this._cfg.mjSearchContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchContBlock);}else{var possibleContainers="";}}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJLanding){if(dojo.byId(this._cfg.mjLandingContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else{var possibleContainers="";}}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJDetails){if(dojo.byId(this._cfg.mjDetailsContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDetailsContBlock);}else{var possibleContainers="";}}else{var possibleContainers="";}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(this.actualTargetObj,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer===""){if(this.dockbarInstance){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDockBarBlock);}else if(this.searchPremiumInstance){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchPremiumContBlock);}else{var possibleContainers=dojo.query(this._cfg.mjItemBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(this.actualTargetObj,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}}
if(currentSavedItemContainer!==""){var savedItemSourceObj=dojo.query(this._cfg.mjItemSource,currentSavedItemContainer)[0];var savedItemSourceCodeObj=dojo.query(this._cfg.mjItemSourceCode,currentSavedItemContainer)[0];var savedItemLinkObj=dojo.query(this._cfg.mjItemLink,currentSavedItemContainer)[0];var savedItemDescObj=dojo.query(this._cfg.mjItemDesc,currentSavedItemContainer)[0];var savedItemDateObj=dojo.query(this._cfg.mjItemDate,currentSavedItemContainer)[0];artUrl=(savedItemLinkObj.href)?savedItemLinkObj.href.toString():savedItemLinkObj.innerHTML;artTitle=savedItemLinkObj.innerHTML;artDesc=(typeof savedItemDescObj!=='undefined')?savedItemDescObj.innerHTML:artTitle;artDate=(typeof savedItemDateObj!=='undefined')?savedItemDateObj.innerHTML:artDate;artSource=(typeof savedItemSourceObj!=='undefined')?savedItemSourceObj.innerHTML:artSource;artSourceCode=(typeof savedItemSourceCodeObj!=='undefined')?savedItemSourceCodeObj.innerHTML:artSourceCode;var htmlInd=artUrl.indexOf('.html');var SBInd=artUrl.indexOf('SB');artContentID=(SBInd!==-1&&htmlInd!==-1)?artUrl.substring(SBInd,htmlInd):"NA";}}
if(artUrl==""){artUrl=window.location.href;}
if(artUrl.indexOf('articleTabs')!==-1){if(artUrl.indexOf('video')!==-1){artContentType="Video";}else if(artUrl.indexOf('slideshow')!==-1){artContentType="Slideshow";}else if(artUrl.indexOf('interactive')!==-1){artContentType="Interactive Graphic";}}else{if(artUrl.indexOf('/video/')!==-1){artContentType="Video";}}
if(artSourceCode.indexOf('sc:')!==-1){artSourceCode=artSourceCode.replace("sc:","");}
artSourceCode=artSourceCode.replace(/^\s+|\s+$/g,'');artSourceCode=artSourceCode.replace(" ","");var articleObj={"FolderID":folderId,"Title":artTitle,"Desc":artDesc,"URL":artUrl,"ContentID":artContentID,"ContentType":artContentType,"ArticleSource":artSource,"ArticleSourceCode":artSourceCode,"ArticleDate":dojo.trim(artDate)};this.userSaveToExistingCollSaveAPI(folderId,articleObj,this.showSaveToCollConfirmation,this);},userSaveToExistingCollSaveAPI:function(folderId,articleObj,callback,context){this._serviceWidget.addArticleToFolder(folderId,articleObj,callback,context);},showSaveToCollConfirmation:function(key,data,criteria){try{if(!data){this.displayResetErrorMsg("display",this._cfg.mjSaveError,errorMsg);return;}
var errorMsg="NO ERROR";if((typeof this.foldertitle!=='undefined')&&this.foldertitle!==null){var folderName=this.foldertitle;this.foldertitle=null;errorMsg="Article save to "+folderName+" failed";}else{if(this.quickSaveModeBlk){var folderName="Quick Save";}else{var folderName=dojo.byId(this._cfg.mjSaveToPrefix+key).firstChild.data;}
errorMsg="Collection created! Article save to "+folderName+" failed";}
this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");this.toggleSaveToPanel("ddPanelState-SaveConfirmation");this.toggleSaveToBar('ddState-saved');this.selfReloadDone="false";var folderUrl=this._pagePathValue+"/mj-usercollection.html?folderid="+key;dojo.byId("mjsave_articlesavedtext").innerHTML='<p>Article saved to<br /> <a href="'+folderUrl+'">'
+folderName+'</a> Collection.</p>';if(this.collectionMode!==this._cfg.mjNewFolderCreatedMode){this.collectionMode=this._cfg.mjSaveCollectionMode;}
this.alreadyClosed=false;var currentFolderName=(dojo.byId('mj-userFolderName')!==null)?dojo.byId('mj-userFolderName').innerHTML.replace('<h3>','').replace('</h3>','').replace('<H3>','').replace('</H3>',''):"";if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails&&(folderName===currentFolderName||currentFolderName==='Most Recent')){var that=this;setTimeout(function(){that.defaultSuperImposeAndClose('checkClosed');if(that._cfg.mjSaveToWidgetInstance===that._cfg.mjSaveToWidgetMJDetails){that._serviceWidget.reloadUserFolders();}
if(currentFolderName==='Most Recent'){dj.module.dashboard.DashboardUserCollection.deleteHeadLineStatus();}else{dj.module.dashboard.DashboardUserCollection.deleteHeadLineStatus(key);}
that.selfReloadDone="true";},5000);}else{var that=this;setTimeout(function(){that.defaultSuperImposeAndClose('checkClosed');},5000);}}catch(e){console.error("showSaveToCollConfirmation error "+e);}},restoreDefaultState:function(prevTargetObj){if(prevTargetObj){this.toggleSaveToDropdown(prevTargetObj,"ddState-collapsed","ddState-expanded");}else if(this.actualTargetObj){if(this.selfReloadDone==="false"){this.toggleSaveToDropdown(this.actualTargetObj,"ddState-collapsed","ddState-expanded");}}},userSaveToNewCollSave:function(ev){var folderNameInput=dojo.byId(this._cfg.mjNewCollField).value;if(this._serviceWidget.validateCollectionName("new",folderNameInput,this._cfg.mjSaveError,this._response,this.userFoldersCount)){this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");folderNameInput=folderNameInput.replace(/^\s+|\s+$/g,'');this.userSaveToNewCollSaveAPI(folderNameInput,this.showSaveNewCollConfirmation,this);}else{this.displayResetErrorMsg("display",this._cfg.mjSaveError,"");}},displayResetErrorMsg:function(dispReset,whatElm,whatMsg){if(dispReset==="display"){if(whatMsg!==""){dojo.byId(whatElm).innerHTML=whatMsg;}
this.toggleSaveToPanel("errorDisplay-On");}else{dojo.byId(whatElm).innerHTML="";this.toggleSaveToPanel("errorDisplay-Off");}},userSaveToNewCollSaveAPI:function(folderName,callback,context){this._serviceWidget.createUserFolder(folderName,"Layout","Layout",callback,context);},showSaveNewCollConfirmation:function(key,data,criteria){try{if(!data){return;}
if(typeof data.Message!=='undefined'){this.displayResetErrorMsg("display",this._cfg.mjSaveError,data.Message);return;}
var folderId="";if(typeof data[0].FolderID!=='undefined'){folderId=data[0].FolderID;}else{while(this.folders[i]){var item=this.folders[i];if(item.FolderTitle===key){folderId=item.FolderID;break;}
i++;}
var maxFolderId=(this.folders[0])?this.folders[0].FolderID:"";var i=0;while(this.folders[i]){var currFolderId=this.folders[i].FolderID;if(currFolderId>maxFolderId){maxFolderId=currFolderId;}
i++;}
if(folderId===""){folderId=maxFolderId+1;}}
this.foldertitle=key;if(folderId!==""){this.collectionMode=this._cfg.mjNewFolderCreatedMode;this.userSaveToExistingCollSave("",folderId);}else{this.displayResetErrorMsg("display",this._cfg.mjSaveError,"Collection addition failed");return;}}catch(e){console.error("showSaveNewCollConfirmation error "+e);}},userSaveToNewCollCancel:function(ev){this.defaultSuperImposeAndClose();},setupSaveToCollectionList:function(){if(typeof this.folders==='undefined'){this._serviceWidget.subscribeUserFolders(this.renderSaveToCollectionList,this);}else{this._serviceWidget.reloadUserFolders();}},setupLoginOrRegister:function(mode){if(!mode){this.toggleSaveToPanel("ddPanelState-Login");this.collectionMode=this._cfg.mjLoginCollectionMode;dojo.byId('logInButton').href=dojo.byId('logInButton').href+'&url='+document.location.href
+'&mjsaveMode=quicksave';dojo.byId('regInButton').href=dojo.byId('regInButton').href+'&url='+document.location.href
+'&mjsaveMode=quicksave';}else{if(this._cfg.mjSaveToWidgetInstance==="IntroMJ"){dojo.byId('logInButton').href=dojo.byId('logInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-journal-main.html';dojo.byId('regInButton').href=dojo.byId('regInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-journal-main.html';}else{dojo.byId('logInButton').href=dojo.byId('logInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-saved-main.html';dojo.byId('regInButton').href=dojo.byId('regInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-saved-main.html';}}},setupCollectionObservers:function(){var i=0;if(typeof this.folders!=='undefined'){while(this.folders[i]){var item=this.folders[i];var folderid=item.FolderID;var folderObj=dojo.byId(this._cfg.mjSaveToPrefix+folderid);if(folderObj!==null){dojo.connect(folderObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.userSaveToExistingCollSave(ev,"");});}
i++;}}},renderSaveToCollectionList:function(response){if(!response){return;}
this._response=response;this.folders=response;var folderdata="";this.quickSaveFolderId="";this.errorCondition=false;var i=0;this.userFoldersCount=0;var displayTitle="";dojo.byId(this._cfg.mjSaveDropdownCollList).innerHTML='<img height="27" width="26" border="0" alt="" src="/img/loadingAni_grey.gif" style="margin-left:60px;"/>';if(typeof response!=='undefined'){if(response.toString().length===3){this.errorCondition=true;}}
while(this.folders[i]){var item=this.folders[i];var folderid=item.FolderID;var foldertitle=item.FolderTitle;var foldertype=item.FolderType;if(typeof folderid==='undefined'){this.errorCondition=true;break;}
displayTitle=(foldertitle.length>15)?foldertitle.substring(0,14)+'...':foldertitle;if(this._cfg.mjUserCollectionType===foldertype||this._cfg.mjSystemCollectionType===foldertype){folderdata+="<li><a href='#' id='saveToFolder#"+folderid+"' >"+displayTitle+"</a></li>";++this.userFoldersCount;if(this._cfg.mjSystemCollectionType===foldertype){this.quickSaveFolderId=folderid;}}
i++;}
if(this.quickSaveModeBlk){this.superImposeBlock(this.currQuickSaveObj,"true");}
if(folderdata!==""){dojo.byId(this._cfg.mjSaveDropdownCollList).innerHTML=folderdata;this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");if(!this.quickSaveModeBlk&&this.collectionMode!==this._cfg.mjNewFolderCreatedMode&&this.collectionMode!==this._cfg.mjSaveCollectionMode){this.toggleSaveToPanel("ddPanelState-MyCollections");}
this.collectionMode=this._cfg.mjListCollectionMode;this.setupCollectionObservers();}else{this.collectionMode="";dojo.byId(this._cfg.mjSaveDropdownCollList).innerHTML="";if(this.errorCondition){if(this.collectionMode!==this._cfg.mjNewFolderCreatedMode&&this.collectionMode!==this._cfg.mjSaveCollectionMode){this.toggleSaveToPanel("ddPanelState-MyCollections");}
this.collectionMode=this._cfg.mjListCollectionMode;this.initialLoad=true;this.displayResetErrorMsg("display",this._cfg.mjSaveError,"System error occured. Please try later.");}}},getElementLeft:function(Elem){var elem=Elem;xPos=elem.offsetLeft;tempEl=elem.offsetParent;while(tempEl!=null){xPos+=tempEl.offsetLeft;tempEl=tempEl.offsetParent;}
return xPos;},getElementTop:function(Elem){var elem=Elem;yPos=elem.offsetTop;tempEl=elem.offsetParent;while(tempEl!=null){yPos+=tempEl.offsetTop;tempEl=tempEl.offsetParent;}
return yPos;},hasValidChars:function(str){str=str.replace(/^\s+|\s+$/g,'');if(!str||str===null||str===""){return false;}
var invalidChars="?!#$%&*()\"||<>=+;:][{}/\\";for(var count=0,len=invalidChars.length;count<len;count++){var badChar=invalidChars.charAt(count);if(str.indexOf(badChar,0)>-1){return false;}}
return true;}};}());
dojo.provide("dj.module.marketdata.excanvas");if(!document.createElement('canvas').getContext){(function(exports){var m=Math;var mr=m.round;var ms=m.sin;var mc=m.cos;var abs=m.abs;var sqrt=m.sqrt;var Z=10;var Z2=Z/2;function getContext(){return this.context_||(this.context_=new CanvasRenderingContext2D_(this));}
var slice=Array.prototype.slice;function bind(f,obj,var_args){var a=slice.call(arguments,2);return function(){return f.apply(obj,a.concat(slice.call(arguments)));};}
var G_vmlCanvasManager_={init:function(opt_doc){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var doc=opt_doc||document;doc.createElement('canvas');doc.attachEvent('onreadystatechange',bind(this.init_,this,doc));}},init_:function(doc){if(!doc.namespaces['g_vml_']){doc.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!doc.namespaces['g_o_']){doc.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}
if(!doc.styleSheets['ex_canvas_']){var ss=doc.createStyleSheet();ss.owningElement.id='ex_canvas_';ss.cssText='canvas{display:inline-block;overflow:hidden;'+'text-align:left;width:300px;height:150px}'+'g_vml_\\:*{behavior:url(#default#VML)}'+'g_o_\\:*{behavior:url(#default#VML)}';}
var els=doc.getElementsByTagName('canvas');for(var i=0;i<els.length;i++){this.initElement(els[i]);}},initElement:function(el,width,height){if(!el.getContext){this.width=width;this.height=height;el.getContext=getContext;el.attachEvent('onpropertychange',onPropertyChange);el.attachEvent('onresize',onResize);var attrs=el.attributes;if(attrs.width&&attrs.width.specified){el.style.width=attrs.width.nodeValue+'px';}else{el.width=el.clientWidth;}
if(attrs.height&&attrs.height.specified){el.style.height=attrs.height.nodeValue+'px';}else{el.height=el.clientHeight;}}
return el;}};function onPropertyChange(e){var el=e.srcElement;switch(e.propertyName){case'width':el.style.width=el.attributes.width.nodeValue+'px';el.getContext().clearRect();break;case'height':el.style.height=el.attributes.height.nodeValue+'px';el.getContext().clearRect();break;}}
function onResize(e){var el=e.srcElement;if(el.firstChild){el.firstChild.style.width=el.clientWidth+'px';el.firstChild.style.height=el.clientHeight+'px';}}
var dec2hex=[];for(var i=0;i<16;i++){for(var j=0;j<16;j++){dec2hex[i*16+j]=i.toString(16)+j.toString(16);}}
function createMatrixIdentity(){return[[1,0,0],[0,1,0],[0,0,1]];}
function matrixMultiply(m1,m2){var result=createMatrixIdentity();for(var x=0;x<3;x++){for(var y=0;y<3;y++){var sum=0;for(var z=0;z<3;z++){sum+=m1[x][z]*m2[z][y];}
result[x][y]=sum;}}
return result;}
function copyState(o1,o2){o2.fillStyle=o1.fillStyle;o2.lineCap=o1.lineCap;o2.lineJoin=o1.lineJoin;o2.lineWidth=o1.lineWidth;o2.miterLimit=o1.miterLimit;o2.shadowBlur=o1.shadowBlur;o2.shadowColor=o1.shadowColor;o2.shadowOffsetX=o1.shadowOffsetX;o2.shadowOffsetY=o1.shadowOffsetY;o2.strokeStyle=o1.strokeStyle;o2.globalAlpha=o1.globalAlpha;o2.arcScaleX_=o1.arcScaleX_;o2.arcScaleY_=o1.arcScaleY_;o2.lineScale_=o1.lineScale_;}
function processStyle(styleString){var str,alpha=1;styleString=String(styleString);if(styleString.substring(0,3)=='rgb'){var start=styleString.indexOf('(',3);var end=styleString.indexOf(')',start+1);var guts=styleString.substring(start+1,end).split(',');str='#';for(var i=0;i<3;i++){str+=dec2hex[Number(guts[i])];}
if(guts.length==4&&styleString.substr(3,1)=='a'){alpha=guts[3];}}else{str=styleString;}
return{color:str,alpha:alpha};}
function processLineCap(lineCap){switch(lineCap){case'butt':return'flat';case'round':return'round';case'square':default:return'square';}}
function CanvasRenderingContext2D_(surfaceElement){this.m_=createMatrixIdentity();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle='#000';this.fillStyle='#000';this.lineWidth=1;this.lineJoin='miter';this.lineCap='butt';this.miterLimit=Z*1;this.globalAlpha=1;this.canvas=surfaceElement;var el=surfaceElement.ownerDocument.createElement('div');el.style.width=G_vmlCanvasManager_.width;el.style.height=G_vmlCanvasManager_.height;el.style.overflow='hidden';el.style.position='absolute';surfaceElement.appendChild(el);this.element_=el;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1;}
var contextPrototype=CanvasRenderingContext2D_.prototype;contextPrototype.clearRect=function(){this.element_.innerHTML='';this.currentPath_=[];};contextPrototype.beginPath=function(){this.currentPath_=[];};contextPrototype.moveTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'moveTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.lineTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'lineTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var p=this.getCoords_(aX,aY);var cp1=this.getCoords_(aCP1x,aCP1y);var cp2=this.getCoords_(aCP2x,aCP2y);bezierCurveTo(this,cp1,cp2,p);};function bezierCurveTo(self,cp1,cp2,p){self.currentPath_.push({type:'bezierCurveTo',cp1x:cp1.x,cp1y:cp1.y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y});self.currentX_=p.x;self.currentY_=p.y;}
contextPrototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var cp=this.getCoords_(aCPx,aCPy);var p=this.getCoords_(aX,aY);var cp1={x:this.currentX_+2.0/3.0*(cp.x-this.currentX_),y:this.currentY_+2.0/3.0*(cp.y-this.currentY_)};var cp2={x:cp1.x+(p.x-this.currentX_)/3.0,y:cp1.y+(p.y-this.currentY_)/3.0};bezierCurveTo(this,cp1,cp2,p);};contextPrototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){aRadius*=Z;var arcType=aClockwise?'at':'wa';var xStart=aX+mc(aStartAngle)*aRadius-Z2;var yStart=aY+ms(aStartAngle)*aRadius-Z2;var xEnd=aX+mc(aEndAngle)*aRadius-Z2;var yEnd=aY+ms(aEndAngle)*aRadius-Z2;if(xStart==xEnd&&!aClockwise){xStart+=0.125;}
var p=this.getCoords_(aX,aY);var pStart=this.getCoords_(xStart,yStart);var pEnd=this.getCoords_(xEnd,yEnd);this.currentPath_.push({type:arcType,x:p.x,y:p.y,radius:aRadius,xStart:pStart.x,yStart:pStart.y,xEnd:pEnd.x,yEnd:pEnd.y});};contextPrototype.rect=function(aX,aY,aWidth,aHeight){this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();};contextPrototype.strokeRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.stroke();this.currentPath_=[];};contextPrototype.fillRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.fill();this.currentPath_=[];};contextPrototype.createLinearGradient=function(aX0,aY0,aX1,aY1){var gradient=new CanvasGradient_('gradient');gradient.x0_=aX0;gradient.y0_=aY0;gradient.x1_=aX1;gradient.y1_=aY1;return gradient;};contextPrototype.createRadialGradient=function(aX0,aY0,aR0,aX1,aY1,aR1){var gradient=new CanvasGradient_('gradientradial');gradient.x0_=aX0;gradient.y0_=aY0;gradient.r0_=aR0;gradient.x1_=aX1;gradient.y1_=aY1;gradient.r1_=aR1;return gradient;};contextPrototype.drawImage=function(image,var_args){var dx,dy,dw,dh,sx,sy,sw,sh;var oldRuntimeWidth=image.runtimeStyle.width;var oldRuntimeHeight=image.runtimeStyle.height;image.runtimeStyle.width='auto';image.runtimeStyle.height='auto';var w=image.width;var h=image.height;image.runtimeStyle.width=oldRuntimeWidth;image.runtimeStyle.height=oldRuntimeHeight;if(arguments.length==3){dx=arguments[1];dy=arguments[2];sx=sy=0;sw=dw=w;sh=dh=h;}else if(arguments.length==5){dx=arguments[1];dy=arguments[2];dw=arguments[3];dh=arguments[4];sx=sy=0;sw=w;sh=h;}else if(arguments.length==9){sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8];}else{throw Error('Invalid number of arguments');}
var d=this.getCoords_(dx,dy);var w2=sw/2;var h2=sh/2;var vmlStr=[];var W=10;var H=10;vmlStr.push(' <g_vml_:group',' coordsize="',Z*W,',',Z*H,'"',' coordorigin="0,0"',' style="width:',W,'px;height:',H,'px;position:absolute;');if(this.m_[0][0]!=1||this.m_[0][1]){var filter=[];filter.push('M11=',this.m_[0][0],',','M12=',this.m_[1][0],',','M21=',this.m_[0][1],',','M22=',this.m_[1][1],',','Dx=',mr(d.x/Z),',','Dy=',mr(d.y/Z),'');var max=d;var c2=this.getCoords_(dx+dw,dy);var c3=this.getCoords_(dx,dy+dh);var c4=this.getCoords_(dx+dw,dy+dh);max.x=m.max(max.x,c2.x,c3.x,c4.x);max.y=m.max(max.y,c2.y,c3.y,c4.y);vmlStr.push('padding:0 ',mr(max.x/Z),'px ',mr(max.y/Z),'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',filter.join(''),", sizingmethod='clip');")}else{vmlStr.push('top:',mr(d.y/Z),'px;left:',mr(d.x/Z),'px;');}
vmlStr.push(' ">','<g_vml_:image src="',image.src,'"',' style="width:',Z*dw,'px;',' height:',Z*dh,'px;"',' cropleft="',sx/w,'"',' croptop="',sy/h,'"',' cropright="',(w-sx-sw)/w,'"',' cropbottom="',(h-sy-sh)/h,'"',' />','</g_vml_:group>');this.element_.insertAdjacentHTML('BeforeEnd',vmlStr.join(''));};contextPrototype.stroke=function(aFill){var lineStr=[];var lineOpen=false;var a=processStyle(aFill?this.fillStyle:this.strokeStyle);var color=a.color;var opacity=a.alpha*this.globalAlpha;var W=10;var H=10;lineStr.push('<g_vml_:shape',' filled="',!!aFill,'"',' style="position:absolute;width:',W,'px;height:',H,'px;"',' coordorigin="0 0" coordsize="',Z*W,' ',Z*H,'"',' stroked="',!aFill,'"',' path="');var newSeq=false;var min={x:null,y:null};var max={x:null,y:null};for(var i=0;i<this.currentPath_.length;i++){var p=this.currentPath_[i];var c;switch(p.type){case'moveTo':c=p;lineStr.push(' m ',mr(p.x),',',mr(p.y));break;case'lineTo':lineStr.push(' l ',mr(p.x),',',mr(p.y));break;case'close':lineStr.push(' x ');p=null;break;case'bezierCurveTo':lineStr.push(' c ',mr(p.cp1x),',',mr(p.cp1y),',',mr(p.cp2x),',',mr(p.cp2y),',',mr(p.x),',',mr(p.y));break;case'at':case'wa':lineStr.push(' ',p.type,' ',mr(p.x-this.arcScaleX_*p.radius),',',mr(p.y-this.arcScaleY_*p.radius),' ',mr(p.x+this.arcScaleX_*p.radius),',',mr(p.y+this.arcScaleY_*p.radius),' ',mr(p.xStart),',',mr(p.yStart),' ',mr(p.xEnd),',',mr(p.yEnd));break;}
if(p){if(min.x==null||p.x<min.x){min.x=p.x;}
if(max.x==null||p.x>max.x){max.x=p.x;}
if(min.y==null||p.y<min.y){min.y=p.y;}
if(max.y==null||p.y>max.y){max.y=p.y;}}}
lineStr.push(' ">');if(!aFill){var lineWidth=this.lineScale_*this.lineWidth;if(lineWidth<1){opacity*=lineWidth;}
lineStr.push('<g_vml_:stroke',' opacity="',opacity,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',processLineCap(this.lineCap),'"',' weight="',lineWidth,'px"',' color="',color,'" />');}else if(typeof this.fillStyle=='object'){var fillStyle=this.fillStyle;var angle=0;var focus={x:0,y:0};var shift=0;var expansion=1;if(fillStyle.type_=='gradient'){var x0=fillStyle.x0_/this.arcScaleX_;var y0=fillStyle.y0_/this.arcScaleY_;var x1=fillStyle.x1_/this.arcScaleX_;var y1=fillStyle.y1_/this.arcScaleY_;var p0=this.getCoords_(x0,y0);var p1=this.getCoords_(x1,y1);var dx=p1.x-p0.x;var dy=p1.y-p0.y;angle=Math.atan2(dx,dy)*180/Math.PI;if(angle<0){angle+=360;}
if(angle<1e-6){angle=0;}}else{var p0=this.getCoords_(fillStyle.x0_,fillStyle.y0_);var width=max.x-min.x;var height=max.y-min.y;focus={x:(p0.x-min.x)/width,y:(p0.y-min.y)/height};width/=this.arcScaleX_*Z;height/=this.arcScaleY_*Z;var dimension=m.max(width,height);shift=2*fillStyle.r0_/dimension;expansion=2*fillStyle.r1_/dimension-shift;}
var stops=fillStyle.colors_;stops.sort(function(cs1,cs2){return cs1.offset-cs2.offset;});var length=stops.length;var color1=stops[0].color;var color2=stops[length-1].color;var opacity1=stops[0].alpha*this.globalAlpha;var opacity2=stops[length-1].alpha*this.globalAlpha;var colors=[];for(var i=0;i<length;i++){var stop=stops[i];colors.push(stop.offset*expansion+shift+' '+stop.color);}
lineStr.push('<g_vml_:fill type="',fillStyle.type_,'"',' method="none" focus="100%"',' color="',color1,'"',' color2="',color2,'"',' colors="',colors.join(','),'"',' opacity="',opacity2,'"',' g_o_:opacity2="',opacity1,'"',' angle="',angle,'"',' focusposition="',focus.x,',',focus.y,'" />');}else{lineStr.push('<g_vml_:fill color="',color,'" opacity="',opacity,'" />');}
lineStr.push('</g_vml_:shape>');this.element_.insertAdjacentHTML('beforeEnd',lineStr.join(''));};contextPrototype.fill=function(){this.stroke(true);}
contextPrototype.closePath=function(){this.currentPath_.push({type:'close'});};contextPrototype.getCoords_=function(aX,aY){var m=this.m_;return{x:Z*(aX*m[0][0]+aY*m[1][0]+m[2][0])-Z2,y:Z*(aX*m[0][1]+aY*m[1][1]+m[2][1])-Z2}};contextPrototype.save=function(){var o={};copyState(this,o);this.aStack_.push(o);this.mStack_.push(this.m_);this.m_=matrixMultiply(createMatrixIdentity(),this.m_);};contextPrototype.restore=function(){copyState(this.aStack_.pop(),this);this.m_=this.mStack_.pop();};contextPrototype.translate=function(aX,aY){var m1=[[1,0,0],[0,1,0],[aX,aY,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.rotate=function(aRot){var c=mc(aRot);var s=ms(aRot);var m1=[[c,s,0],[-s,c,0],[0,0,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.scale=function(aX,aY){this.arcScaleX_*=aX;this.arcScaleY_*=aY;var m1=[[aX,0,0],[0,aY,0],[0,0,1]];var m=this.m_=matrixMultiply(m1,this.m_);var det=m[0][0]*m[1][1]-m[0][1]*m[1][0];this.lineScale_=sqrt(abs(det));};contextPrototype.clip=function(){};contextPrototype.arcTo=function(){};contextPrototype.createPattern=function(){return new CanvasPattern_;};function CanvasGradient_(aType){this.type_=aType;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[];}
CanvasGradient_.prototype.addColorStop=function(aOffset,aColor){aColor=processStyle(aColor);this.colors_.push({offset:aOffset,color:aColor.color,alpha:aColor.alpha});};function CanvasPattern_(){}
exports.G_vmlCanvasManager=G_vmlCanvasManager_;exports.CanvasRenderingContext2D=CanvasRenderingContext2D_;exports.CanvasGradient=CanvasGradient_;exports.CanvasPattern=CanvasPattern_;})(window);}
dojo.provide("dj.module.marketdata.marketwatch");(function(exports){var BlueGrass={};if(typeof(MarketWatch)=="undefined"){var MarketWatch=new(function(){this.Sample={area:"sample"};this.Section={area:"section"};this.Investing={area:"investing"};this.Story={area:"story"};this.News={area:"news"};this.Community={area:"community"};this.Community.InstrumentPicker={area:"community"};this.Community.TopPickers={area:"community"};this.Community.PickerAccordian={area:"community"};this.Community.CommenterGrid={area:"community"};this.Community.FilteredCommentTabs={area:"community"};this.Search={area:"search"};this.MarketState={component:"marketstate"};this.Member={component:"member"};this.DockingBar={component:"dockingbar"};this.DockingBar.Community={component:"dockingbar"};this.DockingBar.Community.Groups={component:"dockingbar"};this.DockingBar.Portfolio={component:"dockingbar"};this.DayParting={component:"dayparting"};this.MarketsNews={component:"marketsnews"};this.Panels={component:"panels"};this.Kiosk={component:"kiosk"};this.BreakingNews={component:"breakingnews"};this.MultiQuote={component:"multiquote"};this.Investing.AdvancedCharts={area:"investing"};this.Investing.AdvancedCharts.Cookie={area:"investing"};this.UI={component:"ui"};this.FishHawk={component:"fishhawk"};this.Video={component:"video"};this.Investing.MutualFunds={area:"investing"};var _baseUrl="";this.setBaseUrl=function(url){_baseUrl=url;};this.getBaseUrl=function(){return _baseUrl;};})();}
if(typeof(string)=="undefined"){var string=(new function(){return{IsNullOrEmpty:function(theString){return(typeof(theString)=="undefined"||!theString||theString.length==0);}}}());}
else{string.IsNullOrEmpty=function(theString){return(typeof(theString)=="undefined"||!theString||theString.length==0);}}
String.prototype.IndexOf=function(val){return this.indexOf(val);}
String.prototype.Substring=function(start){return this.substring(start);}
var Html=new(function(){var thunk=this;var _headlineModelLink=function(text,object,options){var area=options.area||options.Area||"story";var controller=options.controller||options.Controller||"story";var action=null;var guid=object.DocGuid;var attr=null;var queryString="guid="+object.DocGuid.Value;text=object.HeadlineText;if(options&&typeof(options.MaxLength)=="number")
text=text.substring(0,options.MaxLength);if(typeof(object.ContentType)=="number")
object.ContentType=_getContentType(object.ContentType);if(object.ContentType=="headline"){if(typeof(options.LinkDocType90)=="undefined"||options.LinkDocType90==null||options.LinkDocType90==true){if(object.Instruments&&object.Instruments.length>0&&object.Instruments[0].Ticker){if(typeof(options.LinkTickerAsHeadline)!="undefined"&&options.LinkTickerAsHeadline){return _instrumentModelLink(text,object.Instruments[0],{});}
return"["+_instrumentModelLink(object.Instruments[0].Ticker,object.Instruments[0],{})+"] "+text;}}
return text;}
else if(object.ContentType=="nofollow"){attr='rel="nofollow"';}
if(object.SeoHeadlineFragment&&object.SeoHeadlineFragment.length>0){controller=null;action=object.SeoHeadlineFragment.substr(1);queryString=null;}
return thunk.ActionLink(text,area,controller,action,queryString,attr);};var _instrumentModelLink=function(text,object,options){var area=options.area||options.Area||"investing";var controller=options.controller||options.Controller||"stock";if(!object.Ticker)
return;if(object.Type)
controller=_getInstrumentType(object.Type);if(!text||text.length==0)
text=object.Ticker
var area="investing";var action=object.Ticker+"/overview";var queryString="";if(object.CountryCode&&object.CountryCode.toLowerCase()!="us")
queryString="countrycode="+object.CountryCode;return thunk.ActionLink(text,area,controller,action,queryString,null);};var _getContentType=function(type){switch(type){case 1:return"story";case 2:return"audio";case 3:return"video";case 4:return"nofollow";case 5:return"headline";}
return"story";};var _getInstrumentType=function(instrumentType){if(typeof(instrumentType)=="number"){switch(instrumentType){case 0:return"bond";case 2:return"currency";case 1:case 3:case 4:case 7:return"fund";case 5:return"future";case 6:return"index";case 8:case 9:case 10:return"option";}}
else if(instrumentType=="bond"||instrumentType=="currency"||instrumentType=="fund"||instrumentType=="future"||instrumentType=="index"||instrumentType=="option")
return instrumentType;return"stock";}
this.ModelLink=function(textOrObject,objectOrOptions,options){var text=textOrObject;var object=objectOrOptions;if(typeof(textOrObject)!="string"){text="";object=textOrObject;options=objectOrOptions;}
if(!options)options={};if(object.HeadlineText){return _headlineModelLink(text,object,options);}
else if(object.Ticker){return _instrumentModelLink(text,object,options);}};this.ActionLink=function(text,area,controller,action,queryString,attr){var link='<a '+(attr?attr:'')+' href="'+MarketWatch.getBaseUrl()+'/'+area+(controller?'/'+controller:'')+(action?'/'+action:'')+(queryString?'?'+queryString:'')+'">'+text+'</a>';return link;};this.GetShortDateStampMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var diff=now.getTime()-date.getTime();if(diff>86400000||now.getUTCDate()!=date.getUTCDate())
return"<span>"+date.dateFormat("m/d")+"</span>";var formatted=date.dateFormat("g:ia");return"<span>"+formatted.substring(0,formatted.length-1)+"</span>";}
return"<span>&nbsp;</span>";};this.GetTimeAgoMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var nowUtc=new Date().getTime();var easternNow=BlueGrass.Utility.convertToExchangeTime(nowUtc+"",offset);var diff=easternNow.getTime()-date.getTime();var formatted=date.dateFormat("g:ia Today");if(diff>86400000||now.getUTCDate()!=date.getUTCDate())
return"<span>"+date.dateFormat("g:ia n/d/y")+"</span>";else if(diff<=3600000){var ceiling=Math.ceil(diff/60000);if(ceiling==0)
formatted="< 1 min ago"
else
formatted=ceiling+" min ago";}
return"<span class='timeAgo'><span>"+formatted+"</span>"+"<span class='invisible'>"+date.dateFormat("g:ia n/d/y")+"</span></span>";}
return"<span>&nbsp;</span>";};this.GetShortTimeAgoMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var nowUtc=new Date().getTime();var easternNow=BlueGrass.Utility.convertToExchangeTime(nowUtc+"",offset);var diff=easternNow.getTime()-date.getTime();var formatted=date.dateFormat("g:ia");if(easternNow.getDay()!=date.getDay())
return"<span>"+date.dateFormat("n/d/y")+"</span>";else if(diff<=3600000){var ceiling=Math.ceil(diff/60000);if(ceiling==0)
formatted="< 1 min ago"
else
formatted=ceiling+" min ago";}
return"<span class='timeAgo short'><span>"+formatted+"</span>"+"<span class='invisible'>"+date.dateFormat("g:ia n/d/y")+"</span></span>";}
return"<span>&nbsp;</span>";};})();exports.Html=Html;exports.MarketWatch=MarketWatch;exports.BlueGrass=BlueGrass;}(window));dojo.provide("dj.module.marketdata.thunderball");(function(exports){exports.Thunderball={ChartScalingV2:{CalculateDelta2:function(preferredDivisionCount,preferMoreDivisions,allowNoGap,dMin,dMax,dStart,dFinish){if(!dMin){dMin=0;}
if(!dMax){dMax=1;}
if(preferredDivisionCount<=1||preferredDivisionCount==null||preferredDivisionCount==undefined){dStart.value=dMin;dFinish.value=dMax;return dMax-dMin;}
if(dMax<dMin){var Tmp=dMin;dMin=dMax;dMax=Tmp;}
var dMax=Math.abs(dMax);if(dMax==0)dMax=1;var Tol=5.0e-6;if((dMax-dMin)/dMax<=Tol){if(dMax<0)
dMax=0;else if(dMax==0)
dMax=1;else
dMin=0;}
var dGears=[10,5,2.5,2,1];var dBestDifference=-1;var dBestLineCount=-1;var dBestMax=0;var dBestMin=0;var dBestDelta=0;var dRange=dMax-dMin;var dRangeDivision=dRange/preferredDivisionCount;Math.log10=function(n){return this.log(n)/this.log(10);}
var dDivisionMagnitude=Math.log10(dRangeDivision);var nDivisionMultiplier=parseInt(Math.floor(dDivisionMagnitude));for(var nMagAdditive=1;nMagAdditive>-2;nMagAdditive--){for(var i=0;i<dGears.length;i++){var dTmpDelta=dGears[i]*Math.pow(10,nDivisionMultiplier+nMagAdditive);var dTmpMax=Thunderball.ChartScalingV2.Math.RoundUpToMultiple(dMax,dTmpDelta,allowNoGap);var dTmpMin=Thunderball.ChartScalingV2.Math.RoundDownToMultiple(dMin,dTmpDelta,allowNoGap);var dLineCount=Math.round((dTmpMax-dTmpMin)/dTmpDelta)+1;var dDiff=Math.abs(preferredDivisionCount-dLineCount);if((dBestDifference==-1)||(dDiff<=dBestDifference)){if(preferMoreDivisions||(dLineCount<=preferredDivisionCount)){dBestDifference=dDiff;dBestLineCount=dLineCount;dBestMax=dTmpMax;dBestMin=dTmpMin;dBestDelta=dTmpDelta;}}}}
dFinish.value=dBestMax;dStart.value=dBestMin;return dBestDelta;},Math:{RoundUpToMultiple:function(val,multiple,inclusive){var dRemainder=Math.abs(val%multiple);if((dRemainder==0)&&inclusive)
return val;if(val>0)
return val+(multiple-dRemainder);else
return val+dRemainder;},RoundDownToMultiple:function(val,multiple,inclusive){var dRemainder=Math.abs(val%multiple);if((dRemainder==0)&&inclusive)
return val;if(val>0)
return val-dRemainder;else
return val-(multiple-dRemainder);}}},Utilities:{canvas_compatible:false,Requesters:[],check_canvas:function(){try{this.canvas_compatible=!!(document.createElement('canvas').getContext('2d'));}catch(e){this.canvas_compatible=!!(document.createElement('canvas').getContext);}
return this.canvas_compatible;},DataUpdater:function(data){for(var i=0;i<Thunderball.Utilities.Requesters.length;i++){if(Thunderball.Utilities.Requesters[i].requestId==data.requestId){Thunderball.Utilities.Requesters[i].data=data;Thunderball.Utilities.Requesters[i]._didLoad();Thunderball.Utilities.Requesters.splice(i,1);}}},GetData:function(chart){var requestObject=chart.buildRequest();$.ajax({type:"POST",url:chart.url,dataType:"json",data:requestObject,success:function(data){if(data!=null&&data.length>0){var chartdata=data[0].Value;chartdata.requestId=chart.requestId;Thunderball.Utilities.DataUpdater(chartdata);data=null;}}});requestObject=null;},FormatDate:function(dateString){if(typeof dateString=="string"){var converted=0;if(dateString.indexOf("-")>=0||dateString.indexOf("+")>=0){var _userOffset=new Date().getTimezoneOffset()/60;var temp=dateString.substring(dateString.length-7,dateString.length-2);var offset=parseInt(temp.substring(2))/100;if(temp.substring(0,1)=="-"){offset=-offset;}
converted=parseInt(dateString.substring(6,dateString.length-7))+((_userOffset+offset)*3600000);}
else{converted=parseInt(dateString.substring(6,dateString.length-2));}
var dateTime=new Date(converted);return dateTime;}
else{return dateString;}},drawXaxisLines:function(chart){if(chart.style.verticalGridLineStyle){var ctx=chart.drawingContext;chart._bump=true;ctx.beginPath();var ticks=chart._timeLines;for(var i=0;i<ticks.length;i++){var x=ticks[i];ctx.moveTo(x+0.5,chart.height);ctx.lineTo(x+0.5,0);}
ctx.strokeStyle=chart.style.verticalGridLineStyle;ctx.stroke();}
if(chart.style.verticalGridLineStyle_Opaque){var ctx=chart.drawingContext;chart._bump=true;ctx.beginPath();var ticks=chart._opaqueTimeLines;for(var i=0;i<ticks.length;i++){var x=ticks[i];ctx.moveTo(x+0.5,chart.height);ctx.lineTo(x+0.5,0);}
ctx.strokeStyle=chart.style.verticalGridLineStyle_Opaque;ctx.stroke();}
chart._timeLines=[];chart._opaqueTimeLines=[];},addXAxisLabels:function(chart){var labelsToCreate=chart._xAxisLabels;var self=chart;var target=self.targetSelector;var TotalHeight=self.height;var XAxisContent="";var elmWidth=30;var elmWidthCenter;if(!self.style.xAxisLabelPadding){self.style.xAxisLabelPadding=20;}
XAxisContent="<div style='position:relative width:"+self.width+"px;'>";for(var i=0;i<labelsToCreate.length;i++){elmWidthCenter=labelsToCreate[i].x-(elmWidth/2);XAxisContent=XAxisContent+"<div style='text-align:center; position: absolute; top:"+TotalHeight+"px;left:"+elmWidthCenter+"px;width:"+elmWidth+"px' class='xValueLbl'>"+labelsToCreate[i].element+"</div>";}
XAxisContent=XAxisContent+"</div>";dojo.place(XAxisContent,target);},addTick:function(Data,Symbol,Timestamp,Price,Offset){var Sessions=Thunderball.Utilities._getSessionByTicker(Data,Symbol);if(Sessions!=null){var timestamp=BlueGrass.Utility.convertToExchangeTime(Timestamp,Offset);var where=Thunderball.Utilities._findXSession(Sessions,timestamp,Data.BarFactor);if(where&&where.x){where.Session.Trades[where.x]=Price;if(where.Session.Trades.length-2==where.x){where.Session.Trades[where.x+1]=null;}
if(where.Session.Low&&where.Session.Low.Price>Price){where.Session.Low.Price=Price;where.Session.Low.Index=where.x;}
if(where.Session.High&&where.Session.High.Price<Price){where.Session.High.Price=Price;where.Session.High.Index=where.x;}
return where;}}
return where;},_findXSession:function(Sessions,Timestamp,BarFactor){Timestamp=new Date(Timestamp);for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];var ten_days=1000*60*60*24*10;if(Session.Stop.getTime()-Session.Start.getTime()<=ten_days){if(Session.Start<=Timestamp&&Timestamp<=Session.Stop){var x=(Timestamp.getTime()-Session.Start.getTime())/BarFactor;return{x:parseInt(x),Session:Session,Historical:false};}}
else{return{x:null,Session:null,Historical:true};}}
return{x:null,Session:null,Historical:false};},_getSessionByTicker:function(ChartData,Symbol){var s=Symbol.toUpperCase();for(var i=0;i<ChartData.Data.length;i++){if(ChartData.Data[i].Key==s){return ChartData.Data[i].Value.Sessions;}}
return null;}}};}(window));dojo.provide("dj.module.marketdata.chart");dojo.require("dj.module.marketdata.thunderball");dojo.require("dj.module.marketdata.marketwatch");var _PrevClose=0;var _isDEEdition=false;var WSJIndexChartStyle={background:"#ffffff",border:"#E6E2D7",closelineStyle:"#e36825",horizontalGridLineStyle:"#f4f3f1",highIndicatorStyle:"#093c71",highlowLineStyle:"#015190",lowIndicatorStyle:"#093c71",mainLineStyle:"#557BA0",mainPriceLineFill:"rgba(85,123,160,0.15)",mainPriceLineWidth:1,maxPriceLines:4,verticalGridLineStyle:"rgba(180,201,202,0.5)",verticalGridLineStyle_Opaque:"rgba(180,201,202,1.0)",vPadding:12,YAxisLabelStyle:1,YAxisLabelHeight:12,showDecimals:1,regionStyles:{0:'#cde2e0',1:'#cde2e0',2:'rgba(51,51,51,0.06)'},comparelineStyles:{0:'#cc3333',1:'#3b8dad',2:'#c9932e',3:'#b78383',4:'#8eb3bc',5:'#dbb782'}};function LegacyChart(container,legacyQueryString,width,height){var _chartBox=dojo.byId(container);var _legacyQueryString=legacyQueryString;var _width=width;var _height=height;var _currentsymbol=null;var start=legacyQueryString.indexOf("symb=")+5;var end=legacyQueryString.indexOf("&",start);if(end==-1){_currentsymbol=legacyQueryString.substr(start).toUpperCase();}else{_currentsymbol=legacyQueryString.substr(start,end-start).toUpperCase();}
var _showChart=function(){_chartBox.innerHTML="";dojo.place('<img src="//www.marketwatch.com/charts/big.chart'+_legacyQueryString+'" />',_chartBox);};return{ShowChart:function(symbol){if(symbol!=null&&symbol!=undefined&&_currentsymbol!=symbol.toUpperCase()){_currentsymbol=symbol.toUpperCase();_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=");if(_currentsymbol.indexOf("US:CRUDE OIL - ELECTRONIC")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=3343724");}else{_legacyQueryString=_legacyQueryString+"&sid=3343724";}}else if(_currentsymbol.indexOf("US:FUTURE-US-GOLD")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=1782661");}else{_legacyQueryString=_legacyQueryString+"&sid=1782661";}}else if(_currentsymbol.indexOf("DX:DAX")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=125284");}else{_legacyQueryString=_legacyQueryString+"&sid=125284";}}else{_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb="+_currentsymbol);}}
_showChart();},TickSubscribe:function(){},UpdateAllCharts:function(time,freq,startdate,enddate){this.UpdateChart(time,freq,startdate,enddate);},UpdateChart:function(time,freq,startdate,enddate){_legacyQueryString=_legacyQueryString.replace(/freq=[^&^\n]*/i,"freq="+freq);if(time==null||time==undefined){_legacyQueryString=_legacyQueryString.replace(/time=[^&^\n]*/i,"time=");}else{_legacyQueryString=_legacyQueryString.replace(/time=[^&^\n]*/i,"time="+time);}
if(startdate==null||startdate==undefined){_legacyQueryString=_legacyQueryString.replace(/startdate=[^&^\n]*/i,"startdate=");}else{if(_legacyQueryString.indexOf("startdate=")>-1){_legacyQueryString=_legacyQueryString.replace(/startdate=[^&^\n]*/i,"startdate="+startdate);}else{_legacyQueryString=_legacyQueryString+"&startdate="+startdate;}}
if(enddate==null||enddate!=undefined){_legacyQueryString=_legacyQueryString.replace(/enddate=[^&^\n]*/i,"enddate=");}else{if(_legacyQueryString.indexOf("enddate=")>-1){_legacyQueryString=_legacyQueryString.replace(/enddate=[^&^\n]*/i,"enddate="+enddate);}else{_legacyQueryString=_legacyQueryString+"&enddate="+enddate;}}
_showChart();},ChangeSymbol:function(symbol){var symbols=symbol.toUpperCase().split('|');_currentsymbol=symbols[0];_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb="+_currentsymbol);if(symbols.length>1){if(_legacyQueryString.indexOf("compidx=")>-1){_legacyQueryString=_legacyQueryString.replace(/compidx=[^&^\n]*/i,"compidx="+symbols[1]);}else{_legacyQueryString=_legacyQueryString+"&compidx="+symbols[1];}}else{_legacyQueryString=_legacyQueryString.replace(/compidx=[^&^\n]*/i,"compidx=");}
if(symbols.length>2){var comp="";for(var i=2;i<symbols.length;i++){if(comp.length>0){comp=comp+",";}
comp=comp+symbols[i];}
if(_legacyQueryString.indexOf("comp=")>-1){_legacyQueryString=_legacyQueryString.replace(/comp=[^&^\n]*/i,"comp="+comp);}else{_legacyQueryString=_legacyQueryString+"&comp="+comp;}}else{_legacyQueryString=_legacyQueryString.replace(/comp=[^&^\n]*/i,"comp=");}
_showChart();},SetChartRefresh:function(rate){setInterval(_showChart,rate);}}}
function EmbeddedChartMDM(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol,prevClose,isDEEdition){_PrevClose=0;_PrevClose=prevClose;_isDEEdition=false;_isDEEdition=isDEEdition;return new EmbeddedChart(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol);}
function EmbeddedChart(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol){var _chartBox=document.getElementById(container);var _style=style;var _width=width;var _height=height;var _time=time;var _freq=freq;var _startdate=startdate;var _enddate=enddate;var _pagedata=null;var _currentsymbol=null;var _firstsymbol=symbol;var _symbolCount=0;var _chart=null;var _tick=false;var _ticktimeout=null;var _currentchannel=null;var _connection=null;var _url="/Market/ECProxy/ChartData";var _setPageData=function(data){if(data!=null&&data!=undefined&&data.length>0){if(_pagedata==null){_pagedata=[];}
for(var i=0;i<data.length;i++){if(data[i].Value!=null&&data[i].Value!=undefined&&data[i].Key!=''){_pagedata[data[i].Key]=data[i].Value;if(_pagedata[data[i].Key].Data!=null){for(var j=0;j<_pagedata[data[i].Key].Data.length;j++){for(var k=0;k<_pagedata[data[i].Key].Data[j].Value.Sessions.length;k++){var session=_pagedata[data[i].Key].Data[j].Value.Sessions[k];session.Start=new Date(Thunderball.Utilities.FormatDate(session.Start));session.Stop=new Date(Thunderball.Utilities.FormatDate(session.Stop));}}}}}}}
var _showChart=function(symbol){if(_pagedata==null){_chart=new JSChart(_chartBox,symbol.split('|'),_width,_height,_style,_freq,_time,_startdate,_enddate,undefined,MarketWatch.getBaseUrl()+_url);_currentsymbol=symbol;}else{if(symbol!=_currentsymbol){if(_chart!=null){_pagedata[_currentsymbol]=_chart.data;_chart.data=null;_chart=null;}
var symbols=symbol.split('|');_chart=new JSChart(_chartBox,symbols,_width,_height,_style,_freq,_time,_startdate,_enddate,_pagedata[symbol],MarketWatch.getBaseUrl()+_url);_currentsymbol=symbol;_symbolCount=symbols.length;}}}
_setPageData(chartdata);var _refreshPageData=function(){var symbols=[]
for(var symbol in _pagedata){symbols.push(symbol);}
_refreshData(symbols,"mo");}
var _refreshData=function(symbols,cachekey){requestObject={freq:_freq,time:_time,Symbol:symbols,StartDate:_startdate,EndDate:_enddate,Width:_width,Height:_height,CacheKey:cachekey};dojo.rawXhrPost({url:MarketWatch.getBaseUrl()+_url,postData:requestObject,handleAs:"json",load:function(response,ioArgs){if(response!=null){_setPageData(response);response=null;if(_chart!=null){_chart.data=_pagedata[_currentsymbol];_chart._didLoad();}}
return response;}});requestObject=null;}
var _reloadChart=function(){if(_chart!=null){_chart.time=_time;_chart.freq=_freq;_chart.startDate=_startdate;_chart.endDate=_enddate;_chart.reload();}}
return{ShowChart:function(symbol){if(symbol===undefined){symbol=_firstsymbol;}
symbol=symbol.toUpperCase();if(symbol!=_currentsymbol){if(_pagedata[symbol]!==null&&_pagedata[symbol]!==undefined){_showChart(symbol);return true;}else{return false;}}},TickSubscribe:function(){if(_chart!=null){_tick=true;var chartSubscribeCallback=function(message){if(_chart!=null&&_chart.data!=null&&_symbolCount==1){for(var symbol in _pagedata){for(var i=0;i<_pagedata[symbol].Data.length;i++){if(_pagedata[symbol].Data[i].Value.BlueGrassChannel!=null&&_pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase()==message.h.t){if(symbol.toUpperCase()===_currentsymbol.toUpperCase()){_chart.addTick(symbol,message.b.z,message.b.l,message.b.e);}
break;}}}}};var chartConnectionCallback=function(connection,type){if(type=="connect"){_connection=connection;if(_pagedata[_currentsymbol]!=null){_currentchannel=_connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,chartSubscribeCallback);}}};if(_currentchannel!=null){_currentchannel.removeCallback(chartSubscribeCallback);}
if(_connection!=null){if(_pagedata[_currentsymbol]!=null){_currentchannel=_connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,chartSubscribeCallback);}}else{if(BlueGrass!==null&&BlueGrass.Runtime!==null){BlueGrass.Runtime.openConnection({},chartConnectionCallback);}}}},UpdateAllCharts:function(time,freq,startdate,enddate){if(_chart!=null){this.UpdateChart(time,freq,startdate,enddate);setTimeout(_refreshPageData,5);}},UpdateChart:function(time,freq,startdate,enddate){if(_chart!=null){_time=time;_freq=freq;_startdate=startdate;_enddate=enddate;_reloadChart();}},ChangeSymbol:function(symbol){if(_chart!=null){_currentsymbol=symbol;_chart.setSymbols(symbol.split('|'));_symbolCount=_chart.symbols.length;_reloadChart();}},SetChartRefresh:function(rate){setInterval(_refreshPageData,rate);}}}
var JSChart=function(targetSelector,symbols,width,height,style,freq,time,startDate,endDate,data,url){this.targetSelector=targetSelector;if(style===undefined){this.style=LargeChartStyle;}else{this.style=style;}
if(url!==undefined){this.url=url;}
this.width=width;this.height=height;this.symbols=symbols;this.selectedSymbol=symbols[0];if(freq===undefined){this.freq="1mi";}else{this.freq=freq;}
if(time===undefined){this.time="1dy";}else{this.time=time;}
if(startDate!==undefined){this.startDate=startDate;}
if(endDate!==undefined){this.endDate=endDate;}
var self=this;if(data===undefined){$(function(){self.reload();});}else{self.preload(data);}};JSChart.prototype={freq:"1mi",time:"1dy",unit:"Minute",url:"./HistoricChartData.aspx",span:1,step:1,startDate:'',endDate:'',data:null,selectedSymbol:null,width:0,height:0,drawingContext:null,style:null,highPrice:null,highPoint:{"x":null,"y":null},lowPoint:{"x":null,"y":null},lowPrice:null,lastPoint:{"x":null,"y":null},lastPrice:null,closePrice:null,buildRequest:function(){var requestObject;var symbol="";for(var i=0;i<this.symbols.length;i++){if(i>0){symbol+="|";}
symbol+=this.symbols[i];}
requestObject={freq:this.freq,time:this.time,Symbol:symbol,StartDate:this.startDate,EndDate:this.endDate,Width:this.width};return requestObject;},lastTickPrice:0,lastTickChange:0,lastTickX:0,addTick:function(tickSymbol,Timestamp,Price,offSet){var where=Thunderball.Utilities.addTick(this.data,tickSymbol,Timestamp,Price,offSet);if(where.Historical==false){if(where.x==null){return;}else{if(Price!=this.lastTickPrice){this.lastTickChange=Price-this.lastTickPrice;this.lastTickPrice=Price;}else if(where.x==this.lastTickX){return;}
this.lastTickX=where.x;this._didLoad();}}},setSymbols:function(symbols){this.symbols=symbols;this.selectedSymbol=symbols[0];},reload:function(){this._resetState();var d=new Date();var requestId=this.symbols[0]+d.getTime();this.requestId=requestId;Thunderball.Utilities.Requesters.push(this);Thunderball.Utilities.GetData(this);},preload:function(data){this._resetState();this.data=data;this._didLoad();},_resetState:function(){this.lastTickPrice=this.lastTickChange=this.lastTickX=0;},redraw:function(){this._prepareCanvas();this._clearLabels();var ctx=this.drawingContext;ctx.clearRect(0,0,this.width,this.height);ctx.save();this._drawChartBackground();var Data=Thunderball.Utilities._getSessionByTicker(this.data,this.selectedSymbol);if(Data!=null){for(var i=0;i<Data.length;i++){this._drawRegions(Data[i]);}
if(this.style.type=='Spark'){this._drawSpark(Data[Data.length-1]);}else{this._determineTypeOfChart(Data);this._setHLC(Data);this._fillTrades(Data);this._drawPriceLines();this._createYAxisLabels(this.symbols.length);Thunderball.Utilities.addXAxisLabels(this);Thunderball.Utilities.drawXaxisLines(this);this._drawCloseLines(Data);var st=this.style;if(this.highPoint.y!=this.lowPoint.y){this._priceIndicator(this.highPoint,"",st.highIndicatorStyle,"chartPointer chartPoint-high",false);this._priceIndicator(this.lowPoint,"",st.lowIndicatorStyle,"chartPointer chartPoint-low",false);}
this._priceIndicator(this.lastPoint,"","","lastLbl",true);if(this.symbols.length>1){for(var j=1;j<this.symbols.length;j++){var Session=Thunderball.Utilities._getSessionByTicker(this.data,this.symbols[j]);if(Session!=null){var compareColor='black';if(j<=6){compareColor=this.style.comparelineStyles[j-1];}
this._strokeTrades(Session,compareColor);}}}
this._strokeTrades(Data,this.style.mainLineStyle);this._drawChartBorder();if(this.highPoint.y!=this.lowPoint.y){this._drawHorizontalLine(this.highPoint.y);this._drawHorizontalLine(this.lowPoint.y);}
this.startTime=this.overallStartTime;}}
ctx.restore();},_x:0,_xscale:0,_y:0,_yscale:0,_bump:false,_fillStyle:'black',_padding:0,_events:[],_barFactor:0,_barSize:1,_priceLines:[],_timeLines:[],_opaqueTimeLines:[],_historical:false,_customDateRange:false,_chartUnit:1,_displayUnit:1,_xAxisLabels:[],_findOpaqueGridLines:function(time){var xAxisInfo=this._xAxisLabels;var timeLines=this._timeLines;var data=this.data;var opaqueTimeLines=[];this._opaqueTimeLines=[];if(this._displayUnit===1||this._displayUnit===2){if(_isDEEdition){this._convertGridLinesForGermany(xAxisInfo,time,opaqueTimeLines);}else{for(var i=0;i<xAxisInfo.length;i++){var patt=/^M$|^T$|^W$|^F$|^S$/;if(xAxisInfo[i].element.match(patt)){opaqueTimeLines.push(xAxisInfo[i].x);}}}}else{for(var i=0;i<xAxisInfo.length;i++){var patt=/^\d{2}$/;if(xAxisInfo[i].element.match(patt)&&xAxisInfo[i].x!==(.5*timeLines[0])){opaqueTimeLines.push(xAxisInfo[i].x);}}}
if(opaqueTimeLines.length>0){for(var i=0;i<opaqueTimeLines.length;i++){this._opaqueTimeLines.push(opaqueTimeLines[i]);}}},_convertGridLinesForGermany:function(xAxisInfo,time,opaqueTimeLines){var patt=/^M$|^T$|^W$|^F$|^S$/;var pattDE=/^M$|^D$|^F$|^S$/;if(time.toString()=="1dy"){var xElement="";var length=xAxisInfo.length;for(var i=0;i<length;i++){xElement=xAxisInfo[i];if(xElement!=undefined){if(length==1&&(xElement.element.match(patt)||xElement.element.match(pattDE))){this._convertGridLinesForGermany5dy(xAxisInfo,time,opaqueTimeLines);return;}
var len=xElement.element.length;var hour=xElement.element;var ap=xElement.element.substring(len-1);if((len==2||len==3)&&(ap=="a"||ap==="p")){hour=xElement.element.substring(0,len-1);}
if(ap=="p"&&hour!="12"){hour=parseFloat(hour)+parseFloat(12);}else if(hour.length==1){hour="0"+hour;}
xElement.element=hour.toString();}}}else if(time.toString()=="5dy"){this._convertGridLinesForGermany5dy(xAxisInfo,time,opaqueTimeLines);return;}},_convertGridLinesForGermany5dy:function(xAxisInfo,time,opaqueTimeLines){var pattDE=/^M$|^D$|^F$|^S$/;var xElement="";var length=xAxisInfo.length;for(var i=0;i<length;i++){xElement=xAxisInfo[i];if(xElement!=undefined){if(xElement.element=="M"){xElement.element="M";}else if(xElement.element=="W"){xElement.element="M";}else if(xElement.element=="F"){xElement.element="F";}else if(xElement.element=="S"){xElement.element="S";}else if(xElement.element=="T"){xElement.element="D";}
if(xElement.element.match(pattDE)){opaqueTimeLines.push(xElement.x);}}}},_didLoad:function(){if(!this.data)
return;if(this.data.Error){var target=this.targetSelector;var errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>Error, the chart cannot be displayed.</div>";if(this.data.Error=="Error: Time"){errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";}
var ctx=this.drawingContext;if(ctx!=null){ctx.clearRect(0,0,this.width,this.height);this._clearLabels();dojo.place(errorMessage,target);}
return;}
var data=this.data.Data;if(data.length>1){var tradesExist=false;for(var i=0;i<data.length;i++){var value=data[i].Value;var sessions=value.Sessions;for(var j=0;j<sessions.length;j++){if(sessions[j].Trades.length>0){tradesExist=true;continue;}}}
if(!tradesExist){var target=this.targetSelector;var errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";var ctx=this.drawingContext;if(ctx!=null){ctx.clearRect(0,0,this.width,this.height);this._clearLabels();dojo.place(errorMessage,target);}
return;}}
this._barFactor=this.data.BarFactor;this._barSize=this.data.BarSize;this._chartUnit=this.data.xAxisLabelInfo.chartUnit;this._displayUnit=this.data.xAxisLabelInfo.displayUnit;this._timeLines=this.data.xAxisLabelsObj.timeLines;this._xAxisLabels=this.data.xAxisLabelsObj.ElementList;if(this._displayUnit===1||this._displayUnit===2||this._displayUnit===3){this._findOpaqueGridLines(this.time);}
this._customDateRange=this.data.CustomDateRange;try{for(var j=0;j<this.symbols.length;j++){var Sessions=Thunderball.Utilities._getSessionByTicker(this.data,this.symbols[j]);if(Sessions!=null){if(this.symbols.length>1){this._changeDataToPercentage(Sessions);}
dojo.forEach(Sessions,function(Session,i){if(Session.Trades===undefined){Session.Trades=[];}
if(Session.Events===undefined){Session.Events=[];}
if(Session.News===undefined){Session.News=[];}
if(Session.Weight===undefined){}
if(Session.Start===undefined){}
if(Session.Stop===undefined){}
var sessionStartFormat=Thunderball.Utilities.FormatDate(Session.Start);var sessionStopFormat=Thunderball.Utilities.FormatDate(Session.Stop);Session.Start=new Date(sessionStartFormat);Session.Stop=new Date(sessionStopFormat);});this._layoutSessions(Sessions);}}}catch(e){}
this._autoScale(this.data.Data,this.time);this.redraw();},_changeDataToPercentage:function(Sessions){var basePrice=null;for(var k=0;k<Sessions.length;k++){var trades=Sessions[k].Trades;for(var l=0;l<trades.length;l++){if(trades[l]!==null&&basePrice===null){basePrice=trades[l];break;}}
if(basePrice!==null){break;}}
if(basePrice!==null&&basePrice>0){for(var k=0;k<Sessions.length;k++){var trades=Sessions[k].Trades;for(var l=0;l<trades.length;l++){if(trades[l]!==null){trades[l]=100*((trades[l]-basePrice)/basePrice);}}
if(Sessions[k].Low!==null){Sessions[k].Low.Price=100*((Sessions[k].Low.Price-basePrice)/basePrice);}
if(Sessions[k].High!==null){Sessions[k].High.Price=100*((Sessions[k].High.Price-basePrice)/basePrice);}}}},_drawHorizontalLine:function(y){if(this.style.highlowLineStyle){var ctx=this.drawingContext;this._bump=true;ctx.beginPath();ctx.lineWidth=1;ctx.moveTo(0,y+0.5);ctx.lineTo(this.width,y+0.5);ctx.strokeStyle=this.style.highlowLineStyle;ctx.stroke();}},_priceIndicator:function(point,string,style,cssClass,lastPoint){if(point.x===null||point.y===null){return;}
if(lastPoint){if(point.x>this.width-3){point.x=this.width-3;}
var y=point.y-10;var x=point.x-2;if(this.lastTickChange<0){lastPointIcon="<div class='chartDownIndicator'></div>";}else if(this.lastTickChange>0){lastPointIcon="<div class='chartUpIndicator'></div>";}else{lastPointIcon="<div class='chartIndicator'></div>";y=point.y-3;}
return;}else{}},_createYAxisLabels:function(type){if(!this.style.maxPriceLines)
return;var decimalsToShow=2;var YAxisContent="";var displayValue="";var x,y,p;var elmHeight=this.style.YAxisLabelHeight;var excludeLabel=[];if(!this.style.yAxisLabelPadding){this.style.yAxisLabelPadding=2;}
function addCommas(nStr){nStr+='';x=nStr.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
function decimalsNeeded(lineNum,range){var Tol=5.0e-6;if(range===0||lineNum===0)
return 0;var maxDecimals=6;var division=range/lineNum;var decimals=0;while(decimals<=maxDecimals){var divtest=division*Math.pow(10,decimals);if(Math.abs(divtest-Math.round(divtest))<Tol)
break;decimals+=(decimals==0)?2:1;}
return decimals;}
if(this._priceLines.length>1){this._priceLines.sort(function(a,b){return a-b});var firstValue=this._priceLines[0];var lastValue=this._priceLines[this._priceLines.length-1];var diffValue=lastValue-firstValue;var totalNumber=this._priceLines.length-1;if(this.style.showDecimals===0){decimalsToShow=0;}else if(this.style.YAxisLabelStyle===1){if(lastValue<10)
decimalsToShow=3;else if(lastValue<100)
decimalsToShow=2;else
decimalsToShow=0;}else{decimalsToShow=decimalsNeeded(totalNumber,diffValue);}}
try{var current=false;for(var i=this._priceLines.length-1;i>=0;i--){var drawLabel=true;p=this._priceLines[i];if(this._priceLines[i]===this.lastPrice){y=(this.ty(p)-(elmHeight/2)-1);}else if(this._priceLines[i]===this.highPrice){y=(this.ty(p)-elmHeight);}else if(this._priceLines[i]===this.lowPrice){y=this.ty(p)-1;}else if(this._priceLines[i]===this.closePrice){y=(this.ty(p)-(elmHeight/2)-1);}else{y=this.ty(p)-(elmHeight/2);}
x=this.style.yAxisLabelPadding+this.width;if(this.style.YAxisLabelStyle===1){for(var j=0;j<this._priceLines.length;j++){if(this._priceLines[i]!=this.lastPrice&&j!=i&&excludeLabel[j]!=1){var cp=this._priceLines[j];if(this._priceLines[j]===this.lastPrice){cy=(this.ty(cp)-(elmHeight/2))-1;}else if(this._priceLines[j]===this.closePrice){cy=(this.ty(cp)-(elmHeight/2))-1;}else if(this._priceLines[j]===this.highPrice){cy=(this.ty(cp)-elmHeight)-1;}else if(this._priceLines[j]===this.lowPrice){cy=this.ty(cp)-1;}else{drawLabel=false;}
if(Math.abs(Math.abs(cy)-Math.abs(y))<elmHeight+1){if(this._priceLines[j]!=this.closePrice){drawLabel=false;excludeLabel[i]=1;}}}}}
if(type>1){displayValue=p.toFixed(decimalsToShow)+"%";}else{displayValue=p.toFixed(decimalsToShow);}
var labelClass="priceLbl";if(this.style.YAxisLabelStyle===1){var width=5;if(this._priceLines[i]===this.lastPrice&&(this._priceLines[i]>=this.closePrice||this.closePrice===null)&&!current){labelClass="chartPointer chartLastPoint chartPoint-pos";current=true;}else if(this._priceLines[i]===this.lastPrice&&this._priceLines[i]<this.closePrice&&!current){labelClass="chartPointer chartLastPoint chartPoint-neg";current=true;}else if(this._priceLines[i]===this.lowPrice){if(this.lowPrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-low";}else if(this._priceLines[i]===this.highPrice){if(this.highPrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-high";}else if(this.closePrice&&this._priceLines[i]===this.closePrice){if(this.closePrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-close";}}
if(drawLabel===true&&this.style.YAxisLabelStyle===1){YAxisContent=YAxisContent+"<div style='position: absolute; top:"+y+"px;left:"+x+"px; ' class='"
+labelClass+"'>"+displayValue+"</div>";}else if(drawLabel===true){YAxisContent=YAxisContent+"<div style='position: absolute; top:"+y+"px;left:"+x+"px; ' class='"
+labelClass+"'>"+displayValue+"</div>"}}}catch(e){}
dojo.place(YAxisContent,this.targetSelector);},_determineTypeOfChart:function(Sessions){if(Sessions.length>=1&&Sessions[0].Regions.length>=1){var numberOfRegions=Sessions[0].Regions.length;if(numberOfRegions==1&&Sessions[0].Regions[0].Type!=4){this._historical=true;}else{this._historical=false;}}},_setHLC:function(Sessions){this.lastPoint.x=null;this.lastPoint.y=null;this.lowPoint.x=null;this.lowPoint.y=null;this.highPoint.x=null;this.highPoint.y=null;var MinMax=this._getMinMax(Sessions,false);var needsBump=false;if(this.data.Data[0].Value.IsIndex===1&&this._barSize===60){needsBump=true;}
if(MinMax.MinPoint!=null||MinMax.Min!=null){this.lowPoint=MinMax.MinPoint;}
if(MinMax.MaxPoint!=null||MinMax.Max!=null){this.highPoint=MinMax.MaxPoint;}
for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(Session.Trades&&Session.Trades.length!==0){var lastIndex=Session.Trades.length-1;var price=Session.Trades[lastIndex];if(price){this.lastPoint.y=this.ty(price);if(this._historical){this.lastPoint.x=this.tx(lastIndex/this._barSize);}else{if(needsBump){this.lastPoint.x=this.tx(lastIndex+0.5);}else{this.lastPoint.x=this.tx(lastIndex);}}}else{for(var j=lastIndex;j>=0;j--){price=Session.Trades[j];if(price){this.lastPoint.y=this.ty(price);if(this._historical){this.lastPoint.x=this.tx(j/this._barSize);}else{if(needsBump){this.lastPoint.x=this.tx(j+0.5);}else{this.lastPoint.x=this.tx(lastIndex);}}
break;}}}}}},_drawRoundIndicator:function(color,x,y,circleSize){if(x!==null&&y!==null){var ctx=this.drawingContext;ctx.fillStyle=color;ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2,true);ctx.fill();ctx.strokeStyle=color;ctx.beginPath();ctx.save();ctx.lineWidth=1.5;ctx.arc(x,y,circleSize,0,Math.PI*2,true);ctx.stroke();ctx.restore();}},_drawRoundDot:function(color,x,y,size){if(x!==null&&y!==null){var ctx=this.drawingContext;ctx.fillStyle=color;ctx.beginPath();ctx.arc(x,y,size,0,Math.PI*2,true);ctx.fill();}},_drawNewsOverlay:function(Sessions){this._bump=false;for(var i=0;i<Sessions.length;i++){this._setSession(Sessions[i]);var news=Sessions[i].News;for(var j=0;j<news.length;j++){var story=news[j];var x=this.tx(story.At);var p;var Trades=Sessions[i].Trades;for(var k=0;k<Trades.length&&k<story.At;k++){if(Trades[k]){p=Trades[k];}}
if(p){var newsLink=$('<a></a>').attr('href',story.Url);var icon=$('<img />').attr('border',0).attr('src',this.style.newsBackground).attr('title',story.Text).appendTo(newsLink);}}}},_drawPriceLines:function(){if(this.style.horizontalGridLineStyle){var ctx=this.drawingContext;this._bump=true;ctx.beginPath();var ticks=this._priceLines;for(var i=0;i<ticks.length;i++){var y=this.ty(ticks[i]);ctx.moveTo(0,y);ctx.lineTo(this.width,y);}
ctx.strokeStyle=this.style.horizontalGridLineStyle;ctx.stroke();}},_drawChartBorder:function(){if(this.style.border){var ctx=this.drawingContext;ctx.beginPath();ctx.strokeStyle=this.style.border;ctx.strokeRect(0,0,this.width,this.height);}},_drawChartBackground:function(){if(this.style.background){var ctx=this.drawingContext;ctx.beginPath();ctx.fillStyle=this.style.background;ctx.fillRect(0,0,this.width,this.height);}},_drawCloseLines:function(Sessions){var ctx=this.drawingContext;this._bump=true;var x=0;ctx.beginPath();for(var i=0;i<Sessions.length;i++){var session=Sessions[i];this._setSession(session);var w=session.SessionWidth;var x2=x+w;if(session.PreviousClose!==undefined&&session.PreviousClose!==null&&(this.symbols.length==1)){var y=this.ty(session.PreviousClose);ctx.moveTo(x,y);ctx.lineTo(x2,y);}
x=x2;}
ctx.strokeStyle=this.style.closelineStyle;ctx.stroke();},_drawRegions:function(session){var ctx=this.drawingContext;this._setSession(session);this._bump=false;for(var i=0;i<session.Regions.length;i++){var Region=session.Regions[i];var Color=this._regionStyles[Region.Type];if(!Color||Color==this.style.background){continue;}
var x1=this.tx(Region.Start);var x2;if(i===0&&this._barSize===60&&(Region.Stop+Region.Start>0)){x2=this.tx(Region.Stop+0.5);}else{x2=this.tx(Region.Stop);}
ctx.fillStyle=Color;ctx.fillRect(x1,0,x2-x1,this.height);}},_buildTradePath:function(Sessions){var ctx=this.drawingContext;var data=this.data;var isIndex=data.Data[0].Value.IsIndex;var first=true;var x=0;var firstx;var prev=null;var last;for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(Session.Trades){for(var j=0;j<Session.Trades.length;j++){var price=Session.Trades[j];if(price==null){if(prev==null)
continue;price=prev;}
prev=price;var y=this.ty(price);if(this._historical){x=this.tx(j/this._barSize);}else{if(isIndex===1&&this._barSize===60){x=this.tx(j+0.5);}else{x=this.tx(j);}}
if(first){firstx=x;ctx.moveTo(0,y);ctx.lineTo(firstx,y);first=false;}else{ctx.lineTo(x,y);}}}}
return{firstx:firstx,lastx:x};},_strokeFillTrades:function(Sessions,strokeStyle){var ctx=this.drawingContext;ctx.save();ctx.lineWidth=this.style.mainPriceLineWidth;ctx.strokeStyle=strokeStyle;ctx.beginPath();this._bump=true;var x=this._buildTradePath(Sessions);if(x.lastx!=undefined&&x.firstx!=undefined){ctx.stroke();ctx.lineTo(x.lastx,this.height);ctx.lineTo(0,this.height);ctx.fillStyle=this.style.mainPriceLineFill;ctx.fill();}
ctx.restore();},_strokeTrades:function(Sessions,strokeStyle){var ctx=this.drawingContext;ctx.save();ctx.miterLimit=0;ctx.lineJoin="round";ctx.lineWidth=this.style.mainPriceLineWidth;ctx.strokeStyle=strokeStyle;ctx.beginPath();this._bump=true;var x=this._buildTradePath(Sessions);ctx.stroke();ctx.restore();},_fillTrades:function(Sessions){var ctx=this.drawingContext;ctx.fillStyle=this._fillStyle;ctx.beginPath();this._bump=false;var points=this._buildTradePath(Sessions);if(points.lastx!=undefined&&points.firstx!=undefined){ctx.lineTo(points.lastx,this.height);ctx.lineTo(0,this.height);}
ctx.fill();},_precomputeStyles:function(){if(this.style.gradientFillStyle){this._fillStyle=this._makeStyle(this.style.gradientFillStyle);}
if(this.style.mainPriceLineFill){this._fillStyle=this.style.mainPriceLineFill;}
this._regionStyles={};var styles=this.style.regionStyles;for(var style in styles){this._regionStyles[style]=this._makeStyle(styles[style]);}},_prepareCanvas:function(){if(!this.drawingContext||this.drawingContext===null){var canvasWidth=this.width;var canvasHeight=this.height;this.targetSelector.innerHTML="";if(canvasWidth<=0||canvasHeight<=0){throw"Invalid dimensions - width = "+canvasWidth+", height = "+canvasHeight;}
var canvas=document.createElement('canvas');canvas.setAttribute('width',canvasWidth);canvas.setAttribute('height',canvasHeight);dojo.place(canvas,this.targetSelector);if(!Thunderball.Utilities.check_canvas()){canvas=window.G_vmlCanvasManager.initElement(canvas,canvasWidth,canvasHeight);}
this.drawingContext=canvas.getContext("2d");}
this._precomputeStyles();},orphan:function(node){node.parentNode.removeChild(node);},_clearLabels:function(){var label=dojo.query("#"+this.targetSelector.id+" > div");},_layoutSessions:function(Sessions){var TotalSessionWeight=0;dojo.forEach(Sessions,function(value,index){TotalSessionWeight+=value.Weight;});var x=0;for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];var SessionWidth;SessionWidth=Math.floor(this.width*Session.Weight/TotalSessionWeight);Session.SessionWidth=SessionWidth;Session._x=x;x+=SessionWidth;var SessionStart=Session.Start.getTime();var SessionStop=Session.Stop.getTime();var SessionTime=SessionStop-SessionStart;Session._xscale=SessionWidth*this._barFactor/(SessionTime);}},_autoScale:function(Data,time){var Min=null;var Max=null;var High=null;var Low=null;var Close=null;var self=this;var chartValueIndicators=this.style.YAxisLabelStyle;dojo.forEach(Data,function(Sessions,i){var includePreviousClose=true;if(self.symbols.length>1||Sessions.Value===undefined||Sessions.Value.Sessions===undefined||Sessions.Value.Sessions.length<1||Sessions.Value.Sessions[0].PreviousClose===undefined||Sessions.Value.Sessions[0].PreviousClose===null){includePreviousClose=false;}
var MinMax=self._getMinMax(Sessions.Value.Sessions,includePreviousClose);if(chartValueIndicators===1){self._determineLastTrade(Sessions.Value.Sessions[Sessions.Value.Sessions.length-1].Trades);Low=MinMax.Low;High=MinMax.High;if(includePreviousClose&&time=="1dy"){Close=Sessions.Value.Sessions[0].PreviousClose;self.closePrice=Close;}
else if(!includePreviousClose&&time!="1dy"){if(_PrevClose!=null&&_PrevClose>=0){Close=_PrevClose;self.closePrice=Close;}}}
if(!Min||MinMax.Min<Min){Min=MinMax.Min;}
if(!Max||MinMax.Max>Max){Max=MinMax.Max;}});function dStart(){this.value=0;}
function dFinish(){this.value=0;}
if(this.style.maxPriceLines>=1){var dFinishObj=new dFinish();var dStartObj=new dStart();var scale=Thunderball.ChartScalingV2.CalculateDelta2(this.style.maxPriceLines,false,true,Min,Max,dStartObj,dFinishObj);if(dStartObj.value<0&&self.symbols.length===1){scale=Thunderball.ChartScalingV2.CalculateDelta2(Math.round(this.style.maxPriceLines/2),false,true,Min,Max,dStartObj,dFinishObj);}
if(chartValueIndicators===1){if(High===null&&Low===null){if(close!=null){Max=Close+(Close*.01);Min=Close-(Close*.01);}else{Max=1;Min=0;}}
this._priceLines=[];var ticks=this._priceLines;if(Low!=null){ticks.push(Low);this.lowPrice=Low;}
if(this.lastPrice!=null){ticks.push(this.lastPrice);}
if((!(Close===undefined||Close===null))){ticks.push(Close);if(High!=null){ticks.push(High);this.highPrice=High;}}else{if(High!=null){ticks.push(High);this.highPrice=High;}}}else{Min=Math.min(Min,dStartObj.value);Max=Math.max(Max,dFinishObj.value);this._priceLines=[];var ticks=this._priceLines;if(scale>0){for(var p=dStartObj.value;p<=dFinishObj.value+((dFinishObj.value-dStartObj.value)*.05);p+=scale){ticks[ticks.length]=p;}}}}
var pad=this.style.vPadding;var height=this.height-2.0*pad;if(Max-Min===0){if(Max<Min){var Tmp=Min;Min=Max;Max=Tmp;}
var Max=Math.abs(Max);if(Max==0)
Max=1;if(Max<0)
Max=0;else if(Max==0)
Max=1;else
Min=0;}
this._yscale=-height/(Max-Min);this._y=height-Min*this._yscale+pad;},_setSession:function(session){this._xscale=session._xscale;this._x=session._x;},tx:function(x){if(!this._x){this._x=1;}
if(!this._xscale){this._xscale=1;}
return Math.floor(this._xscale*x+this._x)+(this._bump?0.5:0);},ty:function(y){return Math.floor(this._yscale*y+this._y)+(this._bump?0.5:0);},_makeStyle:function(spec){var steps=spec.split('-');if(steps.length==2){var gradient=this.drawingContext.createLinearGradient(0,0,0,this.height);gradient.addColorStop(0,steps[0]);gradient.addColorStop(1,steps[1]);return gradient;}else{return spec;}},_determineLastTrade:function(Trades){var latestPrice=null;for(var k=Trades.length-1;k>=0&&latestPrice===null;k--){if(Trades[k]){latestPrice=Trades[k];}}
this.lastPrice=latestPrice;},_getMinMax:function(Sessions,IncludePreviousClose){var MinPoint;var MaxPoint;var Min;var Max;var LowPrice;var HighPrice;var SessionHighPoint={Index:null,Price:null,SessionIndex:null};var SessionLowPoint={Index:null,Price:null,SessionIndex:null};if(IncludePreviousClose&&Sessions[0].PreviousClose!==null){Max=Min=Sessions[0].PreviousClose;}
var needsBump=false;if(this.data.Data[0].Value.IsIndex===1&&this._barSize===60){needsBump=true;}
for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(!Session.Trades){Session.Trades=[];}
var Low=Session.Low;var High=Session.High;if(Low||High){if(Low&&(!Min||Low.Price<Min)){Min=Low.Price;if(this._historical){MinPoint={x:this.tx(Low.Index/this._barSize),y:this.ty(Min)};}else{if(needsBump){MinPoint={x:this.tx(Low.Index+0.5),y:this.ty(Min)};}else{MinPoint={x:this.tx(Low.Index),y:this.ty(Min)};}}
SessionLowPoint.Index=Low.Index;SessionLowPoint.Price=Low.Price;SessionLowPoint.SessionIndex=i;}
if(High&&(!Max||High.Price>Max)){Max=High.Price;if(this._historical){MaxPoint={x:this.tx(High.Index/this._barSize),y:this.ty(Max)};}else{if(needsBump){MaxPoint={x:this.tx(High.Index+0.5),y:this.ty(Max)};}else{MaxPoint={x:this.tx(High.Index),y:this.ty(Max)};}}
SessionHighPoint.Index=High.Index;SessionHighPoint.Price=High.Price;SessionHighPoint.SessionIndex=i;}
if(Low&&(!LowPrice||Low.Price<LowPrice)){LowPrice=Low.Price;}
if(High&&(!HighPrice||High.Price>HighPrice)){HighPrice=High.Price;}}}
var UniqueHighPoint=null;var UniqueLowPoint=null;if(SessionHighPoint.Index!=null&&SessionHighPoint.Price!=null&&SessionHighPoint.SessionIndex!=null){if(SessionHighPoint.SessionIndex<Sessions.length&&SessionHighPoint.Index<Sessions[SessionHighPoint.SessionIndex].Trades.length){UniqueHighPoint=SessionHighPoint.Price;HighPrice=SessionHighPoint.Price;}}
if(SessionLowPoint.Index!=null&&SessionLowPoint.Price!=null&&SessionLowPoint.SessionIndex!=null){if(SessionLowPoint.SessionIndex<Sessions.length&&SessionLowPoint.Index<Sessions[SessionLowPoint.SessionIndex].Trades.length){UniqueLowPoint=SessionLowPoint.Price;LowPrice=SessionLowPoint.Price;}}
if(UniqueHighPoint!==null&&UniqueLowPoint!==null){if(SessionLowPoint.SessionIndex==SessionHighPoint.SessionIndex){if(SessionLowPoint.Index!==SessionHighPoint.Index){Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}}else
{Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}}else if(UniqueHighPoint!==null){Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}else if(UniqueLowPoint!==null){Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;}
return({Min:Min,Max:Max,Low:LowPrice,High:HighPrice,MinPoint:MinPoint,MaxPoint:MaxPoint});}};dojo.provide("dj.module.article.bluegrassUtil");
dojo.provide("BlueGrass");
var _userOffset = new Date().getTimezoneOffset() / 60;
BlueGrass = (BlueGrass)?BlueGrass:{};
BlueGrass.Utility = {
            arrayRemove: function(array, from, to) {
                // Array Remove - By John Resig (MIT Licensed)
                var rest = array.slice((to || from) + 1 || array.length);
                array.length = from < 0 ? array.length + from : from;
                return array.push.apply(array, rest);
                // End Array Remove

            },
            convertToExchangeTime: function(utcDateString, offset) {
                if (offset && offset !== 0) {
                    offset = offset + _userOffset;
                } else {
                    offset = 0; }
                var converted = parseInt(utcDateString, 10);
                if (isNaN(converted)) {
                    if (utcDateString.indexOf("-") >= 0 || utcDateString.indexOf("+") >= 0) {
                        utcDateString = utcDateString.substring(6, utcDateString.length - 7);
                        
                    } else {
                        utcDateString = utcDateString.substring(6, utcDateString.length - 2);
                    }
                    converted = parseInt(utcDateString, 10);
                }
                converted += 3600000 * offset;
                var dateTime = new Date(converted);
                return dateTime;
            },
            prettyDate: function(date, offset) {
                if (typeof (date) != "object")
                    { date = this.convertToExchangeTime(date, offset); }
                /*
                * Javascript Humane Dates
                * Copyright (c) 2008 Dean Landolt (deanlandolt.com)
                * Re-write by Zach Leatherman (zachleat.com)
                * 
                * Adopted from the John Resig's pretty.js
                * at http://ejohn.org/blog/javascript-pretty-date
                * and henrah's proposed modification 
                * at http://ejohn.org/blog/javascript-pretty-date/#comment-297458
                * 
                * Licensed under the MIT license.
                */

                //i modified the below script - it no longer adjusts based on timezone and
                //it just uses the date above instead of expecting a microformats formatted
                //date that it then create a date object with.
                var time_formats = [
                  [60, 'Just Now'],
                  [90, '1 Minute'], // 60*1.5
                  [3600, 'Minutes', 60], // 60*60, 60
                  [5400, '1 Hour'], // 60*60*1.5
                  [86400, 'Hours', 3600], // 60*60*24, 60*60
                  [129600, '1 Day'], // 60*60*24*1.5
                  [604800, 'Days', 86400], // 60*60*24*7, 60*60*24
                  [907200, '1 Week'], // 60*60*24*7*1.5
                  [2628000, 'Weeks', 604800], // 60*60*24*(365/12), 60*60*24*7
                  [3942000, '1 Month'], // 60*60*24*(365/12)*1.5
                  [31536000, 'Months', 2628000], // 60*60*24*365, 60*60*24*(365/12)
                  [47304000, '1 Year'], // 60*60*24*365*1.5
                  [3153600000, 'Years', 31536000], // 60*60*24*365*100, 60*60*24*365
                  [4730400000, '1 Century'] // 60*60*24*365*100*1.5
                ];

                var dt = new Date(),
                  seconds = (dt - date) / 1000,
                  token = ' Ago',
                  i = 0,
                  format;

                if (seconds < 0) {
                    seconds = Math.abs(seconds);
                    token = '';
                }

                while (format = time_formats[i++]) {
                    if (seconds < format[0]) {
                        if (format.length == 2) {
                            return format[1] + (i > 1 ? token : ''); // Conditional so we don't return Just Now Ago
                        } else {
                            return Math.round(seconds / format[2]) + ' ' + format[1] + (i > 1 ? token : '');
                        }
                    }
                }

                // overflow for centuries
                if (seconds > 4730400000)
                     { return Math.round(seconds / 4730400000) + ' Centuries' + token; }

                return date_str;
            }
        };
dojo.provide("dj.module.article.chart");
dojo.require("dj.module.marketdata.excanvas");
dojo.require("dj.module.marketdata.thunderball");
dojo.require("dj.module.marketdata.marketwatch");
dojo.require("dj.module.article.bluegrassUtil");

(function (exports) {
//-------------------

var WSJIndexChartStyle = {
  background : "#ffffff",
  border : "#E6E2D7",
  closelineStyle : "#e36825",
  horizontalGridLineStyle : "#f4f3f1",
  highIndicatorStyle : "#093c71",
  highlowLineStyle : "#015190",
  lowIndicatorStyle : "#093c71",
  mainLineStyle : "#557BA0",
  mainPriceLineFill : "rgba(85,123,160,0.15)",
  mainPriceLineWidth : 1,
  maxPriceLines : 4,
  verticalGridLineStyle : "rgba(180,201,202,0.5)",
  verticalGridLineStyle_Opaque : "rgba(180,201,202,1.0)",
  vPadding : 12,
  YAxisLabelStyle : 1, //High Low Price Close = 1
  YAxisLabelHeight : 12,
  showDecimals : 1,
  regionStyles : {
    0 : '#cde2e0', // Premarket
    1 : '#cde2e0', //Postmarket
    2 : 'rgba(51,51,51,0.06)'//Intersession
  },
  comparelineStyles : {
    0 : '#cc3333', //Strong red:
    1 : '#3b8dad', //Strong blue:
    2 : '#c9932e', //Strong yellow
    3 : '#b78383', //Weak red:
    4 : '#8eb3bc', //Weak blue:
    5 : '#dbb782' //Weak yellow:
  }
};

/**
 * EXPOSING OBJECTS
 */
exports.WSJIndexChartStyle = WSJIndexChartStyle;
exports.LegacyChart = LegacyChart;
exports.EmbeddedChart = EmbeddedChart;
exports.EmbeddedChartMDM = EmbeddedChartMDM;
exports.JSChart = JSChart;


function LegacyChart(container, legacyQueryString, width, height) {
  //var _chartBox = $(container);
  var _chartBox = dojo.byId(container);
  var _legacyQueryString = legacyQueryString;
  var _width = width;
  var _height = height;
  var _currentsymbol = null;

  var start = legacyQueryString.indexOf("symb=") + 5;
  var end = legacyQueryString.indexOf("&", start);
  if (end == -1) {
    _currentsymbol = legacyQueryString.substr(start).toUpperCase();
  } else {
    _currentsymbol = legacyQueryString.substr(start, end - start).toUpperCase();
  }

  var _showChart = function() {
    //_chartBox.html("");
    _chartBox.innerHTML = "";

    dojo.place('<img src="//www.marketwatch.com/charts/big.chart' + _legacyQueryString + '" />', _chartBox);
    //$('<img src="//www.marketwatch.com/charts/big.chart' + _legacyQueryString + '" />').appendTo(_chartBox).get(0);
    //_chartBox.innerHTML = "<img src=\"www.marketwatch.com/charts/big.chart\"" + _legacyQueryString + "\" />\"";
  };

  return {
    ShowChart : function(symbol) {
      if (symbol !== null && symbol != undefined && _currentsymbol != symbol.toUpperCase()) {
        _currentsymbol = symbol.toUpperCase();

        _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=");

        if (_currentsymbol.indexOf("US:CRUDE OIL - ELECTRONIC") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=");
          if (_legacyQueryString.indexOf("sid=") > -1) {
            _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=3343724");
          } else {
            _legacyQueryString = _legacyQueryString + "&sid=3343724";
          }
        } else if (_currentsymbol.indexOf("US:FUTURE-US-GOLD") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=");
          if (_legacyQueryString.indexOf("sid=") > -1) {
            _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=1782661");
          } else {
            _legacyQueryString = _legacyQueryString + "&sid=1782661";
          }
        } else if (_currentsymbol.indexOf("DX:DAX") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=");
          if (_legacyQueryString.indexOf("sid=") > -1) {
            _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=125284");
          } else {
            _legacyQueryString = _legacyQueryString + "&sid=125284";
          }
        } else {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=" + _currentsymbol);
        }
      }

      _showChart();
    },
    TickSubscribe : function() {
    },
    UpdateAllCharts : function(time, freq, startdate, enddate) {
      this.UpdateChart(time, freq, startdate, enddate);
    },
    UpdateChart : function(time, freq, startdate, enddate) {
      _legacyQueryString = _legacyQueryString.replace(/freq=[^&^\n]*/i, "freq=" + freq);

      if (time === null || time == undefined) {
        _legacyQueryString = _legacyQueryString.replace(/time=[^&^\n]*/i, "time=");
      } else {
        _legacyQueryString = _legacyQueryString.replace(/time=[^&^\n]*/i, "time=" + time);
      }

      if (startdate === null || startdate == undefined) {
        _legacyQueryString = _legacyQueryString.replace(/startdate=[^&^\n]*/i, "startdate=");
      } else {
        if (_legacyQueryString.indexOf("startdate=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/startdate=[^&^\n]*/i, "startdate=" + startdate);
        } else {
          _legacyQueryString = _legacyQueryString + "&startdate=" + startdate;
        }
      }

      if (enddate === null || enddate != undefined) {
        _legacyQueryString = _legacyQueryString.replace(/enddate=[^&^\n]*/i, "enddate=");
      } else {
        if (_legacyQueryString.indexOf("enddate=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/enddate=[^&^\n]*/i, "enddate=" + enddate);
        } else {
          _legacyQueryString = _legacyQueryString + "&enddate=" + enddate;
        }
      }

      _showChart();
    },
    ChangeSymbol : function(symbol) {
      var symbols = symbol.toUpperCase().split('|');

      _currentsymbol = symbols[0];
      _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=" + _currentsymbol);

      if (symbols.length > 1) {
        if (_legacyQueryString.indexOf("compidx=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/compidx=[^&^\n]*/i, "compidx=" + symbols[1]);
        } else {
          _legacyQueryString = _legacyQueryString + "&compidx=" + symbols[1];
        }
      } else {
        _legacyQueryString = _legacyQueryString.replace(/compidx=[^&^\n]*/i, "compidx=");
      }

      if (symbols.length > 2) {
        var comp = "";
        for ( var i = 2; i < symbols.length; i++) {
          if (comp.length > 0) {
            comp = comp + ",";
          }
          comp = comp + symbols[i];
        }
        if (_legacyQueryString.indexOf("comp=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/comp=[^&^\n]*/i, "comp=" + comp);
        } else {
          _legacyQueryString = _legacyQueryString + "&comp=" + comp;
        }
      } else {
        _legacyQueryString = _legacyQueryString.replace(/comp=[^&^\n]*/i, "comp=");
      }

      _showChart();
    },
    SetChartRefresh : function(rate) {
      setInterval(_showChart, rate);
    }
  }
}

var _PrevClose = 0; //Previous Close value for the index
var _isDEEdition = false;

//new method to take care of the Previous Close for various time (chart ranges)
function EmbeddedChartMDM(container, style, width, height, time, freq, startdate, enddate, chartdata, symbol, prevClose, isDEEdition) {
  _PrevClose = 0; //default value
  _PrevClose = prevClose;
  _isDEEdition = false; //default value
  _isDEEdition = isDEEdition;
  return new EmbeddedChart(container, style, width, height, time, freq, startdate, enddate, chartdata, symbol);
}

function EmbeddedChart(container, style, width, height, time, freq, startdate, enddate, chartdata, symbol) {
  var _chartBox = dojo.byId(container);
  var _style = style;
  var _width = width;
  var _height = height;
  var _time = time;
  var _freq = freq;
  var _startdate = startdate;
  var _enddate = enddate;
  var _pagedata = null;
  var _currentsymbol = null;
  var _firstsymbol = symbol;
  var _symbolCount = 0;
  var _chart = null;
  var _tick = false;
  var _ticktimeout = null;
  var _currentchannel = null;
  var _connection = null;
  var _url = "/Market/ECProxy/ChartData";

  var _setPageData = function(data) {
    if (data !== null && data != undefined && data.length > 0) {
      if (_pagedata === null) {
        _pagedata = [];
      }
      for ( var i = 0; i < data.length; i++) {
        if (data[i].Value !== null && data[i].Value != undefined && data[i].Key != '') {
          _pagedata[data[i].Key] = data[i].Value;
          if (_pagedata[data[i].Key].Data !== null) {
            for ( var j = 0; j < _pagedata[data[i].Key].Data.length; j++) {
              for ( var k = 0; k < _pagedata[data[i].Key].Data[j].Value.Sessions.length; k++) {
                var session = _pagedata[data[i].Key].Data[j].Value.Sessions[k];
                session.Start = new Date(Thunderball.Utilities.FormatDate(session.Start));
                session.Stop = new Date(Thunderball.Utilities.FormatDate(session.Stop));
              }
            }
          }
        }
      }
    }
  };

  var _showChart = function(symbol) {
    if (_pagedata === null) {
      _chart = new JSChart(_chartBox, symbol.split('|'), _width, _height, _style, _freq, _time, _startdate, _enddate,
          undefined, MarketWatch.getBaseUrl() + _url);
      _currentsymbol = symbol;
    } else {
      if (symbol != _currentsymbol) {
        if (_chart !== null) {
          _pagedata[_currentsymbol] = _chart.data;
          _chart.data = null;
          _chart = null;
        }
        var symbols = symbol.split('|');
        _chart = new JSChart(_chartBox, symbols, _width, _height, _style, _freq, _time, _startdate, _enddate,
            _pagedata[symbol], MarketWatch.getBaseUrl() + _url);
        _currentsymbol = symbol;
        _symbolCount = symbols.length;
      }
    }
  };

  _setPageData(chartdata);

  var _refreshPageData = function() {
    var symbols = [];
    for ( var symbol in _pagedata) {
      symbols.push(symbol);
    }
    _refreshData(symbols, "mo");
  };

  var _refreshData = function(symbols, cachekey) {
    requestObject = {
      freq : _freq,
      time : _time,
      Symbol : symbols,
      StartDate : _startdate,
      EndDate : _enddate,
      Width : _width,
      Height : _height,
      CacheKey : cachekey
    };

    dojo.rawXhrPost( {
      url : MarketWatch.getBaseUrl() + _url,
      postData : requestObject,
      handleAs : "json",
      load : function(response, ioArgs) {
        if (response !== null) {
          _setPageData(response);
          response = null;
          if (_chart !== null) {
            _chart.data = _pagedata[_currentsymbol];
            _chart._didLoad();
          }
        }

        return response;
      }
    });
    /*
     * $.ajax({ type: "POST", url: MarketWatch.getBaseUrl() + _url, dataType: "json", data: requestObject, success:
     * function(data) { if (data !== null) { _setPageData(data); data = null; if (_chart !== null) { _chart.data =
     * _pagedata[_currentsymbol]; _chart._didLoad(); } } } });
     */
    requestObject = null;
  };

  var _reloadChart = function() {
    if (_chart !== null) {
      _chart.time = _time;
      _chart.freq = _freq;
      _chart.startDate = _startdate;
      _chart.endDate = _enddate;
      _chart.reload();
    }
  }

  return {
    ShowChart : function(symbol) {
      if (symbol === undefined) {
        symbol = _firstsymbol;
      }

      symbol = symbol.toUpperCase();

      if (symbol != _currentsymbol) {
        if (_pagedata[symbol] !== null && _pagedata[symbol] !== undefined) {
          _showChart(symbol);
          return true;
        } else {
          return false;
        }
      }
    },
    
    TickUpdate : function(symbol, message) {
      if (_chart !== null && _chart.data !== null && _symbolCount == 1) {
        for ( var symbol in _pagedata) {
          for ( var i = 0; i < _pagedata[symbol].Data.length; i++) {
            if (_pagedata[symbol].Data[i].Value.BlueGrassChannel !== null
                && _pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase() == message.h.t) {
              if (symbol.toUpperCase() === _currentsymbol.toUpperCase()) {
                _chart.addTick(symbol, message.b.z, message.b.l, message.b.e);
              }
              break;
            }
          }
        }
      }
    },
    
    TickSubscribe : function() {
      if (_chart !== null) {
        _tick = true;

        var chartSubscribeCallback = function(message) {
          if (_chart !== null && _chart.data !== null && _symbolCount == 1) {
            for ( var symbol in _pagedata) {
              for ( var i = 0; i < _pagedata[symbol].Data.length; i++) {
                if (_pagedata[symbol].Data[i].Value.BlueGrassChannel !== null
                    && _pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase() == message.h.t) {
                  if (symbol.toUpperCase() === _currentsymbol.toUpperCase()) {
                    _chart.addTick(symbol, message.b.z, message.b.l, message.b.e);
                  }
                  break;
                }
              }
            }
          }
        };

        var chartConnectionCallback = function(connection, type) {
          if (type == "connect") {
            _connection = connection;
            if (_pagedata[_currentsymbol] !== null) {
              _currentchannel = _connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,
                  chartSubscribeCallback);
            }
          }
        };

        if (_currentchannel !== null) {
          _currentchannel.removeCallback(chartSubscribeCallback);
        }

        if (_connection !== null) {
          if (_pagedata[_currentsymbol] !== null) {
            _currentchannel = _connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,
                chartSubscribeCallback);
          }
        } else {
          if (BlueGrass !== null && BlueGrass.Runtime !== null) {
            BlueGrass.Runtime.openConnection( {}, chartConnectionCallback);
          }
        }
      }
    },
    UpdateAllCharts : function(time, freq, startdate, enddate) {
      if (_chart !== null) {
        this.UpdateChart(time, freq, startdate, enddate);
        setTimeout(_refreshPageData, 5);
      }
    },
    UpdateChart : function(time, freq, startdate, enddate) {
      if (_chart !== null) {
        _time = time;
        _freq = freq;
        _startdate = startdate;
        _enddate = enddate;

        _reloadChart();
      }
    },
    ChangeSymbol : function(symbol) {
      //symbol needs country code otherwise symbols like UK:VOD and US:VOD will be mixed up.
    if (_chart !== null) {
      _currentsymbol = symbol;
      _chart.setSymbols(symbol.split('|'));
      _symbolCount = _chart.symbols.length;
      _reloadChart();
    }
  },
  SetChartRefresh : function(rate) {
    setInterval(_refreshPageData, rate);
  }
  }
};

function JSChart(targetSelector, symbols, width, height, style, freq, time, startDate, endDate, data, url) {
  this.targetSelector = targetSelector;

  if (style === undefined) {
    this.style = LargeChartStyle;
  } else {
    this.style = style;
  }
  if (url !== undefined) {
    this.url = url;
  }

  this.width = width;
  this.height = height;

  this.symbols = symbols;
  this.selectedSymbol = symbols[0];

  if (freq === undefined) {
    this.freq = "1mi";
  } else {
    this.freq = freq;
  }

  if (time === undefined) {
    this.time = "1dy";
  } else {
    this.time = time;
  }

  if (startDate !== undefined) {
    this.startDate = startDate;
  }

  if (endDate !== undefined) {
    this.endDate = endDate;
  }

  var self = this;

  if (data === undefined) {
    $(function() {
      self.reload();
    });
  } else {
    self.preload(data);
  }
};

JSChart.prototype = {
  freq : "1mi",
  time : "1dy",
  unit : "Minute",
  url : "./HistoricChartData.aspx",
  span : 1,
  step : 1,
  startDate : '',
  endDate : '',
  data : null,
  selectedSymbol : null,
  width : 0,
  height : 0,
  drawingContext : null,
  style : null,
  highPrice : null,
  highPoint : {
    "x" : null,
    "y" : null
  },
  lowPoint : {
    "x" : null,
    "y" : null
  },
  lowPrice : null,
  lastPoint : {
    "x" : null,
    "y" : null
  },
  lastPrice : null,
  closePrice : null,

  buildRequest : function() {

    var requestObject;

    var symbol = "";
    for ( var i = 0; i < this.symbols.length; i++) {
      if (i > 0) {
        symbol += "|";
      }
      symbol += this.symbols[i];
    }

    requestObject = {
      freq : this.freq,
      time : this.time,
      Symbol : symbol,
      StartDate : this.startDate,
      EndDate : this.endDate,
      Width : this.width
    };

    return requestObject;
  },

  lastTickPrice : 0,
  lastTickChange : 0,
  lastTickX : 0,

  addTick : function(tickSymbol, Timestamp, Price, offSet) {
    var where = Thunderball.Utilities.addTick(this.data, tickSymbol, Timestamp, Price, offSet);

    if (where.Historical == false) {

      if (where.x === null) {
        // this.reload();
        return;
      } else {
        if (Price != this.lastTickPrice) {
          this.lastTickChange = Price - this.lastTickPrice;
          this.lastTickPrice = Price;
        } else if (where.x == this.lastTickX) {
          // same price, same x - don't redraw                
          return;
        }

        this.lastTickX = where.x;
        this._didLoad();
      }
    }
  },

  setSymbols : function(symbols) {
    this.symbols = symbols;

    this.selectedSymbol = symbols[0];
  },

  reload : function() {
    this._resetState();
    var d = new Date();
    var requestId = this.symbols[0] + d.getTime();

    this.requestId = requestId;

    Thunderball.Utilities.Requesters.push(this);
    Thunderball.Utilities.GetData(this);
  },

  preload : function(data) {
    this._resetState();
    this.data = data;
    this._didLoad();
  },

  _resetState : function() {
    this.lastTickPrice = this.lastTickChange = this.lastTickX = 0;
  },

  /* This method does DOM manipulation, so care is needed under IE */
  redraw : function() {

    this._prepareCanvas();
    this._clearLabels();

    var ctx = this.drawingContext;

    ctx.clearRect(0, 0, this.width, this.height);

    ctx.save();

    this._drawChartBackground();
    //this._debugTiming("drawChartBackground");

    var Data = Thunderball.Utilities._getSessionByTicker(this.data, this.selectedSymbol);

    if (Data !== null) {
      //this._debugTiming("init");
      for ( var i = 0; i < Data.length; i++) {
        this._drawRegions(Data[i]);
      }
      //this._debugTiming("drawRegions");
      if (this.style.type == 'Spark') {
        this._drawSpark(Data[Data.length - 1]);
      } else {
        this._determineTypeOfChart(Data);

        this._setHLC(Data);
        //this._debugTiming("setHLC");

        this._fillTrades(Data);
        //this._debugTiming("fillTrades");

        this._drawPriceLines();
        //this._debugTiming("drawPriceLines");

        this._createYAxisLabels(this.symbols.length);
        //this._debugTiming("createYAxisLabels");

        Thunderball.Utilities.addXAxisLabels(this);
        //this._debugTiming("addXaxisLabels");

        Thunderball.Utilities.drawXaxisLines(this);
        //this._debugTiming("drawXaxisLines");

        //this._strokeFillTrades(Data, this.style.mainLineStyle);
        //this._debugTiming("strokeFillTrades");

        this._drawCloseLines(Data);
        //this._debugTiming("drawCloseLines");

        var st = this.style;
        if (this.highPoint.y != this.lowPoint.y) {
          this._priceIndicator(this.highPoint, "", st.highIndicatorStyle, "chartPointer chartPoint-high", false);
          this._priceIndicator(this.lowPoint, "", st.lowIndicatorStyle, "chartPointer chartPoint-low", false);
        }

        this._priceIndicator(this.lastPoint, "", "", "lastLbl", true);
        //this._debugTiming("priceIndicator");

        if (this.symbols.length > 1) { //Do compare chart
          for ( var j = 1; j < this.symbols.length; j++) {

            var Session = Thunderball.Utilities._getSessionByTicker(this.data, this.symbols[j]);

            if (Session !== null) {
              //this._setSession(Session);
              var compareColor = 'black';
              if (j <= 6) {
                compareColor = this.style.comparelineStyles[j - 1];
              }
              this._strokeTrades(Session, compareColor);
            }
          }
        }

        this._strokeTrades(Data, this.style.mainLineStyle);
        //this._debugTiming("strokeTrades");

        //this._drawNewsOverlay(Data);                

        this._drawChartBorder();
        //this._debugTiming("drawChartBorder");

        if (this.highPoint.y != this.lowPoint.y) {
          this._drawHorizontalLine(this.highPoint.y);
          this._drawHorizontalLine(this.lowPoint.y);
          //this._debugTiming("drawHorizontalLine");
        }

        this.startTime = this.overallStartTime;

        //if (Data.length >= 1) {
        //this._debugTiming("Total (" + Data[0].Trades.length + " trades)");
        //}

      }
    }

    ctx.restore();
  },

  _x : 0,
  _xscale : 0,
  _y : 0,
  _yscale : 0,
  _bump : false,
  _fillStyle : 'black',
  _padding : 0,
  _events : [],
  _barFactor : 0,
  _barSize : 1,
  _priceLines : [],
  _timeLines : [],
  _opaqueTimeLines : [],
  _historical : false,
  _customDateRange : false,
  _chartUnit : 1,
  _displayUnit : 1,
  _xAxisLabels : [],

  _findOpaqueGridLines : function(time) {
    var xAxisInfo = this._xAxisLabels;
    var timeLines = this._timeLines;
    var data = this.data;
    var opaqueTimeLines = [];
    this._opaqueTimeLines = [];
    if (this._displayUnit === 1 || this._displayUnit === 2) {
      //if the label is a day label, we want the line to be opaque
      if(_isDEEdition){
        this._convertGridLinesForGermany(xAxisInfo, time, opaqueTimeLines);
      } else {
        for ( var i = 0; i < xAxisInfo.length; i++) {
            var patt = /^M$|^T$|^W$|^F$|^S$/;
            if (xAxisInfo[i].element.match(patt)) {
              opaqueTimeLines.push(xAxisInfo[i].x);
          }
      }
      }
    } else {
      for ( var i = 0; i < xAxisInfo.length; i++) {
        //if the label is a year label (when the label type is months), we want
        //the line to be opaque
        var patt = /^\d{2}$/;
        if (xAxisInfo[i].element.match(patt) && xAxisInfo[i].x !== (.5 * timeLines[0])) {
          opaqueTimeLines.push(xAxisInfo[i].x);
        }
      }
    }
    if (opaqueTimeLines.length > 0) {
      for ( var i = 0; i < opaqueTimeLines.length; i++) {
        this._opaqueTimeLines.push(opaqueTimeLines[i]);
      }
    }
  },

  _convertGridLinesForGermany : function(xAxisInfo, time, opaqueTimeLines) {
    var patt = /^M$|^T$|^W$|^F$|^S$/; //US week pattern
    var pattDE = /^M$|^D$|^F$|^S$/; //Germany week pattern
    if(time.toString()=="1dy"){ //charts for 1 day
      var xElement = "";
      var length = xAxisInfo.length; 
      for ( var i = 0; i < length; i++) {
        xElement = xAxisInfo[i];
        if(xElement!=undefined){
        //this case is usually for Forex and for some Future indexes
        if (length==1 && (xElement.element.match(patt) || xElement.element.match(pattDE))){
          this._convertGridLinesForGermany5dy(xAxisInfo, time, opaqueTimeLines);
          return;
        }
        var len =  xElement.element.length;
            var hour = xElement.element;
            var ap = xElement.element.substring(len-1);
            if((len==2 || len==3)&&(ap=="a" || ap==="p")){ //E.g.: 9a, 11a, 3p, 4p
              hour = xElement.element.substring(0,len-1); 
            }
            if(ap=="p" && hour!="12"){
              hour = parseFloat(hour) + parseFloat(12);
            } else if(hour.length==1){
              hour = "0"+hour;
            }
            //element details gets directly updated in 'xAxisInfo' array
            xElement.element=hour.toString();
        }
        } 
    } else if(time.toString()=="5dy"){  //charts for 5 days
      this._convertGridLinesForGermany5dy(xAxisInfo, time, opaqueTimeLines);
      return;   
    }
  },
  
  //data is received in a sequence - Monday to Saturday
  _convertGridLinesForGermany5dy : function(xAxisInfo, time, opaqueTimeLines) {
    //var patt = /^Mo$|^D$|^M$|^Do$|^F$|^Sa$/; //Germany week pattern - old
    var pattDE = /^M$|^D$|^F$|^S$/; //Germany week pattern
    var xElement = "";
    var length = xAxisInfo.length; 
    for ( var i = 0; i < length; i++) {
      xElement = xAxisInfo[i];
      if(xElement!=undefined){
          if(xElement.element=="M"){
            xElement.element="M"; //Monday
          } else if(xElement.element=="W"){
            xElement.element="M"; //Wednesday
          } else if(xElement.element=="F"){
            xElement.element="F"; //Friday
          } else if(xElement.element=="S"){
            xElement.element="S"; //Saturday
          } else if(xElement.element=="T"){
            xElement.element="D"; //Tuesday or Thursday
            
            /*Commented this code for old German week pattern
            //special case in 1dy charts
            if(length==1 && time.toString()=="1dy"){
              var timeS = this.data.Data[0].Value.Sessions[0].Stop.toString().toLowerCase();
              if(timeS.indexOf("tue")!=-1){
                xElement.element="D";
              } else if(timeS.indexOf("thu")!=-1){
                xElement.element="Do";
              }
            }             
            else if((i==0 && xAxisInfo[i+1].element=="W")
                || (i!=0 && (i+1)<=length && xAxisInfo[i-1].element=="Mo")){
              //if next = Wed or prev = Mon
              xElement.element="D"; //Tuesday
            } else if((i==0 && xAxisInfo[i+1].element=="F")
                || (i!=0 && (i+1)<=length && xAxisInfo[i-1].element=="M")){
              //if next = Fri or prev = Wed
              xElement.element="Do";  //Thursday
            }*/
            
          }
          if (xElement.element.match(pattDE)) {
            opaqueTimeLines.push(xElement.x);
      }
      }
    }
  },
  
  _didLoad : function() {
    if (!this.data)
      return;
    if (this.data.Error) {
      var target = this.targetSelector;
      var errorMessage = "<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>Error, the chart cannot be displayed.</div>";
      if (this.data.Error == "Error: Time") {
        errorMessage = "<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";
      }
      var ctx = this.drawingContext;
      if (ctx !== null) {
        ctx.clearRect(0, 0, this.width, this.height);
        this._clearLabels();
        dojo.place(errorMessage, target);
        //target.append(errorMessage);
      }
      return;
    }
    var data = this.data.Data;
    //only do this when there is a comparison chart
    if (data.length > 1) {
      var tradesExist = false;
      for ( var i = 0; i < data.length; i++) {
        var value = data[i].Value;
        var sessions = value.Sessions;
        for ( var j = 0; j < sessions.length; j++) {
          if (sessions[j].Trades.length > 0) {
            tradesExist = true;
            continue;
          }
        }
      }
      if (!tradesExist) {
        var target = this.targetSelector;
        var errorMessage = "<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";
        var ctx = this.drawingContext;
        if (ctx !== null) {
          ctx.clearRect(0, 0, this.width, this.height);
          this._clearLabels();
          dojo.place(errorMessage, target);
          //target.append(errorMessage);
        }
        return;
      }
    }
    this._barFactor = this.data.BarFactor;
    this._barSize = this.data.BarSize;
    this._chartUnit = this.data.xAxisLabelInfo.chartUnit;
    this._displayUnit = this.data.xAxisLabelInfo.displayUnit;
    this._timeLines = this.data.xAxisLabelsObj.timeLines;
    this._xAxisLabels = this.data.xAxisLabelsObj.ElementList;
    if (this._displayUnit === 1 || this._displayUnit === 2 || this._displayUnit === 3) {
      //only want opaque lines on hour, day, and month labeled charts
      this._findOpaqueGridLines(this.time);
    }
    this._customDateRange = this.data.CustomDateRange;

    try {
      for ( var j = 0; j < this.symbols.length; j++) {
        var Sessions = Thunderball.Utilities._getSessionByTicker(this.data, this.symbols[j]);
        if (Sessions !== null) {
          if (this.symbols.length > 1) {
            this._changeDataToPercentage(Sessions);
          }

          dojo.forEach(Sessions, function(Session, i) {

//                    $.each(Sessions, function(i, Session) {
              if (Session.Trades === undefined) {
                Session.Trades = [];
              }
              if (Session.Events === undefined) {
                Session.Events = [];
              }
              if (Session.News === undefined) {
                Session.News = [];
              }
              if (Session.Weight === undefined) {
                //alert();
            }
            if (Session.Start === undefined) {
              //alert();
            }
            if (Session.Stop === undefined) {
              // alert();
            }

            //format from string into JS datetime if needed
            var sessionStartFormat = Thunderball.Utilities.FormatDate(Session.Start);
            var sessionStopFormat = Thunderball.Utilities.FormatDate(Session.Stop);

            Session.Start = new Date(sessionStartFormat);
            Session.Stop = new Date(sessionStopFormat);
          });

          this._layoutSessions(Sessions);
        }
      }
    } catch (e) {
      //suppress for now
    }
    this._autoScale(this.data.Data, this.time);

    this.redraw();
  },

  _changeDataToPercentage : function(Sessions) {
    var basePrice = null;
    for ( var k = 0; k < Sessions.length; k++) {
      var trades = Sessions[k].Trades;
      for ( var l = 0; l < trades.length; l++) {
        if (trades[l] !== null && basePrice === null) {
          basePrice = trades[l];
          break;
        }
      }
      if (basePrice !== null) {
        break;
      }
    }
    if (basePrice !== null && basePrice > 0) {
      for ( var k = 0; k < Sessions.length; k++) {
        var trades = Sessions[k].Trades;
        for ( var l = 0; l < trades.length; l++) {
          if (trades[l] !== null) {
            trades[l] = 100 * ((trades[l] - basePrice) / basePrice);
          }
        }
        if (Sessions[k].Low !== null) {
          Sessions[k].Low.Price = 100 * ((Sessions[k].Low.Price - basePrice) / basePrice);
        }

        if (Sessions[k].High !== null) {
          Sessions[k].High.Price = 100 * ((Sessions[k].High.Price - basePrice) / basePrice);
        }
      }
    }
  },

  _drawHorizontalLine : function(y) {

    if (this.style.highlowLineStyle) {
      var ctx = this.drawingContext;
      this._bump = true;

      ctx.beginPath();
      ctx.lineWidth = 1;

      ctx.moveTo(0, y + 0.5);

      ctx.lineTo(this.width, y + 0.5);

      ctx.strokeStyle = this.style.highlowLineStyle;
      ctx.stroke();
    }
  },

  _priceIndicator : function(point, string, style, cssClass, lastPoint) {

    if (point.x === null || point.y === null) {
      return;
    }
    if (lastPoint) {
      if (point.x > this.width - 3) {
        point.x = this.width - 3;
      }

      var y = point.y - 10; //lastpoint animated gif is 20px height
      var x = point.x - 2;

      if (this.lastTickChange < 0) {
        lastPointIcon = "<div class='chartDownIndicator'></div>";
      } else if (this.lastTickChange > 0) {
        lastPointIcon = "<div class='chartUpIndicator'></div>";
      } else {
        lastPointIcon = "<div class='chartIndicator'></div>";
        y = point.y - 3;
      }

      //var elm = "<div style='position: absolute; top:" + y + "px;left:" + x + "px; ' class ='lastPointAnimated'>" + lastPointIcon + "</div>"
      //dojo.place(elm, this.targetSelector);
      //this.targetSelector.append(elm);
      return;

    } else {
      //this._drawRoundDot(style, point.x, point.y, 3);
    }
  },

  _createYAxisLabels : function(type) {

    if (!this.style.maxPriceLines)
      return;

    var decimalsToShow = 2;
    var YAxisContent = "";
    var displayValue = "";
    var x, y, p;

    var elmHeight = this.style.YAxisLabelHeight; //TODO get font size from style and choose elmHeight
    var excludeLabel = [];

    if (!this.style.yAxisLabelPadding) {
      this.style.yAxisLabelPadding = 2;
    }

    function addCommas(nStr) {
      nStr += '';
      x = nStr.split('.');
      x1 = x[0];
      x2 = x.length > 1 ? '.' + x[1] : '';
      var rgx = /(\d+)(\d{3})/;
      while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
      }
      return x1 + x2;
    }

    function decimalsNeeded(lineNum, range) {
      var Tol = 5.0e-6;
      if (range === 0 || lineNum === 0)
        return 0;
      var maxDecimals = 6;
      var division = range / lineNum;
      var decimals = 0;
      while (decimals <= maxDecimals) {
        var divtest = division * Math.pow(10, decimals);
        if (Math.abs(divtest - Math.round(divtest)) < Tol)
          break;
        //never display just one decimal place
        decimals += (decimals == 0) ? 2 : 1;
      }
      return decimals;
    }

    //determine if we need to show decimals
    if (this._priceLines.length > 1) {
      this._priceLines.sort(function(a, b) {
        return a - b
      });
      var firstValue = this._priceLines[0];
      var lastValue = this._priceLines[this._priceLines.length - 1];
      var diffValue = lastValue - firstValue;
      var totalNumber = this._priceLines.length - 1;

      if (this.style.showDecimals === 0) {
        decimalsToShow = 0;
      } else if (this.style.YAxisLabelStyle === 1) {
        if (lastValue < 10)
          decimalsToShow = 3;
        else if (lastValue < 100)
          decimalsToShow = 2;
        else
          decimalsToShow = 0;
      } else {
        decimalsToShow = decimalsNeeded(totalNumber, diffValue);
      }
    }

    try {
      var current = false;
      for ( var i = this._priceLines.length - 1; i >= 0; i--) {
        var drawLabel = true;
        p = this._priceLines[i];

        if (this._priceLines[i] === this.lastPrice) {
          y = (this.ty(p) - (elmHeight / 2) - 1); //vertical center label                
        } else if (this._priceLines[i] === this.highPrice) {
          y = (this.ty(p) - elmHeight);
        } else if (this._priceLines[i] === this.lowPrice) {
          y = this.ty(p) - 1;
        } else if (this._priceLines[i] === this.closePrice) {
          y = (this.ty(p) - (elmHeight / 2) - 1);
        } else {
          y = this.ty(p) - (elmHeight / 2);
        }
        //y = this.ty(p) - (elmHeight / 2); //vertical center label
        x = this.style.yAxisLabelPadding + this.width; //add padding between chart and label

        //loop through the other labels and find out if they overlap. Skip looping through labels that have already been excluded.

        //CG** Need to make sure that labels are not duplicated per Charles.
        //Several ways of doing this.

        if (this.style.YAxisLabelStyle === 1) {

          for ( var j = 0; j < this._priceLines.length; j++) {
            if (this._priceLines[i] != this.lastPrice && j != i && excludeLabel[j] != 1) {
              var cp = this._priceLines[j];
              if (this._priceLines[j] === this.lastPrice) {
                cy = (this.ty(cp) - (elmHeight / 2)) - 1;
              } else if (this._priceLines[j] === this.closePrice) {
                cy = (this.ty(cp) - (elmHeight / 2)) - 1;
              } else if (this._priceLines[j] === this.highPrice) {
                cy = (this.ty(cp) - elmHeight) - 1;
              } else if (this._priceLines[j] === this.lowPrice) {
                cy = this.ty(cp) - 1;
              } else {
                drawLabel = false;
              }
              if (Math.abs(Math.abs(cy) - Math.abs(y)) < elmHeight + 1) {
                //This can be commented back in, if we want the top line on the chart to display, even if it is the previous close. 
                //This line will make the highest line always display, unless the price line would have to be removed to accomodate it.
                //if (i != this._priceLines.length - 1 || this._priceLines[j] === this.lastPrice) {
                if (this._priceLines[j] != this.closePrice) {//never block due to the close price.
                  drawLabel = false;
                  excludeLabel[i] = 1;
                }
              }
            }
          }
        }

        if (type > 1) {//Percentage Labels
          displayValue = p.toFixed(decimalsToShow) + "%";
        } else { //Price Labels
          displayValue = p.toFixed(decimalsToShow);
        }

        //This is to handle different current price coloring for chartValueIndicators style charts.
        var labelClass = "priceLbl";

        if (this.style.YAxisLabelStyle === 1) {
          var width = 5; //Figure out something to do here so that this can be dynamic.
          if (this._priceLines[i] === this.lastPrice
              && (this._priceLines[i] >= this.closePrice || this.closePrice === null) && !current) {
            labelClass = "chartPointer chartLastPoint chartPoint-pos";
            current = true;
          } else if (this._priceLines[i] === this.lastPrice && this._priceLines[i] < this.closePrice && !current) {
            labelClass = "chartPointer chartLastPoint chartPoint-neg";
            current = true;
          } else if (this._priceLines[i] === this.lowPrice) {
            if (this.lowPrice === this.lastPrice && current) {
              drawLabel = false;
            }
            labelClass = "chartPointer chartPoint-low";

          } else if (this._priceLines[i] === this.highPrice) {
            if (this.highPrice === this.lastPrice && current) {
              drawLabel = false;
            }
            labelClass = "chartPointer chartPoint-high";

          } else if (this.closePrice && this._priceLines[i] === this.closePrice) {
            if (this.closePrice === this.lastPrice && current) {
              drawLabel = false;
            }
            labelClass = "chartPointer chartPoint-close";
          }
        }
        if (drawLabel === true && this.style.YAxisLabelStyle === 1) {
          YAxisContent = YAxisContent + "<div style='position: absolute; top:" + y + "px;left:" + x + "px; ' class='"
              + labelClass + "'>" + displayValue + "</div>";
        } else if (drawLabel === true) {
          YAxisContent = YAxisContent + "<div style='position: absolute; top:" + y + "px;left:" + x + "px; ' class='"
              + labelClass + "'>" + displayValue + "</div>"
        }
      }
    } catch (e) {
      //suppress for now
    }
    dojo.query('.chartPointer', this.targetSelector).orphan();
    dojo.query('.priceLbl', this.targetSelector).orphan();
    dojo.query('.xValueLbl', this.targetSelector).orphan();
    dojo.place(YAxisContent, this.targetSelector);
    //this.targetSelector.append(YAxisContent);
  },

  _determineTypeOfChart : function(Sessions) {

    if (Sessions.length >= 1 && Sessions[0].Regions.length >= 1) {
      var numberOfRegions = Sessions[0].Regions.length;

      if (numberOfRegions == 1 && Sessions[0].Regions[0].Type != 4) {
        this._historical = true;
      } else {
        this._historical = false;
      }
    }
  },

  _setHLC : function(Sessions) {

    this.lastPoint.x = null;
    this.lastPoint.y = null;
    this.lowPoint.x = null;
    this.lowPoint.y = null;
    this.highPoint.x = null;
    this.highPoint.y = null;

    var MinMax = this._getMinMax(Sessions, false);
    var needsBump = false;
    if (this.data.Data[0].Value.IsIndex === 1 && this._barSize === 60) {
      needsBump = true;
    }
    //Finds low from the min found in the _getMinMax function
    if (MinMax.MinPoint !== null || MinMax.Min !== null) {
      this.lowPoint = MinMax.MinPoint;
      //this.lowPrice = MinMax.Min.toFixed(decimalsToShow);
    }
    //Finds high from the max found in the _getMinMax function
    if (MinMax.MaxPoint !== null || MinMax.Max !== null) {
      this.highPoint = MinMax.MaxPoint;
      //this.highPrice = MinMax.Max.toFixed(decimalsToShow);
    }

    //Finds last price point in the last session's trade array.
    for ( var i = 0; i < Sessions.length; i++) {

      var Session = Sessions[i];
      this._setSession(Session);

      if (Session.Trades && Session.Trades.length !== 0) {

        var lastIndex = Session.Trades.length - 1;

        var price = Session.Trades[lastIndex];
        //if there is a price where at the last index of the trades array,
        //use that.
        if (price) {
          this.lastPoint.y = this.ty(price);
          if (this._historical) {
            this.lastPoint.x = this.tx(lastIndex / this._barSize);
          } else {
            if (needsBump) {
              this.lastPoint.x = this.tx(lastIndex + 0.5);
            } else {
              this.lastPoint.x = this.tx(lastIndex);
            }
          }
          //this.lastPrice = price.toFixed(decimalsToShow);
        } else { //If there isn't a price at the last index of the
          //trades array, must search for last price value
          for ( var j = lastIndex; j >= 0; j--) {

            price = Session.Trades[j];

            if (price) {
              this.lastPoint.y = this.ty(price);
              if (this._historical) {
                this.lastPoint.x = this.tx(j / this._barSize);
              } else {
                if (needsBump) {
                  this.lastPoint.x = this.tx(j + 0.5);
                } else {
                  this.lastPoint.x = this.tx(lastIndex);
                }

              }
              //this.lastPrice = price.toFixed(decimalsToShow);
              break;
            }
          }
        }
      }
    }
  },

  _drawRoundIndicator : function(color, x, y, circleSize) {
    if (x !== null && y !== null) {
      var ctx = this.drawingContext;

      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, 3, 0, Math.PI * 2, true);
      ctx.fill();

      ctx.strokeStyle = color;
      ctx.beginPath();
      ctx.save();
      ctx.lineWidth = 1.5;
      ctx.arc(x, y, circleSize, 0, Math.PI * 2, true);
      ctx.stroke();
      ctx.restore();
    }
  },

  _drawRoundDot : function(color, x, y, size) {
    if (x !== null && y !== null) {
      var ctx = this.drawingContext;

      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, size, 0, Math.PI * 2, true);
      ctx.fill();
    }
  },

  _drawNewsOverlay : function(Sessions) {
    this._bump = false;

    for ( var i = 0; i < Sessions.length; i++) {
      this._setSession(Sessions[i]);
      var news = Sessions[i].News;

      for ( var j = 0; j < news.length; j++) {
        var story = news[j];

        var x = this.tx(story.At);
        var p;

        /*
         * this does not display news stories that are published _before_ the first trade of the day
         */
        var Trades = Sessions[i].Trades;
        for ( var k = 0; k < Trades.length && k < story.At; k++) {
          if (Trades[k]) {
            p = Trades[k];
          }
        }

        if (p) {
          var newsLink = $('<a></a>').attr('href', story.Url);
          var icon = $('<img />').attr('border', 0).attr('src', this.style.newsBackground).attr('title', story.Text)
              .appendTo(newsLink);
        }
      }
    }
  },

  _drawPriceLines : function() {

    if (this.style.horizontalGridLineStyle) {
      var ctx = this.drawingContext;
      this._bump = true;

      ctx.beginPath();

      var ticks = this._priceLines;
      for ( var i = 0; i < ticks.length; i++) {
        var y = this.ty(ticks[i]);

        ctx.moveTo(0, y);
        ctx.lineTo(this.width, y);
      }

      ctx.strokeStyle = this.style.horizontalGridLineStyle;
      ctx.stroke();
    }
  },

  _drawChartBorder : function() {

    if (this.style.border) {

      var ctx = this.drawingContext;
      ctx.beginPath();
      ctx.strokeStyle = this.style.border;
      ctx.strokeRect(0, 0, this.width, this.height);
    }
  },

  _drawChartBackground : function() {

    if (this.style.background) {

      var ctx = this.drawingContext;
      ctx.beginPath();
      ctx.fillStyle = this.style.background;
      ctx.fillRect(0, 0, this.width, this.height);
    }
  },

  _drawCloseLines : function(Sessions) {
    var ctx = this.drawingContext;
    this._bump = true;

    var x = 0;

    ctx.beginPath();
    for ( var i = 0; i < Sessions.length; i++) {
      var session = Sessions[i];

      this._setSession(session);

      var w = session.SessionWidth;

      var x2 = x + w;

      if (session.PreviousClose !== undefined && session.PreviousClose !== null && (this.symbols.length == 1)) {
        var y = this.ty(session.PreviousClose);

        ctx.moveTo(x, y);
        ctx.lineTo(x2, y);
      }

      x = x2;
    }

    ctx.strokeStyle = this.style.closelineStyle;
    ctx.stroke();
  },

  _drawRegions : function(session) {
    var ctx = this.drawingContext;

    this._setSession(session);
    this._bump = false;

    for ( var i = 0; i < session.Regions.length; i++) {
      var Region = session.Regions[i];
      var Color = this._regionStyles[Region.Type];

      if (!Color || Color == this.style.background) {
        continue;
      }

      var x1 = this.tx(Region.Start);
      var x2;
      //only do comparison if it is the first region (premarket) and premarket is available
      if (i === 0 && this._barSize === 60 && (Region.Stop + Region.Start > 0)) {
        x2 = this.tx(Region.Stop + 0.5);
      } else {
        x2 = this.tx(Region.Stop);
      }

      ctx.fillStyle = Color;
      ctx.fillRect(x1, 0, x2 - x1, this.height);
    }
  },

  _buildTradePath : function(Sessions) {
    var ctx = this.drawingContext;
    var data = this.data;
    var isIndex = data.Data[0].Value.IsIndex;
    var first = true;
    var x = 0;
    var firstx;
    var prev = null;
    var last;
    for ( var i = 0; i < Sessions.length; i++) {
      var Session = Sessions[i];
      this._setSession(Session);

      //if (!this._historical) {
      //if (prev !== null && i !== Sessions.length - 1) {
      //ctx.lineTo(this.tx(0), this.ty(prev));
      //If we are not historical or the last session line to prevouse tick price
      //}
      //}

      if (Session.Trades) {

        for ( var j = 0; j < Session.Trades.length; j++) {
          var price = Session.Trades[j];

          if (price === null) {
            if (prev === null)
              continue;

            price = prev;
          }

          prev = price;

          var y = this.ty(price);
          if (this._historical) {
            x = this.tx(j / this._barSize);
          } else {
            if (isIndex === 1 && this._barSize === 60) {
              x = this.tx(j + 0.5);
            } else {
              x = this.tx(j);
            }
          }
          if (first) {
            firstx = x;
            ctx.moveTo(0, y);
            ctx.lineTo(firstx, y);
            first = false;
          } else {
            ctx.lineTo(x, y);
          }
        }
      }
    }

    return {
      firstx : firstx,
      lastx : x
    };
  },

  _strokeFillTrades : function(Sessions, strokeStyle) {
    var ctx = this.drawingContext;
    ctx.save();
    ctx.lineWidth = this.style.mainPriceLineWidth;
    ctx.strokeStyle = strokeStyle;
    ctx.beginPath();

    this._bump = true;

    var x = this._buildTradePath(Sessions);

    if (x.lastx != undefined && x.firstx != undefined) {
      ctx.stroke();
      ctx.lineTo(x.lastx, this.height);
      ctx.lineTo(0, this.height);

      ctx.fillStyle = this.style.mainPriceLineFill;
      ctx.fill();
    }

    ctx.restore();
  },

  _strokeTrades : function(Sessions, strokeStyle) {
    var ctx = this.drawingContext;
    ctx.save();
    ctx.miterLimit = 0; //limit chart spikes
    ctx.lineJoin = "round";
    ctx.lineWidth = this.style.mainPriceLineWidth;
    ctx.strokeStyle = strokeStyle;
    ctx.beginPath();

    this._bump = true;

    var x = this._buildTradePath(Sessions);

    ctx.stroke();
    ctx.restore();
  },

  _fillTrades : function(Sessions) {
    var ctx = this.drawingContext;
    ctx.fillStyle = this._fillStyle;
    ctx.beginPath();

    this._bump = false;

    var points = this._buildTradePath(Sessions);

    if (points.lastx != undefined && points.firstx != undefined) {
      ctx.lineTo(points.lastx, this.height);
      ctx.lineTo(0, this.height);
    }

    ctx.fill();
  },

  _precomputeStyles : function() {

    if (this.style.gradientFillStyle) {
      this._fillStyle = this._makeStyle(this.style.gradientFillStyle);
    }

    if (this.style.mainPriceLineFill) {
      this._fillStyle = this.style.mainPriceLineFill;
    }

    this._regionStyles = {};
    var styles = this.style.regionStyles;
    for ( var style in styles) {
      this._regionStyles[style] = this._makeStyle(styles[style]);
    }
  },

  _prepareCanvas : function() {
    if (!this.drawingContext || this.drawingContext === null) {
      var canvasWidth = this.width;
      var canvasHeight = this.height;
      this.targetSelector.innerHTML = "";
      //this.targetSelector.html(""); // clear target

      if (canvasWidth <= 0 || canvasHeight <= 0) {
        throw "Invalid dimensions - width = " + canvasWidth + ", height = " + canvasHeight;
      }

      // 01/15/2009 PTE - Change to work with IE 8 and excanvas.js revision 43.
      //var canvas = $('<canvas width="' + canvasWidth + '" height="' + canvasHeight + '"></canvas>').appendTo(this.targetSelector).get(0);

      var canvas = document.createElement('canvas');
      canvas.setAttribute('width', canvasWidth);
      canvas.setAttribute('height', canvasHeight);
      //this.targetSelector.get(0).appendChild(canvas); jquery to dojo
      dojo.place(canvas, this.targetSelector);

      if (!Thunderball.Utilities.check_canvas()) {
        canvas = window.G_vmlCanvasManager.initElement(canvas, canvasWidth, canvasHeight);
      }

      this.drawingContext = canvas.getContext("2d");
    }

    this._precomputeStyles();
  },

  orphan : function(node) {
    node.parentNode.removeChild(node);
  },

  _clearLabels : function() {
    var label = dojo.query(" > div", this.targetSelector);
    //if(label) { this.orphan(label); }
    //if(label) { label.orphan(); }
    //$(this.targetSelector).children("div").remove();
  },

  _layoutSessions : function(Sessions) {
    var TotalSessionWeight = 0;
    dojo.forEach(Sessions, function(value, index) {
      TotalSessionWeight += value.Weight;
    });
    /*
     * $.each(Sessions, function(i, s) { TotalSessionWeight += s.Weight; });
     */
    var x = 0;

    for ( var i = 0; i < Sessions.length; i++) {
      var Session = Sessions[i];

      var SessionWidth;
      SessionWidth = Math.floor(this.width * Session.Weight / TotalSessionWeight);
      Session.SessionWidth = SessionWidth;

      // All sessions are the same width
      Session._x = x;
      x += SessionWidth;

      // Get the scale factor
      var SessionStart = Session.Start.getTime();
      var SessionStop = Session.Stop.getTime();

      var SessionTime = SessionStop - SessionStart;

      Session._xscale = SessionWidth * this._barFactor / (SessionTime);
    }
  },

  _autoScale : function(Data, time) {
    var Min = null;
    var Max = null;
    var High = null;
    var Low = null;
    var Close = null;

    var self = this;

    //this._debugTimingInit();

    var chartValueIndicators = this.style.YAxisLabelStyle;
    //     try {
    //$.each(Data, function(i, Sessions) {
    dojo.forEach(Data, function(Sessions, i) {

      var includePreviousClose = true;

      //for charts with more than one symbol or charts in which there are no session values and no previous close
        //values defined, we should not include the previous close line.
        if (self.symbols.length > 1 || Sessions.Value === undefined || Sessions.Value.Sessions === undefined
            || Sessions.Value.Sessions.length < 1 || Sessions.Value.Sessions[0].PreviousClose === undefined
            || Sessions.Value.Sessions[0].PreviousClose === null) {
          includePreviousClose = false;
        }

        // Do y-axis scaling
        var MinMax = self._getMinMax(Sessions.Value.Sessions, includePreviousClose);

        //Collect the high and low for the MarketOverview. Set the previous close if we are using it. 
        if (chartValueIndicators === 1) {
          self._determineLastTrade(Sessions.Value.Sessions[Sessions.Value.Sessions.length - 1].Trades);
          //the only chart that uses previous close is the market overview. Check here
          //to see if the other requirements are met for using the previous close price
          Low = MinMax.Low;
          High = MinMax.High;

          if (includePreviousClose && time=="1dy") { //existing logic as per time=1dy
            Close = Sessions.Value.Sessions[0].PreviousClose;
            self.closePrice = Close;
          } 
          else if(!includePreviousClose && time!="1dy"){            
            //for 5dy, 1mo, 3mo, 6mo and 1yr chart ranges
            if(_PrevClose!=null && _PrevClose>=0){
              Close = _PrevClose;
              self.closePrice = Close;
            }
          }
        }
        if (!Min || MinMax.Min < Min) {
          Min = MinMax.Min;
        }
        if (!Max || MinMax.Max > Max) {
          Max = MinMax.Max;
        }
      });

    function dStart() {
      this.value = 0;
    }

    function dFinish() {
      this.value = 0;
    }

    if (this.style.maxPriceLines >= 1) {

      var dFinishObj = new dFinish();
      var dStartObj = new dStart();

      var scale = Thunderball.ChartScalingV2.CalculateDelta2(this.style.maxPriceLines, false, true, Min, Max,
          dStartObj, dFinishObj);

      if (dStartObj.value < 0 && self.symbols.length === 1) {
        scale = Thunderball.ChartScalingV2.CalculateDelta2(Math.round(this.style.maxPriceLines / 2), false, true, Min,
            Max, dStartObj, dFinishObj);
      }

      if (chartValueIndicators === 1) {

        //if both high and low are null and close is not null,
        //set the max and min values to an offset of the close price.
        //If the close price is also null, then the max and min should be 1 and 0
        //respectively.
        if (High === null && Low === null) {
          if (close !== null) {
            Max = Close + (Close * .01);
            Min = Close - (Close * .01);
          } else {
            Max = 1;
            Min = 0;
          }
        }

        //Min = Math.min(Min, dStartObj.value);
        //Max = Math.max(Max, dFinishObj.value);               

        this._priceLines = [];
        var ticks = this._priceLines;

        //If this is the MarketOverview, we will set the price lines to High, Low and Prev Close if it is available. 
        if (Low !== null) {
          ticks.push(Low);
          this.lowPrice = Low;
        }
        if (this.lastPrice !== null) {
          ticks.push(this.lastPrice);

        }
        //push close onto array of pricelines only if it is not undefined or null
        if ((!(Close === undefined || Close === null))) {
          ticks.push(Close);

          if (High !== null) {
            ticks.push(High);
            this.highPrice = High;
          }
        } else {
          if (High !== null) {
            ticks.push(High);
            this.highPrice = High;
          }
        }
        //if the chart is a non-market overview chart, get the scaling from the Thunderball.js
        //function objects of dStartObj and dFinishObj.
      } else {

        Min = Math.min(Min, dStartObj.value);
        Max = Math.max(Max, dFinishObj.value);

        this._priceLines = [];
        var ticks = this._priceLines;

        if (scale > 0) {
          for ( var p = dStartObj.value; p <= dFinishObj.value + ((dFinishObj.value - dStartObj.value) * .05); p += scale) {
            ticks[ticks.length] = p;
          }
        }
      }
    }
    // }
    // catch (e) {
    //suppress for now
    // }

    var pad = this.style.vPadding;
    var height = this.height - 2.0 * pad;

    //final check to prevent dividing by zero
    if (Max - Min === 0) {

      if (Max < Min) {
        var Tmp = Min;
        Min = Max;
        Max = Tmp;
      }

      var Max = Math.abs(Max);
      if (Max == 0)
        Max = 1;

      if (Max < 0)
        Max = 0;
      else if (Max == 0)
        Max = 1;
      else
        Min = 0;
    }

    this._yscale = -height / (Max - Min);
    this._y = height - Min * this._yscale + pad;

  },

  _setSession : function(session) {
    this._xscale = session._xscale;
    this._x = session._x;
  },

  tx : function(x) {
    if (!this._x) {
      this._x = 1;
    }
    if (!this._xscale) {
      this._xscale = 1;
    }
    return Math.floor(this._xscale * x + this._x) + (this._bump ? 0.5 : 0);
  },

  ty : function(y) {
    return Math.floor(this._yscale * y + this._y) + (this._bump ? 0.5 : 0);
  },

  _makeStyle : function(spec) {
    var steps = spec.split('-');

    if (steps.length == 2) {
      var gradient = this.drawingContext.createLinearGradient(0, 0, 0, this.height);
      gradient.addColorStop(0, steps[0]);
      gradient.addColorStop(1, steps[1]);
      return gradient;
    } else {
      return spec;
    }
  },

  _determineLastTrade : function(Trades) {

    var latestPrice = null;
    for ( var k = Trades.length - 1; k >= 0 && latestPrice === null; k--) {
      if (Trades[k]) {
        latestPrice = Trades[k];
      }
    }
    this.lastPrice = latestPrice;
  },

  _getMinMax : function(Sessions, IncludePreviousClose) {
    var MinPoint;
    var MaxPoint;
    var Min;
    var Max;
    var LowPrice;
    var HighPrice;
    var SessionHighPoint = {
      Index : null,
      Price : null,
      SessionIndex : null
    };
    var SessionLowPoint = {
      Index : null,
      Price : null,
      SessionIndex : null
    };

    if (IncludePreviousClose && Sessions[0].PreviousClose !== null) {
      Max = Min = Sessions[0].PreviousClose;
    }

    var needsBump = false;
    if (this.data.Data[0].Value.IsIndex === 1 && this._barSize === 60) {
      needsBump = true;
    }
    //walk through each session to find the high and the low
  for ( var i = 0; i < Sessions.length; i++) {
    var Session = Sessions[i];

    this._setSession(Session);

    if (!Session.Trades) {
      Session.Trades = [];
    }

    // get market hours high low
    var Low = Session.Low;
    var High = Session.High;

    if (Low || High) {
      if (Low && (!Min || Low.Price < Min)) {
        Min = Low.Price;
        if (this._historical) {
          MinPoint = {
            x : this.tx(Low.Index / this._barSize),
            y : this.ty(Min)
          };
        } else {
          if (needsBump) {//TODO handle this on server
            MinPoint = {
              x : this.tx(Low.Index + 0.5),
              y : this.ty(Min)
            };
          } else {
            MinPoint = {
              x : this.tx(Low.Index),
              y : this.ty(Min)
            };
          }
        }
        SessionLowPoint.Index = Low.Index;
        SessionLowPoint.Price = Low.Price;
        SessionLowPoint.SessionIndex = i;
      }
      if (High && (!Max || High.Price > Max)) {
        Max = High.Price;
        if (this._historical) {
          MaxPoint = {
            x : this.tx(High.Index / this._barSize),
            y : this.ty(Max)
          };
        } else {
          if (needsBump) {
            MaxPoint = {
              x : this.tx(High.Index + 0.5),
              y : this.ty(Max)
            };
          } else {
            MaxPoint = {
              x : this.tx(High.Index),
              y : this.ty(Max)
            };
          }
        }
        SessionHighPoint.Index = High.Index;
        SessionHighPoint.Price = High.Price;
        SessionHighPoint.SessionIndex = i;
      }

      if (Low && (!LowPrice || Low.Price < LowPrice)) {
        LowPrice = Low.Price;
      }
      if (High && (!HighPrice || High.Price > HighPrice)) {
        HighPrice = High.Price;
      }
    }
  }

  var UniqueHighPoint = null;
  var UniqueLowPoint = null;

  //Insert highest and lowest points on the chart line. 
  if (SessionHighPoint.Index !== null && SessionHighPoint.Price !== null && SessionHighPoint.SessionIndex !== null) {

    if (SessionHighPoint.SessionIndex < Sessions.length
        && SessionHighPoint.Index < Sessions[SessionHighPoint.SessionIndex].Trades.length) {
      UniqueHighPoint = SessionHighPoint.Price;
      HighPrice = SessionHighPoint.Price;
    }
  }

  if (SessionLowPoint.Index !== null && SessionLowPoint.Price !== null && SessionLowPoint.SessionIndex !== null) {

    if (SessionLowPoint.SessionIndex < Sessions.length
        && SessionLowPoint.Index < Sessions[SessionLowPoint.SessionIndex].Trades.length) {
      UniqueLowPoint = SessionLowPoint.Price;
      LowPrice = SessionLowPoint.Price;
    }
  }

  //check if we have a high and low point value
  if (UniqueHighPoint !== null && UniqueLowPoint !== null) {
    //check if they are in the same session.
    if (SessionLowPoint.SessionIndex == SessionHighPoint.SessionIndex) {
      //if low and high are in the same interval don't plot either on the chart line.
      if (SessionLowPoint.Index !== SessionHighPoint.Index) {
        Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index] = UniqueLowPoint;
        Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index] = UniqueHighPoint;
      }
    } else//if not in the same session plot points
    {
      Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index] = UniqueLowPoint;
      Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index] = UniqueHighPoint;
    }
  } else if (UniqueHighPoint !== null) {
    Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index] = UniqueHighPoint;
  } else if (UniqueLowPoint !== null) {
    Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index] = UniqueLowPoint;
  }

  return ( {
    Min : Min,
    Max : Max,
    Low : LowPrice,
    High : HighPrice,
    MinPoint : MinPoint,
    MaxPoint : MaxPoint
  });
}
};


//-------------------
}(window));
dojo.provide("dj.widget.article.ArticleTickerPopUpView");
dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");
dojo.require("dj.lang");
dojo.require("dj.module.article.chart");
dojo.require("dojo.date");


dojo.declare("dj.widget.article.ArticleTickerPopUpView", [], {
  DEFAULT_CONFIG : {},
  constructor: function(container, args, callback) {
    this.conf = {
        tickerName: "",
        country: "",
        baseClass : "inlineTicker",
        tooltipIdPrefix : "tickerTooltip_",
        fragmentUrl : '/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?ticker=',
        TTL: "1m",
        version: 6,
        containerId: "",
        realTimeChannel : "",
        delayedChannel : "",
        chartRefreshTimeout : 180000
    };
    _djl = dj.lang;

    if(_djl.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
        '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
        '#default#VML');
      } 
    }
    dojo.mixin(this.conf, args);
    this.hidePopupTimeout = 150;
    this.insidePopup = false;
    this.insideTicker = false;
    this.container = container;
    this.loader = new dj.widget.fragmentloader.FragmentJSONLoader(this.conf.fragmentUrl + this.conf.tickerName + "&country=" + this.conf.country, 
        this.conf.version, {TTL: this.conf.TTL});
    this._connectToLoaderEvents(callback);
    this.loader.load();

  },

  _connectToLoaderEvents: function(callback) {
    dojo.connect(this.loader, "onLoadJson", dojo.hitch(this, function(data){
      this.createTooltip(data.jsonFile.data, callback);
    }));
  },

  createTooltip: function(data, callback) {
    if(dojo.trim(data) === '') {
      return;
    }
    this.random = Math.abs(Math.random() * 100);
    this.tooltip = new dijit.TooltipDialog({
      id: this.conf.tooltipIdPrefix + this.conf.tickerName + this.random,
      content: data,
      baseClass: this.conf.baseClass,
      onMouseLeave: dojo.hitch(this, function(){
        this.insidePopup = false;
        setTimeout(dojo.hitch(this,this.close), this.hidePopupTimeout);
      }),
      onMouseEnter: dojo.hitch(this, function(){
        this.insidePopup = true;
      })
    });

    this.show();
    this.removeOwnArticle();

    this.drawChart();
    this.setChartRefreshTimer();

    if(callback && typeof callback === "function") {
      callback();
    }
  },

  removeOwnArticle : function() {
    if(AT_VARS && AT_VARS.baseDocId) {
      dojo.query("[data-widget='dj.article'][data-doc-id='"+AT_VARS.baseDocId+"']", this.tooltipContainer).orphan();
    }
  },

  show: function() {
    if(this.open) {
      return;
    }
    this.open = true;
    if(!this.tooltip || this.tooltip === 'undefined') {
      return;
    }
    dijit.popup.open({
      popup: this.tooltip,
      around: this.container
    });

    if(!this.tooltipContainer) {
      this.tooltipContainer = dojo.byId(this.conf.tooltipIdPrefix + this.conf.tickerName + this.random);
    } 

    if(!this.chartContainerId) {
      this.chartContainerId = 'chart_' + this.conf.tooltipIdPrefix + this.conf.tickerName + this.random;
      dojo.query('.tkrChartC', this.tooltipContainer)[0].id = this.chartContainerId;
    }

    if(!this.tickerSymbol) {
      this.tickerSymbol = dojo.query('.tkrPriceSign', this.tooltipContainer);
    }
    if(this.tickerSymbol) {
      dojo.forEach(this.tickerSymbol, dojo.hitch(this,function(obj){ obj.innerHTML = this.container.getAttribute('data-iso');}));
    }  
    
  },
  
  showHideAfterHours:function(afterHourShowHide){    
      var afterHourModuleArr = dojo.query(".tkrValueAfter", this.tooltipContainer);
      var afterHourModule = afterHourModuleArr.length > 0 ? afterHourModuleArr[0] : null;
      if(afterHourShowHide === "show"){
        if(afterHourModule && dojo.hasClassName(afterHourModule, "hidden") ){
           dojo.removeClass(afterHourModule, "hidden");
        }        
      }else if(afterHourShowHide === "hide"){
        if(afterHourModule && !dojo.hasClassName(afterHourModule, "hidden") ){
          dojo.addClass(afterHourModule, "hidden");
       }
      }
  },

  render: function(data) {
    var cssClass = "Neutral";
    var symbol = '';
    var previousClose = 0.00;
    var percentChange = 0.00;
    var last = data.b.l;
    var theDate = "";
    var change = 0.00;
    if(data && data.b) { 
      cssClass = (data.b.c >= 0) ? 'Positive':'Negative';
      symbol = (data.b.c >= 0) ? '+':'';
      if(data.b.c === 0) {
        cssClass = 'Neutral';
        symbol = '';
      }
      previousClose = this.container.getAttribute('data-pc');
      percentChange = (data.b.c / previousClose) * 100 ;
      if(isNaN(percentChange)) {
        percentChange = 0.00;
        cssClass = 'Neutral';
        symbol = '';
      }
      last = data.b.l;
      change = data.b.c;
      theDate = data.b.z;
      if(theDate.indexOf('/Date') !== -1) {
        var offset = this.container.getAttribute('data-offset');
        offset = parseFloat(offset);
        var userOffset = new Date().getTimezoneOffset() / 60;
        offset = offset + userOffset;
        var dateObj = new Date(parseInt(theDate.replace(/[^0-9]/g,''), 10));
        dateObj = dojo.date.add(dateObj, "hour", offset);
        theDate = dj.util.Date.simpleDateFormat.format(dateObj, 'NNN d, yyyy h:mm a ');
      }
    } else {
      return;
    }
	
	var infoLast = last;
	var infoChg = change;
	var ex = dj.module.article.ticker.conf.noDecimalExchange;
	
	if(!ex || (ex && dojo.indexOf(ex,this.container.getAttribute('data-exchange-iso')) === -1)) {
		infoLast = last.toFixed(2);
		infoChg = change.toFixed(2);
	}

    var info = {last: infoLast, change: infoChg, previousClose: previousClose, percentChange: percentChange, date: theDate, symbol: symbol, cssClass: cssClass};
    if(data && data.b && data.b.y) {
      if(data.b.y === 'premarket') {
        if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
          this.callType = "premarket";
        }
      }else if(data.b.y === 'normal') {        
        if(this.callType !== null && typeof this.callType !== "undefined" && this.callType === "premarket" ){
          console.log("BlueGrass market transitioned for " + data.h.t);
          this.showHideAfterHours("hide");
          this.drawChart();
        }
        this.callType = "normal";
        // update the normal hour
        if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
          this.updateNormalValues(info);
        }
        if(data.b.v) {
          this.updateNormalVolume(data.b.v);
        }
        this.updateChartTick(data);
      } else if(data.b.y === 'aftermarket') { 
          this.callType = "aftermarket";
          // update after market
          if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
            this.updateAfterMarketValues(info);
          }
          if(data.b.v) {
            this.updateAfterMarketVolume(data.b.v);
          }
          this.updateChartTick(data);
      }      
      
    }
  },

  updateNormalValues: function(data) {
    // Price
    if(!this.normalPrice) {
      this.normalPrice = dojo.query('.tkrModTop .tkrPriceNumber', this.tooltipContainer)[0];
    }
    if(this.normalPrice){
      this.normalPrice.innerHTML = data.last;
    }

    // Change and Percent Change
    if(!this.normalChange) {
      this.normalChange = dojo.query('.tkrModTop .tkrPriceValue', this.tooltipContainer)[0];
    }
    if(this.normalChange){
      dojo.removeClass(this.normalChange, 'tkrPriceValueNeutral');
      dojo.removeClass(this.normalChange, 'tkrPriceValuePositive');
      dojo.removeClass(this.normalChange, 'tkrPriceValueNegative');
      dojo.addClass(this.normalChange, 'tkrPriceValue' + data.cssClass);
      this.normalChange.innerHTML = data.symbol + data.change + " " + data.symbol + data.percentChange.toFixed(2) + "%";
    }
    // Arrow
    if(!this.normalArrow) {
      this.normalArrow = dojo.query('.tkrModTop .tkrPriceArrow', this.tooltipContainer)[0];
    }
    if(this.normalArrow) {
      dojo.removeClass(this.normalArrow, 'tkrPriceArrowNeutral');
      dojo.removeClass(this.normalArrow, 'tkrPriceArrowPositive');
      dojo.removeClass(this.normalArrow, 'tkrPriceArrowNegative');
      dojo.addClass(this.normalArrow, 'tkrPriceArrow' + data.cssClass);
    }

    // Date
    if(!this.normalDate) {
      this.normalDate = dojo.query('.tkrModTop .tkrVolumeDate', this.tooltipContainer)[0];
    }
    if(this.normalDate) {
      this.normalDate.innerHTML = data.date;
    }
  },

  updateNormalVolume: function(volume) {
    if(!this.normalMarketVolume) {
      this.normalMarketVolume = dojo.query('.tkrModTop .tkrVolumeNum .tkrStrong', this.tooltipContainer)[0];
    }
    if(this.normalMarketVolume) {
      this.normalMarketVolume.innerHTML = this.setVol(volume);
    }
  },

  updateAfterMarketValues: function(data) {
    // Price
    if(!this.afterMarketPrice) {
      this.afterMarketPrice = dojo.query('.tkrModAfter .tkrPriceNumber', this.tooltipContainer)[0];
    }
    if(this.afterMarketPrice) {
      this.afterMarketPrice.innerHTML = data.last;
    }

    // Change and Percent Change
    if(!this.afterMarketChange) {
      this.afterMarketChange = dojo.query('.tkrModAfter .tkrPriceValue', this.tooltipContainer)[0];
    }
    if(this.afterMarketChange) {
      dojo.removeClass(this.afterMarketChange, 'tkrPriceValueNeutral');
      dojo.removeClass(this.afterMarketChange, 'tkrPriceValuePositive');
      dojo.removeClass(this.afterMarketChange, 'tkrPriceValueNegative');
      dojo.addClass(this.afterMarketChange, 'tkrPriceValue' + data.cssClass);
      this.afterMarketChange.innerHTML = data.symbol + data.change.toFixed(2) + " " + data.symbol + data.percentChange.toFixed(2) + "%";
    }

    // Arrow
    if(!this.afterMarketArrow) {
      this.afterMarketArrow = dojo.query('.tkrModAfter .tkrPriceArrow', this.tooltipContainer)[0];
    }
    if(this.afterMarketArrow) {
      dojo.removeClass(this.afterMarketArrow, 'tkrPriceArrowNeutral');
      dojo.removeClass(this.afterMarketArrow, 'tkrPriceArrowPositive');
      dojo.removeClass(this.afterMarketArrow, 'tkrPriceArrowNegative');
      dojo.addClass(this.afterMarketArrow, 'tkrPriceArrow' + data.cssClass);
    }

    // Date
    if(!this.afterMarketDate) {
      this.afterMarketDate = dojo.query('.tkrModAfter .tkrVolumeDate', this.tooltipContainer)[0];
    }
    if(this.afterMarketDate) {
      this.afterMarketDate.innerHTML = data.date;
    }
  },

  updateAfterMarketVolume: function(volume) {
    /* It looks like we dont update volume for after hours from bluegrass
     * Bluegrass is returning the same number for after hours volume
    if(!this.afterMarketVolume) {
      this.afterMarketVolume = dojo.query('.tkrModAfter .tkrVolumeNum .tkrStrong')[0];
    }
    this.afterMarketVolume.innerHTML = this.setVol(volume);
     */
  },  

  drawChart: function() {
    var WSJIndexChartStyle = {
        background : "#ffffff",
        border : "#E6E2D7",
        closelineStyle : "#e36825",
        horizontalGridLineStyle : "#f4f3f1",
        highIndicatorStyle : "#093c71",
        highlowLineStyle : "#015190",
        lowIndicatorStyle : "#093c71",
        mainLineStyle : "#557BA0",
        mainPriceLineFill : "rgba(85,123,160,0.15)",
        mainPriceLineWidth : 1,
        maxPriceLines : 4,
        verticalGridLineStyle : "rgba(180,201,202,0.5)",
        verticalGridLineStyle_Opaque : "rgba(180,201,202,1.0)",
        vPadding : 12,
        YAxisLabelStyle : 0, //High Low Price Close = 1
        YAxisLabelHeight : 12,
        showDecimals : 1,
        regionStyles : {
          0 : '#cde2e0', // Premarket
          1 : '#cde2e0', //Postmarket
          2 : 'rgba(51,51,51,0.06)'//Intersession
        },
        comparelineStyles : {
          0 : '#cc3333', //Strong red:
          1 : '#3b8dad', //Strong blue:
          2 : '#c9932e', //Strong yellow
          3 : '#b78383', //Weak red:
          4 : '#8eb3bc', //Weak blue:
          5 : '#dbb782' //Weak yellow:
        }
    };
    
    //this.chartSymbol = this.conf.country+":"+this.container.getAttribute('data-ticker');
    
    this.chartSymbol = "/"+this.conf.country+"/"+this.container.getAttribute("data-exchange-iso")+"/"+this.container.getAttribute('data-ticker');  
    
    dojo.xhrPost({
      url : '/thunderball/HistoricChartData.aspx',
      handleAs : 'json',
      load : dojo.hitch(this, function(response, xhr){
        var chartData = response;

        this.chart = new EmbeddedChart(this.chartContainerId, WSJIndexChartStyle,
            234, 92, null, null,null,null, chartData, this.chartSymbol , '');

        this.chartExists = this.chart.ShowChart();
      }),
      content : {
        Symbol : this.chartSymbol,
        Width : 234,
        freq : "1mi",
        time : "1dy"
      },
      error : function(error, ioArgs) {
        console.error("MarketBannerTickers - Error on loading charts");
        console.log(error);
        console.log(ioArgs);
      }
    });
  },

  setChartRefreshTimer:function(){
    setTimeout(dojo.hitch(this,function(){
      this.drawChart();
      this.setChartRefreshTimer();
    }), this.conf.chartRefreshTimeout, null);
  },

  updateChartTick: function(data) {
    if(this.chartExists && this.chart && typeof this.chart.TickUpdate === "function" ) {
      this.chart.TickUpdate(this.chartSymbol, data);
    }
  },

  close: function() {
    if(!this.insidePopup && !this.insideTicker) {
      this.open = false;
      dijit.popup.close(this.tooltip);
    }
  },

  setVol:function(number){
    var fmtNumber=number;
    if(number > 999999 && number <= 99999999){
      fmtNumber=number/1000000;
      fmtNumber = fmtNumber.toPrecision(4);
      //fmtNumber=dj.cr.dashboard.mdad_quotes.roundNumber(fmtNumber,3);
      fmtNumber = fmtNumber + "M";
    }else if(number > 999999){
      fmtNumber=number/1000000;
      fmtNumber = fmtNumber.toPrecision(3);
      //fmtNumber=dj.cr.dashboard.mdad_quotes.roundNumber(fmtNumber,2);
      fmtNumber = fmtNumber + "M";
    }
    return fmtNumber;
  },
  
  setDelayedChannel:function(channel){
    this.conf.delayedChannel = channel;
  },
  
  setRealTimeChannel:function(channel){
    this.conf.realTimeChannel = channel;
  }  

});
dojo.provide("dj.widget.article.ArticleTickerView");
dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");
dojo.require("dijit.TooltipDialog");
dojo.require("dj.util.Date");
dojo.require("dj.widget.article.ArticleTickerPopUpView");
dojo.require("dojo.date");


dojo.declare("dj.widget.article.ArticleTickerView", [], {
  constructor: function(container, userConf, initialData) {
    this.conf = {
        fragmentUrl : '/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?ticker=',
        popupFragmentNoCacheURL: '/public/npage/0_0_WG_Article_Ticker_Popup_Q_noCache.html?ticker=',
        TTL: "1m",
        version: 1,
        realTimeChannel : "",
        delayedChannel : "",
        enablePopup : true,
        chartRefreshTimeout : 180000,
        newQuoteURL: false,
        modValue : "inlineTicker",
        linkTarget : ""
    };
    dojo.mixin(this.conf, userConf);
    this.container = container;
    this.popUpView = null;

    this.popupLoaded = false;
    this.hidePopupTimeout = 150;
    this.showPopUpTimeout = 300;

    if(initialData) {
      this.render(initialData);
    }

    if(this.conf.enablePopup) {
      this.addEvents();
    }
  },

  render: function(data) {
    if(data) {
      if(data.b) {
        if(data.b.y === 'premarket') {
            this.callType = "premarket";
        }else if(data.b.y === 'normal') {

//          if(this.callType && this.callType === "premarket"){
//            if(this.popUpView){
//              this.createPopUpView(this.conf.popupFragmentNoCacheURL);
//            }
//          }

          if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
            this.callType = "normal";
            var cssClass = (data.b.c >= 0) ? 'Positive':'Negative';
            var symbol = (data.b.c >= 0) ? '+':'';
            if(data.b.c === 0) {
              cssClass = 'Neutral';
              symbol = '';
            }
            var pc = this.container.getAttribute('data-pc');
            this.tickerName = this.container.getAttribute('data-ticker-name');
            this.ticker = this.container.getAttribute('data-ticker');
            this.country = this.container.getAttribute('data-country');
            this.exchangeIso = this.container.getAttribute('data-exchange-iso');
            var pcp = (data.b.c / pc) * 100 ;
            if(isNaN(pcp)) {
              pcp = 0;
              cssClass = 'Neutral';
              symbol = '';
            }
            if(this.container) {

              if( gcDomain.indexOf( 'marketwatch' ) !== -1 )
              {
                this.container.innerHTML = "<a href='http://www.marketwatch.com/investing/index/" + this.tickerName + "?countrycode=" + this.country + "' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.tickerName +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
              }
			  else if( gcDomain.indexOf( 'wallstreetjournal.de' ) !== -1 ) {
				this.container.innerHTML = "<a class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.tickerName +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
			  }
              else
              {
				if(this.conf.newQuoteURL) {
                  var quotesURL = (dj.context.core.quotesUrlPrefix) ? dj.context.core.quotesUrlPrefix:"http://quotes.wsj.com";
                  //Added to fix countrycode/exchange fix for US by Saba
                  if(this.country === 'US') {
                      this.container.innerHTML = "<a target='"+ this.conf.linkTarget +"' href='"+ quotesURL +"/" + this.ticker +"?mod="+ this.conf.modValue + "' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.ticker +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
                  } else {
                      this.container.innerHTML = "<a target='"+ this.conf.linkTarget +"' href='"+ quotesURL +"/" + this.country + "/" + this.exchangeIso + "/" + this.ticker +"?mod="+ this.conf.modValue + "' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.ticker +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
                  } //End
                  //this.container.innerHTML = "<a href='"+ quotesURL +"/" + this.country + "/" + this.ticker +"?mod="+ this.conf.modValue + "' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.ticker +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
                } else {
                  this.container.innerHTML = "<a target='"+ this.conf.linkTarget +"' href='/public/quotes/main.html?type=djn&symbol="+ this.tickerName +"?mod="+ this.conf.modValue + "' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.tickerName +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
                }
              }
            } else {
              console.error('Cannot deliver the message');
              console.log(data);
            }

            var theDate = data.b.z;
            if(!data.preload) {
              var offset = this.container.getAttribute('data-offset');
              offset = parseFloat(offset);
              var userOffset = new Date().getTimezoneOffset() / 60;
              offset = offset + userOffset;
              var dateObj = new Date(parseInt(theDate.replace(/[^0-9]/g,''), 10));
              dateObj = dojo.date.add(dateObj, "hour", offset);
              theDate = dj.util.Date.simpleDateFormat.format(dateObj, 'NNN d, yyyy h:mm a ');
            }
            var dataObj = {last: data.b.l, pcp: pcp, change: data.b.c, symbol: symbol, pnClass: cssClass, date: theDate};
            this.updateContainerData(dataObj);

          }
        }else if(data.b.y === 'aftermarket') {
          if(this.callType && this.callType === "normal" ){
            console.log("BlueGrass market transitioned for " + data.h.t);
            if(this.popUpView){
              if(this.insideTicker ){
                if(typeof this.dylanCallPending === "undefined" || this.dylanCallPending){
                  this.createPopUpView(new Date().getTime());
                  this.dylanCallPending = false;
                }
              }else{
                this.dylanCallPending = true;
              }
            }
          }
          this.callType = "aftermarket";
        }
      }

      // Send the data to the popup view
      if(this.popUpView) {
        this.popUpView.render(data);
      }
    }
    return;
  },

  addEvents : function() {
    dojo.connect(this.container, "onmouseenter", dojo.hitch(this, function(event){
      this.insideTicker = true;
      setTimeout(dojo.hitch(this, function(){
        if(this.insideTicker) {
          this.showPopUp();
        }
        }), this.showPopUpTimeout);
    }));
    dojo.connect(this.container, "onmouseleave", dojo.hitch(this, function(event){
      this.insideTicker = false;
      if(this.popUpView) {
        this.popUpView.insideTicker = false;
        setTimeout(dojo.hitch(this.popUpView,this.popUpView.close), this.hidePopupTimeout);
      }
    }));
  },

  showPopUp: function() {
    if(this.dylanCallPending){
      this.createPopUpView(new Date().getTime());
      this.dylanCallPending = false;
    }
    if(!this.popUpView) {
      this.createPopUpView(this.conf.version);
    } else {
      this.popUpView.show();
      this.popUpView.insideTicker = true;
    }
  },

  createPopUpView:function(inputVersion){
    this.popUpView = new dj.widget.article.ArticleTickerPopUpView(this.container,
       {tickerName: this.ticker,
        fragmentUrl: this.conf.fragmentUrl,
        country: this.country,
        realTimeChannel : this.conf.realTimeChannel,
        delayedChannel : this.conf.delayedChannel,
        chartRefreshTimeout : this.conf.chartRefreshTimeout,
        version : inputVersion
       },
       dojo.hitch(this, function(){
           if(this.popUpView) {
             this.popUpView.render({b:{y:"normal", l: parseFloat(this.container.getAttribute('data-price')) , c: parseFloat(this.container.getAttribute('data-change')) , z: this.container.getAttribute('data-datetime')}, h:{t:this.conf.realTimeChannel}});
           }
       })
      );

  },

  updateContainerData: function(data) {
    this.container.setAttribute('data-price', data.last);
    this.container.setAttribute('data-datetime', data.date);
    this.container.setAttribute('data-change', data.change);
    this.container.setAttribute('data-changepercent', data.pcp);
  },

  setDelayedChannel:function(channel){
    this.conf.delayedChannel = channel;
    if(this.popUpView){
      this.popUpView.setDelayedChannel(channel);
    }
  },

  setRealTimeChannel:function(channel){
    this.conf.realTimeChannel = channel;
    if(this.popUpView){
      this.popUpView.setRealTimeChannel(channel);
    }
  },

  setAfterHourState:function(afterHourShowHide){

    if(afterHourShowHide === "show"){
      if(this.popUpView){
        if(this.insideTicker ){
          if(typeof this.dylanCallPending === "undefined" || this.dylanCallPending){
            this.createPopUpView(new Date().getTime());
            this.dylanCallPending = false;
          }
        }else{
          this.dylanCallPending = true;
        }
      }
    }else if(afterHourShowHide === "hide"){
      if(this.popUpView ){
        this.popUpView.showHideAfterHours(afterHourShowHide);
      }
    }

  }


 });
dojo.provide("dj.module.article.ticker");


dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");
dojo.require("dj.service.livenews.BluegrassProvider");
dojo.require("dj.widget.article.ArticleTickerView");

dj.module.article.ticker = {
    DEFAULT_CONFIG : {
      fragmentUrl : "/public/npage/0_0_WG_Tickers_Information_Q.html?q=",
      version : 6,
      TTL : "1m",
      popupFragmentURL : "/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?ticker=",
      popupFragmentNoCacheURL : "/public/npage/0_0_WG_Article_Ticker_Popup_Q_noCache.html?ticker=",
      popupTTL : "5m",
      popupVersion: 4,
      popupBaseClass : "inlineTicker",
      endURL : "",
      channelRefreshTimeout : 180000,
      chartRefreshTimeout : 180000,
      enablePopup: true,
      newQuoteURL: false,
      modValue : "inlineTicker",
      linkTarget : "",
	  noDecimalExchange : ["XKRX","XIDX","XTKS","XJSE","XBUD"] // remove decimal place for these exchange (STOCKS ONLY)
    },
    init: function(args) {
      this.conf = dojo.mixin(this.DEFAULT_CONFIG, args);
      this.tickerList = [];
      dojo.query("[data-widget='dj.ticker']").forEach(dojo.hitch(this, function(obj){
        var ticker = obj.getAttribute('data-ticker-name').replace(' ','').replace('&', '');
        if(dojo.indexOf(this.tickerList, ticker) === -1) {
          this.tickerList.push(ticker);
        }
      }));
      
      if(this.tickerList.length > 0) {
        this.loader = new dj.widget.fragmentloader.FragmentJSONLoader(this.conf.fragmentUrl + this.tickerList.join(',') + this.conf.endURL, 
            this._getVersion(), {TTL: this.conf.TTL});
        this._connectToLoaderEvents();
        this.loader.load();
        this.setDataRefreshTimer();
      }
    }, 
    
    _connectToLoaderEvents: function() {
   
      dojo.connect(this.loader, "onLoadJson", dojo.hitch(this, function(data){
        var obj = dojo.fromJson(data.jsonFile.data);
		var dataPrice, netChg;
        this.initialDataBackupArr = [];
        this.countriesList = "";
        dojo.forEach(obj.tickers, dojo.hitch(this, function(ticker, index) {
		dataPrice = parseFloat(ticker.price.replace(/,/g,''));
		netChg = parseFloat(ticker.netChange.replace(/,/g,''));
          if(index === 0) {
            // Initialize the bluegrass provider
            this.bluegrassProvider = new dj.service.livenews.BluegrassProvider();
          }
		  if(this.conf.noDecimalExchange && dojo.indexOf(this.conf.noDecimalExchange, ticker.exchangeIso) > -1) {
		  dataPrice = Math.floor(dataPrice);
		  netChg = Math.floor(netChg);
		  }
          var placement = dojo.query("[data-widget='dj.ticker'][data-ticker-name='"+ ticker.tickerName +"']");
          placement.forEach(dojo.hitch(this, function(t){
            t.setAttribute('data-pc', ticker.pc);
            t.setAttribute('data-ticker-name', ticker.tickerName.toUpperCase());
            t.setAttribute('data-ticker', ticker.name.toUpperCase());
            t.setAttribute('data-company-name', ticker.commonName);
            t.setAttribute('data-price', ticker.price);
            t.setAttribute('data-volume', ticker.volume);
            t.setAttribute('data-datetime', ticker.tickerDateTime);
            t.setAttribute('data-offset', ticker.offset);
            t.setAttribute('data-iso', ticker.iso);
            t.setAttribute('data-change', ticker.netChange);
            t.setAttribute('data-changepercent', ticker.changePercent);
            t.setAttribute('data-country', ticker.country);
            t.setAttribute('data-exchange-iso', ticker.exchangeIso);
            t.setAttribute('id', Math.random());
            var view = new dj.widget.article.ArticleTickerView(t, 
                {
                  TTL: this.conf.popupTTL, 
                  fragmentUrl: this.conf.popupFragmentURL, 
                  popupFragmentNoCacheURL: this.conf.popupFragmentNoCacheURL,
                  version: this._getPopupVersion(), 
                  baseClass : this.conf.popupBaseClass,
                  delayedChannel : ticker.delayedChannel,
                  realTimeChannel : ticker.realTimeChannel,
                  chartRefreshTimeout : this.conf.chartRefreshTimeout,
                  enablePopup: this.conf.enablePopup,
                  newQuoteURL: this.conf.newQuoteURL,
                  modValue: this.conf.modValue,
                  linkTarget : this.conf.linkTarget
                },
                {
                  b:{
                     y:"normal", 
                     c:netChg, 
                     l:dataPrice, 
                     z:ticker.tickerDateTime 
                  },
                  h:{
                    t:ticker.realTimeChannel
                  },
                  preload: true
                });
            
            if(ticker.realTimeChannel && ticker.realTimeChannel !== "") {
              this.bluegrassProvider.subscribeToChannel(ticker.realTimeChannel, view);
            }
            
            if(ticker.delayedChannel && ticker.delayedChannel !== "") {
              this.bluegrassProvider.subscribeToChannel(ticker.delayedChannel, view);
            }
            
            
            
            var initialDataBackup = {
                viewObj : view,
                realTimeChannel : ticker.realTimeChannel,
                delayedChannel : ticker.delayedChannel,
                tickerName : ticker.name.toUpperCase(),
                country : ticker.country,
                tickerDateTime: ticker.tickerDateTime,
                marketState: ticker.marketState
            };
            
            this.initialDataBackupArr.push(initialDataBackup);
            
            if(this.countriesList === ""){
               this.countriesList = ticker.country;
            }else if(this.countriesList.indexOf(ticker.country) === -1){
              this.countriesList = this.countriesList + ticker.country;
            }
            
          }));
        }));
        if(this.bluegrassProvider) {
          try{
            this.bluegrassProvider.connect();
          }catch(e){
              try{
                this.bluegrassProvider.connect();
              }catch(e1){
                this.blueGrassConnectionFailed = true;
                console.err("connection to blueGrass provider failed" + e1);
              }
            
          }
        }
      }));
    },
    
    
    setDataRefreshTimer:function(){
      setTimeout(dojo.hitch(this,function(){
        this.initRefresh();
        this.setDataRefreshTimer();
      }), this.conf.channelRefreshTimeout, null);
    },
    
    initRefresh: function(args) {
      console.log("refreshing channel " + new Date());
      if(this.tickerList.length > 0) {
        var queryParam = "&country=" + this.countriesList;
        this.refreshLoader = new dj.widget.fragmentloader.FragmentJSONLoader(this.conf.fragmentUrl + this.tickerList.join(',') + queryParam + this.conf.endURL, 
            this._getVersion(), {TTL: this.conf.TTL});
        this._connectToRefreshLoaderEvents();
        this.refreshLoader.load();
      }
    }, 
    
    _connectToRefreshLoaderEvents:function(){

      dojo.connect(this.refreshLoader, "onLoadJson", dojo.hitch(this, function(data){
        var connectAgain = false;
        var obj = dojo.fromJson(data.jsonFile.data);
        dojo.forEach(obj.tickers, dojo.hitch(this, function(ticker, index) {
              
              var placement = dojo.query("[data-widget='dj.ticker'][data-ticker-name='"+ ticker.tickerName +"']");
              placement.forEach(dojo.hitch(this, function(t){
                var index = -1;
                var backupObj = null;
                for(i=0;i<this.initialDataBackupArr.length;i++){
                  backupObj = this.initialDataBackupArr[i];
                  if(backupObj.tickerName === ticker.name.toUpperCase()){
                    index = i;
                    break;
                  }
                }
                connectAgain = false;
                if(backupObj){
                    if(backupObj.realTimeChannel){
                      if(ticker.realTimeChannel){
                          if(backupObj.realTimeChannel !== ticker.realTimeChannel  ){
                            connectAgain = true;
                            console.log("subscribing to realtime channel again ************** " + ticker.realTimeChannel);
                             backupObj.viewObj.setRealTimeChannel(ticker.realTimeChannel);
                             this.bluegrassProvider.subscribeToChannel(ticker.realTimeChannel, backupObj.viewObj);
                             if(index >= 0){
                                 this.initialDataBackupArr[index].realTimeChannel = ticker.realTimeChannel;
                             }
                          }
                      }
                    }else{
                      if(ticker.realTimeChannel){
                          connectAgain = true;
                          console.log("subscribing to realtime channel again ************** " + ticker.realTimeChannel);
                          backupObj.viewObj.setRealTimeChannel(ticker.realTimeChannel);
                          this.bluegrassProvider.subscribeToChannel(ticker.realTimeChannel, backupObj.viewObj);
                          if(index >= 0){
                            this.initialDataBackupArr[index].realTimeChannel = ticker.realTimeChannel;
                          }
                      }
                    }
                    
                    
                      if(backupObj.delayedChannel){
                        if(ticker.delayedChannel){
                            if(backupObj.delayedChannel !== ticker.delayedChannel  ){
                               connectAgain = true;
                               console.log("subscribing to delayed channel again ************** " + ticker.delayedChannel);
                               backupObj.viewObj.setDelayedChannel(ticker.delayedChannel);                               
                               this.bluegrassProvider.subscribeToChannel(ticker.delayedChannel, backupObj.viewObj);   
                               if(index >= 0){
                                 this.initialDataBackupArr[index].delayedChannel = ticker.delayedChannel;
                               }
                            }
                        }
                      }else{
                        if(ticker.delayedChannel){
                            connectAgain = true;
                            console.log("subscribing to delayed channel again ************** " + ticker.delayedChannel);
                            backupObj.viewObj.setDelayedChannel(ticker.delayedChannel);
                            this.bluegrassProvider.subscribeToChannel(ticker.delayedChannel, backupObj.viewObj); 
                            if(index >= 0){
                              this.initialDataBackupArr[index].delayedChannel = ticker.delayedChannel;
                            }
                        }
                      }
                      
                      if(backupObj.marketState === "Premarket" && ticker.marketState === "Normal"){
                        console.log("dylan morning market transitioned for " + backupObj.tickerName);
                        backupObj.viewObj.setAfterHourState("hide");
                        backupObj.viewObj.setRealTimeChannel(ticker.realTimeChannel);
                        if(index >= 0){
                          this.initialDataBackupArr[index].marketState = ticker.marketState;
                          this.initialDataBackupArr[index].realTimeChannel = ticker.realTimeChannel;
                        }
                        
                      }
                      if(backupObj.marketState === "Normal" && ticker.marketState === "AfterHours"){
                        console.log("dylan evening market transitioned for " + backupObj.tickerName);
                          backupObj.viewObj.setAfterHourState("show");
                          if(index >= 0){
                            this.initialDataBackupArr[index].marketState = ticker.marketState;
                          }
                      }
                      if(connectAgain){
                        try{
                            this.bluegrassProvider.connect();
                        }catch(e1){
                            this.blueGrassConnectionFailed = true;
                            console.err("connection to blueGrass provider failed" + e1);
                        }
                      }
                }
         // }
            
            
          }));
        }));
        if(this.blueGrassConnectionFailed) {
          try{
            this.bluegrassProvider.connect();
          }catch(e){
              try{
                this.bluegrassProvider.connect();
              }catch(e1){
                this.blueGrassConnectionFailed = true;
                console.err("connection to blueGrass provider failed" + e1);
              }
            
          }
        }
      }));
    
    },
    
    /**
     * If we're in debugMode (chip or query param), 
     * then the current time will be used as version.
     */
    _getVersion: function() {
      var d = new Date(),
          ctxVersion = this.conf.version;

     // v = [ctxVersion, this.cfg.version].join("");

      if (dojo.doc.location.toString().indexOf("debugMode") > -1) {
         ctxVersion = d.getTime();
      }

      return ctxVersion;
    },
    
    /**
     * If we're in debugMode (chip or query param), 
     * then the current time will be used as version.
     */
    _getPopupVersion: function() {
      var d = new Date(),
          ctxVersion = this.conf.popupVersion;

     // v = [ctxVersion, this.cfg.version].join("");

      if (dojo.doc.location.toString().indexOf("debugMode") > -1) {
         ctxVersion = d.getTime();
      }

      return ctxVersion;
    }
    
    
    
};
/*global dojo:false, dj:false, FB:false*/
dojo.provide("dj.widget.social.Facebook");
dojo.require("dj.util.Observer");

dojo.declare("dj.widget.social.Facebook", [], {
  cfg: {
    autoResize: [true],
    scrollTo: {
      "x": 0,
      "y": 0
    }
  },

  constructor: function (args) {
    this._isReady = false;
    this._ob = new dj.util.Observer();

    window.fbAsyncInit = dojo.hitch(this, "init", args);
    (function () {
      var x = dojo.create("div", {
        "id": "fb-root"
      },
      dojo.body());
      dojo.create("script", {
        "src": dojo.doc.location.protocol + "//connect.facebook.net/en_US/all.js",
        //"src": dojo.doc.location.protocol + "//connect.facebook.net/en_US/core.debug.js",
        "async": true
      },
      x);
    } ());
  },

  init: function (args, cb) {
    if (typeof FB === 'undefined') {
      return setTimeout(dojo.hitch(this, function () {
        this.init(args, cb);
      }), 50);
    }

    if (this._isReady) {
      if (cb) {
        return cb();
      } else {
        return;
      }
    }

    var appId = dojo.query('meta[property="fb:app_id"]');
    if (appId.length === 1) {
      FB.init({
        appId: dojo.attr(appId[0], "content"),
        status: true,
        // check login status
        cookie: true // enable cookies to allow the server to access the session
        //xfbml  : true  // parse XFBML
        //channelUrl  : 'http://www.yourdomain.com/channel.html', // Custom Channel URL
        //oauth : true //enables OAuth 2.0
      });

      FB.getLoginStatus(function (response) {
        if (cb) {
          cb();
        }
      });

      this._isReady = true;
      this._ob.fire();
    }
  },
  processLoginStatus: function (cb) {
    this._ob.subscribe(cb);
  },
  addPlugin: function (config) {
    if (this._isReady) {
      this._addPlugin(config);
    } else {
      this._ob.subscribe(function () {
        this._addPlugin(config);
      },
      this);
    }
  },

  _addPlugin: function (args) {
    if (args.createPlugin) {
      if (dojo.isArray(args.createPlugin)) {
        dojo.forEach(args.createPlugin, dojo.hitch(this, function (a) {
          if (a.type && a.type !== "") {
            this.createPlugin(a.type, a.attr, a.location, a.pos);
          }
        }));
      } else {
        if (args.createPlugin.type && args.createPlugin.type !== "") {
          this.createPlugin(args.createPlugin.type, args.createPlugin.attr, args.createPlugin.location, args.createPlugin.pos);
        }
      }
    }
    if (args.parse) {
      FB.XFBML.parse();
    }
    if (args.subscribe) {
      if (dojo.isArray(args.subscribe)) {
        dojo.forEach(args.subscribe, dojo.hitch(this, function (a) {
          this.subscribe(a.event, a.cb);
        }));
      } else {
        this.subscribe(args.subscribe.event, args.subscribe.cb);
      }
    }
    if (args.unsubscribe) {
      if (dojo.isArray(args.unsubscribe)) {
        dojo.forEach(args.unsubscribe, dojo.hitch(this, function (a) {
          this.unsubscribe(a.event, a.cb);
        }));
      } else {
        this.unsubscribe(args.unsubscribe.event, args.unsubscribe.cb);
      }
    }
    if (args.autoResize || args.scrollTo) {
      this.config = dojo.delegate(this.cfg, args);
    }

    if (!this.config) {
      this.config = dojo.delegate(this.cfg, {});
    }
    if (this.config.autoResize) {
      if (dojo.isArray(this.config.autoResize)) {
        if (this.config.autoResize.length === 2) {
          FB.Canvas.setAutoResize(this.config.autoResize[0], this.config.autoResize[1]);
        } else {
          FB.Canvas.setAutoResize(this.config.autoResize[0]);
        }
      }
    }
    if (this.config.scrollTo) {
      FB.Canvas.scrollTo(this.config.scrollTo);
    }
  },

  //Simple pass-through
  api: function () {
    return FB.api.apply(this, arguments);
  },

  subscribe: function (event, cb) {
    FB.Event.subscribe(event, cb);
  },

  unsubscribe: function (event, cb) {
    FB.Event.unsubscribe(event, cb);
  },

  createPlugin: function (type, attr, location, pos) {
    dojo.create(type, attr, dojo.query(location)[0], pos);
  },

  showDialog: function (args, cb) {
    FB.XFBML.parse();
    return FB.ui(args, cb);
  },

  runFQL: function (query, cb) {
    if (this._isReady) {
      this._runFQL(query, cb);
    } else {
      this._ob.subscribe(function () {
        this._runFQL(query, cb);
      },
      this);
    }
  },

  _runFQL: function (query, cb) {
    var fbQuery = FB.Data.query(query);
    fbQuery.wait(function (rows) {
      cb(rows);
    });
  },

  frameResize: function (dim) {
    if (this._isReady) {
      this._frameResize(dim);
    } else {
      this._ob.subscribe(function () {
        this._frameResize(dim);
      },
      this);
    }
  },

  _frameResize: function (dim) {
    if (dojo.isObject(dim) && (dim.width || dim.height)) {
      FB.Canvas.setSize(dim);
    } else {
      FB.Canvas.setSize();
    }
  },
  frameScrollTop: function () {
    if (this._isReady) {
      FB.Canvas.scrollTo(0, 0);
    } else {
      this._ob.subscribe(function () {
        FB.Canvas.scrollTo(0, 0);
      },
      this);
    }
  },

  destroy: function () {}
});

/*global dj:false, dojo:false */
dojo.provide("dj.module.social.facebook");
dojo.require("dj.widget.social.Facebook");

dj.module.social.facebook = {
  init: function () {
  },

  getInstance: function () {
    if (!this.inst) {
      this.inst = new dj.widget.social.Facebook();
    }

    return this.inst;
  }
};
/*global dojo:false, dj:false  */
dojo.provide("dj.widget.social.WatchEdge");

dojo.require("dj.module.social.facebook");

dojo.declare("dj.widget.social.WatchEdge", [], {

  constructor: function (videoURL) {
    this.fbUrl = "/me/video.watches";
    this.videoURL = videoURL;
    this.FB = dj.module.social.facebook.getInstance();
  },

  postVideo: function (cb) {
    cb = cb || function () {};
    console.info('postVideo: '+this.fbUrl + "?video=" + this.videoURL);
    this.FB.api(this.fbUrl + "?video=" + this.videoURL, "post", dojo.hitch(this, function (response) {
      var are = dojo.byId("articleReadEdge");
      if (!response) {
        console.error("There was an exception posting this article to your timeline.");
      } else if (response.error) {
        console.error(response);
      } else {
        this.streamId = response.id;
      }
      cb(response);
    }));
  },

  deleteVideo: function (videoID, cb) {
    cb = cb || function () {};
    if (videoID) {
      this.FB.api("/" + videoID, "delete", function (response) {
        if (!response || response.error) {
          console.error(response);
        }
        cb(response);
      });
    }
  },

  getWatchedVideos: function (cb) {
    cb = cb || function () {};
    this.FB.api(this.fbUrl, 'get', dojo.hitch(this, function (response) {
      if (!response) {
        console.error('There are no videos on your timeline');
      } else if (response.error) {
        console.error('getWatchedVideos error', response);
      }
      cb(response);
    }));
  }

});

/*global dj:false, dojo:false, FB:false, TrimPath:false */
/*jshint multistr:true */
dojo.provide("dj.module.social.videoCenterWatchEdge");
dojo.require("dj.lang");
dojo.require("dj.util.Cookie");
dojo.require("dj.util.Element");
dojo.require("dj.widget.social.WatchEdge");
dojo.require("dj.module.social.facebook");
dojo.require("trimpath.TrimPath");

dj.module.social.videoCenterWatchEdge = {
  init: function () {
    this.conf = {
      cookieName: 'fbWETimelineSharing',
      shareTimeout: 10000,
      showShares: 5
    };

    if (!this.isActivated()) {
      this.hideSharingWidget();
      return;
    }

    this.getControlCookie();
    this.setupEvents();

    this.fb = dj.module.social.facebook.getInstance();
    this.fb.init({},
    dojo.hitch(this, function () {
      this.showSharingWidget();

      if (this.timelineSharing === 'on') {
        console.log('about to enable sharing');
        FB.login(dojo.hitch(this, function () {
          console.log('about to enable sharing');
          this.enableSharing(dojo.hitch(this, function () {
            console.log('sharing enabled, about to setup events');
          }));
        }));
      }

    }));
  },

  isActivated: function () {
    // Kill switch.  Setting this context variable will disable initializing facebook watchedge
    dojo.getObject('dj.context.social.watchedge', true);
    if (dj.context.social.watchedge.disable && dj.context.social.watchedge.disable === true) {
      return false;
    } else {
      return true;
    }
  },

  setupEvents: function () {
    dojo.query('.vcrWatchEdge > .weInfo').forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, 'onmouseenter', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        this.showPopup();
      }));

      dojo.connect(obj, 'onmouseout', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        if (!dj.util.Element.contains(obj, event.clientX, event.clientY)) {
          this.hidePopup();
        }
      }));
    }));

    dojo.query('.vcrWatchEdge > .vcrWatchEdgeDrop').forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, 'onmouseenter', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        this.showPopup();
      }));

      dojo.connect(obj, 'onmouseout', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        if (!dj.util.Element.contains(obj, event.clientX, event.clientY)) {
          this.hidePopup();
        }
      }));
    }));

    dojo.query('.sharingSettings > .sharingOn').forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, 'onclick', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        this.enableSharing();
      }));
    }));

    dojo.query('.sharingSettings > .sharingOff').forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, 'onclick', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        this.disableSharing();
      }));
    }));

    // TODO: change to hover functionality (dj.widget.panel?)
    dojo.query('.sharingSettings > .notLink').forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, 'onclick', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        this.showNotYouMessage();
      }));
    }));

    dojo.query('.sharingSettings > .whatsLink').forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, 'onclick', dojo.hitch(this, function (event) {
        dojo.stopEvent(event);
        this.showWhatsThisMessage();
      }));
    }));

    /*
      dojo.query("[data-widget='weControl'][data-value='"+ this.timelineSharing +"']").forEach(function (obj){
        dojo.addClass(obj, "fbOn");
      });
      */
    dojo.query("[data-dj-widget='allowSharing']").connect("onclick", dojo.hitch(this, function (event) {
      dojo.stopEvent(event);
      this.enableSharing();

      FB.login(function (response) {
        // handle the response
      },
      {
        scope: 'publish_actions'
      });
    }));

    dojo.query("[data-dj-widget='socialSharingOn']").connect("onclick", dojo.hitch(this, function (event) {
      dojo.stopEvent(event);
      this.enableSharing();
    }));

    dojo.query("[data-dj-widget='socialSharingOff']").connect("onclick", dojo.hitch(this, function (event) {
      dojo.stopEvent(event);
      this.disableSharing();
    }));

    dj.lang.addLiveEvent("[data-dj-widget='deleteSharedVideo']", 'click', function (event) {
      var element = event.target;
      dojo.stopEvent(event);
      var videoID = element.getAttribute('data-dj-video-id');
      console.log('removing video share ', videoID);

      this.removeShare(videoID, dojo.hitch(this, function (response) {
        console.log('removed video share ', videoID);
        this.populateSharedVideos();
      }));
    },
    this);

    dojo.query("[data-dj-widget='logoutFacebook']").forEach(dojo.hitch(this, function (obj) {
      dojo.connect(obj, "onclick", dojo.hitch(this, dojo.hitch(this, function (event) {

        dojo.stopEvent(event);
        if (typeof FB !== 'undefined') {
          console.log('logging out of facebook');
          FB.logout(dojo.hitch(this, function () {
            console.log('logged out of facebook');
            this.disableSharing();
            this.setAvatar();
          }));
        }
      })));
    }));

  },

  showPopup: function () {
    if (this.timelineSharing === 'on') {
      this.showActivityPopup();
    } else {
      this.showSharingPopup();
    }
  },

  hidePopup: function () {
    this.hideActivityPopup();
    this.hideSharingPopup();
    this.hideNotYouMessage();
    this.hideWhatsThisMessage();
  },

  /*
   * share
   * @param {String} url of item to share
   * @param {Number} waitTime in seconds before triggering "watched" event
   */
  share: function (url, waitTime) {

    if (!this.isActivated()) {
      this.disableSharing();
      return;
    }

    if (this.timelineSharing === 'off') {
      return;
    }

    this.we = new dj.widget.social.WatchEdge(url);

    //waitTime will be half of the time in miliseconds
    if (document.location.host.match(/djscript/)) {
      waitTime = 10000;
    } else {
      waitTime = waitTime * 1000 / 2;
    }
    console.info("Calling Watchedge in " + waitTime / 1000 + " seconds");

    FB.login(dojo.hitch(this, function (response) {
      if (!response || response.error) {
        return;
      }

      // handle the response
      if (this.weTimeout) {
        clearTimeout(this.weTimeout);
      }
      this.weTimeout = setTimeout(dojo.hitch(this, function () {
        if (this.timelineSharing && this.timelineSharing === "on") {
          this.we.postVideo(dojo.hitch(this, function () {
            this.populateSharedVideos();
          }));
        }
      }), waitTime);
    },
    {
      scope: 'publish_actions'
    }));
  },

  populateSharedVideos: function (cb) {
    cb = cb || function () {};
    var self = this;

    var we = dj.widget.social.WatchEdge();

    we.getWatchedVideos(dojo.hitch(this, function (response) {
      if (response) {
        response.data = response.data.slice(0, this.conf.showShares);
        console.log('watchedVideos:', response);

        var template = TrimPath.parseTemplate(self.sharedVideosListTemplate);
        var output = template.process(response);

        dojo.query("[dj-data-widget='sharedActivity']").forEach(function (el) {
          el.innerHTML = output;
        });
      }

      cb();
    }));
  },

  removeShare: function (videoID, cb) {
    cb = cb || function () {};
    if (this.we) {
      this.we.deleteVideo(videoID, cb);
    }
  },

  showSharingWidget: function () {
    dojo.query("[data-dj-widget='vcrSharing']").removeClass('hidden');
  },

  hideSharingWidget: function () {
    dojo.query("[data-dj-widget='vcrSharing']").addClass('hidden');
  },

  showSharingPopup: function () {
    dojo.query("[data-dj-widget='turnOnSharingDrop']").removeClass('hidden');
  },

  hideSharingPopup: function () {
    dojo.query("[data-dj-widget='turnOnSharingDrop']").addClass('hidden');
  },

  showActivityPopup: function () {
    dojo.query("[data-dj-widget='sharingActivityDrop']").removeClass('hidden');
  },

  hideActivityPopup: function () {
    dojo.query("[data-dj-widget='sharingActivityDrop']").addClass('hidden');
  },

  showNotYouMessage: function () {
    dojo.query("[data-dj-widget='notYou']").removeClass('hidden');
    this.hideWhatsThisMessage();
  },

  hideNotYouMessage: function () {
    dojo.query("[data-dj-widget='notYou']").addClass('hidden');
  },

  showWhatsThisMessage: function () {
    dojo.query("[data-dj-widget='whatsThis']").removeClass('hidden');
    this.hideNotYouMessage();
  },

  hideWhatsThisMessage: function () {
    dojo.query("[data-dj-widget='whatsThis']").addClass('hidden');
  },

  showSharingOn: function () {
    dojo.query("[data-dj-widget='socialSharingOn']").addClass('active');
    dojo.query("[data-dj-widget='socialSharingOff']").removeClass('active');
    dojo.query("[data-dj-widget='sharingOn']").removeClass('hidden');
    dojo.query("[data-dj-widget='sharingOff']").addClass('hidden');
    this.hidePopup();
  },

  showSharingOff: function () {
    dojo.query("[data-dj-widget='socialSharingOn']").removeClass('active');
    dojo.query("[data-dj-widget='socialSharingOff']").addClass('active');
    dojo.query("[data-dj-widget='sharingOn']").addClass('hidden');
    dojo.query("[data-dj-widget='sharingOff']").removeClass('hidden');
    this.hidePopup();
  },

  setControlCookie: function (value) {
    this.timelineSharing = value;
    dj.util.Cookie.setGroupCookie('DJCOOKIE', this.conf.cookieName, value, 356);
  },

  getControlCookie: function () {
    this.timelineSharing = dj.util.Cookie.getGroupCookie("DJCOOKIE", this.conf.cookieName);
    if (!this.timelineSharing) {
      this.timelineSharing = 'off';
    }

    return this.timelineSharing;
  },

  enableSharing: function (cb) {
    this.timelineSharing = 'on';
    this.showSharingOn();
    this.setControlCookie('on');
    var userID = (typeof FB !== 'undefined') ? (FB.getUserID() || 0) : 0;
    this.setAvatar(userID);
    this.populateSharedVideos(cb);
  },

  disableSharing: function () {
    this.timelineSharing = 'off';
    this.showSharingOff();
    this.setControlCookie('off');
  },

  setAvatar: function (userID) {
    if (userID) {
      dojo.query("[data-dj-widget='avatar']").forEach(function (el) {
        var avatarSrc = 'https://graph.facebook.com/' + userID + '/picture';
        dojo.removeClass(el, 'hidden');
        el.src = avatarSrc;
      });
      dojo.query("[data-dj-widget='fbLogo']").addClass('hidden');
    } else {
      dojo.query("[data-dj-widget='avatar']").addClass('hidden');
      dojo.query("[data-dj-widget='fbLogo']").removeClass('hidden');
    }

  },

  sharedVideosListTemplate: "{for video in data}<li><h2 class=\"sharedRecent\"><a href=\"javascript:return false;\">${video.data.video.title}</a></h2><span data-dj-widget=\"deleteSharedVideo\" data-dj-video-id=\"${video.id}\" style=\"cursor: hand; cursor: pointer\" class=\"weHide\">X</span></li>{/for}"
};

dojo.provide("dj.widget.notifications.view.notificationview");

dojo.declare("dj.widget.notifications.view.notificationview", null, {

  containerObject : null,
  seekPos : 0,

  DEFAULT_CONFIG : {
		 containerObject : null,
		 liveAlertObject : null,
		 container : "liveShowTitle",
		 liveShowFag : false,
		 prevDescription : "",
		 prevDate : "",
		 dateActionsTicker : "dateActionsTicker",
		 currentVideoInfoId : "currentVideoInfo",
		 playerID : "videoPlayer",
		 liveDescriptionId : "liveDescriptionId",
		 liveObject : null,
		 videoPlayer : null,
		 liveAlertObjectId : "vcrLiveAlert"
  },

  constructor: function(userConf) {
    dojo.safeMixin(this.DEFAULT_CONFIG, userConf);
  },

  render : function(data) {
	  try {
		  this.DEFAULT_CONFIG.containerObject = this.DEFAULT_CONFIG.containerObject || dojo.byId(this.DEFAULT_CONFIG.container);
		  this.DEFAULT_CONFIG.liveAlertObject = this.DEFAULT_CONFIG.liveAlertObject || dojo.byId(this.DEFAULT_CONFIG.liveAlertObjectId);
		  this.DEFAULT_CONFIG.videoDescription = this.DEFAULT_CONFIG.videoDescription || dojo.byId(this.DEFAULT_CONFIG.currentVideoInfoId);
		  this.DEFAULT_CONFIG.datatickerObject = this.DEFAULT_CONFIG.datatickerObject || dojo.byId(this.DEFAULT_CONFIG.dateActionsTicker);
		  this.DEFAULT_CONFIG.liveObject = this.DEFAULT_CONFIG.liveObject || dojo.byId(this.DEFAULT_CONFIG.liveDescriptionId);

		  if(this.DEFAULT_CONFIG.containerObject && typeof data.b.status != undefined && data.b.status != null) {

			  var alertStatus = dojo.hasClass(this.DEFAULT_CONFIG.liveAlertObject, "hidden");
			  var laterStatus = dojo.hasClass(this.DEFAULT_CONFIG.liveAlertObject, "later");

			  if( (data.b.status == "4" || data.b.status == "closed")) {
				  dojo.removeClass(this.DEFAULT_CONFIG.liveAlertObject, "later");
				//if(!alertStatus) {
					  dojo.addClass(this.DEFAULT_CONFIG.liveObject, "hidden");
					  dojo.addClass(this.DEFAULT_CONFIG.liveAlertObject, "hidden");
					  this.DEFAULT_CONFIG.liveObject.innerHTML = '';
					  if(dojo.hasClass(this.DEFAULT_CONFIG.datatickerObject, "hidden")){
						  console.log("******************** closing and restarting *************************");
						  this.DEFAULT_CONFIG.videoPlayer.playVideo(this.DEFAULT_CONFIG.videoPlayer.videoID, "News", false);
					  }
					  dojo.removeClass(this.DEFAULT_CONFIG.datatickerObject, "hidden");
					  dojo.removeClass(this.DEFAULT_CONFIG.videoDescription, "hidden");
					  dojo.removeClass(this.DEFAULT_CONFIG.liveAlertObject, "later");
				//}
			  } else if( alertStatus && typeof data.b.showName != undefined && data.b.showName !== "" && !laterStatus
					&& (data.b.status == "1" || data.b.status == "2" || data.b.status == "3") ) {
				  var jsonObj = data.b.jsonObject;
				  var smileFile = 'http://m.wsj.net/video-players/wsjlive-sd.smil';
				  var videoData = '';
				  try{
					  jsonObj = dojo.fromJson(jsonObj);
					  if(jsonObj && jsonObj.mediaGroup){
						  for( var i= 0; i < jsonObj.mediaGroup.content.length; i++ ){
							  var type = jsonObj.mediaGroup.content[i].type;
							  if(type && type.toLowerCase() === "application/smil") {
								  smileFile = jsonObj.mediaGroup.content[i].url;
								  break;
							  }
						  }
					  }
					  videoData = dojo.toJson(jsonObj);
					  videoData = videoData.replace(/"/g,'\\"');
				  } catch(e){}
				  dojo.attr(this.DEFAULT_CONFIG.liveAlertObject, "data-smilefile", smileFile);
				  dojo.attr(this.DEFAULT_CONFIG.liveAlertObject, "data-videoData", videoData);
				  this.DEFAULT_CONFIG.containerObject.innerHTML = data.b.showName;
				  dojo.removeClass(this.DEFAULT_CONFIG.liveAlertObject, "hidden");
				  this.DEFAULT_CONFIG.liveObject.innerHTML = '<div class="currentVideoInfo"><small id="showTitle">'+data.b.showName+'</small><h1><a href="" id="videoTitle">'+data.b.headline+'</a></h1><p>'+data.b.content+'</p></div>';
			  }
		  }
	  } catch(exp) {
		  console.log("Error {notificationview}: "+exp);
	  }
  }

});
dojo.provide("dj.module.notifications.notificationupdates");
dojo.require("dj.service.livenews.BluegrassProvider");
dojo.require("dj.widget.notifications.view.notificationview");
dojo.require("dj.utils.VideoUtils");
dojo.require("dj.util.Element");

dj.module.notifications.notificationupdates = {

	notificationview : null,
	notificationProvider : null,
	liveShowFag : false,
	videoPlayer : null,
	init: function (userConfiguration){
		var that = this;
		if(!dj.utils.VideoUtils._isIpad() && dj.utils.VideoUtils.hasValidFlashVersion()){
			this.configuration = {
				liveAlertObject : null,
				datatickerObject : null,
				liveAlertObjectId : "vcrLiveAlert",
				liveDescriptionId : "liveDescriptionId",
				currentVideoInfo : "currentVideoInfo",
				notificationChannel : "/wsj/notification/videoNotification",
				toURL : '/bg/api/connect.ashx',
				container : "liveShowTitle",
				dateActionsTicker : "dateActionsTicker",
				playerID : "videoPlayer",
				vcrLiveAlertID : "vcrLiveAlert",
				source : "http://m.wsj.net/video-players/wsjlive-sd.smil",
				openLive : "open_live"
			};
			if(typeof userConfiguration != undefined && userConfiguration != null)
				this.videoPlayer = userConfiguration;

			this.notificationProvider = new dj.service.livenews.BluegrassProvider({toURL:this.configuration.toURL});
			this.notificationProvider.connect();
			this.bluegrassSubscribe();
			this.addEvents();
		}
	},

	bluegrassSubscribe: function(){
		var notificationview = new dj.widget.notifications.view.notificationview({container : this.configuration.container, liveShowFag : this.liveShowFag, videoPlayer : this.videoPlayer});
		try{
			this.notificationProvider.subscribeToChannel(this.configuration.notificationChannel, notificationview);
		}catch(e){
			console.log("Error{notificationupdates}: " + e);
		}
	},

	playLivePlayer : function(smileFile, videoData) {
		try{
	        var swfObject = swfobject.getObjectById("videoPlayer");
	        swfObject.gotoLiveVideo({source: smileFile, ad_zone: "open_live", videoData: videoData});
		} catch(e){}
	},

	addEvents : function() {
		var liveShowFagStatus = this.liveShowFag;
		var callplayLivePlayer = this.playLivePlayer;

		var liveAlertObject = dojo.byId(this.configuration.liveAlertObjectId);
		var datatickerObject = dojo.byId(this.configuration.dateActionsTicker);
		var liveShowObject = dojo.byId(this.configuration.liveDescriptionId);
		var currentVideoInfoObject = dojo.byId(this.configuration.currentVideoInfo);

	    dj.lang.addLiveEvent(".watchnow, .watchLink", "click", function(ev) {
	    	try{
		      dojo.stopEvent(ev);
		      var smileFile = dj.util.Element.getData(liveAlertObject, "smilefile");
		      var videoData = dj.util.Element.getData(liveAlertObject, "videodata");
		      callplayLivePlayer(smileFile, videoData);
		      dojo.addClass(liveAlertObject, "hidden");
		      dojo.addClass(datatickerObject, "hidden");
		      dojo.removeClass(liveShowObject, "hidden");
		      dojo.addClass(currentVideoInfoObject, "hidden");

		      liveShowFagStatus = true;
		      datatickerObject.innerHTML ='';
		      var nowplaying = dojo.byId("firstthumbnail");
		      if(nowplaying)
					nowplaying.parentNode.removeChild(nowplaying);
		      dojo.addClass(liveAlertObject, "later");
	    	}catch(exp){
	    	}
	    });
	    dj.lang.addLiveEvent(".watchlater", "click", function(ev) {
	    	try{
			      dojo.stopEvent(ev);
			      dojo.addClass(liveAlertObject, "hidden");
			      dojo.addClass(liveAlertObject, "later");
			      liveShowFagStatus = true;

			      setTimeout(function() {
			    	  dojo.removeClass(liveAlertObject, "hidden");
			    	  dojo.removeClass(liveAlertObject, "later");
			      }, 300000);

	    	}catch(exp){
	    	}
	    });
	    dj.lang.addLiveEvent(".watchclose", "click", function(ev) {
	    	try{
			      dojo.stopEvent(ev);
			      dojo.addClass(liveAlertObject, "hidden");
			      dojo.addClass(liveAlertObject, "later");
			      liveShowFagStatus = true;

	    	}catch(exp){
	    	}
	    });
	}

};

dojo.provide("dj.widget.videos.model.PlayerEvents");dj.widget.videos.model.PlayerEvents={playVideo:"onPlayVideo",pauseVideo:"onPauseVideo",unpauseVideo:"onUnpauseVideo",getSeek:"onGetSeek",stopVideo:"onStopVideo",createAdvertisement:"onCreateAdvertisement",openMicroPopUpPlayer:"onOpenMicroPopUpPlayer",openPopUpPlayer:"onOpenPopUpPlayer",openEmbedPopup:"onOpenEmbedPopup",continueLoadVideo:"onContinueLoadVideo",playNextVideo:"onPlayNextVideo",playVideoByItem:"onPlayVideoByItem",requestPlayList:"upNextPlaylist",requestCurrentVideo:"onRequestCurrentVideo",durationChange:"onDurationChange",complete:"onComplete",mediaPlayerStateChange:"onMediaPlayerStateChange"};dojo.provide("dj.widget.videos.model.PlayerTypes");(dj.widget.videos.model.PlayerTypes={MicroPlayer:{width:272,height:153,swfFile:"WSJMediaPlayer.swf"},MicroPlayerHP:{width:264,height:149,swfFile:"WSJMediaPlayer.swf"},MicroPlayerE:{width:360,height:203,swfFile:"WSJMediaPlayer.swf"},MicroPlayerF:{width:512,height:288,swfFile:"WSJMediaPlayer.swf"},MainPlayer:{width:740,height:416,swfFile:"WSJMediaPlayer.swf"},MainPlayerHP:{width:264,height:149,swfFile:"WSJMediaPlayer.swf"},MainPlayerE:{width:360,height:203,swfFile:"WSJMediaPlayer.swf"},MainPlayerF:{width:512,height:288,swfFile:"WSJMediaPlayer.swf"},MainPlayerF_Article:{width:563,height:316,swfFile:"WSJMediaPlayer.swf"},BrowserAdPlayer:{width:170,height:175,swfFile:"adPlayer.swf"},AdPlayer:{width:300,height:60,swfFile:"adPlayer.swf"},AdPlayerRight:{width:300,height:1050,swfFile:"adPlayer.swf"}}).prototype={};dojo.provide("dj.widget.videos.model.Playlist");(dj.widget.videos.model.Playlist=function(){this.videos=null;this.sectionID=this.query="";this.videoIndex=0}).prototype={};dojo.provide("dj.widget.videos.model.SWFPlayer");(dj.widget.videos.model.SWFPlayer=function(){this.objName="undefined";this.containerID=this.swfURL=this.id="";this.height=this.width=0;this.containermodule=this.videoGUID="";this.allowfullscreen=this.endScreenOverlay=true;this.flashVersion="9.0.0";this.shareenabled=false;this.allowPlayerPopup=1;this.hideTools=0;this.plyMediaEnabled=1;this.host="video.wsj.com";this.allowScriptAccess="always";this.windowMode="opaque";this.playNextVideo=this.requestPlayList=this.continueLoadVideo=this.openEmbedPopup=this.openPopUpPlayer=this.createAdvertisement=this.stopVideo=this.getSeek=this.unpauseVideo=this.pauseVideo=this.playVideo=this.eventNamespace=this.configURL="";this.chainVideos=1;this.enableVideoModuleChaining=0;this.mediaPlayerStateChange=this.complete=this.durationChange=""}).prototype={};dojo.provide("dj.utils.VideoUtils");dojo.require("swfobject.swfobject_2_2.swfobject");(function(){dj.utils.VideoUtils={formatDuration:function(a){try{if(a.length!=0){if(a<60)return"0:"+this.formatSeconds(a);for(var b=0;a>59;){a-=60;b++}return b+":"+this.formatSeconds(a)}}catch(c){console.log("formatDuration Error: "+a)}return""},formatSeconds:function(a){return a>9?a:"0"+a},nullOrUndefined:function(a){return a===null||a=="undefined"},emptyOrNull:function(a){if(!this.nullOrUndefined(a))return a.length===0;return true},nonSupportingFlashPlayer:function(a){dojo.byId(a).innerHTML='<div class="noFlash"><p>This content can not be displayed because your browser does not support the Adobe Flash player required to view it.</p></div>'},hasValidFlashVersion:function(){var a=swfobject.getFlashPlayerVersion();if(a)return a.major>=10.2;else{console.error("{VideoUtils} - flashVersion is undefined.");return false}},createSWFPlayer:function(a){if(this.hasValidFlashVersion()){var b={objName:a.objName,allowPlayerPopup:a.allowPlayerPopup,hideTools:a.hideTools,plyMediaEnabled:a.plyMediaEnabled,movieWidth:a.width,movieHeight:a.height,host:a.host,PLAYER_ID:a.id,containermodule:a.containermodule,shareenabled:a.shareenabled,playVideo:this.addEventNamespace(a.eventNamespace,a.playVideo),pauseVideo:this.addEventNamespace(a.eventNamespace,a.pauseVideo),unpauseVideo:this.addEventNamespace(a.eventNamespace,a.unpauseVideo),getSeek:this.addEventNamespace(a.eventNamespace,a.getSeek),stopVideo:this.addEventNamespace(a.eventNamespace,a.stopVideo),createAdvertisement:this.addEventNamespace(a.eventNamespace,a.createAdvertisement),openPopUpPlayer:this.addEventNamespace(a.eventNamespace,a.openPopUpPlayer),openEmbedPopup:this.addEventNamespace(a.eventNamespace,a.openEmbedPopup),openMicroPopUpPlayer:this.addEventNamespace(a.eventNamespace,a.openMicroPopUpPlayer),continueLoadVideo:this.addEventNamespace(a.eventNamespace,a.continueLoadVideo),playNextVideo:this.addEventNamespace(a.eventNamespace,a.playNextVideo),playVideoByItem:this.addEventNamespace(a.eventNamespace,a.playVideoByItem),enableVideoModuleChaining:a.enableVideoModuleChaining,requestPlayList:this.addEventNamespace(a.eventNamespace,a.requestPlayList),requestCurrentVideo:this.addEventNamespace(a.eventNamespace,a.requestCurrentVideo),endScreenOverlay:a.endScreenOverlay,durationChange:this.addEventNamespace(a.eventNamespace,a.durationChange),complete:this.addEventNamespace(a.eventNamespace,a.complete),mediaPlayerStateChange:this.addEventNamespace(a.eventNamespace,a.mediaPlayerStateChange)};if(a.swfURL=="/media/swf/WSJMediaPlayer.swf"){a.chainVideos=1;var c=dojo.getObject("dj.context.video.chainVideos");if(c!=undefined&&c===false)a.chainVideos=0;b.chainVideos=a.chainVideos}try{swfobject.embedSWF(dj.context.core.cdnPrefix+a.swfURL,a.containerID,a.width,a.height,a.flashVersion,"",b,{allowscriptaccess:a.allowScriptAccess,allowfullscreen:a.allowfullscreen,shareenabled:a.shareenabled,wmode:"opaque"},{id:a.id,name:a.id})}catch(d){console.error("Error on embending "+d)}}else this.nonSupportingFlashPlayer(a.containerID)},addEventNamespace:function(a,b){return b===null||b===""?b:a+"."+b},popUpPlayer:function(a){var b="/public/page/video-popup.html";if(dj.context.videoCenter.popUpPageURL)b=dj.context.videoCenter.popUpPageURL;try{if(!a.shareTool||a.shareTool==="undefined")a.shareTool="show"}catch(c){}window.open(b+"?currentPlayingLocation="+
a.playLocation+"&currentlyPlayingCollection="+escape(a.collection)+"&referrerURL="+a.referrerURL+"&shareTool="+a.shareTool+"&imageurl="+a.imageurl+"&linkurl="+a.linkurl+"&currentlyPlayingVideoId="+a.videoID,"popUpPlayer","height=840,width=422,left="+(screen.width-Number(a.width))/2+",top="+(screen.height-Number(a.height))/2+",resizable=yes,scrollbars=yes,toolbar=no,status=no")},embedPopUp:function(a){console.log("videoutils embedPopUp");var b=a.url,c=a.guidval;a=a.shortUrl;if(a!==undefined&&a!==null&&""!==a)b=a;c=c.replace("{","");c=c.replace("}","");a="/public/page/videoembedcode.html";if(dj.context.videoCenter.EmbedPageURL)a=dj.context.videoCenter.EmbedPageURL;window.open(a+"?url="+b+"&guidval="+c,"popUpPlayer","height=372,width=635,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=no,status=no")},isGUID:function(a){return a.match(/{\w{8}-\w{4}-\w{4}-\w{4}-\w{12}}/)},normalizeGuid:function(a){return this.isGUID(a)?a:"{"+a+"}"},omnitureEncoding:function(a,b,c){if(a=="News"){if(b=="Politics"&&c=="s")return"Politics & Campaign";if(this.emptyOrNull(b))return"US"}if(a=="Management"){if(this.emptyOrNull(b)&&c=="c")return"Business";if(this.emptyOrNull(b)&&c=="s")return"Management";if(b=="Business Insight")return c=="c"?"Business":"Business Insight";return"Business"}if(a=="Lifestyle"&&c=="c")return"Life & Style";if(a=="Special Packages"){if(b=="Journal Reports"&&c=="c")return"Special";if(b=="Journal Reports"&&c=="s")return"In-Depth Reports";if(b=="Journal Women"&&c=="c")return"Careers";if(b=="Journal Women"&&c=="s")return"Journal Women"}if(c=="s"&&this.emptyOrNull(b))return a;if(c=="s")return b;if(c=="c")return a},isVideoSupported:function(){if(typeof this._isHtml5==="undefined"){var a=document.createElement("video")||false;this._isH264=(this._isHtml5=a&&typeof a.canPlayType!=="undefined")&&(a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')==="maybe"||a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')==="probably");this._isOgg=this._isHtml5&&(a.canPlayType('video/ogg; codecs="theora, vorbis"')==="maybe"||a.canPlayType('video/ogg; codecs="theora, vorbis"')==="probably")}return this._isHtml5},isOggTheoraVideoSupported:function(){return this.isVideoSupported()&&this._isOgg},isH264BaselineVideoSupported:function(){return this.isVideoSupported()&&this._isH264},callThroughDispatch:function(a,b){var c=dojo.create("a",{is:"false"});dojo.place(c,dojo.body());var d=dj.util.Element.identify(c);dojo.connect(c,"click",function(e){dojo.stopEvent(e);if(c.getAttribute("is")!=="true"){c.setAttribute("is","true");a.call(b)}});setTimeout(dojo.hitch(this,function(){this._doEventDispatch(d)}),400)},_doEventDispatch:function(a){var b;a=dojo.byId(a);if(document.createEvent){b=document.createEvent("MouseEvents");if(b.initMouseEvent)b.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);else b=false}b?a.dispatchEvent(b):a.click&&a.click()},makeFBConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openFBShare)},makeEmbedConnection:function(a,b){dojo.connect(dojo.query("#"+
a,b)[0],"click",this,this.openEmbedShare)},makeTWConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openTwitterShare)},makeEmailConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openEmailShare)},makeGplusConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openGPlusShare)},makeLinkedinConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openLinkedinShare)},makeMixiConnection:function(a,b){dojo.connect(dojo.query("#"+
a,b)[0],"click",this,this.openMixiShare)},makeSinaConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openSinaShare)},makeSohuConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openSohuShare)},makeWeiboConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openWeiboShare)},makeQQConnection:function(a,b){dojo.connect(dojo.query("#"+a,b)[0],"click",this,this.openQQShare)},makeUshiConnection:function(a,b){dojo.connect(dojo.query("#"+
a,b)[0],"click",this,this.openUshiShare)},openTwitterShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://twitter.com/intent/tweet?text="+encodeURIComponent(a)+" "+encodeURIComponent(b),"share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openEmailShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://www.emailthis.clickability.com/et/emailThis?clickMap=create&fb=Y&url="+encodeURIComponent(b)+"&title="+encodeURIComponent(a),"share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openGPlusShare:function(a){a.preventDefault();a=dojo.byId(a.target.id);dj.util.Element.getData(a,"headline");a=dj.util.Element.getData(a,"url");if(a.indexOf(".html")>-1)a=a.substring(0,a.indexOf(".html")+5);else if(a.indexOf("?mod")>-1)a=a.substring(0,a.indexOf("?mod"));this.popUp("https://accounts.google.com/ServiceLogin?service=oz&continue=https://plus.google.com/share?url="+encodeURIComponent(a)+"&src=frameless&btmpl=popup&hl=en-US","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openLinkedinShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(b)+"&title="+encodeURIComponent(a)+"","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openSinaShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://service.weibo.com/share/share.php?url="+encodeURIComponent(b)+"&appkey=2992571369&title="+a+'&pic="+d+"&language=zh_tw',"share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openSohuShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://t.sohu.com/third/post.jsp?url="+encodeURIComponent(b)+"%23jtss-tsohu&title="+encodeURIComponent(a)+"&content="+encodeURIComponent(a+" ")+"&pic=","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openWeiboShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://share.v.t.qq.com/index.php?c=share&a=index&title="+encodeURIComponent(a)+"&url="+encodeURIComponent(b)+"&appkey=118cd1d635c44eab9a4840b2fbf8b0fb","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openQQShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(b)+"&title="+encodeURIComponent(a)+"&pics=&summary=","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openUshiShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"headline");b=dj.util.Element.getData(b,"url");if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));this.popUp("http://www.ushi.cn/feedShare/feedShare!sharetomicroblog.jhtml?type=button&loginflag=share&title="+encodeURIComponent(a)+"&url="+encodeURIComponent(b)+"","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openMixiShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);dj.util.Element.getData(b,"headline");a=dj.util.Element.getData(b,"url");b=dj.util.Element.getData(b,"key");if(a.indexOf(".html")>-1)a=a.substring(0,a.indexOf(".html")+5);else if(a.indexOf("?mod")>-1)a=a.substring(0,a.indexOf("?mod"));this.popUp("http://mixi.jp/share.pl?u="+encodeURIComponent(a)+"&k="+b+"","share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},openGPlusShareBC:function(a){a.preventDefault();a=dojo.byId(a.target.id);var b=dj.util.Element.getData(a,"url"),c=document.createElement("g:plusone");dojo.isIE<=7?c.setAttribute("className","nwsvrSGPlus"):c.setAttribute("class","nwsvrSGPlus");c.setAttribute("count","false");c.setAttribute("size","standard");b=b;if(b.indexOf(".html")>-1)b=b.substring(0,b.indexOf(".html")+5);else if(b.indexOf("?mod")>-1)b=b.substring(0,b.indexOf("?mod"));c.setAttribute("href",encodeURIComponent(b));a.appendChild(c);a.setAttribute("isInitialized",true);if(typeof gapi==="undefined"){a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://apis.google.com/js/plusone.js";document.body.appendChild(a)}gapi.plusone.go()},openEmbedShare:function(a){a.preventDefault();var b=dojo.byId(a.target.id);a=dj.util.Element.getData(b,"url");b=dj.util.Element.getData(b,"guidval");if(a){var c="/public/page/videoembedcode.html";if(pID=="0_0_WJPP_6000"||pID=="0_0_WJPP_6001")c="/public/page/0_0_WJPP_6003.html";else if(pID=="0_0_WCNP_6000"||pID=="0_0_WCNP_6001")c="/public/page/0_0_WCNP_6003.html";if(dj.context.videoCenter.EmbedPageURL)c=dj.context.videoCenter.EmbedPageURL;window.open(c+"?url="+a+"&guidval="+b,"popUpPlayer","height=370,width=603,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=no,status=no")}},openFBShare:function(a){a.preventDefault();a=dojo.byId(a.target.id);(a=dj.util.Element.getData(a,"url"))&&this.popUp("http://www.facebook.com/login.php?display=popup&next=http://www.facebook.com/sharer/sharer.php?u="+a,"share","toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1")},popUp:function(a,b,c){(a=window.open(a,b,c))&&a.focus()},getTime:function(a){var b="",c=parseFloat(this.CleanBad(a));b=this.CleanBad(a);var d=this.CleanBad(a),e=b.length;if(e!=4)return a;else if(c>2401)return a;else{if(c>1259){c-=1200;b=String(c);e=b.length;if(e<4)b="0"+b;a=b.substring(0,1)=="0"?b.substring(1,2):b.substring(0,2);c=b.substring(2,4);b=" PM";if(a=="12")b=" AM"}else{a=b.substring(0,1)=="0"?b.substring(1,2):b.substring(0,2);c=b.substring(2,4);b=" AM";if(a=="12")b=" PM";if(d.substring(0,2)=="00")a="12"}if(c>"59")c="???";return a+":"+c+b}},_isIpad:function(){var a=navigator.userAgent.toLowerCase();if(a.match(/iPhone/i)||a.match(/Android/i)||a.match(/iPad/i))return true;return false},_isIE:function(){if(navigator.userAgent.toLowerCase().match(/MSIE/i))return true;return false},scrollToElement:function(a){for(var b=0,c=0;a!=null;){b+=a.offsetLeft;c+=a.offsetTop;a=a.offsetParent}c!==0&&window.scrollTo(b,c)},CleanBad:function(a){for(var b=0,c="";b<a.length;b++)if("eE-0123456789.".indexOf(a.charAt(b))!=-1)c+=a.charAt(b);return c}}})();dojo.provide("dj.widget.videos.view.SimplePlaylist");dojo.require("dj.utils.VideoUtils");(dj.widget.videos.view.SimplePlaylist=function(a){this.controller={};this.configuration={containerID:"vcrNextVideoimg",titleID:"vcrNextVideoinfo"};dojo.mixin(this.configuration,a);this.container=dojo.byId(this.configuration.containerID);this.title=dojo.byId(this.configuration.titleID)}).prototype={init:function(a){this.controller=a;dj.utils.VideoUtils._isIpad()||this.addEvents(this)},addEvents:function(a){dj.lang.addLiveEvent(".upnextvideo","click",function(b){dojo.stopEvent(b);var c=true;dojo.forEach(dojo.query(".selectedCategory"),function(d){if((d=d.id)&&d.indexOf("noshare")!=-1)c=false});a.controller.videoSelected(c)})},render:function(){var a=this.controller.getNextVideo();if(a){this.title.innerHTML='<a id="'+a.id+"~"+this.controller.playlist.videoIndex+'" class="upnextvideo" href="#">'+a.name+"</a>";this.container.innerHTML='<img id="'+a.id+"~"+this.controller.playlist.videoIndex+'" class="upnextvideo" src="'+a.thumbnailURL+'" />';dj.utils.VideoUtils._isIpad()&&this.addiPadEvents(this)}},addiPadEvents:function(a){dojo.query(".upnextvideo").connect("onclick",function(b){dojo.stopEvent(b);a.controller.videoSelected()})}};dojo.provide("dj.widget.videos.controller.AdPlayer");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.widget.videos.model.PlayerTypes");(dj.widget.videos.controller.AdPlayer=function(a,b){this.observer=a||new dj.util.Observer(dj.widget.videos.controller.AdPlayer);this.configuration={flashPlayerPath:"/media/swf/",playerType:dj.widget.videos.model.PlayerTypes.AdPlayer,containerID:"topAd",playerID:""};dojo.mixin(this.configuration,b)}).prototype={init:function(a){this.view=a;this.view.init(this)},render:function(a,b,c){this.view.render(a,b,c)},loadAd:function(a){this.view.loadAd(a.imageURL,a.linkURL)}};dojo.provide("dj.widget.videos.controller.Playlist");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.utils.VideoUtils");(dj.widget.videos.controller.Playlist=function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoPlaylist);this.configuration={};this.playlist=new dj.widget.videos.model.Playlist;dojo.mixin(this.configuration,b)}).prototype={init:function(a){if(a){this.view=a;this.view.init(this)}},render:function(a){if(dj.utils.VideoUtils.nullOrUndefined(this.view))console.error("No view specified for VideoPlaylist");else{this.playlist=a||this.playlist;if(isNaN(this.playlist.videoIndex))this.playlist.videoIndex=-1;this.view&&this.view.render()}},setPlaylist:function(a){this.playlist=a},getCurrentVideo:function(){return this.playlist.videos.items[this.playlist.videoIndex]},videoSelected:function(a){this.observer.fireByName("onVideoSelected",this.getCurrentVideo().id,"","",a)},getNextVideo:function(){if(isNaN(this.playlist.videoIndex))this.playlist.videoIndex=0;if(this.playlist.videoIndex+1>=this.playlist.videos.items.length)this.playlist.videoIndex=0;else this.playlist.videoIndex++;return this.getCurrentVideo()},getNextVideoID:function(){return this.getNextVideo().id},gerPriorVideoID:function(){return this.playlist.videoIndex-1>=0?this.playlist.videos.items[this.playlist.videoIndex-1].id:null}};dojo.provide("dj.widget.videos.view.FullBrowser");dojo.require("dj.lang");dojo.require("dj.utils.VideoUtils");dojo.require("dj.util.Element");dojo.declare("dj.widget.videos.view.FullBrowser",null,{DEFAULT_CONFIG:{videoThumbsHolder:"videoThumbsHolder",navPageNumbers:"navPageNumbers",videoSearchInput:"videoSearchInput",videoSearchButton:"videoSearchButton",navSearchResults:"navSearchResults",searchResultLabels:"searchResultLabels",defaultSearchType:"wsj-fulltext",searchQueryLabel:"searchTerm",searchForm:"searchForm",thumbnailItemsPerPage:20,thumbnailItemsPerRow:5,addPlacement:4,lastInRowClass:"",vcrRss:"vcrRss",tabPrefix:"vcrTab_",subtabPrefix:"vcrDataPanel_",partnercenterTab:"partnercenter",topnewsTab:"topnews",featuredTab:"featrured",smallCategory:".smallCategory",defaultTopClass:"body",topClass:"pageType-vcrPartnerCenter",registerLiveEvent:false},constructor:function(a){this.controller=null;this.configuration=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),a);this.videoSearchInput=dojo.byId(this.configuration.videoSearchInput);this.videoSearchButton=dojo.byId(this.configuration.videoSearchButton);this.navSearchResults=dojo.byId(this.configuration.navSearchResults);this.searchQueryLabel=dojo.byId(this.configuration.searchQueryLabel);this.searchResultLabels=dojo.byId(this.configuration.searchResultLabels);this.searchForm=dojo.byId(this.configuration.searchForm);this.navPageNumbers=dojo.byId(this.configuration.navPageNumbers);this.videoThumbsHolder=dojo.byId(this.configuration.videoThumbsHolder);this.rssLink=dojo.byId(this.configuration.vcrRss);this.partnercenterTab=this.configuration.partnercenterTab;this.topnewsTab=this.configuration.topnewsTab;this.featuredTab=this.configuration.featuredTab;this.tabPrefix=this.configuration.tabPrefix;this.subtabPrefix=this.configuration.subtabPrefix;this.smallCategory=this.configuration.smallCategory},init:function(a){this.controller=a;this.configuration.registerLiveEvent&&this.addEvents()},addEvents:function(){var a=this;dojo.query(".nav_collection_class").connect("onclick",function(b){var c=dojo.byId("videoBrowserAdv");a.videoBrowserAdObj=c?c:a.videoBrowserAdObj;dojo.stopEvent(b);b=b.srcElement||b.target;if(!(b.tagName!=="span"&&b.tagName!=="SPAN")){c=dj.util.Element.getData(b.parentNode,"vcrrss");try{dojo.forEach(dojo.query(".selectedCategory"),function(g){dojo.removeClass(g,"selectedCategory")});var d=b.parentNode.parentNode.id;if(d===a.tabPrefix+a.partnercenterTab.toLowerCase())try{this.subPCSelect=this.subPCSelect||dojo.byId(a.subtabPrefix+a.partnercenterTab.toLowerCase());(this.subLi=this.subLi||dojo.query(a.smallCategory,this.subPCSelect)[1])&&dojo.addClass(this.subLi,"selectedCategory")}catch(e){}else try{if(d===a.tabPrefix+a.topnewsTab.toLowerCase()){this.subTopSelect=this.subTopSelect||dojo.byId(a.subtabPrefix+a.topnewsTab.toLowerCase());(this.subTopLi=this.subTopLi||dojo.query(a.smallCategory,this.subTopSelect)[0])&&dojo.addClass(this.subTopLi,"selectedCategory")}else if(d===a.tabPrefix+a.featuredTab.toLowerCase()){this.subFeaSelect=this.subFeaSelect||dojo.byId(a.subtabPrefix+a.featuredTab.toLowerCase());(this.subFeaLi=this.subFeaLi||dojo.query(a.smallCategory,this.subFeaSelect)[0])&&dojo.addClass(this.subFeaLi,"selectedCategory")}}catch(f){}}catch(k){}c=c.split("~");dojo.attr(a.rssLink,"href",c[0]);a.rssLink.innerHTML=c[1]+" VIDEO FEED";a.navigationExpand(b);d=dj.util.Element.getData(b.parentNode,"query");c=dj.util.Element.getData(b.parentNode,"linid");a.controller.requestVideos([d,c,b.id],1,false)}});dojo.query(".subnav_collection_class").connect("onclick",function(b){var c=dojo.byId("videoBrowserAdv");a.videoBrowserAdObj=c?c:a.videoBrowserAdObj;dojo.stopEvent(b);b=b.srcElement||b.target;c=dj.util.Element.getData(b.parentNode,"query");var d=dj.util.Element.getData(b.parentNode,"linid"),e=dj.util.Element.getData(b.parentNode,"vcrrss");e=e.split("~");dojo.attr(a.rssLink,"href",e[0]);a.rssLink.innerHTML=e[1]+" VIDEO FEED";a.navigationSelectSub(b);a.controller.requestVideos([c,d,b.id],1,false)});dj.utils.VideoUtils._isIpad()||dj.lang.addLiveEvent(".previewThumb, .videoHealinelink, .play","click",function(b){dojo.stopEvent(b);b=dj.util.Element.getData(b.srcElement||b.target,"guid-index").split("~");var c=true;dojo.forEach(dojo.query(".selectedCategory"),function(e){if((e=e.id)&&e.indexOf("noshare")!=-1)c=false});try{a.controller.currentHTMLVIndex=parseInt(b[1])}catch(d){a.controller.currentHTMLVIndex+=1}a.controller.selectVideo(b[0],b[1],c);a.partnerChannel(a)})},partnerChannel:function(a){try{a.whatsOnObj=a.whatsOnObj||dojo.byId("whatsOn");a.whatsOnPCObj=a.whatsOnPCObj||dojo.byId("pcWhatsOn");a.watchEdgeObj=a.watchEdgeObj||dojo.byId("watchEdge");dojo.forEach(dojo.query(".categoryOpen"),function(c){if(c.id===a.configuration.tabPrefix+a.configuration.partnercenterTab){dojo.query(a.configuration.defaultTopClass).addClass(a.configuration.topClass);a.whatsOnPCObj&&dojo.hasClass(a.whatsOnPCObj,"hidden")&&dojo.removeClass(a.whatsOnPCObj,"hidden");dojo.addClass(a.whatsOnObj,"hidden");dojo.addClass(a.watchEdgeObj,"hidden")}else if(dojo.hasClass(a.whatsOnObj,"hidden")){dojo.query(a.configuration.defaultTopClass).removeClass(a.configuration.topClass);dojo.removeClass(a.whatsOnObj,"hidden");dojo.removeClass(a.watchEdgeObj,"hidden");dojo.addClass(a.whatsOnPCObj,"hidden")}})}catch(b){}},render:function(a,b,c,d){if(dj.utils.VideoUtils.nullOrUndefined(this.controller))console.error("No controller specified for FullBrowser view");else{this.renderThumbnails(a,b,c,d);this.renderNavigation();dojo.byId(this.controller.currentSection)&&this.controller.currentType==="wsj-section"&&this.navigationExpand(dojo.byId(this.controller.currentSection))}},renderThumbnails:function(a,b,c,d){this.videoBrowserAdObj=this.videoBrowserAdObj||dojo.byId("videoBrowserAdv");var e="",f=true,k=this.configuration.thumbnailItemsPerPage,g=this.controller.currentPage;dojo.forEach(dojo.query(".selectedCategory"),function(t){if((t=t.id)&&t.indexOf("noadvertisment")!=-1){f=false;if(g===1)k+=1}});var h=k*(this.controller.currentPage-1);if(!f&&this.controller.currentPage!=1)h+=1;if(this.configuration.addPlacement>0&&this.controller.currentPage!=1)h-=1;var o=h+k;if(this.configuration.addPlacement>0&&this.controller.currentPage===1)o-=1;o=o>this.controller.browserPlayList.items.length?this.controller.browserPlayList.items.length:o;for(h=h;h<o;h++){var l=h%this.configuration.thumbnailItemsPerRow;if(h===this.configuration.addPlacement&&f)if(dj.utils.VideoUtils.hasValidFlashVersion())if(typeof this.videoBrowserAdObj!=undefined&&this.videoBrowserAdObj!=null){var n=dj.util.Element.getData(this.videoBrowserAdObj,"imageurl"),r=dj.util.Element.getData(this.videoBrowserAdObj,"linkurl");e+="<li id='videoBrowserAdv' data-imageurl='"+n+"' data-linkurl='"+r+"'  class='ad'><a target='_blank' href='"+r+"'><img src='"+n+"'/></a></li>"}else if(typeof d!=undefined&&d!=null){n=dj.util.Element.getData(d,"imageurl");r=dj.util.Element.getData(d,"linkurl");if(n)e+="<li id='videoBrowserAdv' data-imageurl='"+n+"' data-linkurl='"+r+"'  class='ad'><a target='_blank' href='"+r+"'><img src='"+n+"'/></a></li>"}else e+="<li id='videoBrowserAdv' class='ad'></li>";else{n=Math.floor(Math.random()*1E10);e+="<li id='videoBrowserAdv' class='ad'><a href='http://ad.doubleclick.net/jump/interactive.wsj.com/ipad_coad;sz=170x175;ord="+n+"' target='_blank'><img src='http://ad.doubleclick.net/ad/interactive.wsj.com/ipad_coad;sz=170x175;ord="+n+"'></a></li>"}e+=this.configuration.lastInRowClass!=""&&l+1==this.configuration.thumbnailItemsPerRow?"<li class='"+this.configuration.lastInRowClass+"' id='li_":"<li id='li_";e+=this.controller.browserPlayList.items[h].id+"'><a data-guid-index='"+this.controller.browserPlayList.items[h].id+"~"+h+"' class='play' href='#'></a>";e+="<a href='#' class='previewThumb' data-guid-index='"+this.controller.browserPlayList.items[h].id+"~"+h+"'><img id='img_"+this.controller.browserPlayList.items[h].id+"~"+h+"' data-guid-index='"+this.controller.browserPlayList.items[h].id+"~"+h+"' href='#' src='"+this.controller.browserPlayList.items[h].thumbnailURL+"' class='previewThumb'></a>";firstClass="";l=this.controller.browserPlayList.items[h].formattedCreationDate.split(" ");n=l[1].split(":");l=l[0]+"&nbsp;&nbsp;"+(n[0]+":"+n[1])+l[2].toLowerCase();n=dj.utils.VideoUtils.formatDuration(this.controller.browserPlayList.items[h].duration);e+="<h2 class='videoHeadline'><a class='videoHealinelink' href='#' data-guid-index='"+this.controller.browserPlayList.items[h].id+"~"+h+"' id='"+this.controller.browserPlayList.items[h].id+"~"+h+"' href='#'>"+this.controller.browserPlayList.items[h].name+"</a></h2><small>"+l+"&nbsp;&nbsp;&nbsp;<em></em> "+n+"</small>";e+="</li>"}try{if(a)this.videoThumbsHolder.innerHTML+=e;else this.videoThumbsHolder.innerHTML=e}catch(p){}if(typeof b!=undefined&&b!=null)try{this.controller.lineupId=b.toLowerCase();if(this.subTabObj=dojo.byId(this.controller.lineupId+"_li"))dojo.addClass(this.subTabObj,"selectedCategory");else{var m=URL_KEYS[this.controller.lineupId];if(m){if(this.subTabObj=dojo.byId(m.section.toLowerCase()+"_li")){dojo.addClass(this.subTabObj,"selectedCategory");c=m.parent.toLowerCase()}}else{var q=this.controller.lineupId.split("_");if(m=URL_KEYS[q[0]])if(this.subTabObj=dojo.byId(m.section.toLowerCase()+"_li")){dojo.addClass(this.subTabObj,"selectedCategory");c=m.parent.toLowerCase()}}}if(this.subCatObj=dojo.byId("vcrDataPanel_"+c.toLowerCase())){dojo.forEach(dojo.query(".subCategories"),function(t){dojo.addClass(t,"hidden")});dojo.removeClass(this.subCatObj,"hidden")}}catch(s){}if(typeof c!=undefined&&c!=null)try{if(this.parentObj=dojo.byId("vcrTab_"+c.toLowerCase())){dojo.forEach(dojo.query(".categoryOpen"),function(t){dojo.removeClass(t,"categoryOpen")});dojo.addClass(this.parentObj,"categoryOpen")}}catch(u){}dj.utils.VideoUtils._isIpad()&&this.addLiveEvents(this)},addLiveEvents:function(a){dojo.query(".previewThumb, .videoHeadline, .play").connect("onclick",function(b){dojo.stopEvent(b);b=dj.util.Element.getData(b.srcElement||b.target,"guid-index").split("~");var c=true;dojo.forEach(dojo.query(".selectedCategory"),function(e){if((e=e.id)&&e.indexOf("noshare")!=-1)c=false});try{a.controller.currentHTMLVIndex=parseInt(b[1])}catch(d){a.controller.currentHTMLVIndex+=1}a.controller.selectVideo(b[0],b[1],c);a.partnerChannel(a)})},highligthThumbnail:function(a){var b=dojo.byId("firstthumbnail");b&&b.parentNode.removeChild(b);a=dojo.byId("li_"+a);try{a&&dojo.create("span",{"class":"featured nowPlaying",id:"firstthumbnail",innerHTML:"Now Playing"},a,"last")}catch(c){}},navigationSelectSub:function(a){dojo.forEach(dojo.query(".selectedCategory"),function(b){dojo.removeClass(b,"selectedCategory")});dojo.addClass(a.parentNode.parentNode,"selectedCategory")},navigationExpand:function(a){dojo.forEach(dojo.query(".subCategories"),function(b){dojo.addClass(b,"hidden")});dojo.forEach(dojo.query(".categoryOpen"),function(b){dojo.removeClass(b,"categoryOpen")});a=a.parentNode.parentNode;dojo.addClass(a,"categoryOpen");a=a.id.split("_");dojo.removeClass(dojo.byId("vcrDataPanel_"+a[1]),"hidden")},renderNavigation:function(){var a="";a+=this.controller.currentPage===1?'<span class="nav_prev">&laquo;</span>':'<a class="nav_prev navPrevious" href="#">&laquo;</a>';for(var b=this.controller.browserPlayList.items.length,c=0;b>0;){c++;b-=this.configuration.thumbnailItemsPerPage;a+=this.controller.currentPage==c?"<li><span>"+c+"</span></li>":'<li><a class="navToPage" id="'+c+'" href="#">'+c+"</a></li>"}},search:function(a){this.controller.requestVideos([this.configuration.defaultSearchType,a,""],1,true);this.searchQueryLabel.innerHTML=a;this.showSearchLabels()},sort:function(a){this.controller.requestVideos([this.controller.currentType,this.controller.currentQuery,""],1,true,a);for(var b=dojo.query(".sortOption"),c=0;c<b.length;c++)dojo.removeClass(b[c].parentNode,"selected");dojo.addClass(dojo.byId(a).parentNode,"selected")},renderLoading:function(){this.videoThumbsHolder.innerHTML='<div style="width:100%;height:250px;padding-top:200px;text-align:center"><img src="/static_html_files/video/VideoCenterPreloader.gif" /><br />Loading</div>'}});dojo.provide("dj.utils.VideoTracking");dojo.require("dj.utils.VideoUtils");dojo.require("dj.util.Tracking");dojo.require("dj.util.ie9.pin");dojo.require("dj.util.Cookie");dj.utils.VideoTracking={configuration:{adFormat:"frmt=2;",allowfullscreen:true},init:function(){if(typeof this.omniture!=="object"){this.omniture=dj.util.Tracking.omniture;var a=dj.util.Page.getQueryParam("site"),b="";try{b=dj.context.videoCenter.host}catch(c){console.error("{Player} error while getting site value from context. ",c.message)}this.site=a?a:b;this.msrc=dj.util.Page.getQueryParam("msrc")}},fire:function(a){try{this.init();var b=this._getOmnitureObject(a),c=this._getCurrentOmnitureObject(b);this._setOmnitureData(b);this._firePixel();this._setOmnitureData(c)}catch(d){console.error("{VideoTracking} ",d)}},addVideoParameters:function(a){var b="WSJ_";params={};if(this.seekTime){params.seekTime=this.seekTime;this.seekTime=null}params.emailPartnerID=110626;params.site=this.site;params.msrc=this.msrc;params.adFrmt=this.configuration.adFormat;params.playerName="HTML5Player";params.embedPlayerURL="";params.embedConfigURL="";params.embedPlayerID="1000";params.embedName="HTML5Player";params.embedBaseURL="HTML5Player";params.embedHeight="";params.embedWidth="";params.larsID=91;params.larsAdTrackingID=1259;params.allowfullscreen=this.configuration.allowfullscreen;if(this.playedOn)params.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");params.prop59=dj.util.Cookie.getCookie("referrerURL");if(params.prop59===undefined||""===params.prop59||params.prop59===null){var c=document.referrer;try{if(c!==undefined&&""!==c){c=c.substring(c.indexOf("http://")+7);params.prop59=c.substring(0,c.indexOf("/"))}}catch(d){}}params.prop60=dj.util.Cookie.getCookie("sitereferrer");params.prop62=b+a.tabCategory;params.prop48=dj.util.ie9.pin.siteMode();var e=dj.util.Region.getViewByRegion();try{params.prop24=dj.util.Omniture.editionToNameMap[e.toLowerCase()]}catch(f){}params.pageName="WSJLive_Video_article type_"+a.titletag;params.prop1="Video";params.prop13=a.adZone;params.prop20="video_"+a.id;params.prop21="WSJLive_"+a.author;params.prop23="video_"+a.formattedCreationDate;params.prop27="";try{dj.util.User.isLoggedIn(function(p){if(p)dj.util.User.isSubLoggedIn(function(m){if(m)dj.util.User.hasRole("WSJ-PRO",function(q){if(q){b="WSJPRO_";params.prop27="WSJ_proc_sub_yes"}else dj.util.User.hasRole("WSJ-ENT",function(s){if(s){b="WSJPRO_";params.prop27="WSJ_proe_sub_yes"}else params.prop27="WSJ_sub_yes"})});else params.prop27="WSJ_mem_yes"});else params.prop27=params.cookieUserType===null||params.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(k){try{params.prop27=params.cookieUserType===null||params.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"}catch(g){}}e=dj.utils.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"s");var h=dj.utils.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"c");if((typeof h==undefined||h==null)&&params.tabCategory=="Partner Channel"){h=params.tabCategory;if((typeof e==undefined||e==null)&&params.tabCategory=="Partner Channel")e=params.subTabCategory}params.appName=b.substring(0,b.length-1);params.appType="HTML5Player";params.section=h;params.subsection=e;params.prop2="WSJLive_"+h;params.prop3="WSJLive_Video_"+h;params.prop4="WSJLive_Video_"+h+"_"+
a.titletag+"_"+a.duration;params.prop26="WSJLive_"+e;params.prop5=window.location.href.split("?")[0];params.prop6=window.location.href;params.prop7="off";params.prop8="video_"+a.doctypeID;params.prop9="free";try{params.prop10=dj.util.Page.getQueryParam("mod")&&""!=dj.util.Page.getQueryParam("mod")?dj.util.Page.getQueryParam("mod"):dj.util.Page.getQueryParam("link")}catch(o){}params.prop16="WSJLive_video_"+a.subTabCategory;params.campaign=params.prop10;try{if((c=document.referrer)&&""!==c){c=c.substring(c.indexOf("//")+
2);var l=c.substring(0,c.indexOf("/"));l=l.toLowerCase()}}catch(n){}params.prop25=dj.util.Cookie.getCookie("TR");try{params.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(r){console.error("cookie read error while fetching cookieUserType : "+r)}a=typeof pID==="string"&&pID.indexOf("0_0_WH")!=-1?"1":"0";params.suppressAds=a;return params},_getOmnitureObject:function(a){omObj=this.addVideoParameters(a);console.log("Omniture HTML5 Here *******))))))))(((((((((((**********");console.log(omObj);return omObj},_getCurrentOmnitureObject:function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c))b[c]=this.omniture.getMetaData(c);return b},_setOmnitureData:function(a){for(var b in a)a.hasOwnProperty(b)&&this.omniture.setMetaData(b,a[b])},_firePixel:function(){this.omniture.firePixel(true)}};dojo.provide("dj.widget.videos.view.WhatsOnTodayView");dojo.require("dj.utils.VideoUtils");dojo.require("dojo.date");dojo.require("dojo.date.locale");dojo.require("dj.util.Element");dojo.declare("dj.widget.videos.view.WhatsOnTodayView",null,{constructor:function(a){this.configuration={name:"WhatsOnTodayView",scheduleContainerId:"whatsOn"};dojo.mixin(this.configuration,a);this.viewCreated=false},render:function(){var a=this.configuration.wsjTvSchedule;try{if(typeof a!="object")a=dojo.fromJson(a)}catch(b){console.error("{WhatsOnTodayView} - Error parsing jsonObject : "+a)}for(var c=dojo.byId(this.configuration.scheduleContainerId),d="",e="",f="",k=0,g=null,h="",o=0,l=null,n="showList prevDayList unclosed",r=false,p=a.schedules.length-1;p>=0;p--){g=a.schedules[p];var m=g.pubdate;h=new Date(m);m=m.split(" ");var q=m[4].split(":");q=Date.UTC(m[3],h.getUTCMonth(),m[1],q[0],q[1],q[2]);q=new Date(q);var s=m[2]+" "+m[1];if(l!==s){l=new Date;l=new Date(l.getUTCMonth()+1+"/"+l.getUTCDate()+"/"+l.getUTCFullYear());h=new Date(h.getUTCMonth()+1+"/"+h.getUTCDate()+"/"+h.getUTCFullYear());if(l.getTime()==h.getTime()){h="Today,";n="showList today currentShowList unclosed"}else if(l.getTime()<h.getTime()){h=m[0];n="showList nextDayList unclosed";f=""}else{f="hidden";h=m[0];n=r?"showList nextDayList unclosed":"showList prevDayList unclosed"}if(o!==0)d+="</ul>";else{if(h==="Today,")e="hidden";if((l.getDay()===6||l.getDay()===0)&&(m[0]==="Mon,"||m[0]==="MON,"||m[0]==="mon,")){h=m[0];n="showList today currentShowList unclosed";f="";e="hidden";r=true}}l=s;d=d+'<ul id="showList~'+o+'" class="'+n+'"><li class="whatsOnDate unclosed"><span class="unclosed">'+h.substring(0,h.length-1)+'</span><h4 class="unclosed">'+
s+"</h4></li>";o++}m=q.getHours();q=q.getMinutes();if(m<10)m="0"+m;if(q<10)q="0"+q;m=dj.utils.VideoUtils.getTime(m+":"+q);g=g.showname;q="";if(PROGRAM_KEYS)try{var u=g.replace(/ /g,"");q=PROGRAM_KEYS[u]}catch(t){}d=d+'<li id="whatsOnProgram~'+k+"~"+q+'" data-showname="'+g+'" class="whatsOnProgram timeprogram unclosed"> <span       class="time timeprogram unclosed">'+m+'</span><span class="program timeprogram"      >'+g+'</span> <span       class="whatsBanner unclosed"></span></li>';k++}d='<span id="whatsToday" class="whatsToday">What\'s on Today</span>'+
('<span id="moreNavprevDay" class="'+e+' moreNav prevDay unclosed"></span><span id="moreNavnextDay" class="'+f+' moreNav nextDay unclosed"></span><div id="whatsOnDropdown"  class="whatsOnDropdown transitioning unclosed"><div id="whatsOnDropdownBackground" class="whatsOnDropdownBackground unclosed">')+d;d+="</ul>";d+="</div> \t</div>";c.innerHTML=d+this.renderScheduleDescription(a.schedules);this.addEvents()},mouseoutEvent:function(a){if(!a)a=window.event;a.stopPropagation();return false},addEvents:function(){var a=this;viewController=this.configuration.videoBrowser;a.whatsOnObj=dojo.byId("whatsOn");var b=dojo.byId("whatsOnDropdown");a.whatsOnDropdown=b;a.dropdownTimeout=null;a.innerFlag=false;dojo.query(".whatsToday").connect("onclick",function(c){try{dojo.stopEvent(c);console.log("that.dropdownTimeout   "+a.dropdownTimeout);if(dojo.hasClass(a.whatsOnObj,"whatsOpen")){a.innerFlag=false;dojo.removeClass(a.whatsOnObj,"whatsOpen");dojo.attr(a.whatsOnDropdown,"style","display:none");a.dropdownTimeout&&clearTimeout(a.dropdownTimeout)}else{a.innerFlag=true;dojo.addClass(a.whatsOnObj,"whatsOpen");dojo.attr(a.whatsOnDropdown,"style","display:block")}}catch(d){}});dojo.query(".whatsToday").connect("onmouseover",function(c){try{console.log("onmouseover onmouseover onmouseover onmouseover onmouseover ");dojo.stopEvent(c);a.dropdownTimeout=setTimeout(dojo.hitch(a,function(){a.innerFlag=true;dojo.addClass(a.whatsOnObj,"whatsOpen");dojo.attr(a.whatsOnDropdown,"style","display:block")}),200)}catch(d){}});dojo.query(".whatsToday").connect("onmouseout",function(c){try{console.log("onmouseout onmouseout onmouseout onmouseout onmouseout ");dojo.stopEvent(c);if(dojo.hasClass(a.whatsOnObj,"whatsOpen")){console.log("has class>>>>>>>>>>>>>>>>>>> ");a.dropdownTimeout=setTimeout(dojo.hitch(a,function(){a.innerFlag=true;dojo.removeClass(a.whatsOnObj,"whatsOpen");dojo.attr(a.whatsOnDropdown,"style","display:none")}),500)}else{console.log("Go away class>>>>>>>>>>>>>>>>>>> ");a.innerFlag=false;a.dropdownTimeout&&clearTimeout(a.dropdownTimeout)}}catch(d){}});dojo.query(".whatsOnDropdown").connect("onmouseout",function(c){c.stopPropagation();if(dojo.query(".drawerOpen")===undefined||dojo.query(".drawerOpen")===null||dojo.query(".drawerOpen").length<=0){try{a.dropdownTimeout=setTimeout(dojo.hitch(a,function(){dojo.removeClass(a.whatsOnObj,"whatsOpen");dojo.attr(a.whatsOnDropdown,"style","display:none");dojo.addClass(a.whatsOnDropdown,"transitioning")}),500)}catch(d){}return false}});dojo.query(".whatsOnDropdown, .moreNav, .whatsOnDate").connect("onmouseover",function(c){try{c.stopPropagation();a.dropdownTimeout&&clearTimeout(a.dropdownTimeout);return false}catch(d){}});dojo.query(".whatsThis").connect("onmouseover",function(c){dojo.stopEvent(c);dojo.forEach(dojo.query(".whatsHover"),function(d){dojo.attr(d,"style","display: block;")})});dojo.query(".whatsThis").connect("onmouseout",function(c){dojo.stopEvent(c);dojo.forEach(dojo.query(".whatsHover"),function(d){dojo.attr(d,"style","display: none;")})});dojo.query(".timeprogram").connect("onclick",function(c){try{dojo.stopEvent(c);dojo.removeClass(a.whatsOnDropdown,"transitioning");var d=c.srcElement||c.target;dojo.forEach(dojo.query(".time"),function(k){dojo.removeClass(k.parentNode,"selected")});dojo.forEach(dojo.query(".whatsOnDrawer"),function(k){dojo.removeClass(k,"drawerOpen")});c=null;var e="";if(d.nodeName=="LI"){c=d.id.split("~");dojo.addClass(d,"selected");e=dj.util.Element.getData(d,"showname")}else{c=d.parentNode.id.split("~");dojo.addClass(d.parentNode,"selected");e=dj.util.Element.getData(d.parentNode,"showname")}dj.module.videos.whatsOnToday.populateDescription(c[2],"uldrawerLatest~"+c[1],e);dojo.addClass(dojo.byId("whatsOnDrawer~"+
c[1]),"drawerOpen")}catch(f){}});dojo.query("span.close").connect("onclick",function(c){dojo.stopEvent(c);dojo.forEach(dojo.query(".whatsOnDrawer"),function(e){dojo.removeClass(e,"drawerOpen")});dojo.forEach(dojo.query(".time"),function(e){dojo.removeClass(e.parentNode,"selected")});try{a.dropdownTimeout=setTimeout(dojo.hitch(a,function(){dojo.removeClass(a.whatsOnObj,"whatsOpen");dojo.attr(a.whatsOnDropdown,"style","display:none");dojo.addClass(a.whatsOnDropdown,"transitioning")}),500)}catch(d){}});dojo.query(".allType").connect("onclick",function(c){try{dojo.stopEvent(c);var d=c.srcElement||c.target;dojo.forEach(dojo.query(".whatsOnDrawer"),function(p){dojo.removeClass(p,"drawerOpen")});dojo.forEach(dojo.query(".time"),function(p){dojo.removeClass(p.parentNode,"selected")});dojo.removeClass(dojo.byId("whatsOn"),"whatsOpen");dojo.attr(dojo.byId("whatsOnDropdown"),"style","display:none");var e=dj.util.Element.getData(d,"showname");if(PROGRAM_SUB_KEYS){c=null;try{var f=e.replace(/ /g,"");c=PROGRAM_SUB_KEYS[f]}catch(k){}if(c!=null&&c!=undefined){c=c.toLowerCase();d=dojo.byId(c);var g=d.parentNode.id.split("~"),h=dj.util.Element.getData(d.parentNode,"vcrrss");dojo.attr(dojo.byId("vcrRss"),"href",h);dojo.forEach(dojo.query(".categoryOpen"),function(p){dojo.removeClass(p,"categoryOpen")});var o=dojo.byId("vcrTab_programs");dojo.addClass(o,"categoryOpen");dojo.forEach(dojo.query(".subCategories"),function(p){dojo.addClass(p,"hidden")});var l=dojo.byId("vcrDataPanel_programs");dojo.removeClass(l,"hidden");dojo.forEach(dojo.query(".selectedCategory"),function(p){dojo.removeClass(p,"selectedCategory")});dojo.addClass(d.parentNode.parentNode,"selectedCategory");var n=dojo.byId("videoBrowserAdv");viewController.requestVideos([g[0],"",d.id],1,false,null,n);dj.utils.VideoUtils.scrollToElement(d)}}}catch(r){}});dojo.query(".prevDay").connect("onclick",function(c){try{dojo.stopEvent(c);dojo.addClass(a.whatsOnDropdown,"transitioning");dojo.forEach(dojo.query(".whatsOnDrawer"),function(g){dojo.removeClass(g,"drawerOpen")});dojo.forEach(dojo.query(".time"),function(g){dojo.removeClass(g.parentNode,"selected")});var d="";dojo.forEach(dojo.query(".currentShowList"),function(g){d=g.id.split("~");dojo.removeClass(g,"currentShowList");dojo.removeClass(g,"today");dojo.addClass(g,"nextDayList")});var e=d[1];if(e>0){e-=1;var f=dojo.byId("showList~"+e);dojo.removeClass(f,"prevDayList");dojo.addClass(f,"today");dojo.addClass(f,"currentShowList");dojo.removeClass(dojo.byId("moreNavprevDay"),"hidden");dojo.removeClass(dojo.byId("moreNavnextDay"),"hidden");e===0&&dojo.addClass(dojo.byId("moreNavprevDay"),"hidden")}}catch(k){}});dojo.query(".nextDay").connect("onclick",function(c){try{dojo.stopEvent(c);dojo.addClass(a.whatsOnDropdown,"transitioning");dojo.forEach(dojo.query(".whatsOnDrawer"),function(h){dojo.removeClass(h,"drawerOpen")});dojo.forEach(dojo.query(".time"),function(h){dojo.removeClass(h.parentNode,"selected")});var d="";dojo.forEach(dojo.query(".currentShowList"),function(h){d=h.id.split("~");dojo.removeClass(h,"currentShowList");dojo.removeClass(h,"today");dojo.addClass(h,"prevDayList")});var e=d[1],f=dojo.query(".showList").length;if(e<f){e++;var k=dojo.byId("showList~"+e);if(k){dojo.removeClass(k,"nextDayList");dojo.addClass(k,"today");dojo.addClass(k,"currentShowList")}dojo.removeClass(dojo.byId("moreNavprevDay"),"hidden");dojo.removeClass(dojo.byId("moreNavnextDay"),"hidden");e===f-1&&dojo.addClass(dojo.byId("moreNavnextDay"),"hidden")}}catch(g){}});window.onclick=function(c){try{var d=c.srcElement||c.target;c="";if(d.className)c=d.className;if(dojo.query(".drawerOpen")===undefined||dojo.query(".drawerOpen")===null||dojo.query(".drawerOpen").length<=0&&c.indexOf("unclosed")===-1){dojo.removeClass(dojo.byId("whatsOn"),"whatsOpen");dojo.attr(dojo.byId("whatsOnDropdown"),"style","display:none");dojo.addClass(dojo.byId("whatsOnDropdown"),"transitioning")}}catch(e){}}},renderScheduleDescription:function(a){for(var b='<div id="whatsOnDrawerAll" class="whatsOnDrawerAll">',c=0,d=a.length-1;d>=0;d--){schedule=a[d];b=b+'<div id="whatsOnDrawer~'+
c+'" class="whatsOnDrawer">\t\t<span class="close">Close&nbsp;&nbsp;X</span>\t\t<div class="drawerProgram">\t\t\t<img src="'+schedule.thumbnail+'" />\t\t\t<div class="drawerInfo">\t\t\t\t<h3 class="property">'+schedule.showname+'</h3>\t\t\t\t<span class="dateTime">'+schedule.pubdate+"</span>\t\t\t\t<p>"+schedule.description+'</p>\t\t\t</div>\t\t</div>\t\t<div id="drawerLatest~'+c+'" class="drawerLatest">\t\t\t<span class="latestBanner">Latest From <em>'+schedule.showname+'</em></span>\t\t\t<ul id="uldrawerLatest~'+
c+'">\t\t\t</ul>\t\t</div>\t\t<a href="#" class="allType">View All Digits Videos &raquo;</a>\t</div>';c++}return b+"</div>"}});dojo.provide("dj.widget.videos.view.AdPlayer");dojo.require("dj.utils.VideoUtils");dojo.require("dj.widget.videos.model.SWFPlayer");(dj.widget.videos.view.AdPlayer=function(a){this.controller={};this.configuration={name:"adPlayer",width:300,height:60};dojo.mixin(this.configuration,a);this.container=dojo.byId(this.configuration.containerID)}).prototype={init:function(a){this.controller=a},render:function(a,b,c){var d=this.controller.configuration;this._setDefaultSize(d.containerID);if(dj.utils.VideoUtils.hasValidFlashVersion()){if(!this.playerCreated){this.playerCreated=true;var e=new dj.widget.videos.model.SWFPlayer;e.id=d.playerID;e.swfURL=d.flashPlayerPath+d.playerType.swfFile;e.containerID=d.containerID;e.width=d.playerType.width;e.height=d.playerType.height;e.host=d.host;dj.utils.VideoUtils.createSWFPlayer(e)}if(c){c.args={imageURL:a,linkURL:b};setTimeout(dojo.hitch(c,function(){c.loadAd(c.args)}),800)}}},loadAd:function(a,b){try{console.log("****************** imageURL  **************** "+a);if(b==null||b=="")b="#";if(typeof swfobject!==undefined){var c=swfobject.getObjectById(this.controller.configuration.playerID);if(typeof c!==undefined&&c!==null)c.loadAd(a,b);else dojo.byId(this.controller.configuration.playerID).innerHTML='<a href="'+b+'"><img src="'+a+'"/></a>'}else dojo.byId(this.controller.configuration.playerID).innerHTML='<a href="'+b+'"><img src="'+a+'"/></a>'}catch(d){}},_setDefaultSize:function(a){(a=dojo.byId(a))&&dojo.style(a,{width:this.configuration.width+"px",height:this.configuration.height+"px"})}};dojo.provide("dj.widget.videos.controller.VideoBrowser");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.utils.VideoUtils");dojo.require("dj.widget.videos.model.Playlist");(dj.widget.videos.controller.VideoBrowser=function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoBrowser);this.configuration={videoCollectionAPIURL:"/api-video/find_all_videos.asp",defaultQuery:"count=59&query=News&type=wsj-section&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection,linkShortURL",defaultSelectionID:"news",defaultParentID:"topnews",flashPlayerPath:"/media/swf/"};this.currentHTMLVIndex=0;this.addToConfig(b);this.currentSection=this.currentVideoID=this.currentQuery="";this.browserAdPlayer=this.browserPlayList=null;this.currentPage=1;this.firstLoad=true;this.sortBy="";this.sorting={BY_RELEVANCE:"RELEVANCE",BY_DATE:"DATE"}}).prototype={init:function(a){this.view=a;this.view.init(this)},addToConfig:function(a){dojo.mixin(this.configuration,a)},requestDefaultVideos:function(a,b){this.requestVideos([this.configuration.defaultQuery,this.configuration.defaultSelectionID,this.configuration.defaultParentID,a,b],this.currentPage,false)},selectVideo:function(a,b,c){b=parseInt(b,10);this.currentVideoID=a;this.highligthThumbnail(a);var d=new dj.widget.videos.model.Playlist;d.videos=this.browserPlayList;d.query=this.currentQuery;d.sectionID=this.currentSection;d.videoIndex=b;this.observer.fireByName("onVideoSelected",a,d,b,c)},getVideoIndex:function(a){for(var b=0;b<this.browserPlayList.items.length;b++)if(a==this.browserPlayList.items[b].id)return b;return null},selectVideoByIndex:function(a){a=parseInt(a,10);this.selectVideo(this.browserPlayList.items[a].id,a)},selectVideoByID:function(a){this.selectVideo(a,this.getVideoIndex(a))},highligthThumbnail:function(a){this.view.highligthThumbnail(a)},requestVideos:function(a,b,c,d,e){if(!(a.length<2)){var f=a[0],k=a[1],g=a[2]==""?"":a[2],h=a[3]==""?"":a[3],o=a[4]==""?"":a[4];if(f!==""){this.view.renderLoading();a="";if(f!=this.currentQuery||d){this.currentQuery=f;a=this.configuration.videoCollectionAPIURL+"?"+this.currentQuery;if(d){a+="&sort="+d;this.sortBy=d}var l=this;dojo.xhrGet({url:a,handleAs:"json",preventCache:true,headers:{Accept:"application/json"},load:function(n){var r=-1,p=n.items;if(h!==""&&o!==undefined&&p&&p.length>0){for(var m=0;m<p.length;m++)if(h===p[m].id){r=m;break}if(r===-1){p.splice(0,0,o);p.splice(p.length-1,1);n.items=p}else if(r>0){m=r;var q="",s=p[0];for(p[0]=p[r];m>1;){q=p[m-1];p[m]=q;m-=1}p[1]=s;n.items=p}}l.browserPlayList=n;l.currentSection=k;l.currentParentID=g;l.render(b,null,k,g,e);if(l.firstLoad){l.firstLoad=false;l.observer.fireByName("onFirstLoad")}l.observer.fireByName("onCollectionLoad",{query:l.currentQuery,sectionID:k,parentID:g,responseObj:n});return n},error:function(n){console.error("Could not load the playlist for "+f);return n}})}else this.render(b,null,k,g,e)}}},render:function(a,b,c,d,e){if(a!=this.currentPage)this.currentPage=a;this.view.render(b,c,d,e);try{this.videoBrowserAdObj=this.videoBrowserAdObj||dojo.byId("videoBrowserAdv");if(typeof this.videoBrowserAdObj!=undefined&&this.videoBrowserAdObj!=null){var f=dj.util.Element.getData(this.videoBrowserAdObj,"imageurl"),k=dj.util.Element.getData(this.videoBrowserAdObj,"linkurl");if(typeof f!==undefined&&f!=null&&f!=="")videoBrowserAdObj.innerHTML='<a href="'+k+'"><img src="'+f+'"/></a>'}}catch(g){}}};dojo.provide("dj.widget.videos.controller.Player");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.Omniture");dojo.require("dj.util.Cookie");dojo.require("dj.util.Page");dojo.require("dj.widget.videos.model.PlayerTypes");dojo.require("dj.module.video.taboolaVideo");dojo.require("dj.utils.VideoUtils");dojo.require("dj.util.ie9.pin");dojo.declare("dj.widget.videos.controller.Player",null,{DEFAULT_CONFIG:{flashPlayerPath:"/media/swf/",playerType:dj.widget.videos.model.PlayerTypes.MainPlayer,containerID:"videoPlayer",descriptionID:"currentVideoInfo",nextVideoContainer:"vcrNextVideo",dateActionsTicker:"dateActionsTicker",playerID:"",videoAPIURL:"/api-video/get_video_info.asp",embedConfURL:"http://wsj.vo.llnwd.net/o28/players/",eventNamespace:"",host:location.host,applications:["video","video_popup","video_tab","video_emb","video_external","video_live"],applicationID:0,loadWaitTime:1E3,loadWaitCount:10,dataset:{},adFormat:"frmt=2;",videoPageValue:"videoPlay",videotrackId:"",allowfullscreen:true,shareenabled:false,categoryOpen:".categoryOpen",selectedCategory:".selectedCategory",enableVideoModuleChaining:0},constructor:function(a,b){this.observer=a||new dj.util.Observer(dj.widget.video.VideoPlayer);this.configuration=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),b);this.videoInformation={};this.view=this.seekTime=null;this.readyForEvents=false;this.playedOn=null;var c=dj.util.Page.getQueryParam("site"),d="";try{d=dj.context.videoCenter.host}catch(e){console.error("{Player} error while getting site value from context. ",e.message)}this.site=c?c:d;this.msrc=dj.util.Page.getQueryParam("msrc")},init:function(a,b,c,d){if(c)this.seekTime=c;this.view=a;if(d&&d!="")this.playedOn=d;this.view.init(this);if(b)d&&d!=""?this.playVideo(b,d):this.playVideo(b);this.loadRetriesLeft=this.configuration.loadWaitCount},playVideo:function(a,b,c){if(b)this.playedOn=b;this.loadRetriesLeft=this.configuration.loadWaitCount;this.view.renderPreloader&&this.view.renderPreloader();this.queryVideo(a,c);this.hideLivePlayer()},hideLivePlayer:function(){try{this.liveObj=this.liveObj||dojo.byId("liveDescriptionId");this.tickObject=this.tickObject||dojo.byId("dateActionsTicker");this.videoDescObj=this.videoDescObj||dojo.byId("currentVideoInfo");dojo.addClass(this.liveObj,"hidden");dojo.removeClass(this.tickObject,"hidden");dojo.removeClass(this.videoDescObj,"hidden")}catch(a){}},queryVideo:function(a,b){var c=this;if(b===undefined||b===null)b=true;dojo.xhrGet({url:this.configuration.videoAPIURL+"?guid="+a+"&fields=all",handleAs:"json",preventCache:true,headers:{Accept:"application/json"},load:function(d){c.videoID=a;c.videoInformation=d;c.shareTool=b;c.render(b);c.loadVideo();c.observer.fireByName("onVideoLoaded",a,d,c.playedOn);return d},error:function(d){console.error("{Player} could not load video: '%s'. Response: %o",a,d);return d}})},render:function(a){return this.view.render(a)},loadVideo:function(){if(this.loadRetriesLeft==0)console.info("{Player} number of Load Retries expired");else{var a=this;if(this.readyForEvents)this._startPlaying();else{this.loadRetriesLeft--;setTimeout(function(){a.loadVideo()},this.configuration.loadWaitTime)}}},_startPlaying:function(){try{var a=dj.context.core.urlPrefix+"/video/"+this.videoInformation.guid+".html";dj.module.video.taboolaVideo.notifyDynamicLoad(a,a,this.configuration.videotrackId,this.configuration.videoPageValue)}catch(b){console.log("Error while Taboola notification, ignore if not a taboola recommended module: "+
b)}try{var c="Top News";dojo.forEach(dojo.query(this.configuration.categoryOpen),function(f){c=dojo.query(".nav_collection_class",f)[0].innerHTML});var d=c;dojo.forEach(dojo.query(this.configuration.selectedCategory),function(f){d=dojo.query(".subnav_collection_class",f)[0].innerHTML})}catch(e){console.log("Error while getting tab category: "+e)}this.videoInformation.tabCategory=c;this.videoInformation.subTabCategory=d;this.view.play(this.addVideoParameters(this.videoInformation))},videoPlayed:function(){},videoPaused:function(){},videoUnPaused:function(){},videoPopUp:function(){},getCurrentVideoID:function(){return this.videoID},getVideoData:function(a){return this.videoInformation[a]},addVideoParameters:function(a){var b="WSJ_";a||(a={});if(this.seekTime){a.seekTime=this.seekTime;this.seekTime=null}a.emailPartnerID=110626;a.site=this.site;a.msrc=this.msrc;a.adFrmt=this.configuration.adFormat;a.playerName=this.view.configuration.name;a.embedPlayerURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath+
this.configuration.playerType.swfFile;a.embedConfigURL=this.configuration.embedConfURL;a.embedPlayerID="1000";a.embedName=this.configuration.playerID;a.embedBaseURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath;a.embedHeight=this.configuration.playerType.height;a.embedWidth=this.configuration.playerType.width;a.larsID=91;a.larsAdTrackingID=1259;a.allowfullscreen=this.configuration.allowfullscreen;if(this.playedOn)a.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");a.prop59=dj.util.Cookie.getCookie("referrerURL");if(a.prop59===undefined||""===a.prop59||a.prop59===null){var c=document.referrer;try{if(c!==undefined&&""!==c){c=c.substring(c.indexOf("http://")+7);a.prop59=c.substring(0,c.indexOf("/"))}}catch(d){}}a.prop60=dj.util.Cookie.getCookie("sitereferrer");console.log(a.prop60+"      >>>>>>>>>>>>>>>>>>>>>>"+this.view.configuration.name+" >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"+a.prop59);a.prop62=b+a.tabCategory;a.prop48=dj.util.ie9.pin.siteMode();var e=dj.util.Region.getViewByRegion();try{a.prop24=dj.util.Omniture.editionToNameMap[e.toLowerCase()]}catch(f){}a.pageName="WSJLive_Video_article type_"+a.titletag;a.prop1="Video";a.prop13=a.adZone;a.prop20="video_"+a.guid;a.prop21="WSJLive_"+a.author;a.prop23="video_"+a.formattedCreationDate;a.prop27="";try{dj.util.User.isLoggedIn(function(p){if(p)dj.util.User.isSubLoggedIn(function(m){if(m)dj.util.User.hasRole("WSJ-PRO",function(q){if(q){b="WSJPRO_";a.prop27="WSJ_proc_sub_yes"}else dj.util.User.hasRole("WSJ-ENT",function(s){if(s){b="WSJPRO_";a.prop27="WSJ_proe_sub_yes"}else a.prop27="WSJ_sub_yes"})});else a.prop27="WSJ_mem_yes"});else a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"})}catch(k){try{a.prop27=a.cookieUserType===null||a.cookieUserType!=="subscribed"?"WSJ_free":"WSJ_reg_yes"}catch(g){}}e=dj.utils.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"s");var h=dj.utils.VideoUtils.omnitureEncoding(a["wsj-section"],a["wsj-subsection"],"c");if((typeof h==undefined||h==null)&&a.tabCategory=="Partner Channel"){h=a.tabCategory;if((typeof e==undefined||e==null)&&a.tabCategory=="Partner Channel")e=a.subTabCategory}a.appName=b.substring(0,b.length-1);a.appType=this.configuration.applications[this.configuration.applicationID];a.section=h;a.subsection=e;a.prop2="WSJLive_"+h;a.prop3="WSJLive_Video_"+h;a.prop4="WSJLive_Video_"+h+"_"+a.titletag+"_"+a.duration;a.prop26="WSJLive_"+e;a.prop5=window.location.href.split("?")[0];a.prop6=window.location.href;a.prop7="off";a.prop8="video_"+a.doctypeID;a.prop9="free";try{a.prop10=dj.util.Page.getQueryParam("mod")&&""!=dj.util.Page.getQueryParam("mod")?dj.util.Page.getQueryParam("mod"):dj.util.Page.getQueryParam("link")}catch(o){}a.prop16="WSJLive_video_"+a.subTabCategory;a.campaign=a.prop10;try{if((c=document.referrer)&&""!==c){c=c.substring(c.indexOf("//")+2);var l=c.substring(0,c.indexOf("/"));l=l.toLowerCase()}}catch(n){}a.prop25=dj.util.Cookie.getCookie("TR");try{a.cookieUserType=dj.util.Cookie.getCookie("user_type")}catch(r){console.error("cookie read error while fetching cookieUserType : "+
r)}c=typeof pID==="string"&&pID.indexOf("0_0_WH")!=-1?"1":"0";a.suppressAds=c;return a}});dojo.provide("dj.widget.videos.view.LargePlayer");dojo.require("dj.utils.VideoUtils");dojo.require("dj.widget.videos.model.PlayerEvents");dojo.require("dj.widget.videos.model.SWFPlayer");dojo.require("dj.module.article.ticker");dojo.declare("dj.widget.videos.view.LargePlayer",null,{constructor:function(a){this.nextVideoContainer=this.controller=null;this.nextVideoContainerId="vcrNextVideo";this.configuration={name:"largePlayer",showSectionTitle:true,useVideoTitleLink:true,dialect:"http://system.marketwatch.com/mktw/symbol"};dojo.mixin(this.configuration,a);this.playerCreated=false},init:function(a){this.controller=a;this.descriptionContainer=dojo.byId(this.controller.configuration.descriptionID);this.nextVideoContainer=dojo.byId(this.controller.configuration.nextVideoContainer);this.dateActionsTicker=dojo.byId(this.controller.configuration.dateActionsTicker);this.render()},render:function(a){var b=this.controller.configuration;if(!this.playerCreated){this.playerCreated=true;var c=new dj.widget.videos.model.SWFPlayer;c.id=b.playerID;c.swfURL=b.flashPlayerPath+b.playerType.swfFile;c.containerID=b.containerID;c.width=b.playerType.width;c.height=b.playerType.height;c.eventNamespace=b.eventNamespace;c.host=b.host;if(b.enableVideoModuleChaining)c.enableVideoModuleChaining=b.enableVideoModuleChaining;if(typeof b.endScreenOverlay!="undefined")c.endScreenOverlay=b.endScreenOverlay;if(b.chainVideos)c.chainVideos=b.chainVideos;b=dj.widget.videos.model.PlayerEvents;for(var d in b)if(b.hasOwnProperty(d))c[d]=d;dj.utils.VideoUtils.createSWFPlayer(c)}this.renderDescription(a)},play:function(a){var b=swfobject.getObjectById(this.controller.configuration.playerID);b&&typeof b.playVideo=="function"?b.playVideo(dojo.toJson(a)):console.error("{Player} video Player still not loaded")},renderDescription:function(a){if(this.controller.videoInformation.name){var b="",c=this.controller.videoInformation;b=this.controller.videoInformation["wsj-subsection"]&&this.controller.videoInformation["wsj-subsection"]!="null"?unescape(this.controller.videoInformation["wsj-subsection"]):this.controller.videoInformation["wsj-section"]&&this.controller.videoInformation["wsj-section"]!="null"?unescape(this.controller.videoInformation["wsj-section"]):"&nbsp;";var d=c.guid,e=c.linkShortURL,f=c.name;if((typeof a==undefined||a===null||a===true)&&pID=="0_0_WJPP_6000"){f='<div id="'+d+'_summary_shareTool" class="vcrSocial" data-vcr-sharetool="show">'+'<a id="fb_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare facebook" href=""></a>'+'<a id="tw_'+d+'" data-url="'+e+'" data-headline="'+f+'"  class="vcrShare twitter" href=""></a>'+'<a id="linkedin_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare linkedin" href=""></a>'+'<a id="mixi_'+d+'" data-url="'+e+'" data-headline="'+
f+'" class="vcrShare mixi" href="" data-key="cb06210f9fbb7d10ad9d37664e4973a84ccf524f"></a>'+'<a id="embed_'+d+'" data-url="'+e+'" data-guidval="'+d+'" class="vcrShare embed" href=""></a>'+'<a id="email_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare email" href=""></a></div>';e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="http://static.mixi.jp/js/share.js";document.body.appendChild(e)}else if((typeof a==undefined||a===null||a===true)&&pID=="0_0_WCNP_6000")f='<div id="'+d+'_summary_shareTool" class="vcrSocial" data-vcr-sharetool="show">'+'<a id="sina_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare sine" href=""></a>'+'<a id="sohu_'+d+'" data-url="'+e+'" data-headline="'+f+'"  class="vcrShare sohu" href=""></a>'+'<a id="weibo_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare weibo" href=""></a>'+'<a id="qq_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare qq" href=""></a>'+'<a id="ushi_'+d+'" data-url="'+e+'" data-headline="'+
f+'" class="vcrShare ushi" href=""></a>'+'<a id="embed_'+d+'" data-url="'+e+'" data-guidval="'+d+'" class="vcrShare embed" href=""></a>'+'<a id="email_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare email" href=""></a></div>';else if(typeof a==undefined||a===null||a===true)f='<div id="'+d+'_summary_shareTool" class="vcrSocial" data-vcr-sharetool="show">'+'<a id="fb_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare facebook" href=""></a>'+'<a id="tw_'+d+'" data-url="'+e+'" data-headline="'+
f+'"  class="vcrShare twitter" href=""></a>'+'<a id="gplus_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare google" href=""></a>'+'<a id="embed_'+d+'" data-url="'+e+'" data-guidval="'+d+'" class="vcrShare embed" href=""></a>'+'<a id="email_'+d+'" data-url="'+e+'" data-headline="'+f+'" class="vcrShare email" href=""></a></div>';else f='<div class="vcrSocial" data-vcr-sharetool="hide">&nbsp;</div>';e='<div class="currentVideoInfo">';if(this.configuration.showSectionTitle)e+='<small id="showTitle">'+
b+"</small>";e+="<h1>";if(this.configuration.useVideoTitleLink){e+='<a id="videoTitle" href="">';e+=this.controller.videoInformation.name;e+="</a>"}else e+=this.controller.videoInformation.name;e+="</h1>"+f;e+="<p>"+this.controller.videoInformation.description+"</p></div>";b='<small id="dateTicker">'+this.controller.videoInformation.formattedCreationDate+"</small>";b+="<small></small>";b+="<small>"+this.getDuration(this.controller.videoInformation.duration)+"</small>";f="Read Article";if(c.relatedLinkText)f=c.relatedLinkText;c=c.relatedLinkHref;if(typeof c!==undefined&&c!==null&&""!==c)b+='<a href="'+c+'" class="vcrMore">'+f;dojo.query(".articleVideoInfo [data-widget='dj.ticker']").orphan();dojo.query(".inlineTickerPopup").orphan();c=this.controller.videoInformation.tickers;if(c!=null&&c.length>0&&c[0]!=":"){b+='<span class="vcrMore">&bull;</span></a>';for(f=0;f<c.length;f++)b+="<span data-widget='dj.ticker' data-ticker-name='"+c[f]+"'></span>"}this.descriptionContainer.innerHTML=e;this.dateActionsTicker.innerHTML=b;(this.nextVideoContainer=this.nextVideoContainer||dojo.byId(this.nextVideoContainerId))&&dojo.hasClass(this.nextVideoContainer,"hidden")&&dojo.removeClass(this.nextVideoContainer,"hidden");if((typeof a==undefined||a===null||a===true)&&pID=="0_0_WJPP_6000"){dj.utils.VideoUtils.makeFBConnection("fb_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmbedConnection("embed_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeTWConnection("tw_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmailConnection("email_"+
d,d+"_summary_shareTool");dj.utils.VideoUtils.makeLinkedinConnection("linkedin_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeMixiConnection("mixi_"+d,d+"_summary_shareTool")}else if((typeof a==undefined||a===null||a===true)&&pID=="0_0_WCNP_6000"){dj.utils.VideoUtils.makeSinaConnection("sina_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeSohuConnection("sohu_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeWeiboConnection("weibo_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeQQConnection("qq_"+
d,d+"_summary_shareTool");dj.utils.VideoUtils.makeUshiConnection("ushi_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmbedConnection("embed_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmailConnection("email_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmailConnection("email_"+d,d+"_summary_shareTool")}else if(typeof a==undefined||a===null||a===true){dj.utils.VideoUtils.makeFBConnection("fb_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmbedConnection("embed_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeTWConnection("tw_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeEmailConnection("email_"+d,d+"_summary_shareTool");dj.utils.VideoUtils.makeGplusConnection("gplus_"+d,d+"_summary_shareTool")}dj.module.article.ticker.init({enablePopup:true,linkTarget:"_blank",newQuoteURL:true,version:9,fragmentUrl:"/public/npage/0_0_WG_Tickers_Information_Q.html?d="+this.configuration.dialect+"&q=",popupFragmentURL:"/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?d="+this.configuration.dialect+"&ticker="})}},getDuration:function(a){var b=Math.floor(a/3600),c=a%3600;a=Math.floor(c/60);c=Math.ceil(c%60);return b>0?b+":"+a+":"+c:a>0?c<10?a+":0"+c:a+":"+c:c<10?"0:0"+c:"0:"+c}});dojo.provide("dj.widget.videos.view.Html5LargePlayer");dojo.require("dj.widget.videos.view.LargePlayer");dojo.require("dj.util.Element");dojo.require("dj.utils.VideoTracking");dojo.declare("dj.widget.videos.view.Html5LargePlayer",dj.widget.videos.view.LargePlayer,{advertisementFlag:false,render:function(a){var b=this.controller.videoInformation;if(null!=b){this.oCnt=dojo.byId("videoPlayer");if(typeof this.oCnt==="undefined")throw Error("{Html5LargePlayer} video-center embed container does not exist.");dojo.empty(this.oCnt);this._createVideoObject(b.videoStillURL,b.video320kMP4Url);dojo.place(this._video,this.oCnt);this._subscribeToVideoEvents();this.renderDescription(a);this.controller.readyForEvents=true}},play:function(a){dj.utils.VideoUtils.callThroughDispatch(function(){this._video.play()},this);dj.utils.VideoTracking.fire(a)},_createVideoObject:function(a,b){var c=this.controller.configuration;this._video=dojo.create("video",{poster:a,src:b,controls:"true",width:c.playerType.width,height:c.playerType.height});if(typeof this.advertisementFlag==undefined||this.advertisementFlag==false){var d=Math.floor(Math.random()*1E10);dojo.forEach(dojo.query(".topAd"),function(e){e.innerHTML="<a href='http://ad.doubleclick.net/ad/interactive.wsj.com/ipad_coad;sz=300x50;ord="+d+"' target='_blank'><img src='http://ad.doubleclick.net/ad/interactive.wsj.com/ipad_coad;sz=300x50;ord="+d+"'></a>"});this.advertisementFlag=true}},_subscribeToVideoEvents:function(){var a=dojo.getObject(this.controller.configuration.eventNamespace);dojo.connect(this._video,"onended",function(){a.playNextVideo()})}});dojo.provide("dj.module.videos.whatsOnToday");dojo.require("dj.widget.videos.view.WhatsOnTodayView");dojo.require("dj.widget.videos.controller.VideoBrowser");dojo.require("dj.widget.videos.view.FullBrowser");dojo.require("dj.utils.VideoUtils");(function(){dj.module.videos.whatsOnToday={init:function(a){if(!dj.utils.VideoUtils._isIpad()&&dj.utils.VideoUtils.hasValidFlashVersion()){this.configuration={whatsOnTodayView:null,videoAPIURL:"/api-video/find_all_videos.asp",liveUrlPrefix:"http://live.wsj.com",defaultQuery:"count=59&query=News&type=wsj-section&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection,linkShortURL",defaultSelectionID:"news"};dojo.deepMixin(this.configuration,a);this.observer=new dj.util.Observer(dj.module.videos.whatsOnToday);this.videoBrowser=new dj.widget.videos.controller.VideoBrowser(this.observer,{defaultQuery:this.configuration.defaultQuery,defaultSelectionID:this.configuration.defaultSelectionID});this.videoBrowser.init(new dj.widget.videos.view.FullBrowser);this.configuration.whatsOnTodayView=new dj.widget.videos.view.WhatsOnTodayView({wsjTvSchedule:wsjtvSchedule,context:this,videoBrowser:this.videoBrowser});this.populateModules()}},populateModules:function(){this.configuration.whatsOnTodayView.render(this.configuration.whatsOnTodayView)},populateDescription:function(a,b,c){drawerContainer=b;liveUrlPrefix=this.configuration.liveUrlPrefix;b=dojo.byId("whatsOnDrawer~"+b.split("~")[1]);b=dojo.query(".allType",b)[0];b.innerHTML="View All "+c+" Videos &raquo;";dojo.attr(b,"data-showname",c);dojo.xhrGet({url:this.configuration.videoAPIURL+"?"+a,handleAs:"json",preventCache:true,headers:{Accept:"application/json"},load:function(d){if(d){d=d.items;for(var e="",f="",k=0;k<d.length;k++){var g=d[k];if(k==3)f="last";var h=g.linkURL;if(liveUrlPrefix)h=h.replace("http://live.s.dev.wsj.com",liveUrlPrefix);e=e+"<li class = "+f+'><a href="'+h+'"><img class="latestThumb" width="115" height="65" src="'+g.thumbnailURL+'" /></a><h2 class="latestTitle" class="latestTitle"><a href="'+h+'">'+g.name+"</a></h2></li>"}dojo.byId(drawerContainer).innerHTML=e}},error:function(d){console.error("{populateDescription} could not load related videos ");return d}})}}})();dojo.provide("dj.module.videos.VideoCenter");dojo.require("dj.util.Observer");dojo.require("dj.widget.videos.controller.Player");dojo.require("dj.widget.videos.controller.AdPlayer");dojo.require("dj.widget.videos.controller.VideoBrowser");dojo.require("dj.widget.videos.controller.Playlist");dojo.require("dj.widget.videos.view.SimplePlaylist");dojo.require("dj.widget.videos.view.FullBrowser");dojo.require("dj.widget.videos.view.AdPlayer");dojo.require("dj.widget.videos.view.LargePlayer");dojo.require("dj.widget.videos.view.Html5LargePlayer");dojo.require("dj.widget.videos.model.PlayerTypes");dojo.require("dj.module.notifications.notificationupdates");dojo.require("dj.utils.VideoUtils");dojo.require("dj.util.Element");dojo.require("dj.util.Cookie");(function(){dj.module.videos.VideoCenter={init:function(a){this.configuration={videoCenterContainerID:"masterVideoCenter",advertisingSectionLabelID:"advertisingSectionLabel",specialAdCollection:"WSJ Business Center",flashPlayerPath:"/media/swf/",host:"video.wsj.com",loadWaitTime:2E3,defalutSiteReferrer:"wsj",playerName:"video_videocenter",defaultType:"wsj-section",defaultFields:"&type=wsj-section&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection,linkShortURL",defaultCount:"count=59",defaultQuery:"count=59&query=News&type=wsj-section&fields=id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection,linkShortURL",defaultParentID:"topnews",videoID:"",queryFlag:true,browserAdObj:null,defaultSelectionID:"news",eventCallbacks:[],videoBrowserAdv:"videoBrowserAdv",topAdv:"topAdv",luxeAdv:"luxeAdv",currLuxeAdd:0,playerEventsRegistered:false,defaultCatClass:".wsj",thumbnailItemsPerRow:5,thumbnailItemsPerPage:20,luxeAd:"luxeAd",browserAd:"browserAd",defaultTopClass:"body",vcrFullywide:".vcrFullywide",browserWidth:1280,browserHeight:600,posibleDomains:["online.wsj.com","barrons.com","marketwatch.com","smartmoney.com","asia.wsj.com","india.wsj.com","uk.wsj.com","europe.wsj.com"],propMapping:[{tabClass:".wsj",pattern:"online.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".marketwatch",pattern:"marketwatch.com/",topClass:"pageType-vcrMW",backTitle:"Back to MarketWatch",sitereferrer:"MarketWatch"},{tabClass:".barrons",pattern:"barrons.com/",topClass:"pageType-vcrBarrons",backTitle:"Back to Barron's",sitereferrer:"Barrons"},{tabClass:".asia",pattern:"asia.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".india",pattern:"india.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".uk",pattern:"uk.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".jp",pattern:"jp.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".cn",pattern:"cn.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".europe",pattern:"europe.wsj.com/",topClass:"pageType-vcrWSJ",backTitle:"Back to WSJ",sitereferrer:"wsj"},{tabClass:".smartmoney",pattern:"smartmoney.com/",topClass:"pageType-vcrPartnerCenter",backTitle:"Back to SmartMoney",sitereferrer:"SmartMoney"}],luxAdSizes:[250,600,1050],smallAdSizes:[50,60],browserAdSizes:[175]};dojo.deepMixin(this.configuration,a);try{console.log("DetectProperty");this.detectProperty();this.addTranscriptEvent();this.videoBrowserAdvObj=this.videoBrowserAdvObj||dojo.byId(this.configuration.videoBrowserAdv);this.videoFullyWide=null;try{dojo.forEach(dojo.query(this.configuration.vcrFullywide),dojo.hitch(this,function(o){this.videoFullyWide=o}))}catch(b){}this.videoTopAdObj=this.videoTopAdObj||dojo.byId(this.configuration.topAdv);this.videoLuxAdObj=this.videoLuxAdObj||dojo.byId(this.configuration.luxeAdv);if(document.body.offsetWidth<this.configuration.browserWidth||document.body.offsetHeight<this.configuration.browserHeight){dojo.hasClass(this.videoFullyWide,"luxury")&&dojo.removeClass(this.videoFullyWide,"luxury");dojo.addClass(this.videoLuxAdObj,"hidden");dojo.attr(this.videoLuxAdObj,"style","display: none")}else{dojo.addClass(this.videoFullyWide,"luxury");dojo.addClass(this.videoTopAdObj,"hidden");dojo.attr(this.videoTopAdObj,"style","display: none")}this.videoCenterContainer=dojo.byId(this.configuration.videoCenterContainerID);this.observer=new dj.util.Observer(dj.module.videos.VideoCenter);this.subscribeToEvents();this.addEvents();this.videoLoadsFirst=false;a=null;var c=this.getVideoIdFromHash();if(this.configuration.videoID!="undefined"&&this.configuration.videoID!=""){var d="{"+this.configuration.videoID+"}";if(dj.utils.VideoUtils.isGUID(d)){this.videoLoadsFirst=true;c=d.replace("{","");c=c.replace("}","");document.location.hash="!"+c}else d=null}else if(typeof AT_VARS!="undefined"&&AT_VARS.baseDocId){d="{"+AT_VARS.baseDocId+"}";if(dj.utils.VideoUtils.isGUID(d)){this.videoLoadsFirst=true;c=d.replace("{","");c=c.replace("}","");document.location.hash="!"+c}else d=null}else if(c){this.videoLoadsFirst=true;d="{"+c.substring(2)+"}"}else if(typeof URL_KEYS!="undefined"&&URL_KEYS!=null)try{var e=dj.util.Page.getQueryParam("category");if(e!==undefined&&e!==null&&""!==e&&URL_KEYS[e])a={defaultType:URL_KEYS[e].type,defaultQuery:URL_KEYS[e].query,defaultSelectionID:URL_KEYS[e].section,defaultParentID:URL_KEYS[e].parent};else{var f=location.href,k=f.indexOf("?");if(k!=-1){e=f.substring(k+1);if(URL_KEYS[e])a={defaultType:URL_KEYS[e].type,defaultQuery:URL_KEYS[e].query,defaultSelectionID:URL_KEYS[e].section,defaultParentID:URL_KEYS[e].parent}}}}catch(g){}this.videoPlayer=new dj.widget.videos.controller.Player(this.observer,{playerID:"videoPlayer",flashPlayerPath:this.configuration.flashPlayerPath,eventNamespace:"dj.module.videos.VideoCenter",host:this.configuration.host,loadWaitTime:this.configuration.loadWaitTime});this.adPlayer=new dj.widget.videos.controller.AdPlayer(this.observer,{containerID:"topAd",playerID:"topAd",flashPlayerPath:this.configuration.flashPlayerPath,host:this.configuration.host});this.videoPlaylist=new dj.widget.videos.controller.Playlist(this.observer);this.videoBrowser=a?new dj.widget.videos.controller.VideoBrowser(this.observer,a):new dj.widget.videos.controller.VideoBrowser(this.observer,{defaultQuery:this.configuration.defaultQuery,defaultSelectionID:this.configuration.defaultSelectionID,defaultParentID:this.configuration.defaultParentID});this.scrollToPlayer=this.fromTopNav=false;this.adView=new dj.widget.videos.view.AdPlayer;this.adPlayer.init(this.adView);this.videoPlayer.init(dj.utils.VideoUtils.hasValidFlashVersion()?new dj.widget.videos.view.LargePlayer({name:this.configuration.playerName}):new dj.widget.videos.view.Html5LargePlayer({name:this.configuration.playerName}),d);this.videoPlaylist.init(new dj.widget.videos.view.SimplePlaylist);this.videoBrowser.init(new dj.widget.videos.view.FullBrowser({thumbnailItemsPerRow:this.configuration.thumbnailItemsPerRow,thumbnailItemsPerPage:this.configuration.thumbnailItemsPerPage,registerLiveEvent:true}));this.videoLoadsFirst||this.videoBrowser.requestDefaultVideos();this.adPlayer.render();dj.module.notifications.notificationupdates.init(this.videoPlayer);dj.context.videoCenter.resizeObj=null;window.onresize=function(){try{if(dj.context.videoCenter.resizeObj===null)dj.context.videoCenter.resizeObj=setTimeout(" dj.module.videos.VideoCenter.resizeFunc();",200);else{clearTimeout(dj.context.videoCenter.resizeObj);dj.context.videoCenter.resizeObj=setTimeout(" console.log('Ads*****************'); dj.module.videos.VideoCenter.resizeFunc();",200)}}catch(o){}}}catch(h){}},getVideoIdFromHash:function(){var a=document.location.hash;return typeof a!==undefined&&a!==""?a:null},resizeFunc:function(){if(this.loadAdFlag){this.videoTopAdObj=this.videoTopAdObj||dojo.byId("topAdv");this.videoLuxAdObj=this.videoLuxAdObj||dojo.byId("luxeAdv");this.browserWidth=this.configuration.browserWidth||1280;this.browserHeight=this.configuration.browserHeight||600;console.log(document.body.offsetWidth+" :  : "+document.body.offsetHeight);if((document.body.offsetWidth<this.browserWidth||document.body.offsetHeight<this.browserHeight)&&dojo.hasClass(this.videoTopAdObj,"hidden")){var a=dj.util.Element.getData(this.videoTopAdObj,"imageurl"),b=dj.util.Element.getData(this.videoTopAdObj,"linkurl");if(typeof a!==undefined&&a!==null&&a!==""){dojo.removeClass(this.videoFullyWide,"luxury");this.videoTopAdObj.innerHTML='<div id="topAd" class="advertisement"><a target="_blank" href="'+
b+'"><img src="'+a+'"/></a></div>';dojo.addClass(this.videoLuxAdObj,"hidden");dojo.attr(this.videoLuxAdObj,"style","display: none");dojo.attr(this.videoTopAdObj,"style","display: block");dojo.removeClass(this.videoTopAdObj,"hidden")}console.log(document.body.offsetWidth+" : "+a+" : "+document.body.offsetHeight)}else if(dojo.hasClass(this.videoLuxAdObj,"hidden")&&document.body.offsetWidth>=this.browserWidth&&document.body.offsetHeight>=this.browserHeight){a=dj.util.Element.getData(this.videoLuxAdObj,"imageurl");b=dj.util.Element.getData(this.videoLuxAdObj,"linkurl");if(typeof a!==undefined&&a!=null&&a!==""){dojo.addClass(this.videoFullyWide,"luxury");dojo.addClass(this.videoTopAdObj,"hidden");dojo.attr(this.videoTopAdObj,"style","display: none");dojo.attr(this.videoLuxAdObj,"style","display: block");dojo.removeClass(this.videoLuxAdObj,"hidden");this.videoTopAdObj.innerHTML='<div id="topAd" class="advertisement"><a target="_blank" href="'+b+'"><img src="'+a+'"/></a></div>';this.videoLuxAdObj.innerHTML='<a target="_blank" href="'+b+'"><img src="'+a+'"/></a>'}console.log(document.body.offsetWidth+" : "+a+" : "+document.body.offsetHeight)}}},subscribe:function(a,b,c){this.observer.subscribeByName(a,b,c)},subscribeToEvents:function(){this.subscribe("onVideoSelected",this.videoSelected,this);this.subscribe("onCollectionLoad",this.collectionLoad,this);this.subscribe("onFirstLoad",this.firstLoad,this);this.subscribe("onVideoLoaded",this.videoLoaded,this);for(var a=this.configuration.eventCallbacks,b=a.length-1;b>=0;b--)this.subscribe(a[b].event,a[b].callback,this)},videoLoaded:function(a,b){this.configuration.currLuxeAdd=0;this.currentPlayingVideo=a;var c;c=a.replace("{","");c=c.replace("}","");document.location.hash="!"+c;if(this.videoLoadsFirst){c="News";try{c=this.videoPlayer.getVideoData("wsj-section");var d=this.configuration.defaultQuery;if(c){if(c!==undefined&&c=="Live Programs")(c=this.videoPlayer.getVideoData("wsj-subsection"))||(c="News")}else c="News"}catch(e){c="News"}c=c.toLowerCase();var f=null;if(typeof URL_KEYS!=="undefined"&&URL_KEYS[c])f=URL_KEYS[c].query;if(this.configuration.queryFlag)d=f!=null?f:this.configuration.defaultCount+"&query="+c+this.configuration.defaultFields;this.videoBrowser.addToConfig({defaultQuery:d,defaultSelectionID:c});this.videoBrowser.requestDefaultVideos(a,b)}this.videoBrowser.highligthThumbnail(a);document.title=this.videoPlayer.videoInformation.titletag!==""?"Video - "+this.videoPlayer.videoInformation.titletag+" - WSJ.com":"Video - "+this.videoPlayer.videoInformation.name+" - WSJ.com";if(d=b.linkURL){c=d.indexOf("s.dev");if(c===-1)c=d.indexOf("f.dev");if(c!==-1)d=d.substr(0,c)+d.substr(c+6)}this.videoPlayer.liveUrl=d;this.changeTranscript(this.videoPlayer.getVideoData("transcript"))},videoSelected:function(a,b,c,d){this.configuration.currLuxeAdd=0;var e;e=a.replace("{","");e=e.replace("}","");document.location.hash="!"+e;this.currentPlayingVideo=this.videoID=a;if(isNaN(c))c=-1;if(b!==undefined&&b.videos!==undefined){e=b.videos.items;c+=0;if(typeof c!==undefined&&c!==null){var f=Array(6),k=0;try{for(var g=c+1;g<c+7;g++)if(e[g]){f[k]=e[g];k++}else{c=7-k;for(g=0;g<c;g++){f[k]=e[g];k++}break}this.nextVideoPlaylist=f}catch(h){}}else this.nextVideoPlaylist=b.videos.items}else if(this.nextVideoPlaylist!==undefined&&this.nextVideoPlaylist.length>5){f=Array(5);k=0;for(g=1;g<this.nextVideoPlaylist.length;g++){f[k]=this.nextVideoPlaylist[g];k++}this.nextVideoPlaylist=f}if(this.scrollToPlayer){c=dojo.byId(this.videoPlayer.configuration.playerID);c!=null&&c!==undefined&&this.scrollToElement(c)}this.scrollToPlayer=true;if(this.videoLoadsFirst)this.videoLoadsFirst=false;else this.videoPlayer.playVideo(a,unescape(this.videoBrowser.currentSection),d);this.videoPlaylist.render(b);this.transcriptLoaded=false;this.trascriptVisible&&this.getTranscript(a)},collectionLoad:function(a){try{a.responseObj.items.length>this.configuration.thumbnailItemsPerPage*this.videoBrowser.currentPage?dojo.query("[data-widget='loadMore']").removeClass("hidden"):dojo.query("[data-widget='loadMore']").addClass("hidden")}catch(b){}},playVideoByItem:function(a,b){try{var c=b.id;this.currentPlayingVideo=c;this.videoPlayer.playVideo(c,unescape(this.videoBrowser.currentSection));var d=b.index,e=this.videoPlaylist.playlist;if(e!==undefined&&e.videos!==undefined){var f=e.videos.items;d=this.videoPlaylist.playlist.videoIndex+b.index;this.videoPlaylist.playlist.videoIndex=d;if(typeof d!=undefined&&d!=null){var k=Array(6);e=0;try{for(var g=d+1;g<d+7;g++)if(f[g]){k[e]=f[g];e++}else{d=7-e;for(g=0;g<d;g++){k[e]=f[g];e++}break}this.nextVideoPlaylist=k}catch(h){}}else this.nextVideoPlaylist=e.videos.items}this.videoPlaylist.render();this.videoBrowser.highligthThumbnail(c);this.trascriptVisible&&this.getTranscript(videoID)}catch(o){console.log("Error {playVideoByItem}: "+o)}},firstLoad:function(){this.videoLoadsFirst?this.videoBrowser.selectVideoByID(this.videoPlayer.getCurrentVideoID()):this.videoBrowser.selectVideoByIndex(0)},playNextVideo:function(){var a=null;if(!dj.utils.VideoUtils._isIpad()&&dj.utils.VideoUtils.hasValidFlashVersion())a=this.videoPlaylist.getNextVideo();else{this.videoBrowser.currentHTMLVIndex+=1;a=this.videoPlaylist.playlist.videos.items[this.videoBrowser.currentHTMLVIndex]}try{var b=dojo.byId("firstthumbnail");if(typeof b==undefined||b==null)a=this.videoPlaylist.getCurrentVideo()}catch(c){}a=a.id;this.videoPlayer.playVideo(a,unescape(this.videoBrowser.currentSection));this.videoPlaylist.render();this.videoBrowser.highligthThumbnail(a)},createAdvertisement:function(a,b,c){if(dojo.indexOf(this.configuration.smallAdSizes,c)!=-1)if(document.body.offsetWidth<this.configuration.browserWidth||document.body.offsetHeight<this.configuration.browserHeight){dojo.removeClass(this.videoTopAdObj,"hidden");dojo.attr(this.videoTopAdObj,"style","display: block");dojo.attr(this.videoTopAdObj,"data-linkurl",b);dojo.attr(this.videoTopAdObj,"data-imageurl",a);this.adPlayer.loadAd({imageURL:a,linkURL:b})}else{dojo.addClass(this.videoTopAdObj,"hidden");dojo.attr(this.videoTopAdObj,"style","display: none");dojo.attr(this.videoTopAdObj,"data-linkurl",b);dojo.attr(this.videoTopAdObj,"data-imageurl",a)}else if(dojo.indexOf(this.configuration.luxAdSizes,c)!=-1){this.videoLuxAdObj=this.videoLuxAdObj||dojo.byId("luxeAdv");if(document.body.offsetWidth>=this.configuration.browserWidth&&document.body.offsetHeight>=this.configuration.browserHeight){if(this.configuration.currLuxeAdd<c){this.configuration.currLuxeAdd=c;dojo.addClass(this.videoFullyWide,"luxury");dojo.removeClass(this.videoLuxAdObj,"hidden");dojo.attr(this.videoLuxAdObj,"style","display: block");dojo.attr(this.videoLuxAdObj,"data-linkurl",b);dojo.attr(this.videoLuxAdObj,"data-imageurl",a);this.videoLuxAdObj.innerHTML="";dojo.create("a",{target:"_blank",href:b,"data-linkurl":b,"data-imageurl":a,innerHTML:'<img src="'+a+'"></img>'},this.videoLuxAdObj)}}else{dojo.removeClass(this.videoFullyWide,"luxury");dojo.addClass(this.videoLuxAdObj,"hidden");dojo.attr(this.videoLuxAdObj,"style","display: none");dojo.attr(this.videoLuxAdObj,"data-linkurl",b);dojo.attr(this.videoLuxAdObj,"data-imageurl",a);this.videoLuxAdObj.innerHTML="";dojo.create("a",{target:"_blank",href:b,"data-linkurl":b,"data-imageurl":a,innerHTML:'<img src="'+a+'"></img>'},this.videoLuxAdObj,"first")}}else if(dojo.indexOf(this.configuration.browserAdSizes,c)!=-1)if(this.videoBrowserAdvObj=dojo.byId(this.configuration.videoBrowserAdv)){dojo.byId(this.videoBrowserAdvObj).innerHTML="";dojo.attr(this.videoBrowserAdvObj,"data-linkurl",b);dojo.attr(this.videoBrowserAdvObj,"data-imageurl",a);dojo.byId(this.videoBrowserAdvObj).innerHTML='<a target="_blank" href="'+
b+'"><img src="'+a+'"/></a>'}else{this.param1=a;this.param2=b;this.param3=c;this.bAdCount=this.bAdCount||0;if(this.bAdCount<15){setTimeout(dojo.hitch(this,function(){this.createAdvertisement(this.param1,this.param2,this.param3)}),200);this.bAdCount+=1}}this.loadAdFlag=true},openEmbedPopup:function(){dj.utils.VideoUtils.embedPopUp({url:this.videoPlayer.getVideoData("linkURL"),guidval:this.videoPlayer.videoID,shortUrl:this.videoPlayer.getVideoData("linkShortURL")});return true},openPopUpPlayer:function(){var a=swfobject.getObjectById(this.videoPlayer.configuration.playerID),b=0;if(typeof a.getSeek==="function")b=Math.floor(a.getSeek());a=dj.util.Element.getData(this.videoTopAdObj,"imageurl");var c=dj.util.Element.getData(this.videoTopAdObj,"linkurl"),d="show";dojo.forEach(dojo.query(".vcrSocial"),function(f){d=dj.util.Element.getData(f,"vcr-sharetool")});var e=dj.util.Cookie.getCookie("referrerURL");dj.utils.VideoUtils.popUpPlayer({playLocation:b,collection:this.videoPlayer.getVideoData("wsj-section"),videoID:this.videoPlayer.videoID,height:this.videoPlayer.configuration.playerType.height,width:this.videoPlayer.configuration.playerType.width,shareTool:d,referrerURL:e,imageurl:a,linkurl:c})},continueLoadVideo:function(){this.videoPlayer.readyForEvents=true},requestPlayList:function(){return this.nextVideoPlaylist},requestCurrentVideo:function(){return this.currentPlayingVideo},addEvents:function(){try{if(dj.utils.VideoUtils._isIE()){var a=document.title;document.attachEvent("onpropertychange",function(c){c.propertyName==="title"&&document.title!==a&&setTimeout(function(){document.title=a},1);c=null})}}catch(b){}dojo.query("[data-widget='loadMore']").connect("onclick",dojo.hitch(this,function(c){dojo.stopEvent(c);this.videoBrowser.render(this.videoBrowser.currentPage+1,true);this.collectionLoad({responseObj:this.videoBrowser.browserPlayList})}))},detectProperty:function(){var a=document.referrer,b=dj.util.Cookie.getCookie("referrerURL");console.log(a+"      ****************       testing    ******************    "+
b);if(b)for(var c=this.configuration.posibleDomains,d=c.length-1;d>=0;d--)if(a.indexOf(c[d])!=-1&&b.indexOf(c[d])==-1){dj.util.Cookie.setCookie("referrerURL",a);b=a;break}if(b&&b!=="")a=b;else if(a&&a!==""){b=a=this.cleanReferrer(a);dj.util.Cookie.setCookie("referrerURL",a)}else dj.util.Cookie.setCookie("referrerURL","");dj.util.Cookie.setCookie("sitereferrer","WSJLive");a&&""!==a?dojo.forEach(this.configuration.propMapping,dojo.hitch(this,function(e){if(a.indexOf(e.pattern)!=-1){console.log(e.pattern+":"+e.topClass+":"+e.pattern);dojo.query(this.configuration.defaultTopClass).addClass(e.topClass);dj.util.Cookie.setCookie("sitereferrer",e.sitereferrer);dj.util.Cookie.setCookie("referrerURL",a);dojo.query(".vcrBack").forEach(function(f){f.innerHTML=e.backTitle;f.href=a;dojo.removeClass(f,"hidden");dojo.query(e.tabClass).removeClass("hidden")})}})):dojo.query(this.configuration.defaultCatClass).removeClass("hidden")},cleanReferrer:function(a){var b=a.indexOf("?");return b!=-1?a.substring(0,b):a},changeTranscript:function(a){a||(a="No transcript available for this video.");dojo.query(".vcrTranscriptContent").forEach(function(b){b.innerHTML="<p>"+a+"</p>"})},showHideTranscript:function(){this.changeTranscript(this.videoPlayer.getVideoData("transcript"));dojo.query(".toggleTranscript, .vcrTranscript").toggleClass("open")},addTranscriptEvent:function(){dojo.query(".toggleTranscript").connect("onclick",dojo.hitch(this,function(a){dojo.stopEvent(a);this.showHideTranscript()}))},scrollToElement:function(a){for(var b=0,c=0;a!=null;){b+=a.offsetLeft;c+=a.offsetTop;a=a.offsetParent}c!==0&&window.scrollTo(b,c)}}})();
dojo.provide("dj.util.Article");dj.util.Article={getParentByNodeName:function(b,a){if(b.nodeName.toLowerCase()==a||b.parentNode===null)return b;return dj.util.Article.getParentByNodeName(b.parentNode,a)},isFloat:function(b){return/\d+\.\d+/.test(b)},shortenMe:function(){var b="http://api.bit.ly/shorten?callback=bitlyCallback&longUrl="+encodeURIComponent(longUrl)+"&version=2.0.1&login=wsjblogs&apiKey=R_4dd2ea29f00a2b806151d12d7807286b";if(document.getElementById("bitlynode")===null){var a=document.createElement("script");a.setAttribute("id","bitlynode");a.setAttribute("src",b);document.body.appendChild(a)}else window.open(bitlyTargetUrl);return false}};dojo.provide("dj.widget.article.tools.PartnerButton");dj.widget.article.tools.PartnerButton={init:function(b,a,c){dojo.forEach(dojo.query(b),function(d){dojo.connect(d,a,d,function(e){dojo.stopEvent(e);c.apply(this)})})}};dojo.provide("dj.widget.article.tools.TextBuddy");dojo.declare("dj.widget.article.tools.TextBuddy",null,{constructor:function(b,a,c,d){this.idLarge=b;this.idSmall=a;this.idMiddle=c;this.targetElements=dojo.query(".article.story p");if((b=dojo.query("div.articlePage p"))&&b.length>0)this.targetElements=dojo.query("div.articlePage p");this.initialState=[];this.refFontSize=0;this.increment=1;this.max=-1;this.min=4;this.menuButton=d;this.unit={em:0.1,px:1};return this},init:function(b){if(b){(b=dojo.byId(this.idLarge))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(true);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});(b=dojo.byId(this.idSmall))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(false);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});this.targetElements.forEach(function(a,c){var d=dojo.style(a,"fontSize");this.initialState[c]=d;if(c===0){d=d.substring(0,d.length-2);this.refFontSize=dj.util.Article.isFloat(d)?parseFloat(d):parseInt(d,10)}},this);(b=dojo.byId(this.idMiddle))&&dojo.connect(b,"onclick",this,function(a){this.clickHandlerMiddle();dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()})}else this.hideIt()},clickHandlerMiddle:function(){var b=this.initialState;this.targetElements.forEach(function(a,c){dojo.style(a,{fontSize:""+b[c]})})},makeItSo:function(b){if(this.targetElements&&this.targetElements.length>0){var a=dojo.style(this.targetElements[0],"fontSize"),c=a.substring(a.length-2),d=this.unit[c];a=a.substring(0,a.length-2);var e=dj.util.Article.isFloat(a);a=e?parseFloat(a):parseInt(a,10);a=a-this.refFontSize;if(e)a=a.toPrecision(2);if(!(b&&this.max!=-1&&a>=this.max*d||!b&&this.min!=-1&&a<=-(this.min*d))){var f=(b?this.increment:-this.increment)*d;this.targetElements.forEach(function(g){var h=dojo.style(g,"fontSize"),j=h.indexOf(c);if(j!=-1){h=h.substring(0,j);h=dj.util.Article.isFloat(h)?parseFloat(h):parseInt(h,10);dojo.style(g,{fontSize:h+f+c})}})}}},hideIt:function(){var b=dojo.byId(this.idLarge);b&&dojo.addClass(b.up(),"hidden")}});dojo.provide("dj.module.articleVisitHistory");dojo.require("dj.util.Cookie");dj.module.articleVisitHistory={_cookieName:"articleVisitHistory",_maxNumberOfIds:30,init:function(){dj.util.Cookie.deleteGroupCookie(true,this._cookieName);this._deleteCookie("DJCOOKIE")},_setCookie:function(b,a,c){var d="";if(c){d=new Date;d.setTime(d.getTime()+c*864E5);d="; expires="+d.toGMTString()}document.cookie=b+"="+a+d+"; path=/; domain=online.wsj.com"},_deleteCookie:function(b){this._setCookie(b,"",-1)}};dojo.provide("dj.module.comments.displayCommentCount");dojo.require("dj.util.Observer");dj.module.comments.displayCommentCount={init:function(){dj.context.article.commentsObserver=new dj.util.Observer;dj.context.article.commentsObserver.subscribeByName("commentsOnArticle",this.render,this)},render:function(b){console.log(b);if(isNaN(b)||b==0)dojo.query("#comment_text")[0].innerHTML="Be the first to comment";else{var a=" Comments, add yours ";if(b==1)a=" Comment, add yours ";dojo.query("#comment_text")[0].innerHTML=b+a}}};dojo.provide("dj.util.referal");dojo.require("dj.util.Page");dj.util.referal={getString:function(){var b="";if(document.referrer!=undefined&&document.referrer!=null&&document.referrer!="")b=document.referrer;else{var a=dj.util.Page.getQueryParam("fixedKeyword");if(a!="")return{engine:"DUMMY",query:a}}if(b!=""){a=b.match(/(google|bing|yahoo|aol)/);var c="q=";if(a[1]=="yahoo")c="p=";b=b.split(c);c=-1;if(b[1]!="")c=b[1].indexOf("&",0);queryString=c!=-1?b[1].substring(0,c):b[1];b=unescape(queryString).replace(/[-,+]/g," ");return b!=undefined&&b!=null?{engine:a[1],query:b}:{engine:"",query:""}}}};dojo.provide("dj.module.articlePagination");dojo.require("dj.util.History");dojo.require("dj.util.Observer");dj.module.articlePagination={init:function(){dj.util.History.init();this.oPages=dojo.query("#articleTabs_panel_article .articlePage");if(!(typeof this.oPages=="undefined"||this.oPages===null)){this.oPages.removeClass("hidden");this.panelsName="articleTabs_panel_article";var b=this.oPages.length;this.paginationModel.setNumberOfPages(b);if(!(b<2)){var a=this,c=1;dj.util.History.subscribe(a.panelsName,function(e){a.paginationModel.setCurrent(e-1)});this.paginationModel.subscribe("current",function(e){c=a.oPages[e];if(typeof c!="undefined"){a.oPages.style({display:"none"});c.setStyle({display:"block"})}});this.paginationModel.subscribe("next",function(){a.paginationModel.setCurrent(a.paginationModel.getNext())});this.paginationModel.subscribe("prev",function(){a.paginationModel.setCurrent(a.paginationModel.getPrev())});this.paginationModel.subscribe("all",function(){a.oPages.invoke("setStyle",{display:"block"})});this.insertPagination(b,"article_pagination_top","article_pagination_bottom");var d=dj.util.History.get(a.panelsName)||null;d=d!==null&&d<=b&&d>0?d:1;a.paginationModel.setCurrent(d-1);dj.util.History.set(this.panelsName,d)}}},paginationModel:function(){var b=null,a=0,c=new dj.util.Observer(this);return{getPrev:function(){return 0<=b-1?b-1:b},getNext:function(){return a>b+1?b+1:b},getCurrent:function(){return b},setNumberOfPages:function(d){a=d},getNumberOfPages:function(){return a},setCurrent:function(d,e){b=d;c.fireByName("current",d,e)},doNext:function(d){c.fireByName("next",d)},doPrev:function(d){c.fireByName("prev",d)},doAll:function(d){c.fireByName("all",d)},subscribe:function(d,e){if(arguments.length==1){e=d;d="current"}c.subscribeByName(d,e)}}}(),insertPagination:function(){var b=$A(arguments),a=b.shift(),c=this.paginationModel,d=this;b.each(function(e){e=$(e);var f=d.buildPagination(a);c.subscribe("current",function(g){if(!isNaN(g)&&typeof f.pgs[g]!=="undefined"){g===0?dojo.addClass(f.prv,"disabled"):dojo.removeClass(f.prv,"disabled");g==a-1?dojo.addClass(f.nxt,"disabled"):dojo.removeClass(f.nxt,"disabled");f.all.setStyle({display:"block"});f.pgs.invoke("removeClassName","current");f.pgs[g].addClassName("current");window.scrollTo(0,0)}});c.subscribe("all",function(){f.all.setStyle({display:"none"});f.pgs.invoke("removeClassName","current");window.scrollTo(0,0)});f.pgs.each(function(g,h){g.observe("click",function(j){j.stop();c.setCurrent(h,g);dj.util.History.set(d.panelsName,h+1)})});f.nxt.observe("click",function(g){g.stop();c.doNext(f);dj.util.History.set(d.panelsName,c.getCurrent()+1)});f.prv.observe("click",function(g){g.stop();c.doPrev(f);dj.util.History.set(d.panelsName,c.getCurrent()+1)});f.all.observe("click",function(g){g.stop();c.doAll(f)});e.insert(f.cnt)})},buildPagination:function(b){var a=new Element("div",{"class":"pagination"}),c=new Element("ul",{"class":"listPages"});a.insert(c);var d=new Element("li",{"class":"listFirst"}),e=(new Element("a",{href:"#articleTabs_panel_article=prev"})).update("&laquo; Previous");d.insert(e);c.insert(d);d=[];for(var f=null,g=1;g<=b;g++){f=new Element("li",{"class":g!==1?"page":"page current"});f.insert((new Element("a",{href:"#articleTabs_panel_article="+g})).update(g));c.insert(f);d.push(f)}f=new Element("li");b=(new Element("a",{href:"#articleTabs_panel_article=next"})).update("Next &raquo;");f.insert(b);c.insert(f);c=(new Element("a",{href:"#articleTabs_panel_article=all","class":"articleOnePage"})).update("All On One Page");a.insert(c);return{cnt:a,pgs:d,prv:e,nxt:b,all:c}}};dojo.provide("dj.module.articleTabs");dojo.require("dj.widget.panels.virtual.Tabs");dojo.require("dj.widget.panels.virtual.History");dj.module.articleTabs={init:function(){this.panels=dj.widget.panels.PanelsFactory.create("articleTabs",{core:{panelPrefix:"articleTabs_panel_",panels:["article","video","slideshow","interactive","map","document","quotes","comments","englisharticle","whysubscribe"],enableBrowserHistory:true},tabs:{tabPrefix:"articleTabs_tab_",tabOnStyle:"selected",tabOffStyle:"deselected"}})},getPanels:function(){return this.panels}};dojo.provide("dj.widget.article.quotes.ArticleQuotes");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Tracking");dojo.declare("dj.widget.article.quotes.ArticleQuotes",null,{constructor:function(b,a,c,d,e,f){this.tabModule=b;this.tabName="quotes";this.dataTagId="quotesContainer";this.quotesPanelUrl=null;this.chartDataReady=this.adContainersAdded=false;this.fundChartData=this.fundChartDataUrl=this.chartData=this.chartDataUrl=null;this._init=false;this.omniture={saveVars:["pageName","section","aheadline","abasedocid","author","ctype"],saveValues:[],ctype:"quotes_tab",section:"Research and Tools",abasedocid:"",aheadline:"",author:"",pageNameSuffix:"_quotes"};this.typeMap=dojo.mixin({company:"djn","mutual-fund":"usfunds"},e);this.urlConfig=dojo.mixin({symbolTablePathPrefix:"/public/npage/",chartDataPathPrefix:"/public/npage/",symbolTablePathPageId:"0_0_WA_quotes_tab",chartDataPathPageId:"0_0_WA_QuotesTabChartData"},a);this.config=dojo.mixin({symbolsPerRequest:8,firstAdPosition:4,adInterval:3,multipleAds:false,loadingImg:true,initAutoComplete:true},f);this.baseChartConfig={StartDate:"",EndDate:"",Width:135,Height:35};this.chartConfig=dojo.mixin({freq:"5mi",time:"1dy"},this.baseChartConfig);if(c&&c.chart)this.chartConfig=dojo.mixin(this.chartConfig,c.chart);this.fundChartConfig=dojo.mixin({freq:"1d",time:"5dy"},this.baseChartConfig);if(c&&c.fund)this.fundChartConfig=dojo.mixin(this.fundChartConfig,c.fund);this.WSJIndexChartStyle=dojo.mixin({background:"#ffffff",border:"#E6E2D7",closelineStyle:"#e36825",horizontalGridLineStyle:"#f4f3f1",highIndicatorStyle:"#093c71",highlowLineStyle:"#015190",lowIndicatorStyle:"#093c71",mainLineStyle:"#557BA0",mainPriceLineFill:"rgba(85,123,160,0.15)",mainPriceLineWidth:1,maxPriceLines:4,verticalGridLineStyle:"rgba(180,201,202,0.5)",verticalGridLineStyle_Opaque:"rgba(180,201,202,1.0)",vPadding:0,YAxisLabelStyle:1,YAxisLabelHeight:0,showDecimals:1,regionStyles:{0:"#cde2e0",1:"#cde2e0",2:"rgba(51,51,51,0.06)"},comparelineStyles:{0:"#cc3333",1:"#3b8dad",2:"#c9932e",3:"#b78383",4:"#8eb3bc",5:"#dbb782"}},d);this.callWhenQuotesActive(b)},init:function(){if(!this._init){this._init=true;var b=dj.util.Element.getDataset(dojo.byId(this.dataTagId)),a=eval(b.companySymbolCount),c="",d="",e="",f="",g="qqs",h=this.config.symbolsPerRequest,j="",n="";var_qsSymbol="";for(var l=0;l<a;l++){var p=b["companySymbol"+l].split("@"),q=p[0].toUpperCase(),r=this.typeMap[p[1]].toUpperCase();if(r==="DJN")c=c.concat(","+q);else e=e.concat(","+q);if(l!==0&&l%h===0){j=j.concat("&"+g+Math.ceil(l/h)+"="+this.processQueryString(f));f=""}f=f.concat("&symbol="+q+"&type="+r)}if(f!=="")j=j.concat("&"+g+Math.ceil(a/h)+"="+this.processQueryString(f));var m=this.urlConfig;if(c.length>0){var u=this.chartConfig,k="";for(name in u)k=k.concat("&"+name+"="+u[name]);var t="/public/npage/0_0_WG_Tickers_Information_Q.html?q="+c;if(t===null){this.chartDataReady=false;return}var o=this;dj.lang.xhrGet({url:t,handleAs:"json",preventCache:true,load:function(x){o._qsChartCountrySymbols=x;dojo.forEach(o._qsChartCountrySymbols.tickers,function(v){var y=v.country,z=v.name;d=d.concat(","+y+":"+z)});o.chartDataUrl=m.chartDataPathPrefix+
m.chartDataPathPageId+".html?queryString="+o.processQueryString(k+"&Symbols="+d)},error:function(){o.chartDataReady=false}})}if(e.length>0){var w=this.fundChartConfig;k="";for(name in w)k=k.concat("&"+name+"="+w[name]);this.fundChartDataUrl=m.chartDataPathPrefix+m.chartDataPathPageId+".html?queryString="+this.processQueryString(k+"&Symbols="+e.substring(1))}if(j.length>0)this.quotesPanelUrl=m.symbolTablePathPrefix+m.symbolTablePathPageId+".html?"+j.substring(1)}},callWhenQuotesActive:function(b){var a=false;b.addChangeListener("success",function(c){a=this.play(a,c.getId())},this);a=this.play(a,b.getActive().getId())},play:function(b,a){if(this.tabName!==a)return b||false;this.omniturefirepixel(true);if(b)this.loadAd();else{this.init();this.beginLoading();this.initSymbolLookup();this.loadQuotesTable()}return true},loadQuotesTable:function(){var b=this;console.log();var a=this.quotesPanelUrl+this.getCurrentDateQueryString();a!==null&&a!==""&&dojo.xhrGet({url:a,load:function(c){dojo.byId(b.dataTagId).innerHTML=c;b.loadAd();b.loadCharts()}})},getCurrentDateQueryString:function(){var b=new Date,a;a=" ".concat(b.getFullYear()+"-");a=a.concat(this.addLeadingZero(b.getMonth()+1)+"-");a=a.concat(this.addLeadingZero(b.getDate())+" ");a=a.concat(this.addLeadingZero(b.getHours())+":");a=a.concat(this.addLeadingZero(b.getMinutes()));return"&ct="+this.processQueryString(a)},addLeadingZero:function(b){if(b<10)return"0"+b;return b},processQueryString:function(b){return escape(b.substring(1))},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;var b=this.omniture.pixel.getMetaData("pageName");if(b.indexOf("FreeRegScrimForm")==-1){this.omniture.pixel.resetPixel();this.omnituresavepixel();if(b.indexOf("Flash Interactive")!=-1){this.omniture.ctype="quotes_tab_interactives";s.prop21="";s.prop8="DJ Infographics"}this.omniture.pixel.setMetaData("ctype",this.omniture.ctype);this.omniture.pixel.setMetaData("section",this.omniture.section);this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);this.omniture.pixel.setMetaData("abasedocid",this.omniture.abasedocid);this.omniture.pixel.setMetaData("author",this.omniture.author);this.omniture.pixel.setMetaData("pageName",b+this.omniture.pageNameSuffix);this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}},loadAd:function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.insertAdContainers();this.ads.loadAds(this.tabName)},insertAdContainers:function(){if(!this.adContainersAdded){this.adContainersAdded=true;var b=dojo.byId("mqContainerDiv");b=dojo.query("ul.mqContainerList",b);var a=this,c=0,d=0,e=this.config.firstAdPosition-1;dojo.forEach(b,function(f){if((a.config.multipleAds||c===0)&&!dojo.hasClass(f,"hidden")){if(d===e||d>e&&(d-e)%a.config.adInterval===0)dojo.place(dojo.create("div",{id:"ad_div"+c++,"class":"adSummary ad_728_reallywide"}),f,"after");d++}});c===0&&dojo.place(dojo.create("div",{id:"ad_div"+c++,"class":"adSummary ad_728_reallywide"}),b[b.length-1],"after")}},loadCharts:function(){if(dj.lang.isIE){document.namespaces.g_vml_||document.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");document.namespaces.g_o_||document.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}this.getChartData(this.chartDataUrl);this.getChartData(this.fundChartDataUrl)},renderChart:function(){if(this.chartDataReady){var b=this;dojo.forEach(this.chartData,function(a){a=a.Key;var c="chartCanvas"+a,d=dojo.byId(c);if(d){b.renderChartWithContainerAndSymbol(c,a,a);if(dojo.hasAttr(d,"advancedChartUrl")){dojo.style(d,{cursor:"pointer"});dojo.connect(d,"click",d,function(){window.location=dojo.attr(d,"advancedChartUrl")})}}})}},renderChartWithContainerAndSymbol:function(b,a,c){try{(new EmbeddedChart(b,this.WSJIndexChartStyle,this.chartConfig.Width,this.chartConfig.Height,this.chartConfig.time,this.chartConfig.freq,null,null,this.chartData,a)).ShowChart()||this.showNoChartMessage(b,c)}catch(d){console.log(d)}},showNoChartMessage:function(b){dojo.byId(b)},getChartData:function(b){if(b===null)this.chartDataReady=false;else{var a=this;dj.lang.xhrGet({url:b,handleAs:"json",preventCache:true,load:function(c){a.chartData=c;a.chartDataReady=true;a.renderChart();a.doneLoading();return c},error:function(c){a.chartDataReady=false;return c}})}},initSymbolLookup:function(){if(this.config.initAutoComplete){initInfoComplete((new InfoCompleteConfig("quotesTabSymbolLookupField","quotesTabSymbolLookupResults","quotesTabSymbolLookupBtn")).initSymbol(formatSymbolCompleteResult),symbolComplete);var b=dojo.byId("quotesTabSymbolLookupField"),a=dojo.connect(b,"click",b,function(){if(this.value!=="")this.value="";dojo.disconnect(a)})}},beginLoading:function(){if(this.config.loadingImg){dojo.hasClass("quotesTabLoading","hidden")&&dojo.removeClass("quotesTabLoading","hidden");dojo.addClass("quotesPanel","hidden")}},doneLoading:function(){if(this.config.loadingImg){dojo.addClass("quotesTabLoading","hidden");dojo.removeClass("quotesPanel","hidden")}}});dojo.provide("dj.widget.article.text.ArticleText");dojo.require("dj.widget.video.Video");dojo.require("dj.widget.ad.AdManager");(function(){var b=dj.widget.article.text;(b.ArticleTabText=function(a,c,d){this.tabModule=a;this.playObserver=c;this.tabName="article";this.videos={};this.videothumbs={};this.flashes={};this.omniture={};this.omniturePrefix=d!=="undefined"?d:"";this.omniture.saveVars=["pageName","section","aheadline","abasedocid","author"];this.omniture.saveValues=[];var e=this;a.observePanels(function(f,g){if(a.hasPanel(f))if(f==e.tabName)e.play();else g==e.tabName&&e.pausevideos()})}).prototype={registervideo:function(a,c,d,e,f){this.videos[a]={v:c,w:d,h:e,c:f}},registerflash:function(a,c,d){this.flashes[a]={p:c,s:d};if(!this.fixthumbhref){(a=dojo.byId("article_story_body"))&&dojo.connect(a,"onclick",function(e){var f=e.target;typeof f.href!=="undefined"&&f.href.indexOf("#")>-1&&f.href.split("#")[1].indexOf("articleTabs_")>-1&&dojo.stopEvent(e)});this.fixthumbhref=true}},registervideothumbnail:function(a,c){this.videothumbs[a]={v:c}},playflashes:function(){for(var a in this.flashes)if(this.flashes.hasOwnProperty(a))if(!this.flashes[a].flash)this.flashes[a].flash=new dj.widget.flash.Flash(a,this.flashes[a].p,this.flashes[a].s)},playvideos:function(){for(var a in this.videos)if(this.videos.hasOwnProperty(a))if(!this.videos[a].video)this.videos[a].video=new dj.widget.video.Video(a,this.videos[a].v,this.videos[a].w,this.videos[a].h,this.videos[a].c)},playvideothumbs:function(){for(var a in this.videothumbs)if(this.videothumbs.hasOwnProperty(a))if(!this.videothumbs[a].videothumb){this.videothumbs[a].videothumb=new dj.widget.video.Video(a);this.videothumbs[a].videothumb.loadthumbnail(this.videothumbs[a].v,200,120,this.playObserver)}},pausevideos:function(){if(this.videos)for(var a in this.videos)try{this.videos[a].video.pauseMicroPlayer()}catch(c){}},play:function(a){if(!a)if((a=dojo.query("div.articleHeadlineBox"))&&a[0]){a=dojo.position(a[0],true).y;var c=dojo.getViewport().t[1];a<c&&window.scrollTo(0,a)}if((a=dojo.byId("fblikebot"))&&a.getElementsByTagName("iframe")[0]&&a.getElementsByTagName("iframe")[0].height<5)a.getElementsByTagName("iframe")[0].src=a.getElementsByTagName("iframe")[0].src;if((a=dojo.byId("related_stories_module"))&&a.getElementsByTagName("iframe")[0]&&a.getElementsByTagName("iframe")[0].height<15)a.getElementsByTagName("iframe")[0].src=a.getElementsByTagName("iframe")[0].src;if(!this.ads)this.ads=dj.widget.ad.AdManager;if(this.ads)try{this.ads.loadAds("article")}catch(d){}this.omniturefirepixel()},tabplay:function(){this.setdefault();this.tabModule.setActivePanel(this.tabName)},playbookmark:function(){this.tabModule.getActivePanel()==this.tabName&&this.play(true)},omnituresavepixel:function(){for(var a=this.omniture.saveVars.length,c=0;c<a;c++)this.omniture.saveValues[c]=this.omniture.pixel.getMetaData(this.omniture.saveVars[c])},omniturerestorepixel:function(){for(var a=this.omniture.saveVars.length,c=0;c<a;c++)this.omniture.pixel.setMetaData(this.omniture.saveVars[c],this.omniture.saveValues[c])},omniturefirepixel:function(){if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData("ctype","article");this.omniture.pixel.setMetaData("section","Article");this.omniturePrefix!==""?this.omniture.pixel.firePixel(true,this.omniturePrefix):this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}}})();dojo.provide("dj.widget.article.tools.ArticleTools");dojo.require("dj.util.Url");dojo.require("clickability.w-button");dojo.getObject("dj.module.dashboard",true);dojo.getObject("dj.module.articleTools",true);var suppressReprints=0,digg_url=AT_VARS.articleUrl,clickURL=digg_url+"?mod=mostpop",digg_title=AT_VARS.clickTitle,clickTitle=digg_title,digg_bodytext=AT_VARS.bodyText,digg_topic="";longUrl=digg_url+"?mod=wsj_share_twitter";twitter_title=digg_title;if(twitter_title.length>79)twitter_title=twitter_title.substr(0,77)+"...";function bitlyCallback(b){bitlyTargetUrl=b.statusCode==="OK"&&b.results[longUrl].shortCNAMEUrl!="undefined"?"http://twitter.com/intent/tweet?text="+encodeURIComponent(twitter_title+" "+b.results[longUrl].shortCNAMEUrl):"http://twitter.com/intent/tweet?text="+encodeURIComponent(twitter_title+" "+longUrl);window.open(bitlyTargetUrl)}
function CopyrightPopUp(){var b=AT_VARS,a=[];a.push("PublisherName="+escape(b.publicationName));a.push("ContentID="+escape(b.baseDocId+b.baseDocExtension));a.push("orderReset=true");a.push("Title="+escape(b.articleHeadline));a.push("Author="+escape(b.authors));a.push("CreditLine="+escape(b.byLine||""));a.push("PublicationDate="+escape(b.publicationDate));a.push("ArticleType="+escape(b.articleType));a.push("DJType="+escape(b.djType));a.push("orderSource=wsj.com");dj.util.Url.openWin("https://s100.copyright.com/Clients/wsj_com/FairUse.jsp?"+
a.join("&"),"reprints",515,440,"scroll,resizable",true)}
dj.util.Article={getParentByNodeName:function(b,a){if(b.nodeName.toLowerCase()==a||b.parentNode===null)return b;return dj.util.Article.getParentByNodeName(b.parentNode,a)},isFloat:function(b){return/\d+\.\d+/.test(b)},shortenMe:function(){var b="http://api.bit.ly/shorten?callback=bitlyCallback&longUrl="+encodeURIComponent(longUrl)+"&version=2.0.1&login=wsjblogs&apiKey=R_4dd2ea29f00a2b806151d12d7807286b";if(document.getElementById("bitlynode")===null){var a=document.createElement("script");a.setAttribute("id","bitlynode");a.setAttribute("src",b);document.body.appendChild(a)}else window.open(bitlyTargetUrl);return false}};dojo.declare("dj.module.articleTools.Initilizer2011",null,{constructor:function(b,a,c,d){(new dj.module.articleTools.Button(b+".at.emailthis",function(){var e="wsj_share_email";if(b.indexOf("b")>0)e+="_bot";ET(e)},false)).init();(new dj.module.articleTools.Button(b+".at.print",function(){var e="".concat(document.location),f=e.indexOf("#");if(f!=-1)e=e.substring(0,f);dj.util.Url.openWin(e+"#printMode","printFriendly",800,600,"",true)},false)).init();a?(new dj.module.articleTools.TextBuddy(b+".at.tbl",b+".at.tbs",b+".at.tbm")).init(c):(new dj.module.articleTools.Button(b+".at.reprint",function(){CopyrightPopUp()},false)).init();if(d)(a=dojo.byId(b+".at.sponsor"))&&dojo.removeClass(a,"hidden")}});dojo.declare("dj.module.articleTools.Initilizer",null,{constructor:function(b,a,c,d){var e=false;(new dj.module.articleTools.Button(b+".at.emailthis",function(){var f="wsj_share_email";if(b.indexOf("b")>0)f+="_bot";ET(f)},e)).init();(new dj.module.articleTools.Button(b+".at.print",function(){var f="".concat(document.location),g=f.indexOf("#");if(g!=-1)f=f.substring(0,g);dj.util.Url.openWin(f+"#printMode","printFriendly",800,600,"",true)},e)).init();if(a){a=(new dj.module.articleTools.MenuButton(b+".share.arrow",b+".share.ddc")).init();(new dj.module.articleTools.TextBuddy(b+".at.tbl",b+".at.tbs",b+".at.tbm",a)).init(c)}else(new dj.module.articleTools.Button(b+".at.reprint",function(){CopyrightPopUp()},e)).init();(new dj.module.articleTools.ShareButton(b+".share.facebook",function(){var f="http://www.facebook.com/share.php?u="+encodeURIComponent(digg_url+"?mod=wsj_share_facebook")+"&t="+encodeURIComponent(digg_title);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.delicios",function(){var f="http://del.icio.us/post?v=4&partner=wsj&noui&jump=closeurl="+encodeURIComponent(digg_url+"?mod=wsj_share_delicios")+"&title="+encodeURIComponent(digg_title)+"&bodytext="+encodeURIComponent(digg_bodytext);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.reddit",function(){var f="http://www.reddit.com/submit?title="+encodeURIComponent(digg_title)+" &url="+encodeURIComponent(digg_url+"?mod=wsj_share_reddit");window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.stumble",function(){var f="http://www.stumbleupon.com/submit?&url="+encodeURIComponent(digg_url+"?mod=wsj_share_stumble")+"&title="+encodeURIComponent(digg_title);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.fark",function(){var f="http://www.fark.com/cgi/farkit.pl?u="+encodeURIComponent(digg_url+"?mod=wsj_share_fark")+"&h="+encodeURIComponent(digg_title);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.linkedin",function(){var f="http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(digg_url+"?mod=wsj_share_linkedin")+"&source=WSJ";window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.twitter",function(){dj.util.Article.shortenMe()},e)).init();(new dj.module.articleTools.ShareButton(b+".share.viadio",function(){var f="http://www.viadeo.com/shareit/share/?url="+encodeURIComponent(digg_url+"?mod=wsj_share_viadeo")+"&title="+encodeURIComponent(digg_title)+"&urlaffiliate=40510";window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.orkut",function(){var f="http://promote.orkut.com/preview?nt=orkut.com&tt="+encodeURIComponent(digg_title)+"&cn="+encodeURIComponent(digg_bodytext)+"&du="+encodeURIComponent(digg_url+"?mod=wsj_share_orkut");window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.digg",function(){Digg.remoteSubmit(digg_url+"?mod=wsj_share_digg",digg_title,digg_bodytext,digg_topic)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.myspace",function(){var f="http://www.myspace.com/Modules/PostTo/Pages/?t="+encodeURIComponent(digg_title)+"&c="+encodeURIComponent(digg_bodytext)+"&u="+encodeURIComponent(digg_url+"?mod=wsj_share_myspace")+"&l=3";window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.ybuzz",function(){var f=dojo.byId(this.id);if(f)f.href+=digg_url+"?mod=wsj_share_ybuzz"},true)).init();if(d)(c=dojo.byId(b+".at.sponsor"))&&dojo.removeClass(c,"hidden")}});dojo.declare("dj.module.articleTools.Button",null,{constructor:function(b,a,c){this.id=b;if(this.clickHandler=a)this.clickHandler=dojo.hitch(this,this.clickHandler);this.isLink=c;return this},init:function(){if(this.isLink)this.clickHandler();else{var b=dojo.byId(this.id);b&&this.clickHandler&&dojo.connect(b,"onclick",this,this.clickHandler)}dojo.connect(document,"onclick",this,function(a){this.handleDocClick(a)});return this},handleDocClick:function(b){dj.util.Article.getParentByNodeName(b.target,"a").id==this.id&&!this.isLink&&dojo.stopEvent(b)}});dojo.declare("dj.module.articleTools.ShareButton",dj.module.articleTools.Button,{constructor:function(){if(this.clickHandler===null){var b=dojo.byId(this.id);b&&dojo.addClass(b.parentNode,"hidden")}}});dojo.declare("dj.module.articleTools.MenuButton",null,{constructor:function(b,a){this.id=b;this.menuItem=dojo.byId(a);return this},init:function(){var b=dojo.byId(this.id);b&&dojo.connect(b,"onclick",this,function(a){this.toggleMenu();dojo.stopEvent(a)});dojo.connect(document,"onclick",this,function(a){var c=dojo.byId(this.id);c&&a.target!=c&&this.closeMenu()});return this},toggleMenu:function(){dojo.toggleClass(this.menuItem,"collapsed");dojo.toggleClass(this.menuItem,"expanded");dj.module.dashboard.DashboardSaveTo&&dj.module.dashboard.DashboardSaveTo.restoreDefaultState()},closeMenu:function(){dojo.addClass(this.menuItem,"collapsed");dojo.removeClass(this.menuItem,"expanded");dj.module.dashboard.DashboardSaveTo&&dj.module.dashboard.DashboardSaveTo.restoreDefaultState()}});dojo.declare("dj.module.articleTools.TextBuddy",null,{constructor:function(b,a,c,d){this.idLarge=b;this.idSmall=a;this.idMiddle=c;this.targetElements=dojo.query(".article.story p");if((b=dojo.query("div.articlePage p"))&&b.length>0)this.targetElements=dojo.query("div.articlePage p");this.initialState=[];this.refFontSize=0;this.increment=1;this.max=-1;this.min=4;this.menuButton=d;this.unit={em:0.1,px:1};return this},init:function(b){if(b){(b=dojo.byId(this.idLarge))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(true);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});(b=dojo.byId(this.idSmall))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(false);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});this.targetElements.forEach(function(a,c){var d=dojo.style(a,"fontSize");this.initialState[c]=d;if(c===0){d=d.substring(0,d.length-2);this.refFontSize=dj.util.Article.isFloat(d)?parseFloat(d):parseInt(d,10)}},this);(b=dojo.byId(this.idMiddle))&&dojo.connect(b,"onclick",this,function(a){this.clickHandlerMiddle();dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()})}else this.hideIt()},clickHandlerMiddle:function(){var b=this.initialState;this.targetElements.forEach(function(a,c){dojo.style(a,{fontSize:""+b[c]})})},makeItSo:function(b){if(this.targetElements&&this.targetElements.length>0){var a=dojo.style(this.targetElements[0],"fontSize"),c=a.substring(a.length-2),d=this.unit[c];a=a.substring(0,a.length-2);var e=dj.util.Article.isFloat(a);a=e?parseFloat(a):parseInt(a,10);a=a-this.refFontSize;if(e)a=a.toPrecision(2);if(!(b&&this.max!=-1&&a>=this.max*d||!b&&this.min!=-1&&a<=-(this.min*d))){var f=(b?this.increment:-this.increment)*d;this.targetElements.forEach(function(g){var h=dojo.style(g,"fontSize"),j=h.indexOf(c);if(j!=-1){h=h.substring(0,j);h=dj.util.Article.isFloat(h)?parseFloat(h):parseInt(h,10);dojo.style(g,{fontSize:h+f+c})}})}}},hideIt:function(){var b=dojo.byId(this.idLarge);b&&dojo.addClass(b.up(),"hidden")}});dojo.provide("dj.module.comments.comments");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Tracking");dojo.require("dj.community.ArticleComments");dojo.require("dj.util.Observer");dj.module.comments.comments={sbNumber:typeof AT_VARS==="object"?AT_VARS.baseDocId:"",tabName:"comments",articleName:typeof AT_VARS==="object"?AT_VARS.articleHeadline:"",theArticleComments:null,showCommentsOnTabs:function(b,a){var c=this,d=false;b=b=="undefined"||b===null?dj.context.core.urlPrefix:document.URL.substring(0,document.URL.indexOf(".com")+4);if(s.prop2==="WSJ_Opinion"||s.prop2==="Opinion")d=true;c.theArticleComments=new dj.community.ArticleComments(c.sbNumber,c.articleName,b+"/community","/community",function(e){if("undefined"!==typeof dj.module.articleTabs&&"undefined"!==typeof dj.module.articleTabs.config&&"undefined"!==typeof dj.module.articleTabs.config.comments){var f=dj.module.articleTabs.config.comments;if("undefined"!==typeof f.commentCountDisplayText)var g=f.commentCountDisplayText;if("undefined"!==typeof f.firstCommentDisplayText)var h=f.firstCommentDisplayText;if("undefined"!==typeof f.addCommentSingularDisplayText)var j=f.addCommentSingularDisplayText;if("undefined"!==typeof f.addCommentPluralDisplayText)var n=f.addCommentPluralDisplayText}this.cElement=dojo.query("#articleTabs_tab_comments a")[0];if(!isNaN(e)&&e>0){f="Comments";if("undefined"!==typeof g)f=g;if(AT_VARS.articleType=="Portuguese"||AT_VARS.articleType=="Spanish")f="Comentarios";this.cElement.innerHTML=f+" ("+e+")"}if(g=dojo.byId("comment_text"))if(isNaN(e)||e===0){g.innerHTML="Be the first to comment";if("undefined"!==typeof h)g.innerHTML=h}else{h=" Comments, add yours ";if("undefined"!==typeof n)h=n;if(e==1){h=" Comment, add yours ";if("undefined"!==typeof j)h=j}g.innerHTML=e+h}},function(e){c.activateCommentsPanel();e=dojo.byId(e);if(e===undefined)window.scrollTo(0,0);else e!==null?window.scrollTo(0,e.offsetTop-200):console.error("Exception occured in showComments")},d,function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.ads&&this.ads.loadAds(c.tabName);dj.module.articleCommentsTab.omniturefirepixel()},a);c.theArticleComments.GetCommentBox("leaveComment");dj.module.articleTabs&&dj.module.articleTabs.panels.getActivePanel()===c.tabName&&c.theArticleComments.GetComments("discussionThreadBox")},showCommentsOnCommentTab:function(){this.theArticleComments.GetComments("discussionThreadBox")},clearComment:function(b){b.value=""},activateCommentsPanel:function(){dj.module.articleTabs&&dj.module.articleTabs.panels.getActivePanel()!==this.tabName&&dj.module.articleTabs.panels.setActivePanel(this.tabName)},replaceHTMLTags:function(b){b=b.replace(/</g,"&lt;");return b=b.replace(/>/g,"&gt;")}};dojo.mixin(dj.module.comments,dj.module.comments.comments);dojo.provide("dj.widget.article.slideshow.nonflashSlideshow");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.util.Ads");dojo.require("dj.util.Tracking");dojo.require("dojo.back");dojo.require("dojo.hash");ApplicationState=function(b,a,c){this.stateData=a;this.changeUrl=c||false;this.pModel=b};ApplicationState.prototype={back:function(){dj.widget.article.slideshow.slideshowHOD.historyCall(this.stateData)},forward:function(){dj.widget.article.slideshow.slideshowHOD.historyCall(this.stateData)}};dj.widget.article.slideshow.nonflashSlideshow={ACTION_SOURCE:{BOOKMARK:1,CONTROL:2,HISTORY:3,NONE:-1},init:function(b,a){var c=this.config=dojo.safeMixin({containerId:"slideContainer",imageCreditCriteria:".imageCredit div",slideDescriptionCriteria:".slideDescription div",adRefreshCounter:3,hasBrowserHistory:true,panels:{core:{enableLazyImages:true,panelGroup:".imageSlide .newsItem",cacheVector:false,tabletSwipe:true},carousel:{hasLastSlideScrim:true}},additionalControl:["slideBox"],hashPrefix:"slide/",history:true,lastSlideScrim:{id:"lastSlideScrim",clazz:".lastSlideScrim",backToBeginning:".dSlideviewer-backToBeginning"},slideContainer:"slideBox",swipeThresholdRatio:0.5,removeElement:null,removeClass:"startNext",renderThumbs:false,fireInitOmniture:true,omnitureContainerId:"omnitureInitCall",disableOmnitureCall:false,thumbsContainerId:"thumbBox",thumbsPanels:{core:{panelIncrement:3},carousel:{navContainer:".nav-inline",showNavButtons:true}}},b);try{if(b!=null&&b!==undefined){if(b.photopannel!==undefined&&b.photopannel!=null&&b.photopannel!="")c.panels=dojo.fromJson(b.photopannel);if(b.lastslidescrimobj!==undefined&&b.lastslidescrimobj!=null&&b.lastslidescrimobj!="")c.lastSlideScrim=dojo.fromJson(b.lastslidescrimobj);if(b.thumbspanel!==undefined&&b.thumbspanel!=null&&b.thumbspanel!="")c.thumbsPanels=dojo.fromJson(b.thumbspanel);if(b.slideContainer!==undefined&&b.slideContainer!=null)c.additionalControl[0]=b.slideContainer}}catch(d){console.log("Error while reteriving the config obj: "+d)}this._initialize(a);this._initLastSlideScrim();this.config.hasBrowserHistory&&this._initHistory();this._initializeTools();this._initializeCaptionShowHide()},_initialize:function(b){var a=null,c=this.config,d=this,e=c.additionalControl,f=dj.widget.panels.PanelsFactory;this.clickCounter=0;this.omniture={};this.panelsCount=0;this.actionSource=this.ACTION_SOURCE.NONE;if(b!==undefined&&b!==null)a=this.nextPanel=f.create(c.containerId,c.panels);else a=this.pnls=f.create(c.containerId,c.panels);a.firstNavArrows={view:a.views.navArrows,control:a.controllers.navArrows,lastSlideScrim:c.lastSlideScrim,slideContainer:c.slideContainer};a.lastSlideScrim=c.lastSlideScrim;b=0;for(var g=e.length;b<g;b++)f.addModuleNavArrows(a,{container:dojo.byId(e[b]),tabletSwipe:c.panels.core.tabletSwipe,thresholdRatio:c.swipeThresholdRatio});this.panelsCount=a.getNumberOfPanels();try{if(c.panels.carousel.hasLastSlideScrim){d=this;d.currPanel=a;dojo.addLiveEvent(c.lastSlideScrim.backToBeginning,"click",dojo.hitch(d,function(j){dojo.stopEvent(j);d._backToBeginning(d.currPanel)}),this)}}catch(h){console.log("Error while initializing last slide: "+c.lastSlideScrim.backToBeginning+" Error Msg: "+h)}a.addChangeListener("failure",function(j){var n=a.firstNavArrows.lastSlideScrim.id,l=dojo.byId(n);if(l!==undefined&&l!==null){if(j>a.getNumberOfPanels()){a.firstNavArrows.view.displayLastSlideScrim();this._enableLastSlideScrim(n,a.firstNavArrows.slideContainer)}j=false}else{if(j>a.getNumberOfPanels()){a.firstNavArrows.view.displayLastSlideScrim();this._enableLastSlideScrim()}j=false}(new dj.module.articleTools.Button("email_LastSlide",function(){ET()},j)).init()},this);a.addChangeListener("success",function(j){prevId=this.model._prevInHistory._position?this.model._prevInHistory._position:1;j=j.getPosition();if(prevId===j)prevId=1;if(j!==1)dojo.removeClass(c.slideContainer,"theFirstSlide");else j===1&&dojo.addClass(c.slideContainer,"theFirstSlide");try{if(!c.panels.carousel.hasLastSlideScrim&&a.getNumberOfPanels()===j)c.panels.carousel.nextButton!==undefined&&dojo.forEach(dojo.query(c.panels.carousel.nextButton),function(p){dojo.addClass(p,"hidden")});else!c.panels.carousel.hasLastSlideScrim&&a.getNumberOfPanels()-1===j&&c.panels.carousel.nextButton!==undefined&&dojo.forEach(dojo.query(c.panels.carousel.nextButton),function(p){dojo.hasClass(p,"hidden")&&dojo.removeClass(p,"hidden")})}catch(n){console.log("{nonflashSlideshow => addChangeListener} Error while hidding/showing next arrow")}try{c.removeElement=dojo.query("."+c.removeClass)||c.removeElement;c.removeElement.length>0&&dojo.removeClass(c.removeElement[0],c.removeClass)}catch(l){console.log("{nonflashSlideshow => addChangeListener} Error while removing startnext class")}d.updateThumbsAndPanel(prevId,j,c.renderThumbs,c.containerId,c.slideDescriptionCriteria,c.imageCreditCriteria);if(c.renderThumbs){d.thumbs.setActiveByPosition(j);if(j>d.thumbs.getActivePanel()+7)d.thumbs.setActiveByPosition(j-6);else j<=d.thumbs.getActivePanel()&&d.thumbs.setActiveByPosition(j)}});if(dojo.byId(c.thumbsContainerId))c.renderThumbs=true;if(dojo.byId(c.omnitureContainerId))c.fireInitOmniture=false;if(c.renderThumbs){this.thumbs=dj.widget.panels.PanelsFactory.create(c.thumbsContainerId,c.thumbsPanels);d=this;dojo.addLiveEvent(".thumbs","click",function(){try{d._disableLastSlideScrim();d.pnls.firstNavArrows.control.disableLastSlideScrim()}catch(j){console.info("Error in disabling the last slide.")}d.pnls.getActivePanel();var n=this.id.split("_")[1];d.pnls.setActiveByPosition(n)})}},_initializeCaptionShowHide:function(){dojo.addLiveEvent(".ssTxtToggle","click",function(b){dojo.stopEvent(b);var a=this.parentNode;if(a){var c=dojo.query(".caption_short",a);if(c){var d=dojo.query(".caption_full",a);if(d){c.addClass("hidden");d.removeClass("hidden");dojo.addClass(this,"hidden")}}}})},updateThumbsAndPanel:function(b,a,c,d,e,f){this.clickCounter+=1;var g=null;if(d!==undefined&&d!==null&&d!=="")g=dojo.byId(d);var h=null,j=null;if(d!==undefined&&d!==null&&d!==""){h=dojo.query(e,g.parentNode);j=dojo.query(f,g.parentNode)}else{h=dojo.query(this.config.imageCreditCriteria);j=dojo.query(this.config.slideDescriptionCriteria)}if(h!=undefined&&h[b-1])h[b-1].style.display="none";if(h!=undefined&&h[a-1])h[a-1].style.display="block";if(j!=undefined&&j[b-1])j[b-
1].style.display="none";if(j!=undefined&&j[a-1])j[a-1].style.display="block";if(this.clickCounter%this.config.adRefreshCounter==0)try{(new dj.util.Ads).loadAds("slideshow",{ordrecalculate:1})}catch(n){}if(c){c=dojo.query(".imageInfo .summary p");if(c[b-1])c[b-1].style.display="none";dojo.removeClassName(dojo.query("#thumbs_"+b)[0],"selected");if(c[a-1])c[a-1].style.display="block";dojo.addClassName(dojo.query("#thumbs_"+a)[0],"selected")}if(a!==1)try{this.config.disableOmnitureCall||this.omniturefirepixel(a)}catch(l){console.log("Error nonflashSlideshow{omniturefirepixel}: "+
l)}},_initHistory:function(){var b=this.config;if(b.history){dojo.subscribe("/dojo/hashchange",this,function(d){if(this.actionSource!==this.ACTION_SOURCE.CONTROL&&this.actionSource!==this.ACTION_SOURCE.BOOKMARK){d=d.replace(b.hashPrefix,"");var e=this.pnls.getNumberOfPanels();if(d==="eos"){this._enableLastSlideScrim();this.actionSource=this.ACTION_SOURCE.HISTORY;this.isEos=true}else{e=parseInt(d);this.isEos&&this._disableLastSlideScrim();this.isEos=false}this.pnls.setActiveByPosition(e)}if(this.actionSource!==this.ACTION_SOURCE.HISTORY)this.actionSource=this.ACTION_SOURCE.NONE});this.pnls.addChangeListener("success",function(d){if(this.actionSource===this.ACTION_SOURCE.BOOKMARK||this.actionSource===this.ACTION_SOURCE.HISTORY)this.actionSource=this.ACTION_SOURCE.NONE;else{d=b.hashPrefix+d._position;this.actionSource=this.ACTION_SOURCE.CONTROL;dojo.hash(d)}},this);this.pnls.addChangeListener("failure",function(d){if(this.actionSource!==this.ACTION_SOURCE.BOOKMARK&&d>this.pnls.getNumberOfPanels()){d=b.hashPrefix+"eos";this.actionSource=this.ACTION_SOURCE.CONTROL;dojo.hash(d)}},this);var a=dojo.hash();this.actionSource=this.ACTION_SOURCE.BOOKMARK;if(a===""||a==="articleTabs%3Dslideshow"){if(a==="articleTabs%3Dslideshow")this.isTabbedSlideshow=true;dojo.hash(b.hashPrefix.concat(1),true);b.fireInitOmniture&&this.omniturefirepixel()}else{a=a.split("/")[1];if(a==="eos"){a=this.pnls;var c=a._activePanelObserver;this.isEos=true;c.fireByName("failure",a.getNumberOfPanels()+1);this.pnls.setActiveByPosition(this.pnls.getNumberOfPanels())}else{a=parseInt(a);if(a!==this.pnls.getActive()._position)this.pnls.setActiveByPosition(a);else{this.actionSource=this.ACTION_SOURCE.NONE;b.fireInitOmniture&&this.omniturefirepixel()}}}}},_initLastSlideScrim:function(){},_initializeTools:function(){(new dj.module.articleTools.Button("email",function(){ET()},false)).init()},_enableLastSlideScrim:function(b,a){var c=this.config;if(b!==undefined&&b!==null){dojo.removeClass(b,"hidden");dojo.removeClass(a,"theFirstSlide");dojo.addClass(a,"theLastSlide")}else{dojo.removeClass(c.lastSlideScrim.id,"hidden");dojo.removeClass(c.slideContainer,"theFirstSlide");dojo.addClass(c.slideContainer,"theLastSlide")}},_disableLastSlideScrim:function(b,a){var c=this.config;if(b!==undefined&&b!==null){dojo.addClass(b,"hidden");dojo.removeClass(a,"theLastSlide");dojo.addClass(a,"theFirstSlide")}else{dojo.addClass(c.lastSlideScrim.id,"hidden");dojo.removeClass(c.slideContainer,"theLastSlide");dojo.addClass(c.slideContainer,"theFirstSlide")}},_backToBeginning:function(b){if(b!==undefined&&b!==null){this._disableLastSlideScrim(b.firstNavArrows.lastSlideScrim.id,b.firstNavArrows.slideContainer);b.setActiveByPosition(1);b.firstNavArrows.control.disableLastSlideScrim()}else{this._disableLastSlideScrim();this.pnls.setActiveByPosition(1);this.pnls.firstNavArrows.control.disableLastSlideScrim()}},historyCall:function(b){this.pnls.setHistory=false;var a=b;if(b.length>1&&b.indexOf("last")>0){a=b.split("/")[1];this.pnls.setActiveByPosition(a);dojo.byId("lastSlideScrim").style.display="block"}else this.pnls.setActiveByPosition(a);this.pnls.setHistory=true},initExplore:function(){this.initExploreSlideshows();this.initializeExplore()},initExploreSlideshows:function(){this.exploreMore=dj.widget.panels.PanelsFactory.create("exploreMoreSlideshows",{core:{panelIncrement:5,panelGroup:".carouselContainer",panel:"ul.one li",enableLazyImages:true},carousel:{},rotator:{rotateTime:0}})},initializeExplore:function(){var b=this;dojo.addLiveEvent(".baseDocId","click",function(){b.baseDocId=this.id;b.openSlideshow()})},openSlideshow:function(){document.location.href=dj.context.core.urlPrefix+"/article/"+this.baseDocId+".html"},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){isBlogs=document.domain.indexOf("blogs")==-1?false:true;this.omniture={};this.omniture.saveVars=["pageName","section","subsection","aheadline","abasedocid","author","atype","csource","ctype","apage","basesection"];this.omniture.saveValues=[];if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniturePrefix=typeof dj.context.core!=="undefined"&&typeof dj.context.core.urlPrefix!=="undefined"&&dj.context.core.urlPrefix.indexOf("wallstreetjournal.de")!==-1?"WSJDE_":"WSJ_";var b=this.omniture.pixel.getMetaData("subsection");if(typeof b=="undefined"||b==""){b="US News";setMetaData("subsection",b)}setMetaData("qsymbol","slideshow");var a=this.omniture.pixel.getMetaData("aheadline");setMetaData("aheadline",this.omniturePrefix+"slideshow_"+b+"_"+a);if(!isBlogs){setMetaData("section","Multimedia");setMetaData("apage",this.omniturePrefix+"Multimedia_Slideshow");setMetaData("atype",this.omniturePrefix+"Multimedia_Slideshow");setMetaData("basesection",this.omniturePrefix+"Slideshow");this.isTabbedSlideshow?setMetaData("ctype","photos_tab"):setMetaData("ctype","photos")}setMetaData("csource","DJ Infographics");this.omniture.pixel.getMetaData("atype");b=this.pnls.getActivePanel()+1;setMetaData("pageName","Infogrfx Slide Show Redesigned_"+a+"_"+b+"_of_"+this.panelsCount);typeof dj.context.core!=="undefined"&&typeof dj.context.core.urlPrefix!=="undefined"&&dj.context.core.urlPrefix.indexOf("wallstreetjournal.de")!==-1?this.omniture.pixel.firePixel(true,"WSJDE_"):this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}};dojo.provide("dj.widget.article.flash.ArticleFlash");dojo.require("dj.util.History");dojo.require("dj.widget.flash.Flash");dojo.require("dj.widget.flash.IssuuFlash");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.flash.template");dojo.require("dj.widget.panels.virtual.Carousel");(function(){var b=dj.widget.article.flash;dojo.declare("dj.widget.article.flash.ArticleTabFlash",null,{constructor:function(a,c){this.parent=dojo.byId(a);this.id=a;this.tabModule=c;this.omniture={};this.omniture.ctype="flash";this.supportAjaxLoading=true;var d=this;c.observePanels(function(e,f){if(c.hasPanel(e))if(e==d.tabName)d.play();else if(f==d.tabName){dj.util.History.get("project")&&dj.util.History.set("project","",false);dj.util.History.get("s")&&dj.util.History.set("s","",false)}})},clear:function(a){if(a)a.so=null;for(;this.parent.firstChild;)this.parent.removeChild(this.parent.firstChild);this.player=null},makeid:function(a,c){if(a&&c)return a+"|"+c;if(a)return a},redraw:function(a){this.clear(this.flash);this.flash=a;this.supportAjaxLoading&&dojo.getObject("dj.util.flash.template",true).scan?this.createIframeOrFlash(a.p,a.s):this.flash.load(a.p,a.s)},createIframeOrFlash:function(a,c){var d;d=this.id.search(/interactive/i)!=-1?"interactive":this.id.search(/slideshow/i)!=-1?"slideshow":"";var e=dj.context.articleFlash.outputFilterFlashUrl,f=dj.context.articleFlash.outputFilterCacheable;if(e===undefined||e==="")e=f?"/public/page/0_0_W0_OutputFilter_DataTag_Flash_Cacheable":"/public/npage/0_0_W0_OutputFilter_DataTag_Flash.html";d=f?e+"-"+a+"-"+c+"-"+d+".html":e+"?flashProject="+a+"&alternateText="+c+"&slug="+d;var g=dojo.byId(this.id);dojo.xhrGet({url:d,handleAs:"text",load:function(h){g.innerHTML=h;dj.util.flash.template.scan()},error:function(){}})},register:function(a,c){if(!this.flashes)this.flashes={};var d={};d=this.newflash(this.id,a,c,true);d.swfPrefix=this.swfPrefix;this.flashes[this.makeid(a,c)]=d},setdefault:function(a,c){this.flash=this.findflashbyids(a,c);if(!this.flash){this.flash=this.newflash(this.id,a,c,true);this.flash.swfPrefix=this.swfPrefix;this.flashes[this.makeid(a,c)]=this.flash}},findflashbyids:function(a,c){if(!this.flashes)this.flashes={};var d=this.makeid(a,c);return this.flashes[d]?this.flashes[d]:null},playbyid:function(a,c){this.p=a;this.s=c;if(this.flash=this.findflashbyids(this.p,this.s)){this.redraw(this.flash);return true}else return false},playdefault:function(){if(this.flashes){if(!this.flash)for(var a in this.flashes)if(this.flashes.hasOwnProperty(a)){if(this.flashes[a])this.flash=this.flashes[a];break}this.redraw(this.flash)}},play:function(){var a=dojo.query("div.articleHeadlineBox");if(a&&a[0]){a=dojo.position(a[0],true).y;var c=dojo.getViewport().t;a<c&&window.scrollTo(0,a)}if(this.flash)this.playdefault();else{a=dj.util.History.get("project");c=dj.util.History.get("s");if(!c||!this.playbyid(a,c))this.playdefault()}this.reloadads()},reloadads:function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.ads&&this.ads.loadAds(this.tabName)},tabplay:function(a,c){this.setdefault(a,c);dj.util.History.set("project",a,false);c&&dj.util.History.set("s",c,false);this.tabModule.setActivePanel(this.tabName)},playbookmark:function(){this.tabModule.getActivePanel()==this.tabName&&this.play()},newflash:function(a,c,d,e){return new dj.widget.flash.Flash(a,c,d,{noload:e},this.tabName)}});dojo.declare("dj.widget.article.flash.ArticleFlashSlideshow",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="slideshow";this.omniture.ctype="slideshow_tab"},newflash:function(a,c,d,e){return new dj.widget.flash.SlideshowFlash(a,c,d,{noload:e})}});dojo.declare("dj.widget.article.flash.ArticleFlashInteractive",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="interactive";this.omniture.ctype="interactives_tab"}});dojo.declare("dj.widget.article.flash.ArticleFlashDocument",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="document";this.omniture.ctype="documents_tab";this.supportAjaxLoading=false},newflash:function(a,c,d,e){return new dj.widget.flash.IssuuFlash(a,c,d,{noload:e})}});dojo.declare("dj.widget.article.flash.ArticleFlashMap",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="map";this.omniture.ctype="maps_tab"}})})();dojo.provide("dj.module.article.articleKeywordBased");dojo.require("dj.util.referal");dj.module.article.articleKeywordBased={init:function(b){try{var a=dj.util.referal.getString();defaultArgs={moduleType:"",moduleURL:""};dojo.mixin(defaultArgs,b);if(typeof defaultArgs.moduleType!="undefined"&&defaultArgs.moduleType!=""&&defaultArgs.URL!=""&&typeof a!="undefined"&&a.query!=""){var c=dojo.byId(defaultArgs.moduleType);!(dojo.hasClass(c,"hidden")&&(c.style.display=="none"||c.style.display==""))&&this.getText(c,a,defaultArgs.moduleType,defaultArgs.moduleURL)}}catch(d){console.log("Displaying the Keywordbased Content");console.log(d)}},getText:function(b,a,c,d){coUrl=d+a.query+"-"+c+".html";dj.lang.xhrGet({url:coUrl,preventCache:true,handleAs:"text",load:function(e){b.innerHTML=e;console.log(" load response")},error:function(){console.log("error response");b.innerHTML=""}})}};dojo.provide("dj.widget.article.video.ArticleVideo");dojo.require("dj.module.articleTabs");dojo.require("dj.util.History");(function(){var b=dj.widget.article.video;(b.ArticleTabVideo=function(a,c){this.tabModule=a;this.tabPlayObserver=c;this.tabName="video";if(a){var d=this;a.observePanels(function(e,f){if(a.hasPanel(e))if(e==d.tabName)d.play();else if(f==d.tabName){d.player&&d.player.setBookMark();dj.util.History.get("video")&&dj.util.History.set("video","",false)}})}this.tabPlayObserver&&this.tabPlayObserver.subscribe(dojo.hitch(this,"tabplay"))}).prototype={guidconfig:{videoPlayerDivId:"videoPlayer",videoSummaryDivId:"videoSummary",registeredVideosDivId:"videoRelated",advertisementDivId:"videoAd",sideNavUlId:"videoSideNav",videoResultsDivId:"videoSearchResults",searchDivId:"videoSearchForm"},register:function(a){if(this.isguid(a)){if(!this.guidvideos)this.guidvideos=[];this.guidvideos.push(a)}},setdefault:function(a){this.defaultvid=a},playbyid:function(a){if(a&&this.isguid(a)){this.player.loadVideo(a,"articlePage");return true}else return false},playdefault:function(){if(this.defaultvid){this.isguid(this.defaultvid)?this.player.loadVideo(this.defaultvid,"articlePage"):this.player.loadVideo("","articlePage");this.defaultvid=null}else this.player.loadVideo("","articlePage")},play:function(){if(!this.player){this.player=new dj.widget.video.video(this.guidconfig,"dj.module.articleVideoPlayer.player");if(this.guidvideos)for(var a=this.guidvideos.length,c=0;c<a;c++)this.player.registerVideo(this.guidvideos[c])}(a=dj.util.History.get("video"))?this.playbyid(a):this.playdefault();if((a=dojo.query("div.articleHeadlineBox"))&&a[0]){a=dojo.position(a[0],true).y;c=dojo.getViewport().t;a<c&&window.scrollTo(0,a)}},tabplay:function(a){this.setdefault(a);dj.util.History.set("video",a);this.tabModule.setActivePanel("video")},playbookmark:function(){this.tabModule.getActivePanel()=="video"&&this.play()},popupvideo:function(){this.player.openPopUpPlayer()},isguid:function(a){a=""+a;if(a.substring(0,1)!="{")a="{"+a;return a.substring(0,1)=="{"&&a.substring(9,10)=="-"&&a.substring(14,15)=="-"&&a.substring(19,20)=="-"?true:false}}})();dojo.provide("dj.widget.article.comments.ArticleComments");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Tracking");dojo.require("dj.module.comments.comments");dojo.require("dj.module.fbLikeButton");dojo.declare("dj.widget.article.comments.ArticleComments",null,{constructor:function(b){this.tabModule=b;this.tabName="comments";this.omniture={};this.omniture.saveVars=["pageName","section","aheadline","atype","abasedocid","csource","apage","caccess","basesection","author"];this.omniture.saveValues=[];this.omniture.ctype="comments_tab";this.omniture.section="Community";this.omniture.abasedocid="";this.omniture.aheadline="";this.omniture.author="";this.omniture.pageNameSuffix="_comments";this.callWhenCommentsActive(b)},callWhenCommentsActive:function(b){var a=false;b.addChangeListener("success",function(c){a=this.play(a,c.getId())},this);a=this.play(a,b.getActive().getId())},play:function(b,a){if(this.tabName!==a)return b||false;this.loadAd();this.omniturefirepixel(true);b||dj.module.comments.showCommentsOnCommentTab();return true},loadAd:function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.ads.loadAds(this.tabName)},tabplay:function(){},playbookmark:function(){this.tabModule.getActivePanel()==this.tabName&&this.play(true)},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;var b=this.omniture.pixel.getMetaData("pageName");if(b.indexOf("FreeRegScrimForm")==-1){this.omniture.pixel.resetPixel();this.omnituresavepixel();if(b.indexOf("Flash Interactive")!=-1){this.omniture.ctype="comments_tab_interactives";s.prop21="";s.prop8="DJ Infographics"}this.omniture.pixel.setMetaData("ctype",this.omniture.ctype);this.omniture.pixel.setMetaData("section","Community");this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);this.omniture.pixel.setMetaData("abasedocid",this.omniture.abasedocid);this.omniture.pixel.setMetaData("author",this.omniture.author);this.omniture.pixel.setMetaData("pageName",b+this.omniture.pageNameSuffix);if(b.indexOf("WSJ PDF Document")!==-1||b.indexOf("WSJ_PDF_")!==-1){this.omniture.pixel.setMetaData("apage","WSJ_Community_PDFs");this.omniture.pixel.setMetaData("atype","WSJ_Community_PDFs");this.omniture.pixel.setMetaData("aheadline","WSJ_pdf_"+s.prop4);this.omniture.pixel.setMetaData("csource","DJ PDFs");this.omniture.pixel.setMetaData("caccess","free");this.omniture.pixel.setMetaData("author","");this.omniture.pixel.setMetaData("abasedocid","pdf_"+this.omniture.abasedocid);s.prop2=="WSJ_Infographic"&&this.omniture.pixel.setMetaData("basesection","WSJ_PDFs")}this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}}});
dojo.provide("dj.widget.newsreel.NewsReelLoader");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.user.EnvironmentDao");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.declare("dj.widget.newsreel.NewsReelLoader",dj.widget.fragmentloader.FragmentLoader,{NEWSREEL_CONFIG:{newsreelContainer:"newsReel",adRegisterKey:"newsReelAd",TTL:"24h"},constructor:function(a,b,e,c,d){this.cfg=dojo.delegate(this.DEFAULT_CONFIG,this.NEWSREEL_CONFIG);dojo.mixin(this.cfg,d);if(a=dj.util.Element.getDataset(dojo.byId(c)||{}))this.mstPageId=a.newsreelpage||this.mstPageId;this.cfg.isLoadCss=false;this.cfg.isLoadJs=false;this._initNewsReelRenderers();console.info("this.cfg.isLoadHtml="+
this.cfg.isLoadHtml)},onHtmlLoad:function(){dj.module.newsReel.init(this.cfg.newsreelContainer,this.cfg.adRegisterKey)},_initRenderers:function(){},_initNewsReelRenderers:function(){var a=dojo.clone(dj.context.core);this.userEnv=this._getUserEnv();a.customCacheCdnPrefix=dj.context.core.cdnPrefix;a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,a,{TTL:this.cfg.TTL});var b=new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentBo(a,this.userEnv,this.cfg);this.fileRenderer=new dj.widget.fragmentloader.renderer.FileRenderer(dj.util.animation,b)},_getUserEnv:function(){var a=this.userEnv;a||(a=(new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User)).getEnvironment());return a}});
dojo.provide("dj.module.article.ArticleVideoTab");dojo.require("dj.widget.video.MicroPlayer");dojo.require("dj.util.Observer");dojo.require("dj.widget.videos.controller.Player");dojo.require("dj.widget.videos.controller.AdPlayer");dojo.require("dj.widget.videos.controller.VideoBrowser");dojo.require("dj.widget.videos.controller.Playlist");dojo.require("dj.widget.videos.view.SimplePlaylist");dojo.require("dj.widget.videos.view.FullBrowser");dojo.require("dj.widget.videos.view.AdPlayer");dojo.require("dj.widget.videos.view.LargePlayer");dojo.require("dj.widget.videos.view.Html5LargePlayer");dojo.require("dj.widget.videos.model.PlayerTypes");dojo.require("dj.utils.VideoUtils");(function(){dj.module.article.ArticleVideoTab={init:function(a){this.configuration={advertisingSectionLabelID:"advertisingSectionLabel",specialAdCollection:"WSJ Business Center",host:"video.wsj.com",loadWaitTime:2E3,playerName:"video_articletab",flashPlayerPath:"/media/swf/",playerType:dj.widget.videos.model.PlayerTypes.MainPlayerF_Article,eventCallbacks:[],adContainer:"videoAd",adWidth:300,adHeight:250,videoObjectQuery:"[data-dj-live-widget='video.ArticleVideoTab']"};this.adCalls=[];this.staticAdUrl=this.staticAdImg="";dojo.deepMixin(this.configuration,a);this.observer=new dj.util.Observer(dj.module.article.ArticleVideoTab);this.subscribeToEvents();var b="";dojo.byId("videoThumbsHolder");var c=[],f=true;dojo.forEach(dojo.query(this.configuration.videoObjectQuery),function(d){d=dojo.attr(d,"data-video-info");var e;try{d=d.replace(/&lt;/g,"<");d=d.replace(/&amp;#/g,"&#");d=d.replace(/(\r\n|\n|\r)/gm," ");e=dojo.fromJson(d)}catch(g){}c.push(e);if(f){f=false;b=e.guid}});this.videoPlayer=new dj.widget.videos.controller.Player(this.observer,{playerType:this.configuration.playerType,playerID:"videoPlayer",eventNamespace:"dj.module.article.ArticleVideoTab",host:this.configuration.host,loadWaitTime:this.configuration.loadWaitTime,enableVideoModuleChaining:1,endScreenOverlay:false});this.videoPlaylist=new dj.widget.videos.controller.Playlist(this.observer);this.videoPlaylist.firstVideoID=b;this.videoBrowser=new dj.widget.videos.controller.VideoBrowser(this.observer);this.adPlayer=new dj.widget.videos.controller.AdPlayer(this.observer,{containerID:this.configuration.adContainer,playerID:this.configuration.adContainer,playerType:{width:this.configuration.adWidth,height:this.configuration.adHeight,swfFile:"adPlayer.swf"},flashPlayerPath:this.configuration.flashPlayerPath,host:this.configuration.host});this.adPlayer.init(new dj.widget.videos.view.AdPlayer({width:this.configuration.adWidth,height:this.configuration.adHeight}));this.adPlayer.render();this.scrollToPlayer=this.fromTopNav=false;a={name:this.configuration.playerName,enableVideoModuleChaining:1,showSectionTitle:false,useVideoTitleLink:false};this.videoPlayer.init(dj.utils.VideoUtils.hasValidFlashVersion()?new dj.widget.videos.view.LargePlayer(a):new dj.widget.videos.view.Html5LargePlayer(a));this.videoBrowser.init(new dj.widget.videos.view.FullBrowser({thumbnailItemsPerPage:99,thumbnailItemsPerRow:3,registerLiveEvent:true,lastInRowClass:"leftest"}));this.videoBrowser.browserPlayList={items:c};this.videoBrowser.render(1);this.videoPlaylist.init();this.observer.fireByName("onFirstLoad")},subscribe:function(a,b,c){this.observer.subscribeByName(a,b,c)},subscribeToEvents:function(){this.subscribe("onVideoSelected",this.videoSelected,this);this.subscribe("onCollectionLoad",this.collectionLoad,this);this.subscribe("onFirstLoad",this.firstLoad,this);this.subscribe("onVideoLoaded",this.videoLoaded,this);for(var a=this.configuration.eventCallbacks,b=a.length-1;b>=0;b--)this.subscribe(a[b].event,a[b].callback,this)},videoLoaded:function(a){this.videoBrowser.highligthThumbnail(a);document.title=this.videoPlayer.videoInformation.titletag!==""?"Video - "+this.videoPlayer.videoInformation.titletag+" - WSJ.com":"Video - "+this.videoPlayer.videoInformation.name+" - WSJ.com"},videoSelected:function(a,b){this.scrollToPlayer&&this.scrollToElement(dojo.byId(this.videoPlayer.configuration.playerID));this.scrollToPlayer=true;if(this.videoLoadsFirst)this.videoLoadsFirst=false;else this.videoPlayer.playVideo(a,unescape(this.videoBrowser.currentSection));this.videoPlaylist.render(b);this.nextVideoPlaylist=b},collectionLoad:function(){console.log("collectionLoad")},firstLoad:function(){this.videoLoadsFirst?this.videoBrowser.selectVideoByID(this.videoPlayer.getCurrentVideoID()):this.videoBrowser.selectVideoByIndex(0)},playNextVideo:function(){var a=this.videoPlaylist.getNextVideoID();if(a!="{"+this.videoPlaylist.firstVideoID+"}"){this.videoPlayer.playVideo(a,unescape(this.videoBrowser.currentSection));this.videoPlaylist.render();this.videoBrowser.highligthThumbnail(a)}},createAdvertisement:function(a,b,c){if(!this.adLoaded&&(c==250||c==600)){this.adLoaded=true;this.adPlayer.loadAd({imageURL:a,linkURL:b});setTimeout(dojo.hitch(this,function(){this.adLoaded=false}),5E3)}else if(c==50||c==60){this.staticAdImg=a;this.staticAdUrl=b}},openPopUpPlayer:function(){var a=swfobject.getObjectById(this.videoPlayer.configuration.playerID),b=0;if(typeof a.getSeek==="function")b=Math.floor(a.getSeek());dj.utils.VideoUtils.popUpPlayer({playLocation:b,collection:this.videoPlayer.getVideoData("wsj-section"),videoID:this.videoPlayer.videoID,height:this.videoPlayer.configuration.playerType.height,width:this.videoPlayer.configuration.playerType.width,imageurl:this.staticAdImg,linkurl:this.staticAdUrl})},continueLoadVideo:function(){this.videoPlayer.readyForEvents=true},requestPlayList:function(){return this.nextVideoPlaylist},addEvents:function(){},scrollToElement:function(a){for(var b=0,c=0;a!==null;){b+=a.offsetLeft;c+=a.offsetTop;a=a.offsetParent}window.scrollTo(b,c)}}})();dojo.provide("dj.module.globalNav");dj.module.globalNav={setupQuicklinks:function(a,b){this.oHideQuickLinks=dojo.query(".hideQuickLinks");this.oGlobalSubNav=dojo.byId(a);this.oQuicklinksContainer=dojo.byId(b);if(typeof this.oHideQuickLinks==="undefined")if(this.oGlobalSubNav===null)if(this.oQuicklinksContainer!=null){dojo.removeClass(this.oQuicklinksContainer,"subnav_hide");dojo.addClass(this.oQuicklinksContainer,"subnav_show")}}};
dojo.provide("dj.module.header.autocomplete");
dj.module.header.autocomplete={searchExec:function(){var a={autocompleteSuggestProvider:"MWatchWSJHatSearchProvider",autocompleteInputField:"globalHeaderSearchInput"};new dj.module.ep.globalheader.wsjAutocomplete(a.autocompleteInputField,{suggestProvider:a.autocompleteSuggestProvider,companyResearchBaseUrl:dj.context.core.quotesUrlPrefix},{categoryTypeArr:["FEATURES","COMPANIES","PRIVATE_COMPANIES","TOPICS","KEYWORDS"],CategoryDisplayConfigs:[{subHeading1:"",subHeading2:"",noOfColumns:1,columnToObjMap:["term",
"url"],subHeading1DisplayFlag:false,name:"suggestedTerms",maxNoOfSuggestionsToDisplay:3,subHeading1Class:"",noOfColumnsToObjMap:2},{subHeading1:"COMPANIES & QUOTES",subHeading2:"See all symbol results for ",noOfColumns:6,columnToObjMap:["ticker","company","country","exchange","exchangeIsoCode","type"],subHeading1DisplayFlag:true,subHeading2DisplayFlag:false,name:"companies",maxNoOfSuggestionsToDisplay:5,subHeading1Class:"hdrSearchListComp",noOfColumnsToObjMap:6},{subHeading1:"Private Companies",subHeading2:"",
noOfColumns:1,columnToObjMap:["name"],subHeading1DisplayFlag:true,name:"privateCompanies",maxNoOfSuggestionsToDisplay:5,subHeading1Class:"hdrSearchListComp hdrSearchListCompPrivate",noOfColumnsToObjMap:1},{subHeading1:"Topics and People In The News",subHeading2:"",noOfColumns:1,columnToObjMap:["name","code","type"],subHeading1DisplayFlag:true,name:"topics",maxNoOfSuggestionsToDisplay:5,subHeading1Class:"hdrSearchListTopicPpl",noOfColumnsToObjMap:3},{subHeading1:"Recent Searches",subHeading2:"",noOfColumns:1,
columnToObjMap:["keyword"],subHeading1DisplayFlag:true,name:"keywords",maxNoOfSuggestionsToDisplay:3,subHeading1Class:"hdrSearchListRecent",noOfColumnsToObjMap:1}]})}};
dojo.provide("dj.module.header.localWeather");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.widget.fragmentloader.FragmentLoader");
(function(){dj.module.header.localWeather={init:function(a){var b={defaultLocation:"10005",ttl:10,populateEl:"weatherContent",fragmentPage:"0_0_WC_HeaderWeather",iframeId:"iframeweatherDetails",iframeParam:"location",locationNameId:"locationName",pznUrl:"/pznusersvc/update/user/profile",setPznWeatherUrl:"/pznusersvc/view/user/profile?profileType=weatherCode",redirectUrl:"http://commerce.wsj.com/auth/login",locationSavedTxt:"Default location saved"};dojo.mixin(b,a);this.config=b;this.cookieWeatherCode=
this.getCookie("weatherCode");dj.util.Region.getViewByRegion()==="na,us"&&this._load()},_load:function(){var a=this;dj.util.User.isLoggedIn(function(b){if(b)dj.util.User.getUserId(function(c){var d=a.getCookie("weatherCode")?a.getCookie("weatherCode"):a.config.defaultLocation;if(a.getCookie("weatherUser")===c)a.getHTML(d);else{a.clearWeatherCookies();a.getPznLocalWeather(c)}});else{a.getHTML(a.config.defaultLocation);a.clearWeatherCookies()}})},getHTML:function(a){var b=(new dj.util.user.EnvironmentDao(dj.util.Region,
dj.util.User)).getEnvironment();(new dj.widget.fragmentloader.FragmentLoader(b,this.config.fragmentPage,a+"-v"+Math.floor(Math.random()*9E4)+1E4,this.config.populateEl,{isLoadCss:false,isLoadHtml:true,isLoadJs:false,isLoadInlineJs:false,isAnimated:false,TTL:this.config.ttl})).load()},getCookie:function(a){return dj.util.Cookie.getGroupCookie("DJCOOKIE",a)},setCookie:function(a,b){dj.util.Cookie.setGroupCookie("DJCOOKIE",a,b,365)},setDefaultLocation:function(a){var b=this,c=dojo.byId(a);a=b.getIframeParam(this.config.iframeId,
this.config.iframeParam);var d=a!==""?a:this.config.defaultLocation;dojo.byId(this.config.locationNameId).innerHTML=unescape(this.getIframeParam(b.config.iframeId,"name"));dj.util.User.isLoggedIn(function(e){if(e)d!==b.getCookie("weatherCode")?dojo.connect(c,"click",function(g){dojo.stopEvent(g);b.clearWeatherCookies();b.setPznLocalWeather(d);b.getHTML(d);b.setCookie("weatherCode",d);dojo.addClass(c,"hidden");dojo.place("<span style='font-size:1.1em'>"+b.config.locationSavedTxt+"</span>",c,"before")}):
dojo.addClass(c,"hidden");else dojo.connect(c,"click",function(g){dojo.stopEvent(g);window.location=b.getCommerceRedirectUrl()})})},getPznLocalWeather:function(a){var b=this;dojo.xhrGet({url:b.config.setPznWeatherUrl,headers:{Accept:"application/json"},handleAs:"json",load:function(c,d){d.xhr.getResponseHeader("Status");if(200!==d.xhr.status)console.error("Error message: Service is not working with Error Code: "+d.xhr.status);else{var e=c.User.profileData[0];if(e!==undefined){b.setCookie("weatherUser",
a);b.setCookie("weatherCode",e.weatherCode);b.getHTML(e.weatherCode)}else b.getHTML(b.config.defaultLocation)}},error:function(c,d){console.error("HTTP status code: ",d.xhr.status);return c}})},setPznLocalWeather:function(a){a={url:this.config.pznUrl,postData:dojo.toJson({profileType:"weatherCode",profileName:"weatherCode",params:[{weatherCode:a}]}),handleAs:"json",contentType:"application/json",accept:"application/json",load:function(){},error:function(){}};dojo.xhrPost(a)},clearWeatherCookies:function(){dj.util.Cookie.deleteGroupCookie("DJCOOKIE",
"weatherUser");dj.util.Cookie.deleteGroupCookie("DJCOOKIE","weatherCode")},getCommerceRedirectUrl:function(a){return(a||this.config.redirectUrl)+"&url="+escape(window.location)},getIframeParam:function(a,b){var c=dojo.byId(a).src,d="[\\?&]"+b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)";c=RegExp(d).exec(c);return c===null?"":c[1]}}})();
dojo.provide("dj.module.header.sectionMenu");dojo.require("dj.widget.panel.LiveModalPanel");dojo.require("dj.util.Element");dojo.require("dj.lang");dojo.require("dj.widget.panel.SelectDropdownPanel");
(function(){dj.module.header.sectionMenu={init:function(){var a=false;this.delayedMouseOver("._exp",function(b){if(!a){this.initializeHeaderPanels();this.setEvents();a=true}this.initShowData(b)},250);this.fadeInArrows()},initializeHeaderPanels:function(){new dj.widget.panel.LiveModalPanel({container:".linklist_dropdown .wsjmn_dropdown_container",containerInd:".linklist_dropdown .wsjmn_dropdown_container .mnExpand",dropdownContent:".wsjmn_dropdownContent",actionEvent:"click",stateContainer:".wsjmn_dropdownTree",
stateCollapsed:"wsjmn_ddState-collapsed",stateExpanded:"wsjmn_ddState-expanded",navContainer:".pmMainNav",stateHover:"mndd_ddState-hover",queryUpClass:"wsjmn_dropdownTree",addMouseEvents:false})},initShowData:function(a){var b=this.getDropdownIndex(a),c=dj.util.Element.getDataset(a).dropdownindex;c=dojo.byId(c+"_content");this.showData(b,c,a)},showData:function(a,b,c){var d=this;setTimeout(function(){if(dojo.hasClassName(c,"_data")===false){dojo.addClass(c,"_data");d.getHTML(a,b,c)}})},getDropdownIndex:function(a){a=
dj.util.Element.getDataset(a);return dj.util.Element.getDataset(dojo.byId(a.dropdownindex)).panelServiceUri},setIframeShimHeights:function(a){a=dj.util.Element.getDataset(a).dropdownindex.match(/(\d.*)/)[0];var b="wsjmn_dropdown_iframe"+a,c=dojo.byId("wsjmn_dropdown"+a+"_content");b=dojo.byId(b);for(var d=0;d<=c.length-1;d++)try{b.offsetHeight=dojo.byId("wsjmn_dropdown_content"+a).offsetHeight}catch(e){}try{b.offsetHeight=dojo.byId("wsjmn_dropdown_content"+a).offsetHeight}catch(g){}},setEvents:function(){var a=
this;dj.lang.addLiveEvent("._exp","mousedown",function(b){a.initShowData(b.target||b.srcElement)});dj.lang.addLiveEvent(".subExpand","mousedown",function(){a.subFlyoutToggle("1-3")})},delayedMouseOver:function(a,b,c){var d=false,e,g=this;dj.lang.addLiveEvent(a,"mouseout",function(){d=false});dj.lang.addLiveEvent(a,"mouseover",function(){e&&clearTimeout(e);d=true;var h=this;e=setTimeout(function(){d&&b.call(g,h)},c)})},getHTML:function(a,b){dojo.xhrGet({url:a,headers:{Accept:"application/html"},handleAs:"text",
load:function(c,d){d.xhr.getResponseHeader("Status");b.innerHTML=c;c.match(/<!--BusinessDropdown--\>/)&&new dj.widget.panel.SelectDropdownPanel("subIndDropdown")},error:function(c,d){console.error("HTTP status code: ",d.xhr.status);return c}})},subFlyoutToggle:function(a){a=dojo.byId("wsjsub_flyout"+a);if(a===null)return false;var b=a.className;a.className=b.indexOf("wsjsub_ddState-collapsed")!=-1?b.replace(/wsjsub_ddState-collapsed/,"wsjsub_ddState-expanded"):b.replace(/wsjsub_ddState-expanded/,
"wsjsub_ddState-collapsed");return false},fadeInArrows:function(){for(var a=dojo.query(".mnExpand._exp"),b=0;b<=a.length-1;b++)dojo.fadeIn({node:a[b],duration:1E3}).play()}}})();
dojo.provide("dj.module.globalHeader");dojo.deprecated("dj.module.globalHeader","use dj.module.header.globalHeader instead","1.4.1");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");
dj.module.globalHeader=function(){var a={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",
MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",
LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/itp/asia?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/itp/europe?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",
SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",
TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",
MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",
US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter",GO_PRO_HOOK:"goprohook",GO_PRO_HOOK_REGION:["na,us"]};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(this.cfg.HEADER_CONTAINER_CLASS)[0];this.editionDropdownSetUp();this.displaySubSection();
this.displayTimeStamp();var c=this;this.currRegion=dj.util.Region.getViewByRegion();this.concatURL="";this.concatURL=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;dj.util.User.isLoggedIn(function(g){if(g){c.displaySubscriberDetails();c.setupLogout()}else{c.setupLogin();c.ofreereg=dojo.query(c.cfg.FREE_REG_CLASS,c.oHeader)[0];g=dojo.query("#register_module",c.ofreereg)[0];dojo.style(g,{display:"none"});dojo.style(c.ofreereg,{display:"block"});c.oSubscriberLogin=
dojo.query(c.cfg.SUBSCRIBER_LOGIN_CLASS,c.oHeader)[0];g=dojo.query(".login_module",c.oSubscriberLogin)[0];dojo.style(g,{display:"none"});dojo.style(c.oSubscriberLogin,{display:"block"});c.oHeaderPromo=dojo.query(c.cfg.HEADER_PROMO_CLASS,c.oHeader)[0];dojo.style(c.oHeaderPromo,{display:"block"})}});this.highlightFormFactorLinks();this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL;var d=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_ASIA,e=
this.cfg.LOGGED_IN_TODAYS_PAPER_URL_EUROPE;if(this.currRegion=="asia"||this.currRegion=="asia,india")b=d;else if(this.currRegion=="europe")b=e;this.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain+b:b;dj.util.User.isSubLoggedIn(function(g){if(g){var h=-1;dojo.forEach(c.cfg.GO_PRO_HOOK_REGION,function(k,i){if(k===c.currRegion)h=i});if(c.cfg.GO_PRO_HOOK_REGION==="all"||h!==-1)dojo.removeClass(c.cfg.GO_PRO_HOOK,"hidden")}})},toggleDropdownClass:function(){var b=
this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;if(dojo.hasClass(this.oLocDropDownContainer,b)){dojo.removeClass(this.oLocDropDownContainer,b);dojo.addClass(this.oLocDropDownContainer,c)}else dojo.hasClass(this.oLocDropDownContainer,c)&&dojo.addClass(this.oLocDropDownContainer,b)},editionDropdownSetUp:function(){var b=this;this.oLocationNav=dojo.query(this.cfg.LOCATION_NAV_CLASS,this.oHeader)[0];var c=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,d=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME,
e=this.cfg.US_EDITION_LINK_CLASS;e=this.cfg.US_EDITION_LINK_CLASS;var g=this.cfg.EU_EDITION_LINK_CLASS,h=this.cfg.IN_EDITION_LINK_CLASS,k=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var i=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=
dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oJpnEdition=dojo.byId("jpnEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.osectionFooterSub=dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();var f="";this.tempConcatURL=
typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;this.isMDCPageFlag=document.location.href&&document.location.href!==""&&document.location.href.indexOf(i)!==-1;this.oUsEdition&&dojo.connect(this.oUsEdition,"onclick",this,function(l){dojo.stopEvent(l);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href});
this.oUsEditionFooter&&dojo.connect(this.oUsEditionFooter,"onclick",this,function(l){dojo.stopEvent(l);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href});this.oEuEdition&&dojo.connect(this.oEuEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.isMDCPageFlag?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;
if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365)}});this.oInEdition&&dojo.connect(this.oInEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.isMDCPageFlag?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365)}});this.oAsiaEdition&&dojo.connect(this.oAsiaEdition,
"onclick",this,function(l){dojo.stopEvent(l);window.location=this.isMDCPageFlag?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365)}});this.oChiEdition&&dojo.connect(this.oChiEdition,"onclick",this,function(l){dojo.stopEvent(l);window.open(this.oChiEdition.href)});this.oJpnEdition&&dojo.connect(this.oJpnEdition,"onclick",this,function(l){dojo.stopEvent(l);
window.open(this.oJpnEdition.href)});this.oSpaEdition&&dojo.connect(this.oSpaEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.oSpaEdition.href});this.oPorEdition&&dojo.connect(this.oPorEdition,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.oPorEdition.href});this.osectionFooterSub&&dojo.connect(this.osectionFooterSub,"onclick",this,function(l){dojo.stopEvent(l);window.location=this.osectionFooterSub.href});this.osectionFooterNonSub&&dojo.connect(this.osectionFooterNonSub,
"onclick",this,function(l){dojo.stopEvent(l);window.location=this.osectionFooterNonSub.href});if(this.currRegion=="asia"){f="Asia Edition";this.oSelectedEdition=dojo.query(k,this.oHeader)[0]}else if(this.currRegion=="asia,india"){f="Asia Edition";this.oSelectedEdition=dojo.query(h,this.oHeader)[0]}else if(this.currRegion=="europe"){f="Europe Edition";this.oSelectedEdition=dojo.query(g,this.oHeader)[0]}else{f="U.S. Edition";this.oSelectedEdition=dojo.query(e,this.oHeader)[0]}dojo.addClass(this.oSelectedEdition,
"selected");this.oCurrentEdition.innerHTML=f;this.oFormFactorContainer=dojo.byId("formFactorContainer");dojo.style(this.oFormFactorContainer,{display:""});this.oLocDropDownContainer=dojo.byId("locNavContainer");dojo.style(this.oLocDropDownContainer,{display:""});if(this.oLocDropDownContainer){dojo.connect(this.oLocationNav,"onclick",this,function(l){dojo.stopEvent(l);if(dojo.hasClass(b.oLocDropDownContainer,c)){dojo.removeClass(b.oLocDropDownContainer,c);dojo.addClass(b.oLocDropDownContainer,d)}else if(dojo.hasClass(b.oLocDropDownContainer,
d)){dojo.removeClass(b.oLocDropDownContainer,d);dojo.addClass(b.oLocDropDownContainer,c)}});dojo.connect(document,"onclick",this,function(l){if(dj.util.Element.contains(this.oLocDropDownContainer,l.clientX,l.clientY)==false)if(dojo.hasClass(this.oLocDropDownContainer,d)){dojo.removeClass(this.oLocDropDownContainer,d);dojo.addClass(this.oLocDropDownContainer,c)}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(l){if(l){dojo.style(b.oSectionFooterNonSub,
{display:"none"});dojo.style(b.oSectionFooterSub,{display:""})}else{dojo.style(b.oSectionFooterNonSub,{display:""});dojo.style(b.oSectionFooterSub,{display:"none"})}})}},displayTimeStamp:function(){this.oTimestamp=dojo.query(this.cfg.TIMESTAMP_CLASS,this.oHeader)[0];if(typeof pDate!=="undefined"&&this.oTimestamp)this.oTimestamp.innerHTML=window.pStl=="renovation"?dj.util.Date.displayTime(pDate,pDateinGMT):pDate},displaySubSection:function(){this.oCurrentSubSection=dojo.query(this.cfg.CURRENT_SUBSECTION_DISPLAY_CLASS,
this.oHeader)[0];if(typeof globalHeaderPageTitle!=="undefined"&&globalHeaderPageTitle&&globalHeaderPageTitle!==""){this.oCurrentSubSection.innerHTML=globalHeaderPageTitle;this._delayedFadeInSubSection()}},_delayedFadeInSubSection:function(){setTimeout(dojo.hitch(this,function(){dojo.style(this.oCurrentSubSection,{display:"inline",opacity:0});dojo.fadeIn({node:this.oCurrentSubSection,duration:this.cfg.WSJ_LOGO_FADE_APPEAR_DURATION*1E3}).play()}),this.cfg.WSJ_LOGO_DELAY_DURATION)},displaySubscriberDetails:function(){dj.util.User.renderCallsign(this.cfg.USER_NAME_ELEMENT_ID);
this.setupSubscriberLinks();this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];var b=this;dj.util.User.isSubLoggedIn(function(c){if(c)b.setupMessageCenter();else{b.setUpMJLinksForReg();dojo.style(b.oMessageCenterLink,{display:"none"})}});this.oSubscriberDetails=dojo.byId(this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID);dojo.removeClass(this.oSubscriberDetails,"hidden")},setUpMJLinksForReg:function(){this.oFooter=dojo.query(this.cfg.FOOTER_CONTAINER_CLASS)[0];var b=this.cfg.MOJ_LINK_URL,
c=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(c,this.oHeader)[0];this.oMojLinkFooter=dojo.query(c,this.oFooter)[0];if(typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""){this.oMojLinkHeader.href="http://"+gcDomain+b;this.oMojLinkFooter.href="http://"+gcDomain+b}else{this.oMojLinkHeader.href=b;this.oMojLinkFooter.href=b}},setupSubscriberLinks:function(){this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,this.oHeader)[0];var b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL,c=this;
dj.util.User.isSubLoggedIn(function(d){if(d)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain+b:b})},setupMessageCenter:function(){this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];this.oMessageCount=dojo.query(this.cfg.MESSAGE_COUNT_CLASS,this.oHeader)[0];var b=this,c=function(e){if(e=="-1")dojo.style(b.oMessageCenterLink,{display:"none"});else b.oMessageCount.innerHTML=e},d=dj.util.Cookie.getCookie("msgCount");
d===null?dojo.xhrPost({url:this.cfg.MESSAGE_CENTER_POST_URL,handleAs:"json",handle:function(e){d=e.MessagesCount;e=e.Status;dj.util.Cookie.setCookie("msgCount",d,5/24/60);dj.util.Cookie.setCookie("userStatus",e,5/24/60);c(d)},error:function(e,g){console.error("Exception occured while posting posting Ajax Request: %s",g)}}):c(d)},setupLogin:function(){this.oUserName=dojo.byId(this.cfg.LOGIN_USERNAME_ELEMENT_ID);this.oPassword=dojo.byId(this.cfg.LOGIN_PASSWORD_ELEMENT_ID);this.oLoginImg=dojo.byId(this.cfg.LOGIN_BUTTON_ELEMENT_ID);
this.oLoginForm=dojo.byId(this.cfg.LOGIN_FORM_ID);this.oLoginForm!=null&&this.oLoginForm.reset();this.oPageUrl=dojo.byId(this.cfg.PAGE_URL_ELEMENT_ID);var b=this;if(this.oPageUrl){var c=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID,d=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,e=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,g=this.cfg.MDC_PAGE_PID,h;h=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var k;var i=k=dojo.isIE?window.location.href:document.location.href;
if(typeof pID!=="undefined"){i=pID===c?h+this.cfg.HOMEPAGE_SUBSCRIBER_URL:pID===e?h+"/email":pID===d?h+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===g?h+this.cfg.MDC_LINK_URL:k;if(dojo.isIE)document.login_form.url.value=i;else this.oPageUrl.value=i}if(this.oUserName){dojo.connect(this.oUserName,"onfocus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"onclick",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}if(this.oPassword){dojo.connect(this.oPassword,
"onfocus",this,function(){dj.util.Form.clearValue(b.oPassword,"Password");this.oPassword.type="password"});dojo.connect(this.oPassword,"onclick",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")});dojo.connect(this.oPassword,"onchange",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")})}dojo.isIE&&dojo.connect(this.oLoginImg,"onclick",this,function(){document.login_form.url.value=k;console.log("coming in to img onlick in IE"+k);this.oLoginForm.submit()});dojo.connect(this.oPassword,
"onkeypress",this,function(f){f=f.keyCode||f.which;if(dojo.isIE)if(f==dojo.keys.ENTER){document.login_form.url.value=k;this.oLoginForm.submit()}})}},setupLogout:function(){(this.oLogout=dojo.byId(this.cfg.LOGOUT_LINK_ELEMENT_ID))&&dojo.connect(this.oLogout,"onclick",this,function(b){dojo.stopEvent(b);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE=;path=/;domain=.wsj.com;expires=Thu, 01-Jan-1970 00:00:01 GMT";if(typeof dj.module.facebook.connect.logout==
"function"&&FB.getAuthResponse())dj.module.facebook.connect.logout(function(){window.location=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"});else{console.info("Facebook API is not available when executing Logout");window.location=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"}})},highlightFormFactorLinks:function(){this.oTodaysPaperLinkContainer=dojo.query(this.cfg.TODAYS_PAPER_LINK_CONTAINER_CLASS,
this.oHeader)[0];this.oVideoLinkContainer=dojo.query(this.cfg.VIDEO_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oBlogsLinkContainer=dojo.query(this.cfg.BLOGS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oColumnsLinkContainer=dojo.query(this.cfg.COLUMNS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oInteractiveGraphicsLinkContainer=dojo.query(this.cfg.INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oTopicsLinkContainer=dojo.query(this.cfg.TOPICS_LINK_CONTAINER_CLASS,this.oHeader)[0];this.oCommunityForumsLinkContainer=
dojo.query(this.cfg.COMMUNITY_FORUMS_LINK_CONTAINER_CLASS,this.oHeader)[0];var b=this.cfg.TODAYS_PAPER_PID,c=this.cfg.TODAYS_PAPER_US_NONSUB_PID,d=this.cfg.TODAYS_PAPER_EUROPE_NONSUB_PID,e=this.cfg.TODAYS_PAPER_ASIA_NONSUB_PID,g=this.cfg.TODAYS_PAPER_US_PID,h=this.cfg.TODAYS_PAPER_EUROPE_PID,k=this.cfg.TODAYS_PAPER_ASIA_PID,i=this.cfg.TODAYS_PAPER_PAST_EDITIONS_PID,f=this.cfg.TODAYS_PAPER_INDEX_BIZ_PID,l=this.cfg.TODAYS_PAPER_INDEX_PEOPLE_PID,o=this.cfg.TODAYS_PAPER_CORRECTIONS_PID,n=this.cfg.VIDEO_PID,
m=this.cfg.INTERACTIVE_GRAPHICS_PID,p=this.cfg.TOPICS_PID,q=this.cfg.COLUMNS_PID,r=this.cfg.BLOGS_PID,s=document.location.host+this.cfg.COMMUNITY_HIGHLIGHT_COMPARE_URL,t=this.cfg.FORUMS_HIGHLIGHT_COMPARE_URL;if(typeof pID!=="undefined")if(pID.indexOf(b)==0||pID===c||pID===d||pID===e||pID===g||pID===h||pID===k||pID===i||pID===f||pID===l||pID===o)dojo.addClass(this.oTodaysPaperLinkContainer,"selected");else if(pID===n)dojo.addClass(this.oVideoLinkContainer,"selected");else if(pID===m)dojo.addClass(this.oInteractiveGraphicsLinkContainer,
"selected");else if(pID===q)dojo.addClass(this.oColumnsLinkContainer,"selected");else if(pID===r)dojo.addClass(this.oBlogsLinkContainer,"selected");else pID===p&&dojo.addClass(this.oTopicsLinkContainer,"selected");if(document.location.href&&document.location.href!==""&&document.location.href.indexOf(s)!==-1||document.location.href.indexOf(t)!==-1)dojo.addClass(this.oCommunityForumsLinkContainer,"selected")}}}();
dojo.provide("dj.module.header.globalHeader");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");
dj.module.header.globalHeader=function(){var a={HEADER_CONTAINER_CLASS:".header",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",
US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter"};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(".header")[0];
this.editionDropdownSetUp();this.currRegion=dj.util.Region.getViewByRegion();this.oLocToggle=dojo.byId("loc_toggle")},toggleDropdownClass:function(){var b=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;this.oLocToggle=dojo.byId("loc_toggle");if(dojo.hasClass(this.oLocToggle,b)){dojo.removeClass(this.oLocToggle,b);dojo.addClass(this.oLocToggle,c)}else if(dojo.hasClass(this.oLocToggle,c)){dojo.removeClass(this.oLocToggle,c);dojo.addClass(this.oLocToggle,b)}},editionDropdownSetUp:function(){this.oLocationNav=
dojo.byId("locNavContainer");var b=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME,c=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME,d=this.cfg.US_EDITION_LINK_CLASS,e=this.cfg.EU_EDITION_LINK_CLASS,g=this.cfg.IN_EDITION_LINK_CLASS,h=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var k=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=
dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oGerEdition=dojo.byId("gerEdition");this.oJpnEdition=dojo.byId("jpnEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.oIndonesiaEdition=dojo.byId("indonesiaEdition");this.oKoreaEdition=dojo.byId("koreaEdition");this.osectionFooterSub=
dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();this.tempConcatURL=typeof gcDomain!=="undefined"&&gcDomain&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;this.isMDCPageFlag=document.location.href&&document.location.href!==""&&document.location.href.indexOf(k)!==-1;this.oUsEdition&&dojo.connect(this.oUsEdition,"onclick",this,function(f){dojo.stopEvent(f);dj.util.Region.setViewByRegion("na,us");
dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href});this.oUsEditionFooter&&dojo.connect(this.oUsEditionFooter,"onclick",this,function(f){dojo.stopEvent(f);dj.util.Region.setViewByRegion("na,us");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=this.isMDCPageFlag?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href});this.oEuEdition&&dojo.connect(this.oEuEdition,
"onclick",this,function(f){dojo.stopEvent(f);window.location=this.isMDCPageFlag?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365)}});this.oInEdition&&dojo.connect(this.oInEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.isMDCPageFlag?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");
dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365)}});this.oAsiaEdition&&dojo.connect(this.oAsiaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.isMDCPageFlag?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365)}});this.oChiEdition&&dojo.connect(this.oChiEdition,"onclick",this,function(f){dojo.stopEvent(f);window.open(this.oChiEdition.href)});
this.oGerEdition&&dojo.connect(this.oGerEdition,"onclick",this,function(f){dojo.stopEvent(f);window.open(this.oGerEdition.href)});this.oJpnEdition&&dojo.connect(this.oJpnEdition,"onclick",this,function(f){dojo.stopEvent(f);window.open(this.oJpnEdition.href)});this.oSpaEdition&&dojo.connect(this.oSpaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.oSpaEdition.href});this.oPorEdition&&dojo.connect(this.oPorEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=
this.oPorEdition.href});this.oIndonesiaEdition&&dojo.connect(this.oIndonesiaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.oIndonesiaEdition.href});this.oKoreaEdition&&dojo.connect(this.oKoreaEdition,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.oKoreaEdition.href});this.osectionFooterSub&&dojo.connect(this.osectionFooterSub,"onclick",this,function(f){dojo.stopEvent(f);window.location=this.osectionFooterSub.href});this.osectionFooterNonSub&&dojo.connect(this.osectionFooterNonSub,
"onclick",this,function(f){dojo.stopEvent(f);window.location=this.osectionFooterNonSub.href});this.oSelectedEdition=this.currRegion=="asia"?dojo.query(h,this.oHeader)[0]:this.currRegion=="asia,india"?dojo.query(g,this.oHeader)[0]:this.currRegion=="europe"?dojo.query(e,this.oHeader)[0]:dojo.query(d,this.oHeader)[0];dojo.addClass(this.oSelectedEdition,"selected");this.oFormFactorContainer=dojo.byId("formFactorContainer");this.oLocDropDownContainer=dojo.byId("locNavContainer");this.oLocPopupContainer=
dojo.byId("popupContainer");if(this.oLocDropDownContainer){var i=function(){this.oLocToggle=dojo.byId("loc_toggle");if(dojo.hasClass(this.oLocToggle,b)){dojo.removeClass(this.oLocToggle,b);dojo.addClass(this.oLocToggle,c)}else if(dojo.hasClass(this.oLocToggle,c)){dojo.removeClass(this.oLocToggle,c);dojo.addClass(this.oLocToggle,b)}};dojo.connect(this.oLocationNav,"onclick",this,function(f){dojo.stopEvent(f);i()});dojo.connect(document,"onclick",this,function(f){if(dj.util.Element.contains(this.oLocPopupContainer,
f.clientX,f.clientY)==false)if(dojo.hasClass(this.oLocToggle,c)){dojo.removeClass(this.oLocToggle,c);dojo.addClass(this.oLocToggle,b)}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(){})}}}}();
dojo.provide("dj.module.header.globalHeaderSS");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");
dj.module.header.globalHeaderSS={DEFAULT_CONFIG:{HEADER_CONTAINER_CLASS:".header",cUserInfoDD:".userInfoPopUpContainer",cUserInfoLink:".userInfoOnClickLink",cSectionInfoDD:".sectionsDDPopUpContainer",cSectionInfoLink:".menuOnClickLink",cLoginInfoLink:".loginClassSS"},initialize:function(a){this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,a);this.currRegion=dj.util.Region.getViewByRegion();this.genericEventsSetUp();var b=this;dj.util.User.isLoggedIn(function(c){c?b.subscriberEventsSetUp():b.nonsubscriberEventsSetUp()})},
subscriberEventsSetUp:function(){var a=this;dj.util.User.isSubLoggedIn(function(b){b?dojo.removeClass("goprohook","hidden"):dojo.removeClass("upgradeprohook","hidden")});this.oUserInfoDD=dj.lang.query(a.cfg.cUserInfoDD)[0];dj.lang.addLiveEvent(a.cfg.cUserInfoLink,"click",function(b){dojo.stopEvent(b);if(a.oUserInfoDD)dojo.hasClass(a.oUserInfoDD,"popOpen")?dojo.removeClass(a.oUserInfoDD,"popOpen"):dojo.addClass(a.oUserInfoDD,"popOpen")},this);dojo.connect(document,"onclick",this,function(b){dj.util.Element.contains(this.oUserInfoDD,
b.clientX,b.clientY)===false&&this.oUserInfoDD&&dojo.hasClass(this.oUserInfoDD,"popOpen")&&dojo.removeClass(this.oUserInfoDD,"popOpen")})},nonsubscriberEventsSetUp:function(){dojo.removeClass("promoLoginDetailsId","hidden");dj.lang.addLiveEvent(this.cfg.cLoginInfoLink,"click",function(a){dojo.stopEvent(a);window.location=(a.target||a.srcElement).href+document.location},this)},genericEventsSetUp:function(){var a=this;this.oSectionInfoDD=dj.lang.query(a.cfg.cSectionInfoDD)[0];dj.lang.addLiveEvent(a.cfg.cSectionInfoLink,
"click",function(b){dojo.stopEvent(b);if(a.oSectionInfoDD)dojo.hasClass(a.oSectionInfoDD,"popOpen")?dojo.removeClass(a.oSectionInfoDD,"popOpen"):dojo.addClass(a.oSectionInfoDD,"popOpen")},this);dj.lang.addLiveEvent(a.cfg.cSectionInfoLink,"mouseover",function(b){dojo.stopEvent(b);if(a.oSectionInfoDD)dojo.hasClass(a.oSectionInfoDD,"popOpen")||setTimeout('dojo.addClass(dj.lang.query(".sectionsDDPopUpContainer")[0], "popOpen")',500)},this);dojo.connect(document,"onclick",this,function(b){dj.util.Element.contains(this.oSectionInfoDD,
b.clientX,b.clientY)===false&&this.oSectionInfoDD&&dojo.hasClass(this.oSectionInfoDD,"popOpen")&&dojo.removeClass(this.oSectionInfoDD,"popOpen")})}};
dojo.provide("dj.module.header.login");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");dojo.require("dj.module.facebook.connect");
dj.module.header.login=function(){var a={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",
MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",
LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/itp/asia?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/itp/europe?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",
SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",
TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",
MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",
US_EDITION_MDC_URL:"/mdc/public/page/marketsdata.html",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter",GO_PRO_HOOK:"goprohook",GO_PRO_HOOK_REGION:["all"]};return{initialize:function(b){this.cfg=dj.lang.cloneMixin(a,b);this.oHeader=dojo.query(this.cfg.HEADER_CONTAINER_CLASS)[0];this.currRegion=dj.util.Region.getViewByRegion();
this.concatURL="";this.subscriberLoginInit();this.displayGoPro();this.concatURL=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain:"http://"+document.domain},subscriberLoginInit:function(){var b=this;dj.util.User.isLoggedIn(function(c){if(c){b.displaySubscriberDetails();b.setupLogout()}else{b.setupLogin();b.oSubscriberLogin=dojo.query(b.cfg.SUBSCRIBER_LOGIN_CLASS,b.oHeader)[0];c=dojo.query(".login_module",b.oSubscriberLogin)[0];dojo.style(c,{display:"block"});dojo.style(b.oSubscriberLogin,
{display:"block"});b.oHeaderPromo=dojo.query(b.cfg.HEADER_PROMO_CLASS,b.oHeader)[0];dojo.style(b.oHeaderPromo,{display:"block"})}})},displayGoPro:function(){var b=this;dj.util.User.isSubLoggedIn(function(c){if(c){var d=-1;dojo.forEach(b.cfg.GO_PRO_HOOK_REGION,function(e,g){if(e===b.currRegion)d=g});if(b.cfg.GO_PRO_HOOK_REGION[0]==="all"||d!==-1)dojo.byId(b.cfg.GO_PRO_HOOK)&&dojo.removeClass(b.cfg.GO_PRO_HOOK,"hidden")}})},displaySubscriberDetails:function(){dj.util.User.renderCallsign(this.cfg.USER_NAME_ELEMENT_ID);
this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];var b=this;dj.util.User.isSubLoggedIn(function(c){if(c)b.setupMessageCenter();else{b.setUpMJLinksForReg();b.oMessageCenterLink&&dojo.style(b.oMessageCenterLink,{display:"none"})}});this.oSubscriberDetails=dojo.byId(this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID);dojo.removeClass(this.oSubscriberDetails,"hidden")},setUpMJLinksForReg:function(){this.oFooter=dojo.query(this.cfg.FOOTER_CONTAINER_CLASS)[0];var b=this.cfg.MOJ_LINK_URL,
c=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(c,this.oHeader)[0];this.oMojLinkFooter=dojo.query(c,this.oFooter)[0];if(typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""){if(this.oMojLinkHeader)this.oMojLinkHeader.href="http://"+gcDomain+b;if(this.oMojLinkFooter)this.oMojLinkFooter.href="http://"+gcDomain+b}else{if(this.oMojLinkHeader)this.oMojLinkHeader.href=b;if(this.oMojLinkFooter)this.oMojLinkFooter.href=b}},setupSubscriberLinks:function(){this.oTodaysPaperLink=dojo.query(this.cfg.TODAYS_PAPER_LINK_CLASS,
this.oHeader)[0];var b=this.cfg.LOGGED_IN_TODAYS_PAPER_URL,c=this;dj.util.User.isSubLoggedIn(function(d){if(d)c.oTodaysPaperLink.href=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"http://"+gcDomain+b:b})},setupMessageCenter:function(){this.oMessageCenterLink=dojo.query(this.cfg.MESSAGE_CENTER_LINK_CLASS,this.oHeader)[0];this.oMessageCount=dojo.query(this.cfg.MESSAGE_COUNT_CLASS,this.oHeader)[0];var b=this,c=function(e){if(e=="-1")dojo.style(b.oMessageCenterLink,{display:"none"});
else b.oMessageCount.innerHTML=e},d=dj.util.Cookie.getCookie("msgCount");d===null?dojo.xhrPost({url:this.cfg.MESSAGE_CENTER_POST_URL,handleAs:"json",handle:function(e){d=e.MessagesCount;e=e.Status;dj.util.Cookie.setCookie("msgCount",d,5/24/60);dj.util.Cookie.setCookie("userStatus",e,5/24/60);c(d)},error:function(e,g){console.error("Exception occured while posting posting Ajax Request: %s",g)}}):c(d)},setupLogin:function(){this.oUserName=dojo.byId(this.cfg.LOGIN_USERNAME_ELEMENT_ID);this.oPassword=
dojo.byId(this.cfg.LOGIN_PASSWORD_ELEMENT_ID);this.oLoginImg=dojo.byId(this.cfg.LOGIN_BUTTON_ELEMENT_ID);this.oLoginForm=dojo.byId(this.cfg.LOGIN_FORM_ID);this.oLoginForm!=null&&this.oLoginForm.reset();this.oPageUrl=dojo.byId(this.cfg.PAGE_URL_ELEMENT_ID);var b=this;if(this.oPageUrl!==null){var c=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID,d=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID,e=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID,g=this.cfg.MDC_PAGE_PID,h;h=typeof gcDomain!=="undefined"&&gcDomain!==null&&
gcDomain!==""?"http://"+gcDomain:"http://"+document.domain;var k;var i=k=dojo.isIE?window.location.href:document.location.href;if(typeof pID!=="undefined"){i=pID===c?h+this.cfg.HOMEPAGE_SUBSCRIBER_URL:pID===e?h+"/email":pID===d?h+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL:pID===g?h+this.cfg.MDC_LINK_URL:k;c=i.indexOf("?")!=-1?"&":"?";if(typeof c!==undefined){c=c+"_nocache="+(new Date).getTime();if(i.indexOf("#")!=-1)i=i.replace("#",c+"#");else i+=c}if(dojo.isIE)document.login_form.url.value=i;else this.oPageUrl.value=
i}if(this.oUserName!==null){dojo.connect(this.oUserName,"onfocus",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")});dojo.connect(this.oUserName,"onclick",this,function(){dj.util.Form.clearValue(this.oUserName,"User Name")})}if(this.oPassword!==null){dojo.connect(this.oPassword,"onfocus",this,function(){dj.util.Form.clearValue(b.oPassword,"Password");this.oPassword.type="password"});dojo.connect(this.oPassword,"onclick",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")});
dojo.connect(this.oPassword,"onchange",this,function(){dj.util.Form.clearValue(b.oPassword,"Password")})}dojo.isIE&&dojo.connect(this.oLoginImg,"onclick",this,function(){document.login_form.url.value=k;console.log("coming in to img onlick in IE"+k);this.oLoginForm.submit()});dojo.connect(this.oPassword,"onkeypress",this,function(f){f=f.keyCode||f.which;if(dojo.isIE)if(f==dojo.keys.ENTER){document.login_form.url.value=k;this.oLoginForm.submit()}})}},setupLogout:function(){this.oLogout=dojo.byId(this.cfg.LOGOUT_LINK_ELEMENT_ID);
this.oLogout!==null&&dojo.connect(this.oLogout,"onclick",this,function(b){dojo.stopEvent(b);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE=;path=/;domain=.wsj.com;expires=Thu, 01-Jan-1970 00:00:01 GMT";if(typeof dj.module.facebook.connect.logout=="function"&&FB.getAuthResponse())dj.module.facebook.connect.logout(function(){window.location=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"});
else{console.info("Facebook API is not available when executing Logout");window.location=typeof gcDomain!=="undefined"&&gcDomain!==null&&gcDomain!==""?"/logout?url=http://"+gcDomain:"/logout"}})}}}();
dojo.provide("dj.module.header.exec._common");dojo.require("dj.module.header.sectionMenu");dj.module.header.exec._common={init:function(a){var b=a||{};this._exec(this.preInit);this._exec([function(){dj.module.header.sectionMenu.init()}]);this._exec(this.postInit,b)},preInit:[],postInit:[],_exec:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];try{d.call(null,b)}catch(e){console.error("HeaderExec-"+c+": ",e)}}}};
dojo.provide("dj.module.header.exec.NA_WSJ_SUB");dojo.require("dj.module.header.exec._common");dojo.require("dj.module.header.autocomplete");dojo.require("dj.module.header.globalHeader");dojo.require("dj.module.header.localWeather");dojo.require("dj.module.header.login");dojo.require("dj.module.facebook.connect");dojo.require("dj.widget.panel.SelectDropdownPanel");
dj.module.header.exec.NA_WSJ_SUB=dojo.delegate(dj.module.header.exec._common,{postInit:[function(){dj.module.header.autocomplete.searchExec()},function(){dj.module.header.globalHeader.initialize()},function(){dj.module.header.localWeather.init({defaultLocation:"10005",redirectUrl:"http://commerce.wsj.com/auth/login?roles=FREEREG-BASE&mg=cmy-wsj"})},function(){dj.module.header.login.initialize()},function(){dj.module.facebook.connect.init()},function(){var a=dojo.byId("MoreIndustries_Container");if(a)dj.module.moreIndustries=
new dj.widget.panel.SelectDropdownPanel(a)},function(){dj.module.browserPhaseout().init()},function(){}]});
dojo.provide("dj.module.header.exec.NA_WSJ_SUB_SS");dojo.require("dj.module.header.exec._common");dojo.require("dj.module.header.autocomplete");dojo.require("dj.module.header.globalHeaderSS");dojo.require("dj.module.header.localWeather");dojo.require("dj.module.header.login");dojo.require("dj.module.facebook.connect");dojo.require("dj.widget.panel.SelectDropdownPanel");
dj.module.header.exec.NA_WSJ_SUB_SS=dojo.delegate(dj.module.header.exec._common,{postInit:[function(){dj.module.header.autocomplete.searchExec()},function(){dj.module.header.globalHeaderSS.initialize()},function(){dj.module.header.login.initialize()},function(){dj.module.facebook.connect.init()}]});
dojo.provide("dj.module.header.exec.NA_WSJ_PUB");dojo.require("dj.module.header.exec._common");dojo.require("dj.module.header.autocomplete");dojo.require("dj.module.header.globalHeader");dojo.require("dj.module.header.localWeather");dojo.require("dj.widget.panel.ModalPanel");dojo.require("dj.module.header.login");dojo.require("dj.module.facebook.connect");dojo.require("dj.widget.panel.SelectDropdownPanel");
dj.module.header.exec.NA_WSJ_PUB=dojo.delegate(dj.module.header.exec._common,{postInit:[function(){dj.module.header.autocomplete.searchExec()},function(){dj.module.header.globalHeader.initialize()},function(){dj.module.header.localWeather.init({defaultLocation:"10005",expireInterval:"2400",redirectUrl:"http://commerce.wsj.com/auth/login?roles=FREEREG-BASE&mg=cmy-wsj"})},function(){dj.module.facebook.connect.init()},function(){var a=dojo.byId("MoreIndustries_Container");if(a)dj.module.moreIndustries=
new dj.widget.panel.SelectDropdownPanel(a)},function(){if(typeof openHouseMode!=="undefined"&&openHouseMode)dojo.byId("hat_top_style").className=""},function(){dj.module.browserPhaseout().init()},function(){},function(a){if(typeof a!="undefined"){dojo.require("dj.widget.loader.LoginLoader");window.console&&console.log("here... version is "+a.version);dj.widget.loader.LoginLoader({isLoadJs:a.isLoadJs,version:a.version}).init()}else window.console&&console.log("..cfg....is undefined ")}]});
dojo.provide("dj.module.header.exec.NA_WSJ_PUB_SS");dojo.require("dj.module.header.exec._common");dojo.require("dj.module.header.autocomplete");dojo.require("dj.module.header.globalHeaderSS");dojo.require("dj.module.header.localWeather");dojo.require("dj.widget.panel.ModalPanel");dojo.require("dj.module.header.login");dojo.require("dj.module.facebook.connect");dojo.require("dj.widget.panel.SelectDropdownPanel");
dj.module.header.exec.NA_WSJ_PUB_SS=dojo.delegate(dj.module.header.exec._common,{postInit:[function(){dj.module.header.autocomplete.searchExec()},function(){dj.module.header.globalHeaderSS.initialize()},function(){dj.module.inlineLogin=new dj.widget.panel.ModalPanel("login","login_module",{openModalPanelEvent:"click",closeModalPanelEvent:"blur",closeModalPanelButtonSelector:".closeLogin",closeModalPanelEventForButtonSelector:"click"})},function(){dj.module.header.login.initialize()},function(){dj.module.facebook.connect.init()},
function(){if(typeof openHouseMode!=="undefined"&&openHouseMode)dojo.byId("hat_top_style").className=""},function(a){if(typeof a!="undefined"){dojo.require("dj.widget.loader.LoginLoader");window.console&&console.log("here... version is "+a.version);dj.widget.loader.LoginLoader({isLoadJs:a.isLoadJs,version:a.version}).init()}else window.console&&console.log("..cfg....is undefined ")}]});
dojo.provide("dj.module.header.exec.NA_WSJ_REG");dojo.require("dj.module.header.exec.NA_WSJ_SUB");dj.module.header.exec.NA_WSJ_REG=dojo.delegate(dj.module.header.exec.NA_WSJ_SUB,{});

dojo.provide("dj.module.honk.SingleSignOnService");dj.module.honk.SingleSignOnService={DEFAULT_CONFIG:{ssoSvcCall:"/cdssvco/honk/v1/GetMessage",cbfunc:null,cbcontext:null},login:function(svcConfig){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,svcConfig);this.svcresponseurl=null;this.identifier=null;this.callAjaxRequest();},callAjaxRequest:function(){var cb=(Math.floor(10000000*Math.random()));var _url=this.cfg.ssoSvcCall;var _me=this;var _ajaxrequest={url:_url+"?cb="+cb,headers:{Accept:"application/json"},handleAs:"json",load:function(response,ioArgs){var _jsonResponse=response;if(_jsonResponse.Identifier){_me.identifier=_jsonResponse.Identifier;console.log("Identifier in honk.js:::"+_me.identifier);}
if(_jsonResponse.URL){_me.svcresponseurl=_me.cfg.cbcontext.cfg.ssoSvcResponse+_jsonResponse.URL;}else{_me.svcresponseurl=_me.cfg.cbcontext.cfg.honkWebUrl;}
if(_me.cfg.cbfunc){if(_me.cfg.cbcontext){_me.cfg.cbfunc.apply(_me.cfg.cbcontext);}}
_me.svcresponseurl=null;_me.identifier=null;},error:function(response,ioArgs){}};dojo.xhrGet(_ajaxrequest);}};dojo.provide("dj.module.honk.Honk");dojo.require("dj.util.queryParam");dojo.require("dj.module.honk.SingleSignOnService");dojo.require("dojox.encoding.crypto.SimpleAES");dojo.require("dj.util.User");dojo.declare("dj.module.honk.Honk",[],{DEFAULT_CONFIG:{honkUrlDiv:"honkurl",iFrameId:"iframerightContent",defaultUrl:"http://uat.honk.com/wsj",honkWebUrl:"http://uat.honk.com",ajaxCallUrl:"/community/integration/RegisterTrueCarUser",ssoSvcResponse:"http://uat.honk.com/wsj",_ssosvc:dj.module.honk.SingleSignOnService,userLoggedIn:false,setIframe:true,thirdPartyIframeDiv:"truecarDiv",histogramIframe:{show:false,id:""}},constructor:function(honkConfig){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,honkConfig);},init:function(){this.getURL();if(!this.cfg.userLoggedIn){console.log("Iframe src for public user:"+this._url);this.setContentCnt();}},getURL:function(){var honkUrl=this.cfg.defaultUrl;var uUrl=dj.util.queryParam.getQueryStrParam('u');if(uUrl==null||uUrl==""){var url="";var divTag=dojo.byId(this.cfg.honkUrlDiv);if(divTag!=null){url=dojo.byId(this.cfg.honkUrlDiv).innerHTML;honkUrl=this.cfg.honkWebUrl+url;console.log("honk url ------"+honkUrl);}}else{honkUrl=uUrl;}
console.log("testing url"+honkUrl);this._url=honkUrl;if((uUrl==null||uUrl=="")&&(url==null||url=="")&&(this.cfg.userLoggedIn)){this.cfg._ssosvc.login({cbfunc:this.setSSOUrl,cbcontext:this});}},setSSOUrl:function(){console.log("Identifier:::"+this.cfg._ssosvc.identifier);this._identifier=this.cfg._ssosvc.identifier;console.log(this.cfg._ssosvc.svcresponseurl);this._url=this.cfg._ssosvc.svcresponseurl;this.callAjaxRequest();console.log("Iframe src for loggedin user:"+this._url);this.setContentCnt();},setContentCnt:function(){if(this.cfg.setIframe){var index=this._url.indexOf("hideIFrame");if(index>-1){dojo.byId(this.cfg.iFrameId).className="hidden";}else{if(this.cfg.histogramIframe.show){if(dojo.byId(this.cfg.histogramIframe.id)){dojo.byId(this.cfg.histogramIframe.id).className="hidden";}}
dojo.byId(this.cfg.iFrameId).src=this._url;}}else{var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){if(!that.cfg.userLoggedIn){console.log("inside userloggedin is false");that._identifier='1234';}}
this._identifier=that._identifier;});try{Tcpp.WhiteLabel.Widgets.Iframe.init({parentElement:dojo.byId(this.cfg.thirdPartyIframeDiv),url:this._url,userId:this._identifier,urlParamName:"u"});}catch(e){console.log("TrueCar resizing call failed.");}}},_getUserId:function(){var _userId=0;dj.util.User.getUserId(function(userId){_userId=userId;});return _userId;},callAjaxRequest:function(){var cb=(Math.floor(10000000*Math.random()));var _url=this.cfg.ajaxCallUrl;var _ajaxrequest={url:_url+"?cb="+cb,load:function(response,ioArgs){},error:function(response,ioArgs){}};dojo.xhrGet(_ajaxrequest);}});
dojo.provide("dj.widget.poll.Poll");dojo.require("dojo.cookie");dojo.require("dojox.encoding.digests.MD5");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.poll.Poll",null,{constructor:function(userConf){this.conf={expires:36500,voteOptionsParameter:"dj_vote",voteCookieName:"djpoll_vote",ajaxVoteOption:"noflash"};dojo.mixin(this.conf,userConf);},submitVote:function(voteUrl,pollName,hashKey,pollOption){var response;switch(this.conf.ajaxVoteOption){case'always':response=this.submitAjaxVote(voteUrl,pollName,hashKey,pollOption);break;case'never':break;case'noflash':if(swfobject.getFlashPlayerVersion().major<9){response=this.submitAjaxVote(voteUrl,pollName,hashKey,pollOption);}}
if(response&&response.error){return response;}
this.processCookie(pollOption);return response;},prepareAjaxUrl:function(voteUrl,pollName,hashKey,pollOption){if(dojo.cookie.isSupported()){var isChangedVote;var voteCookie=this.currentCookie;if(voteCookie===undefined){this.voteHash=this.generateVoteHash();}
else{this.voteHash=voteCookie.voteHash;}
var hashString=pollName+pollOption+this.voteHash+hashKey;var saltHash=dojox.encoding.digests.MD5(hashString,dojox.encoding.digests.outputTypes.Hex);var fullVoteUrl=voteUrl+pollName+"/"+pollOption+"/"+this.voteHash+"/"+saltHash;return fullVoteUrl;}},submitAjaxVote:function(voteUrl,pollName,hashKey,pollOption){var fullVoteUrl=this.prepareAjaxUrl(voteUrl,pollName,hashKey,pollOption);if(!this.currentCookie===undefined){fullVoteUrl=fullVoteUrl.replace("/vote/","/modifyvote/");}
var deferred=dojo.xhrPost({url:fullVoteUrl,handleAs:"json",sync:true,timeout:5000});return deferred.results[0]||{};},generateVoteHash:function(){var newdate=new Date();var randomNumber=Math.random();var voteHash=''+
newdate.getUTCFullYear()+
newdate.getUTCMonth()+
newdate.getUTCDate()+
newdate.getUTCHours()+
newdate.getUTCMinutes()+
newdate.getUTCSeconds()+
newdate.getUTCMilliseconds()+randomNumber;return voteHash;},displayPollResultAndFlashVote:function(communityURL,selectedPollOption,target){var resultURL=communityURL+"?"+this.conf.voteOptionsParameter+"="+selectedPollOption;if(target===undefined||target===''||target===null){location.href=resultURL;}
else{window.open(resultURL,target);}},getMyCookie:function(){return this.getMyCookieObject();},getMyCookieObject:function(){if(this.currentCookie===undefined){this.currentCookie=dojo.fromJson(this.getCookie());}
return this.currentCookie;},getCookie:function(){var voteCookie;var voteCookies=dojo.cookie(this.conf.voteCookieName);var oldCookieName='djpoll_vote_'+this.pollId;var oldCookie=dojo.cookie(oldCookieName);voteCookies=dojo.fromJson(voteCookies);if(voteCookies&&this.pollId in voteCookies){voteCookie=voteCookies[this.pollId];voteCookie=dojo.toJson(voteCookie);}else{voteCookie=(function(){})();}
if(oldCookie){var deletedCookie=(function(){})();voteCookie=dojo.fromJson(oldCookie);voteCookies=voteCookies||{};if(!voteCookies[this.pollId]){voteCookies[this.pollId]=voteCookie;this.writeCookie(voteCookies);}
dojo.cookie(oldCookieName,deletedCookie,{path:'/',expires:0});}
return voteCookie;},writeCookie:function(voteCookieObjects){dojo.cookie("djpoll_vote",dojo.toJson(voteCookieObjects),{path:'/',expires:this.conf.expires});this.currentCookie=voteCookieObjects[this.pollId];},processCookie:function(pollOption){if(this.voteHash===undefined){this.voteHash=this.generateVoteHash();}
voteCookieObjects=dojo.fromJson(dojo.cookie("djpoll_vote"))||{};voteCookieObjects[this.pollId]={pollOption:pollOption,voteHash:this.voteHash,time:new Date().getTime()};this.writeCookie(voteCookieObjects);},deletePollCookie:function(pollId){voteCookieObject=dojo.fromJson(dojo.cookie("djpoll_vote"))||{};delete voteCookieObject[pollId];this.writeCookie(voteCookieObject);return;}});dojo.provide("dj.widget.poll.PollView");dojo.require("dj.widget.poll.Poll");dojo.require("dj.lang");dojo.declare("dj.widget.poll.PollView",null,{constructor:function(userConf){this.conf={category:"",hashKey:"r0ckstar",radioButtonPrefix:".js_pollRadio_",submitButtonPrefix:".js_pollSubmit_",radioButtonNamePrefix:"pollSelection_",pollResultsPrefix:"pollResults_"};dojo.mixin(this.conf,userConf);if(this.conf.category===""){console.error("You must define a category");return{};}
this.pollService=new dj.widget.poll.Poll(this.conf);this.setCategroyDivAndPollId();this.setSubmitButton();this.setRadioButtons();this.setPollResultsAnchor();this.setInitialWidgetState();this.addUiEvent();},addUiEvent:function(){var me=this;dj.lang.addLiveEvent(this.conf.radioButtonPrefix+this.pollId,"click",function(event){me.enableSubmitButton();});dj.lang.addLiveEvent(this.conf.submitButtonPrefix+this.pollId,"click",function(event){dojo.stopEvent(event);me.submitVote();});},enableSubmitButton:function(){if(this.submitButton){dojo.removeAttr(this.submitButton,"disabled");dojo.removeClass(this.submitButton,"input-disabled");}else{console.error("%s submit button for poll id %s was not found.",this.conf.submitButtonPrefix+this.pollId,this.pollId);}},submitVote:function(){var submitButtonDisabledValue=dojo.attr(this.submitButton,"disabled");if(submitButtonDisabledValue===false||submitButtonDisabledValue===null||submitButtonDisabledValue===undefined||submitButtonDisabledValue===''){var selectedRadioButtons=this.getSelectedRadioButtons();if(selectedRadioButtons.length===1){var selectedRadioButton=selectedRadioButtons[0];var voteUrl=dojo.byId("voteUrl_"+this.pollId).value;var pollName=dojo.byId("pollName_"+this.pollId).value;var pollOption=selectedRadioButton.value;this.pollService.submitVote(voteUrl,pollName,this.conf.hashKey,pollOption);var displayUrl;var target;if(this.pollResultsAnchor){displayUrl=this.pollResultsAnchor.href;target=this.pollResultsAnchor.target;}
if(displayUrl===undefined||displayUrl===''||displayUrl===null){console.error("Community URL is missing for poll category %s",this.conf.category);}
else{this.pollService.displayPollResultAndFlashVote(displayUrl,pollOption,target);}}}},setCategroyDivAndPollId:function(){var pollDivs=dojo.query("div[data-poll-category='"+this.conf.category+"']");if(pollDivs.length===1){this.categoryDiv=pollDivs[0];this.pollId=dojo.attr(this.categoryDiv,"data-poll-id");this.pollService.pollId=this.pollId;if(this.pollId===null||this.pollId===''||this.pollId===undefined){console.error("No attribute data-poll-id specified for poll category %s",this.conf.category);}}
else{if(pollDivs.length===0){console.error("No poll div for category %s",this.conf.category);}
else{console.error("Too many poll divs for category %s",this.conf.category);}}},setSubmitButton:function(){var submitButtons=dojo.query(this.conf.submitButtonPrefix+this.pollId);if(submitButtons.length===1){this.submitButton=submitButtons[0];}
else{console.error("Expecting 1 submit button for poll category %s. Found %s instead.",this.conf.category,submitButtons.length);}},setRadioButtons:function(){this.radioButtons=dojo.query("input[name='"+this.conf.radioButtonNamePrefix+this.pollId+"']");if(this.radioButtons.length===0){console.error("No radio buttons found for poll category %s.",this.conf.category,submitButtons.length);}},setPollResultsAnchor:function(){var pollResultsAnchors=dojo.query("a[name='"+this.conf.pollResultsPrefix+this.pollId+"']");if(pollResultsAnchors.length===1){this.pollResultsAnchor=pollResultsAnchors[0];}},getSelectedRadioButtons:function(){return dojo.query("input[name='"+this.conf.radioButtonNamePrefix+this.pollId+"']:checked");},setInitialWidgetState:function(){this.setSelectedRadioButton();},setSelectedRadioButton:function(){this.checkDisableSubmitButton();var voteCookieObject=this.pollService.getMyCookieObject();if(voteCookieObject!==undefined){var me=this;dojo.forEach(this.radioButtons,function(item){me.checkRadioButton(item,voteCookieObject.pollOption);});}},checkDisableSubmitButton:function(){if(dojo.cookie.isSupported()){var voteCookie=this.pollService.getMyCookie();if(voteCookie===undefined){dojo.attr(this.submitButton,"disabled","true");}}},checkRadioButton:function(radioButton,cookiePollOption){if(radioButton.value==cookiePollOption){radioButton.checked=true;}}});dojo.provide("dj.util.excanvas");

// Copyright 2006 Google Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


// Known Issues:
//
// * Patterns are not implemented.
// * Radial gradient are not implemented. The VML version of these look very
//   different from the canvas one.
// * Clipping paths are not implemented.
// * Coordsize. The width and height attribute have higher priority than the
//   width and height style values which isn't correct.
// * Painting mode isn't implemented.
// * Canvas width/height should is using content-box by default. IE in
//   Quirks mode will draw the canvas using border-box. Either change your
//   doctype to HTML5
//   (http://www.whatwg.org/specs/web-apps/current-work/#the-doctype)
//   or use Box Sizing Behavior from WebFX
//   (http://webfx.eae.net/dhtml/boxsizing/boxsizing.html)
// * Non uniform scaling does not correctly scale strokes.
// * Optimize. There is always room for speed improvements.

// Only add this code if we do not already have a canvas implementation
if (!document.createElement('canvas').getContext) {

(function() {

    // alias some functions to make (compiled) code shorter
    var m = Math;
    var mr = m.round;
    var ms = m.sin;
    var mc = m.cos;
    var abs = m.abs;
    var sqrt = m.sqrt;

    // this is used for sub pixel precision
    var Z = 10;
    var Z2 = Z / 2;

    /**
    * This funtion is assigned to the <canvas> elements as element.getContext().
    * @this {HTMLElement}
    * @return {CanvasRenderingContext2D_}
    */
    function getContext() {
        return this.context_ ||
        (this.context_ = new CanvasRenderingContext2D_(this));
    }

    var slice = Array.prototype.slice;

    /**
    * Binds a function to an object. The returned function will always use the
    * passed in {@code obj} as {@code this}.
    *
    * Example:
    *
    *   g = bind(f, obj, a, b)
    *   g(c, d) // will do f.call(obj, a, b, c, d)
    *
    * @param {Function} f The function to bind the object to
    * @param {Object} obj The object that should act as this when the function
    *     is called
    * @param {*} var_args Rest arguments that will be used as the initial
    *     arguments when the function is called
    * @return {Function} A new function that has bound this
    */
    function bind(f, obj, var_args) {
        var a = slice.call(arguments, 2);
        return function() {
            return f.apply(obj, a.concat(slice.call(arguments)));
        };
    }

    var G_vmlCanvasManager_ = {
        init: function(opt_doc) {
            if (/MSIE/.test(navigator.userAgent) && !window.opera) {
                var doc = opt_doc || document;
                // Create a dummy element so that IE will allow canvas elements to be
                // recognized.
                doc.createElement('canvas');
                doc.attachEvent('onreadystatechange', bind(this.init_, this, doc));
            }
        },

        init_: function(doc) {
            // create xmlns
            if (!doc.namespaces['g_vml_']) {
                doc.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                           '#default#VML');

            }
            if (!doc.namespaces['g_o_']) {
                doc.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                           '#default#VML');
            }

            // Setup default CSS.  Only add one style sheet per document
            if (!doc.styleSheets['ex_canvas_']) {
                var ss = doc.createStyleSheet();
                ss.owningElement.id = 'ex_canvas_';
                ss.cssText = 'canvas{display:inline-block;overflow:hidden;' +
                // default size is 300x150 in Gecko and Opera
            'text-align:left;width:300px;height:150px}' +
            'g_vml_\\:*{behavior:url(#default#VML)}' +
            'g_o_\\:*{behavior:url(#default#VML)}';

            }

            // find all canvas elements
            var els = doc.getElementsByTagName('canvas');
            for (var i = 0; i < els.length; i++) {
                this.initElement(els[i]);
            }
        },

        /**
        * Public initializes a canvas element so that it can be used as canvas
        * element from now on. This is called automatically before the page is
        * loaded but if you are creating elements using createElement you need to
        * make sure this is called on the element.
        * @param {HTMLElement} el The canvas element to initialize.
        * @return {HTMLElement} the element that was created.
        */
        initElement: function(el, width, height) {
            if (!el.getContext) {

                this.width = width;
                this.height = height;

                el.getContext = getContext;

                // do not use inline function because that will leak memory
                el.attachEvent('onpropertychange', onPropertyChange);
                el.attachEvent('onresize', onResize);

                var attrs = el.attributes;
                if (attrs.width && attrs.width.specified) {
                    // TODO: use runtimeStyle and coordsize
                    // el.getContext().setWidth_(attrs.width.nodeValue);
                    el.style.width = attrs.width.nodeValue + 'px';
                } else {
                    el.width = el.clientWidth;
                }
                if (attrs.height && attrs.height.specified) {
                    // TODO: use runtimeStyle and coordsize
                    // el.getContext().setHeight_(attrs.height.nodeValue);
                    el.style.height = attrs.height.nodeValue + 'px';
                } else {
                    el.height = el.clientHeight;
                }
                //el.getContext().setCoordsize_()
            }
            return el;
        }
    };

    function onPropertyChange(e) {
        var el = e.srcElement;

        switch (e.propertyName) {
            case 'width':
                el.style.width = el.attributes.width.nodeValue + 'px';
                el.getContext().clearRect();
                break;
            case 'height':
                el.style.height = el.attributes.height.nodeValue + 'px';
                el.getContext().clearRect();
                break;
        }
    }

    function onResize(e) {
        var el = e.srcElement;
        if (el.firstChild) {
            el.firstChild.style.width = el.clientWidth + 'px';
            el.firstChild.style.height = el.clientHeight + 'px';
        }
    }

    //G_vmlCanvasManager_.init();

    // precompute "00" to "FF"
    var dec2hex = [];
    for (var i = 0; i < 16; i++) {
        for (var j = 0; j < 16; j++) {
            dec2hex[i * 16 + j] = i.toString(16) + j.toString(16);
        }
    }

    function createMatrixIdentity() {
        return [
      [1, 0, 0],
      [0, 1, 0],
      [0, 0, 1]
    ];
    }

    function matrixMultiply(m1, m2) {
        var result = createMatrixIdentity();

        for (var x = 0; x < 3; x++) {
            for (var y = 0; y < 3; y++) {
                var sum = 0;

                for (var z = 0; z < 3; z++) {
                    sum += m1[x][z] * m2[z][y];
                }

                result[x][y] = sum;
            }
        }
        return result;
    }

    function copyState(o1, o2) {
        o2.fillStyle = o1.fillStyle;
        o2.lineCap = o1.lineCap;
        o2.lineJoin = o1.lineJoin;
        o2.lineWidth = o1.lineWidth;
        o2.miterLimit = o1.miterLimit;
        o2.shadowBlur = o1.shadowBlur;
        o2.shadowColor = o1.shadowColor;
        o2.shadowOffsetX = o1.shadowOffsetX;
        o2.shadowOffsetY = o1.shadowOffsetY;
        o2.strokeStyle = o1.strokeStyle;
        o2.globalAlpha = o1.globalAlpha;
        o2.arcScaleX_ = o1.arcScaleX_;
        o2.arcScaleY_ = o1.arcScaleY_;
        o2.lineScale_ = o1.lineScale_;
    }

    function processStyle(styleString) {
        var str, alpha = 1;

        styleString = String(styleString);
        if (styleString.substring(0, 3) == 'rgb') {
            var start = styleString.indexOf('(', 3);
            var end = styleString.indexOf(')', start + 1);
            var guts = styleString.substring(start + 1, end).split(',');

            str = '#';
            for (var i = 0; i < 3; i++) {
                str += dec2hex[Number(guts[i])];
            }

            if (guts.length == 4 && styleString.substr(3, 1) == 'a') {
                alpha = guts[3];
            }
        } else {
            str = styleString;
        }

        return { color: str, alpha: alpha };
    }

    function processLineCap(lineCap) {
        switch (lineCap) {
            case 'butt':
                return 'flat';
            case 'round':
                return 'round';
            case 'square':
            default:
                return 'square';
        }
    }

    /**
    * This class implements CanvasRenderingContext2D interface as described by
    * the WHATWG.
    * @param {HTMLElement} surfaceElement The element that the 2D context should
    * be associated with
    */
    function CanvasRenderingContext2D_(surfaceElement) {
        this.m_ = createMatrixIdentity();

        this.mStack_ = [];
        this.aStack_ = [];
        this.currentPath_ = [];

        // Canvas context properties
        this.strokeStyle = '#000';
        this.fillStyle = '#000';

        this.lineWidth = 1;
        this.lineJoin = 'miter';
        this.lineCap = 'butt';
        this.miterLimit = Z * 1;
        this.globalAlpha = 1;
        this.canvas = surfaceElement;

        var el = surfaceElement.ownerDocument.createElement('div');
        el.style.width = G_vmlCanvasManager_.width; //surfaceElement.clientWidth + 'px';
        el.style.height = G_vmlCanvasManager_.height;  //surfaceElement.clientHeight + 'px';
        el.style.overflow = 'hidden';
        el.style.position = 'absolute';
        surfaceElement.appendChild(el);

        this.element_ = el;
        this.arcScaleX_ = 1;
        this.arcScaleY_ = 1;
        this.lineScale_ = 1;
    }

    var contextPrototype = CanvasRenderingContext2D_.prototype;
    contextPrototype.clearRect = function() {
        this.element_.innerHTML = '';
        this.currentPath_ = [];
    };

    contextPrototype.beginPath = function() {
        // TODO: Branch current matrix so that save/restore has no effect
        //       as per safari docs.
        this.currentPath_ = [];
    };

    contextPrototype.moveTo = function(aX, aY) {
        var p = this.getCoords_(aX, aY);
        this.currentPath_.push({ type: 'moveTo', x: p.x, y: p.y });
        this.currentX_ = p.x;
        this.currentY_ = p.y;
    };

    contextPrototype.lineTo = function(aX, aY) {
        var p = this.getCoords_(aX, aY);
        this.currentPath_.push({ type: 'lineTo', x: p.x, y: p.y });

        this.currentX_ = p.x;
        this.currentY_ = p.y;
    };

    contextPrototype.bezierCurveTo = function(aCP1x, aCP1y,
                                            aCP2x, aCP2y,
                                            aX, aY) {
        var p = this.getCoords_(aX, aY);
        var cp1 = this.getCoords_(aCP1x, aCP1y);
        var cp2 = this.getCoords_(aCP2x, aCP2y);
        bezierCurveTo(this, cp1, cp2, p);
    };

    // Helper function that takes the already fixed cordinates.
    function bezierCurveTo(self, cp1, cp2, p) {
        self.currentPath_.push({
            type: 'bezierCurveTo',
            cp1x: cp1.x,
            cp1y: cp1.y,
            cp2x: cp2.x,
            cp2y: cp2.y,
            x: p.x,
            y: p.y
        });
        self.currentX_ = p.x;
        self.currentY_ = p.y;
    }

    contextPrototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {
        // the following is lifted almost directly from
        // http://developer.mozilla.org/en/docs/Canvas_tutorial:Drawing_shapes

        var cp = this.getCoords_(aCPx, aCPy);
        var p = this.getCoords_(aX, aY);

        var cp1 = {
            x: this.currentX_ + 2.0 / 3.0 * (cp.x - this.currentX_),
            y: this.currentY_ + 2.0 / 3.0 * (cp.y - this.currentY_)
        };
        var cp2 = {
            x: cp1.x + (p.x - this.currentX_) / 3.0,
            y: cp1.y + (p.y - this.currentY_) / 3.0
        };

        bezierCurveTo(this, cp1, cp2, p);
    };

    contextPrototype.arc = function(aX, aY, aRadius,
                                  aStartAngle, aEndAngle, aClockwise) {
        aRadius *= Z;
        var arcType = aClockwise ? 'at' : 'wa';

        var xStart = aX + mc(aStartAngle) * aRadius - Z2;
        var yStart = aY + ms(aStartAngle) * aRadius - Z2;

        var xEnd = aX + mc(aEndAngle) * aRadius - Z2;
        var yEnd = aY + ms(aEndAngle) * aRadius - Z2;

        // IE won't render arches drawn counter clockwise if xStart == xEnd.
        if (xStart == xEnd && !aClockwise) {
            xStart += 0.125; // Offset xStart by 1/80 of a pixel. Use something
            // that can be represented in binary
        }

        var p = this.getCoords_(aX, aY);
        var pStart = this.getCoords_(xStart, yStart);
        var pEnd = this.getCoords_(xEnd, yEnd);

        this.currentPath_.push({ type: arcType,
            x: p.x,
            y: p.y,
            radius: aRadius,
            xStart: pStart.x,
            yStart: pStart.y,
            xEnd: pEnd.x,
            yEnd: pEnd.y
        });

    };

    contextPrototype.rect = function(aX, aY, aWidth, aHeight) {
        this.moveTo(aX, aY);
        this.lineTo(aX + aWidth, aY);
        this.lineTo(aX + aWidth, aY + aHeight);
        this.lineTo(aX, aY + aHeight);
        this.closePath();
    };

    contextPrototype.strokeRect = function(aX, aY, aWidth, aHeight) {
        // Will destroy any existing path (same as FF behaviour)
        this.beginPath();
        this.moveTo(aX, aY);
        this.lineTo(aX + aWidth, aY);
        this.lineTo(aX + aWidth, aY + aHeight);
        this.lineTo(aX, aY + aHeight);
        this.closePath();
        this.stroke();
        this.currentPath_ = [];
    };

    contextPrototype.fillRect = function(aX, aY, aWidth, aHeight) {
        // Will destroy any existing path (same as FF behaviour)
        this.beginPath();
        this.moveTo(aX, aY);
        this.lineTo(aX + aWidth, aY);
        this.lineTo(aX + aWidth, aY + aHeight);
        this.lineTo(aX, aY + aHeight);
        this.closePath();
        this.fill();
        this.currentPath_ = [];
    };

    contextPrototype.createLinearGradient = function(aX0, aY0, aX1, aY1) {
        var gradient = new CanvasGradient_('gradient');
        gradient.x0_ = aX0;
        gradient.y0_ = aY0;
        gradient.x1_ = aX1;
        gradient.y1_ = aY1;
        return gradient;
    };

    contextPrototype.createRadialGradient = function(aX0, aY0, aR0,
                                                   aX1, aY1, aR1) {
        var gradient = new CanvasGradient_('gradientradial');
        gradient.x0_ = aX0;
        gradient.y0_ = aY0;
        gradient.r0_ = aR0;
        gradient.x1_ = aX1;
        gradient.y1_ = aY1;
        gradient.r1_ = aR1;
        return gradient;
    };

    contextPrototype.drawImage = function(image, var_args) {
        var dx, dy, dw, dh, sx, sy, sw, sh;

        // to find the original width we overide the width and height
        var oldRuntimeWidth = image.runtimeStyle.width;
        var oldRuntimeHeight = image.runtimeStyle.height;
        image.runtimeStyle.width = 'auto';
        image.runtimeStyle.height = 'auto';

        // get the original size
        var w = image.width;
        var h = image.height;

        // and remove overides
        image.runtimeStyle.width = oldRuntimeWidth;
        image.runtimeStyle.height = oldRuntimeHeight;

        if (arguments.length == 3) {
            dx = arguments[1];
            dy = arguments[2];
            sx = sy = 0;
            sw = dw = w;
            sh = dh = h;
        } else if (arguments.length == 5) {
            dx = arguments[1];
            dy = arguments[2];
            dw = arguments[3];
            dh = arguments[4];
            sx = sy = 0;
            sw = w;
            sh = h;
        } else if (arguments.length == 9) {
            sx = arguments[1];
            sy = arguments[2];
            sw = arguments[3];
            sh = arguments[4];
            dx = arguments[5];
            dy = arguments[6];
            dw = arguments[7];
            dh = arguments[8];
        } else {
            throw Error('Invalid number of arguments');
        }

        var d = this.getCoords_(dx, dy);

        var w2 = sw / 2;
        var h2 = sh / 2;

        var vmlStr = [];

        var W = 10;
        var H = 10;

        // For some reason that I've now forgotten, using divs didn't work
        vmlStr.push(' <g_vml_:group',
                ' coordsize="', Z * W, ',', Z * H, '"',
                ' coordorigin="0,0"',
                ' style="width:', W, 'px;height:', H, 'px;position:absolute;');

        // If filters are necessary (rotation exists), create them
        // filters are bog-slow, so only create them if abbsolutely necessary
        // The following check doesn't account for skews (which don't exist
        // in the canvas spec (yet) anyway.

        if (this.m_[0][0] != 1 || this.m_[0][1]) {
            var filter = [];

            // Note the 12/21 reversal
            filter.push('M11=', this.m_[0][0], ',',
                  'M12=', this.m_[1][0], ',',
                  'M21=', this.m_[0][1], ',',
                  'M22=', this.m_[1][1], ',',
                  'Dx=', mr(d.x / Z), ',',
                  'Dy=', mr(d.y / Z), '');

            // Bounding box calculation (need to minimize displayed area so that
            // filters don't waste time on unused pixels.
            var max = d;
            var c2 = this.getCoords_(dx + dw, dy);
            var c3 = this.getCoords_(dx, dy + dh);
            var c4 = this.getCoords_(dx + dw, dy + dh);

            max.x = m.max(max.x, c2.x, c3.x, c4.x);
            max.y = m.max(max.y, c2.y, c3.y, c4.y);

            vmlStr.push('padding:0 ', mr(max.x / Z), 'px ', mr(max.y / Z),
                  'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',
                  filter.join(''), ", sizingmethod='clip');")
        } else {
            vmlStr.push('top:', mr(d.y / Z), 'px;left:', mr(d.x / Z), 'px;');
        }

        vmlStr.push(' ">',
                '<g_vml_:image src="', image.src, '"',
                ' style="width:', Z * dw, 'px;',
                ' height:', Z * dh, 'px;"',
                ' cropleft="', sx / w, '"',
                ' croptop="', sy / h, '"',
                ' cropright="', (w - sx - sw) / w, '"',
                ' cropbottom="', (h - sy - sh) / h, '"',
                ' />',
                '</g_vml_:group>');

        this.element_.insertAdjacentHTML('BeforeEnd',
                                    vmlStr.join(''));
    };

    contextPrototype.stroke = function(aFill) {
        var lineStr = [];
        var lineOpen = false;
        var a = processStyle(aFill ? this.fillStyle : this.strokeStyle);
        var color = a.color;
        var opacity = a.alpha * this.globalAlpha;

        var W = 10;
        var H = 10;

        lineStr.push('<g_vml_:shape',
                 ' filled="', !!aFill, '"',
                 ' style="position:absolute;width:', W, 'px;height:', H, 'px;"',
                 ' coordorigin="0 0" coordsize="', Z * W, ' ', Z * H, '"',
                 ' stroked="', !aFill, '"',
                 ' path="');

        var newSeq = false;
        var min = { x: null, y: null };
        var max = { x: null, y: null };

        for (var i = 0; i < this.currentPath_.length; i++) {
            var p = this.currentPath_[i];
            var c;

            switch (p.type) {
                case 'moveTo':
                    c = p;
                    lineStr.push(' m ', mr(p.x), ',', mr(p.y));
                    break;
                case 'lineTo':
                    lineStr.push(' l ', mr(p.x), ',', mr(p.y));
                    break;
                case 'close':
                    lineStr.push(' x ');
                    p = null;
                    break;
                case 'bezierCurveTo':
                    lineStr.push(' c ',
                       mr(p.cp1x), ',', mr(p.cp1y), ',',
                       mr(p.cp2x), ',', mr(p.cp2y), ',',
                       mr(p.x), ',', mr(p.y));
                    break;
                case 'at':
                case 'wa':
                    lineStr.push(' ', p.type, ' ',
                       mr(p.x - this.arcScaleX_ * p.radius), ',',
                       mr(p.y - this.arcScaleY_ * p.radius), ' ',
                       mr(p.x + this.arcScaleX_ * p.radius), ',',
                       mr(p.y + this.arcScaleY_ * p.radius), ' ',
                       mr(p.xStart), ',', mr(p.yStart), ' ',
                       mr(p.xEnd), ',', mr(p.yEnd));
                    break;
            }


            // TODO: Following is broken for curves due to
            //       move to proper paths.

            // Figure out dimensions so we can do gradient fills
            // properly
            if (p) {
                if (min.x == null || p.x < min.x) {
                    min.x = p.x;
                }
                if (max.x == null || p.x > max.x) {
                    max.x = p.x;
                }
                if (min.y == null || p.y < min.y) {
                    min.y = p.y;
                }
                if (max.y == null || p.y > max.y) {
                    max.y = p.y;
                }
            }
        }
        lineStr.push(' ">');

        if (!aFill) {
            var lineWidth = this.lineScale_ * this.lineWidth;

            // VML cannot correctly render a line if the width is less than 1px.
            // In that case, we dilute the color to make the line look thinner.
            if (lineWidth < 1) {
                opacity *= lineWidth;
            }

            lineStr.push(
        '<g_vml_:stroke',
        ' opacity="', opacity, '"',
        ' joinstyle="', this.lineJoin, '"',
        ' miterlimit="', this.miterLimit, '"',
        ' endcap="', processLineCap(this.lineCap), '"',
        ' weight="', lineWidth, 'px"',
        ' color="', color, '" />'
      );
        } else if (typeof this.fillStyle == 'object') {
            var fillStyle = this.fillStyle;
            var angle = 0;
            var focus = { x: 0, y: 0 };

            // additional offset
            var shift = 0;
            // scale factor for offset
            var expansion = 1;

            if (fillStyle.type_ == 'gradient') {
                var x0 = fillStyle.x0_ / this.arcScaleX_;
                var y0 = fillStyle.y0_ / this.arcScaleY_;
                var x1 = fillStyle.x1_ / this.arcScaleX_;
                var y1 = fillStyle.y1_ / this.arcScaleY_;
                var p0 = this.getCoords_(x0, y0);
                var p1 = this.getCoords_(x1, y1);
                var dx = p1.x - p0.x;
                var dy = p1.y - p0.y;
                angle = Math.atan2(dx, dy) * 180 / Math.PI;

                // The angle should be a non-negative number.
                if (angle < 0) {
                    angle += 360;
                }

                // Very small angles produce an unexpected result because they are
                // converted to a scientific notation string.
                if (angle < 1e-6) {
                    angle = 0;
                }
            } else {
                var p0 = this.getCoords_(fillStyle.x0_, fillStyle.y0_);
                var width = max.x - min.x;
                var height = max.y - min.y;
                focus = {
                    x: (p0.x - min.x) / width,
                    y: (p0.y - min.y) / height
                };

                width /= this.arcScaleX_ * Z;
                height /= this.arcScaleY_ * Z;
                var dimension = m.max(width, height);
                shift = 2 * fillStyle.r0_ / dimension;
                expansion = 2 * fillStyle.r1_ / dimension - shift;
            }

            // We need to sort the color stops in ascending order by offset,
            // otherwise IE won't interpret it correctly.
            var stops = fillStyle.colors_;
            stops.sort(function(cs1, cs2) {
                return cs1.offset - cs2.offset;
            });

            var length = stops.length;
            var color1 = stops[0].color;
            var color2 = stops[length - 1].color;
            var opacity1 = stops[0].alpha * this.globalAlpha;
            var opacity2 = stops[length - 1].alpha * this.globalAlpha;

            var colors = [];
            for (var i = 0; i < length; i++) {
                var stop = stops[i];
                colors.push(stop.offset * expansion + shift + ' ' + stop.color);
            }

            // When colors attribute is used, the meanings of opacity and o:opacity2
            // are reversed.
            lineStr.push('<g_vml_:fill type="', fillStyle.type_, '"',
                   ' method="none" focus="100%"',
                   ' color="', color1, '"',
                   ' color2="', color2, '"',
                   ' colors="', colors.join(','), '"',
                   ' opacity="', opacity2, '"',
                   ' g_o_:opacity2="', opacity1, '"',
                   ' angle="', angle, '"',
                   ' focusposition="', focus.x, ',', focus.y, '" />');
        } else {
            lineStr.push('<g_vml_:fill color="', color, '" opacity="', opacity,
                   '" />');
        }

        lineStr.push('</g_vml_:shape>');

        this.element_.insertAdjacentHTML('beforeEnd', lineStr.join(''));
    };

    contextPrototype.fill = function() {
        this.stroke(true);
    }

    contextPrototype.closePath = function() {
        this.currentPath_.push({ type: 'close' });
    };

    /**
    * @private
    */
    contextPrototype.getCoords_ = function(aX, aY) {
        var m = this.m_;
        return {
            x: Z * (aX * m[0][0] + aY * m[1][0] + m[2][0]) - Z2,
            y: Z * (aX * m[0][1] + aY * m[1][1] + m[2][1]) - Z2
        }
    };

    contextPrototype.save = function() {
        var o = {};
        copyState(this, o);
        this.aStack_.push(o);
        this.mStack_.push(this.m_);
        this.m_ = matrixMultiply(createMatrixIdentity(), this.m_);
    };

    contextPrototype.restore = function() {
        copyState(this.aStack_.pop(), this);
        this.m_ = this.mStack_.pop();
    };

    contextPrototype.translate = function(aX, aY) {
        var m1 = [
      [1, 0, 0],
      [0, 1, 0],
      [aX, aY, 1]
    ];

        this.m_ = matrixMultiply(m1, this.m_);
    };

    contextPrototype.rotate = function(aRot) {
        var c = mc(aRot);
        var s = ms(aRot);

        var m1 = [
      [c, s, 0],
      [-s, c, 0],
      [0, 0, 1]
    ];

        this.m_ = matrixMultiply(m1, this.m_);
    };

    contextPrototype.scale = function(aX, aY) {
        this.arcScaleX_ *= aX;
        this.arcScaleY_ *= aY;
        var m1 = [
      [aX, 0, 0],
      [0, aY, 0],
      [0, 0, 1]
    ];

        var m = this.m_ = matrixMultiply(m1, this.m_);

        // Get the line scale.
        // Determinant of this.m_ means how much the area is enlarged by the
        // transformation. So its square root can be used as a scale factor
        // for width.
        var det = m[0][0] * m[1][1] - m[0][1] * m[1][0];
        this.lineScale_ = sqrt(abs(det));
    };

    /******** STUBS ********/
    contextPrototype.clip = function() {
        // TODO: Implement
    };

    contextPrototype.arcTo = function() {
        // TODO: Implement
    };

    contextPrototype.createPattern = function() {
        return new CanvasPattern_;
    };

    // Gradient / Pattern Stubs
    function CanvasGradient_(aType) {
        this.type_ = aType;
        this.x0_ = 0;
        this.y0_ = 0;
        this.r0_ = 0;
        this.x1_ = 0;
        this.y1_ = 0;
        this.r1_ = 0;
        this.colors_ = [];
    }

    CanvasGradient_.prototype.addColorStop = function(aOffset, aColor) {
        aColor = processStyle(aColor);
        this.colors_.push({ offset: aOffset,
            color: aColor.color,
            alpha: aColor.alpha
        });
    };

    function CanvasPattern_() { }

    // set up externs
    G_vmlCanvasManager = G_vmlCanvasManager_;
    CanvasRenderingContext2D = CanvasRenderingContext2D_;
    CanvasGradient = CanvasGradient_;
    CanvasPattern = CanvasPattern_;

})();

} // if
dojo.provide("dj.widget.livenews.view.baseLiveUpdateView");

dojo.declare("dj.widget.livenews.view.baseLiveUpdateView", null, {
	actions : {NONE:0,INSERT:1,UPDATE:2,DELETE:3},
	containerObject : null,
	DEFAULT_CONFIG : {
		updateCount : 10,
		imagePrefix : 'http://si.wsj.net/public/resources/images/',
		multiArray : null,
		chartPrefix : 'http://si.wsj.net/public/resources/images/',
		chartMultiArray : null,
		wrapperImgClass : 'newsImage newsImage-A'
	},

	constructor: function(args){
	    dojo.safeMixin(this, args);
	},

  	render : function(response) {
		console.error("{baseLiveUpdateView:render} - This is an abstract class, please define implementation");
	},

	CleanBad : function(string) {
	   for (var i=0, output='', valid="eE-0123456789."; i<string.length; i++)
	   if (valid.indexOf(string.charAt(i)) != -1)
		   output += string.charAt(i)
	   return output;
	},

	getTime : function(time) {
	   var that = this;
	   var sAve = 0;
	   var ez1 = "";
	   var ml3 = "00";
	   var pw3 = parseFloat(that.CleanBad(time));
	   var pm4 = that.CleanBad(time);
	   var pm5 = that.CleanBad(time);
	   var len = pm4.length;
	   if (len != 4) {
		   return time;
	   }
	   else if (pw3>2401) {
		   return time;
	   }
	   else if (pw3>1259) {
		   pw3 = pw3 - 1200;

		   var pm4 = String(pw3);

		   var len = pm4.length;
		   if (len < 4) {
			   pm4 = "0"+ pm4;
		   }

		   if (pm4.substring(0, 1) == "0") {
			   var hours = pm4.substring(1, 2);
		   }
		   else {
			   	var hours = pm4.substring(0, 2);
		   }
		   var mins = pm4.substring(2, 4);
		   ez1 = " P.M.";
		   if (hours == "12") ez1 = " A.M.";
		   if (mins > "59") mins = "???";
		   return hours + ":" + mins + ez1;
	   }
	   else {
		   if (pm4.substring(0, 1) == "0") {
			   var hours = pm4.substring(1, 2);
		   }
		   else {
			   var hours = pm4.substring(0, 2);
		   }
		   var mins = pm4.substring(2, 4);
		   ez1 = " A.M.";
		   if (hours == "12") {
			   ez1 = " P.M.";
		   }
		   if (pm5.substring(0, 2) == "00") {
			   hours = "12";
		   }
		   if (mins > "59")
			   mins = "???";

		   return hours + ":" + mins + ez1;
	   }
	  }

});
dojo.provide("dj.widget.livenews.view.mrktView");

dojo.declare("dj.widget.livenews.view.mrktView", null, {

  containerObject : null,
  constructor: function(userConf) {
	this.conf = {
    };
    dojo.safeMixin(this.conf, userConf);
  },

  render : function(data) {
	  that = this;

	  var containerLi = dojo.query("[data-bluegrass-channel='"+data.h.t+"']");
	  dojo.forEach(containerLi, function(liElement) {

		  var innerEle;
		  var spanEle;
		  var spanEleSec;
		  var deltaClass = "deltaType-noChange";
		  var pos_sign = '+';

		  var updateFlag = that.getMetaData(data, "Y");
		  if(updateFlag !== "normal") {
			  return;
		  }

		  if(liElement.id == 'marketdata_stocks')
		  {
			  innerEle = liElement.children;
			  var sChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(sChange !== "error" && (la !== null && la !== "error")) {
				  if(sChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  spanEle = innerEle[1].children[0].children;
				  spanEle[1].innerHTML = la;

				  spanEleSec = innerEle[1].children;

				  spanEleSec[1].innerHTML = '<span class="marketDelta '+deltaClass+'"> '+pos_sign + sChange +' ('+pos_sign+that.getMetaData(data, "PC")+'%)</span>';
			  }

		  } else if(liElement.id == 'marketdata_actives')
		  {
			  innerEle = liElement.children[0].children;
			  var aChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if(aChange !== "error") {
				  if(aChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  var delayChannel = dj.util.Element.getData(liElement  , "delayed-bluegrass-channel");
				  if((delayChannel == null || delayChannel === undefined) && (vl !== null && vl !== "error")) {
					  innerEle[1].innerHTML = '<div class="info_int"><span class="info_intValue">'+vl+'</span></div>'+
		            	'<div class="marketDelta '+deltaClass+'"> '+pos_sign+aChange+'<span class="marketDeltaDivider"> | </span>'+pos_sign+that.getMetaData(data, "PC")+'%</div>';
				  } else {
					  spanEle = innerEle[1].children;
					  dojo.removeClass(spanEle[1],"deltaType-positive");
					  dojo.removeClass(spanEle[1],"deltaType-negative");
					  dojo.addClass(spanEle[1],deltaClass );
				  	  spanEle[1].innerHTML = pos_sign+aChange+'<span class="marketDeltaDivider"> | </span>'+pos_sign+that.getMetaData(data, "PC")+'%';
				  }
			  }
		  } else if(liElement.id == 'marketdata_gainers' || liElement.id == 'marketdata_decliners')
		  {
			  innerEle = liElement.children[0].children;
			  var gChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(gChange !== "error" && (la !== null && la !== "error")) {
				  if(gChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  spanEle = innerEle[1].children;
				  spanEle[0].innerHTML = '<span class="info_intValue '+deltaClass+'">'+pos_sign+that.getMetaData(data, "PC")+'%</span>';
				  spanEleSec = innerEle[1].children[1].children;
				  var currency = spanEleSec[1].innerHTML;
				  spanEle[1].innerHTML = '<span class="'+deltaClass+'">'+pos_sign+gChange+'</span> <span class="marketDeltaDivider"> '+currency+'</span>'+la;
			  }

		  } else if(liElement.id == 'marketdata_volume')
		  {
			  innerEle = liElement.children[0].children;
			  divInnerEle = innerEle[1].children;
			  var vChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if( vChange !== "error" ) {
				  if(vChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }
				  var delayChannel = dj.util.Element.getData(liElement  , "delayed-bluegrass-channel");
				  if( (delayChannel == null || delayChannel === undefined) && (vl !== null && vl !== "error")){
					  var avgVol = divInnerEle[0].children[2].innerHTML.replace(/,/g,"");
					  var newVolume = vl.replace(/,/g,"");
					  var diffVol = ( ((newVolume - avgVol) / avgVol) * 100);
					  if (diffVol.toFixed){
						  diffVol = diffVol.toFixed(2);
				      }
					  newVolume = that.formatCurrency(newVolume, 'VL');
					  diffVol = that.formatCurrency(diffVol, 'LA');

					  divInnerEle[0].children[1].innerHTML = diffVol;

					  divInnerEle[1].innerHTML = '<span class="market_intValue">'+newVolume+' </span> <span class="marketDeltaDivider"> | </span> <span class="'+deltaClass+'">'+pos_sign+vChange+'%</span>';
				  } else {
					  divInnerEle[1].innerHTML = '<span class="market_intValue">'+divInnerEle[1].children[0].innerHTML + '</span><span class="marketDeltaDivider"> | </span> <span class="'+deltaClass+'">'+pos_sign+vChange+'%</span>';
				  }
			  }
		  } else if(liElement.id == 'live_market_stocks')
		  {
			  innerEle = liElement.children;

			  var sChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(sChange !== "error" && (la !== null && la !== "error")) {
				  if(sChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  spanEle = innerEle[1].children[0].children;
				  spanEle[1].innerHTML = la;
				  spanEleSec = innerEle[1].children;

				  //spanEleSec[1].innerHTML = '<span class="marketDelta '+deltaClass+'"> '+pos_sign + sChange +' ('+pos_sign+that.getMetaData(data, "PC")+'%)</span>';
				  spanEleSec[1].innerHTML = ' '+pos_sign + sChange +' ('+pos_sign+that.getMetaData(data, "PC")+'%)';
				  dojo.removeClass(spanEleSec[1], "deltaType-negative");
				  dojo.removeClass(spanEleSec[1], "deltaType-positive");
				  dojo.addClass(spanEleSec[1], deltaClass);
			  } else {
				  console.error("Data is incorrect for : "+ data.b.t + "[ " + data.b.c + ", "+  la +  " ]");
			  }

		  } else if(liElement.id == 'live_market_charts')
		  {
			  innerEle = liElement.children;
			  innerEleChild = innerEle[0].children;

			  var sChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(sChange !== "error" && (la !== null && la !== "error")) {
				  innerEleChild[1].children[1].innerHTML = la;

				  if(sChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  innerEle[1].innerHTML = '<span class="marketDelta '+deltaClass+'"> '+pos_sign+sChange+ ' ('+pos_sign+that.getMetaData(data, "PC")+'%)</span>';
			  }
		  }

	  });

	  var delayedLi = dojo.query("[data-delayed-bluegrass-channel='"+data.h.t+"']");
	  that.populateDelayedData(delayedLi, data, that);
  },

 populateDelayedData : function(containerLi, data, that){

	  dojo.forEach(containerLi, function(liElement) {

		  var innerEle;
		  var spanEle;
		  var spanEleSec;
		  var deltaClass = "deltaType-noChange";
		  var pos_sign = '+';

		  var updateFlag = that.getMetaData(data, "Y");
		  if(updateFlag !== "normal") {
			  return;
		  }

		  if(liElement.id == 'marketdata_actives')
		  {
			  innerEle = liElement.children[0].children;
			  var aChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if(vl !== null && vl !== "error") {

				  var realChannel = dj.util.Element.getData(liElement  , "bluegrass-channel");
				  if((realChannel == null || realChannel === undefined) && aChange !== "error") {
					  if(aChange.indexOf('-') === -1 ){
						  deltaClass = "deltaType-positive";
						  pos_sign = '+';
					  } else {
						  deltaClass = "deltaType-negative";
						  pos_sign = '';
					  }
					  innerEle[1].innerHTML = '<div class="info_int"><span class="info_intValue">'+vl+'</span></div>'+
		            	'<div class="marketDelta '+deltaClass+'"> '+pos_sign+aChange+'<span class="marketDeltaDivider"> | </span>'+pos_sign+that.getMetaData(data, "PC")+'%</div>';
				  } else {
					  spanEle = innerEle[1].children;
				  	  spanEle[0].innerHTML = '<span class="info_intValue">'+vl +'</span></div>';
				  }
			  }
		  } else if(liElement.id == 'marketdata_volume')
		  {
			  innerEle = liElement.children[0].children;
			  divInnerEle = innerEle[1].children;
			  var vChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if( vl !== null && vl !== "error" ) {
				  var avgVol = divInnerEle[0].children[2].innerHTML.replace(/,/g,"");
				  var newVolume = vl.replace(/,/g,"");
				  var diffVol = ( ((newVolume - avgVol) / avgVol) * 100);
				  if (diffVol.toFixed){
					  diffVol = diffVol.toFixed(2);
			      }
				  newVolume = that.formatCurrency(newVolume, 'VL');
				  diffVol = that.formatCurrency(diffVol, 'LA');

				  divInnerEle[0].children[1].innerHTML = diffVol;


				  var realChannel = dj.util.Element.getData(liElement  , "bluegrass-channel");
				  if( (realChannel == null || realChannel === undefined) && vChange !== "error"){
					  if(vChange.indexOf('-') === -1 ){
						  deltaClass = "deltaType-positive";
						  pos_sign = '+';
					  } else {
						  deltaClass = "deltaType-negative";
						  pos_sign = '';
					  }
					  divInnerEle[1].innerHTML = '<span class="market_intValue">'+newVolume+' </span> <span class="marketDeltaDivider"> | </span> <span class="'+deltaClass+'">'+pos_sign+vChange+'%</span>';
				  } else {
					  divInnerEle[1].children[0].innerHTML = '<span class="market_intValue">'+newVolume+' </span>';
				  }
			  }
		  }

	  });


  },

  getMetaData : function(_d, _t, _cont) {

	  var _m ="";
	  try{
	      switch(_t) {
		      case "CH": // Change
		        _m = _d.b.c;
		        if(_m === null){
		        	_m = "error"; // Error scenario not expected
		        }
		        break;
		      case "Y": // updateflag
			        _m = _d.b.y;
			        if(_m === null){
			        	_m = "error"; // Error scenario not expected
			        }
	            break;
		      case "PC": // % Change
		        _m = ((_d.b.c*100)/(_d.b.l - _d.b.c) );
		        break;
		      case "VL": // Volume
		        _m = _d.b.v;
		        if(_m !== null){
		        	_m = that.formatCurrency(_m, 'VL');
		        }
		        break;
		      case "LA": // Last-Price
		        _m = _d.b.l;
		        if(_m !== null){
		        	_m = that.formatCurrency(_m, 'LA');
		        }
		        break;
		      default : // default - Last
		        _m = _d.b.l;
		        break;
	      }
	      if(_m !== null){
	      	if (_m.toFixed){
	      		_m = _m.toFixed(2);
	      	}
	      }
	  }catch(err)
	  {
		  console.log("error while calculating either price, change or volume.");
		  _m = "error";
	  }

      return _m;
  },

  formatCurrency : function(num, type) {
		  num = num.toString().replace(/\$|\,/g,'');
		  if(isNaN(num)) {
			  num = "0";
		  }
		  sign = (num == (num = Math.abs(num)));
		  num = Math.floor(num*100+0.50000000001);
		  cents = num%100;
		  num = Math.floor(num/100).toString();

		  for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
		  num = num.substring(0,num.length-(4*i+3))+','+ num.substring(num.length-(4*i+3));

		  if(type === 'LA') {
			  if(cents > 10) {
				  num = num + '.' + cents;
			  } else if(cents > 0 && cents<10) {
				  num = num + '.0' + cents;
			  } else if( cents == 0) {
				  num = num + '.00';
			  }
		  }
		  return (((sign)?'':'-') + num);

  }

});
dojo.provide("dj.module.marketdataticker.marketDataRenderer");

dojo.require("dj.widget.panels.PanelsFactory");
dojo.require("dj.util.Page");

if (typeof dj.module === "undefined") {
  dj.module = {};
}

if (typeof dj.module.marketdataticker.marketDataRenderer === "undefined") {
	dj.module.marketdataticker.marketDataRenderer = {};
}

var _djl = dj.lang;
var _djp = dj.util.Page;

dj.module.marketdataticker.marketDataRenderer = {

  init : function(conf) {
    // Check for IE to change canvas for VML
    if(_djl.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                   '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                   '#default#VML');
      }
    }

    // Default Configuration
    this.configuration = {
      moduleName : "marketDataModule",
      defaultTab : 1,
      refreshModule : false,
      refreshRate : 60,

      moduleContainer : "marketDataContainer",
      tabs : ["stocksinnews", "actives", "gainers", "decliners", "unusualVolume"],

      dataContainer : "marketDataTable_",
      showMyMarkets: true

    };
    _djl.mixin(this.configuration, conf);

    this.timer = "";

    this.panelData = [];
    this.panels = this.createPanels(this.configuration.moduleContainer);

    if(this.configuration.refreshModule) {
      _djp.enableModuleRefresh(this.configuration.moduleName);
      //this.setRefresh(this.configuration.refreshRate);
    }
  },

  showHideTip: function(objId) {

	  var toolTipDiv = dojo.byId(objId);

	  var indexVal = toolTipDiv.className.indexOf("hidden");

      if((toolTipDiv.className).indexOf("hidden") == -1)
      {
          dojo.addClass(toolTipDiv,"hidden");
      }
      else
      {
    	  dojo.removeClass(toolTipDiv, "hidden");
      }
 },


  /**
   * Refresh rate in seconds
   */
  setRefresh: function(refreshRate) {
    var that = this;
    that.timer = setInterval(function(){
      if(_djp.isModuleRefreshEnabled(that.configuration.moduleName)) {
        /*that.getTableData();
        that.renderChart();
        that.getChartData();
        console.log("Refreshed Market Data");*/
      }
    }, refreshRate * 1000);
  },

  createPanels : function(container) {
    var that = this;

    return dj.widget.panels.PanelsFactory.create(container, {
      core: {
        panelPrefix:     "marketDataPanel_",
        panels:          that.configuration.tabs,
        enableHistory:   false,
        activePanel:     that.configuration.defaultTab
      },

      tabs: {
        tabPrefix:       "marketDataTab_",
        tabOnStyle:      "selected",
        tabOffStyle:     ""
      }
    });
  }
};
dojo.provide("dj.module.stockinnews.mrktProvider");
dojo.require("dj.lang");
dojo.require("dj.util.bluegrass");

dojo.declare("dj.module.stockinnews.mrktProvider", null, {
    channels : [],
    _cfg : {},
    connectFlag : null,

    DEFAULT_CONFIG : {
      toURL : dj.context.marketdata.bluegrass.toURL,
      viaURL : dj.context.marketdata.bluegrass.viaURL
    },


    constructor : function(cfg) {
        this._cfg = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
     },

    subscribeToChannel : function(channel, theView) {
      this.channels.push( {
        channelName : channel,
        view : theView
      });
    },

    subscribeToChannels : function(channels, theView) {
      var that = this;
      dojo.forEach(channels, function(channel){
    	that.subscribeToChannel(channel, theView);
      });
    },

    dynamicSubscribeChannel : function(dynamicChannels, theView, channels) {
    that = this;

	 try{
	      var connection = dj.util.bluegrass.Runtime.getConnection();
	      if (connection != null) {
	          dojo.forEach(dynamicChannels,function(channel) {
	              if (typeof channel.view.render == "function") {
	                var callback = dojo.hitch(channel.view,channel.view.render);
	                channel = connection.subscribe(channel.channelName, callback);
	              } else {
	                console.log("View object for channel %s does not have a render method",
	                        channelName);
	              }
	            });
	        } else {
	        	console.log("{dynamicSubscribeChannel} subscribeToChannels");
	        	that.subscribeToChannels(channels, theView);
	        }

	      } catch (e){
	    	  console.log(e);
	      }
    },


    connectCallback : function(backendConnection, type) {
      if (type == "connect") {
        connection = backendConnection;
        this.connectFlag = true;
        var channelsArray = this.channelList;

        dojo.forEach(channelsArray,function(channel) {
            if (typeof channel.view.render == "function") {
              var callback = dojo.hitch(channel.view,channel.view.render);
              channel = connection.subscribe(channel.channelName, callback);
            } else {
              console.log("View object for channel %s does not have a render method",
                      channelName);
            }
          });

      }
    },

    connect : function(callerCallback) {
    	if(callerCallback !== null && callerCallback !== undefined){
	      dj.util.bluegrass.Runtime.openConnection( {to : this._cfg.toURL, via : this._cfg.viaURL }, callerCallback);
    	} else {
    		var channelObject = {channelList: this.channels};
    	    var callback = dojo.hitch(channelObject, this.connectCallback);
    	    dj.util.bluegrass.Runtime.openConnection( {to : this._cfg.toURL, via : this._cfg.viaURL }, callback);
    	}
    }

  });
dojo.provide("dj.widget.livenews.view.liveUpdateView");
dojo.require("dj.widget.livenews.view.baseLiveUpdateView");
dojo.require("dj.util.Region");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");

dojo
    .declare(
        "dj.widget.livenews.view.liveUpdateView",
        dj.widget.livenews.view.baseLiveUpdateView,
        {

          constructor : function(cfg) {
            this.DEFAULT_CONFIG = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
          },

          render : function(response, initialLoad) {
            var that = this;
            if (response !== undefined && response !== null) {
              if (response.length !== undefined) {
                // that.DEFAULT_CONFIG.nohCount = response.length -
                // that.DEFAULT_CONFIG.nosCount;
                var noOfElements = response.length;
                console.log(response.length);
                for ( var i = response.length - 1; i > -1; i--) {
                  that.populateData(response[i], initialLoad);
                }
              } else {
                that.populateData(response);
              }
            }
          },

          populateData : function(data, initialLoad) {

        	if ( (initialLoad === null || initialLoad === undefined || initialLoad !== "initialLoad") &&
        		  (data.b.y === null || data.b.y === undefined || data.b.y !== "normal") ){
			  return;
		    }

            var that = this;
            var channelName = data.h.t;
            var checkDuplicate = null;
            var outerId = "";

            var publishDate = "";
            var today = new Date();
            var innerEle;
            var deltaClass = "deltaType-noChange";
            var outerEle = null;
            var region = dj.util.Region.getViewByRegion();

            if (channelName !== null && channelName !== undefined) {
              for ( var ch = 0; ch < that.DEFAULT_CONFIG.multiArray.length; ch++) {
                if (channelName === that.DEFAULT_CONFIG.multiArray[ch][0]) {
                  outerEle = dojo.query(that.DEFAULT_CONFIG.multiArray[ch][1])[0];
                  outerId = that.DEFAULT_CONFIG.multiArray[ch][1];
                  break;
                }
              }
            }
            var articleFlag = false;
            var blogFlag = false;
            var tpu = '';

            try {
              if (data.b.tpu !== undefined && data.b.tpu !== null) {
                tpu = data.b.tpu;
              }
              if (tpu !== null && tpu !== '' && tpu.indexOf('http') === 0 && tpu.indexOf('blog') != -1) {
                blogFlag = true;
              }
            } catch (e) {
              console.error("Error while reteriving tpu: " + e);
            }

            if (data.b.ei !== null && data.b.ei !== '') {
              articleFlag = true;
            }

            if (outerEle !== null && outerEle !== undefined
                && (blogFlag === true || articleFlag === true)) {
              var sbNum = data.b.ei;
              sbNum = sbNum.substring(0, sbNum.indexOf("."));

              var liEle = document.createElement('li');
              liEle.setAttribute('id', outerId + "_liveArticle_" + sbNum);
              // liEle.setAttribute('class', 'firstList');
              dojo.addClass(liEle, "firstList");

              var h5Ele = document.createElement('h5');
              // h5Ele.setAttribute('class', 'timestamp');
              dojo.addClass(h5Ele, "timestamp");

              liEle.appendChild(h5Ele);

              var aEle = document.createElement('a');
              aEle.setAttribute('href', '#');
              liEle.appendChild(aEle);

              var h2Ele = document.createElement('h2');

              var a2Ele = document.createElement('a');
              a2Ele.appendChild(document.createTextNode(data.b.h));
              h2Ele.appendChild(a2Ele);
              liEle.appendChild(h2Ele);

              var pEle = document.createElement('p');

              var summary = data.b.a;
              if (summary.length > 250) {
                summary = summary.substring(0, 250);
                var limit = summary.lastIndexOf(" ");
                summary = summary.substring(0, limit) + "...";
              }

              // if (that.DEFAULT_CONFIG.nohCount <= 0) {
              pEle.appendChild(document.createTextNode(summary));
              // }
              // that.DEFAULT_CONFIG.nohCount = that.DEFAULT_CONFIG.nohCount -1;

              liEle.appendChild(pEle);

              /**
               * Start of Org pub date logic.
               */
              var blogDate = data.b.z;
              var printDate = true;
              if (blogDate !== undefined && blogDate !== null) {
                var blogIndex = blogDate.indexOf("(");
                blogDate = blogDate.substring(blogIndex + 1,
                    blogDate.length - 2);
                blogDate = parseInt(blogDate);
                publishDate = new Date(blogDate);
              } else {
                console.error("Blogs org-pub-date is null.");
                printDate = false;
              }

              var dateVal = "";
              var lPublishDate = "";

              try {
                if (printDate) {
                  dateVal = dojo.date.locale.format(publishDate, {
                    selector : "time",
                    timePattern : "h:mm a"
                  });

                  if (dateVal !== "") {

                    for ( var dateCount = 0; dateCount < that.DEFAULT_CONFIG.latestDateArray.length; dateCount++) {
                      if (outerId === that.DEFAULT_CONFIG.latestDateArray[dateCount][0]) {
                        var tempDate = that.DEFAULT_CONFIG.latestDateArray[dateCount][1];
                        if (tempDate === "" || tempDate === undefined || tempDate === null) {
                          that.DEFAULT_CONFIG.latestDateArray[dateCount][1] = publishDate;
                        } else if (tempDate.getTime() < publishDate.getTime()) {
                          that.DEFAULT_CONFIG.latestDateArray[dateCount][1] = publishDate;
                        }
                        break;
                      }
                    }

                    if (today.getDate() != publishDate.getDate()) {
                      dateVal = dojo.date.locale.format(publishDate, {
                        selector : "date",
                        datePattern : "MMM. dd, yyyy"
                      });
                    }
                    h5Ele.appendChild(document.createTextNode(dateVal));
                  }
                }

              } catch (e) {
                console.log("Error while calculating org pub date." + e);
              }
              /**
               * End of org pub date logic.
               */

              var channelsArr = [];
              if (blogFlag === true) {
                a2Ele.setAttribute('href', tpu + '?mod='
                    + that.DEFAULT_CONFIG.modMarkets);
              } else {
                a2Ele.setAttribute('href', dj.context.core.urlPrefix
                    + '/article/' + sbNum + '.html?mod='
                    + that.DEFAULT_CONFIG.modMarkets);
              }

              var blogUpdate = false;
              checkDuplicate = dojo.byId(outerId + "_liveArticle_" + sbNum);
              if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                blogUpdate = true;
              } else if (initialLoad !== null && initialLoad !== undefined
                  && initialLoad === "initialLoad") {
                if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                  outerEle
                      .removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                }

                if (outerEle.children.length == 0) {
                  outerEle.appendChild(liEle);
                } else {
                  outerEle.insertBefore(liEle, outerEle.children[0]);
                  // outerEle.children[1].removeAttribute('class', 'firstList');
                  dojo.removeClass(outerEle.children[1], "firstList");
                }
              }

              if (blogFlag === true) {

                try {

                  if (dateVal != null && dateVal !== undefined) {
                    var today = new Date();

                    if (initialLoad === null || initialLoad === undefined) {

                      if (outerEle.children.length == 0) {
                        outerEle.appendChild(liEle);
                      } else {
                        for ( var dateCount = 0; dateCount < that.DEFAULT_CONFIG.latestDateArray.length; dateCount++) {
                          if (outerId === that.DEFAULT_CONFIG.latestDateArray[dateCount][0]) {
                            lPublishDate = that.DEFAULT_CONFIG.latestDateArray[dateCount][1];
                            break;
                          }
                        }

                        checkDuplicate = dojo.byId(outerId + "_liveArticle_"
                            + sbNum);
                        if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                          blogUpdate = true;
                        } else if ((lPublishDate == null || lPublishDate == "")
                            || (lPublishDate.getTime() <= publishDate.getTime())) {
                          if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                            outerEle
                                .removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                          }

                          if (outerEle.children.length == 0) {
                            outerEle.appendChild(liEle);
                          } else {
                            outerEle.insertBefore(liEle, outerEle.children[0]);
                            // outerEle.children[1].removeAttribute('class',
                            // 'firstList');
                            dojo.removeClass(outerEle.children[1], "firstList");
                          }
                        } else {
                          console.log("Old blog");
                        }

                      }
                    }

                  }
                } catch (dateErr) {
                  console.log("Date Parsing Error: " + dateErr);
                }

                if (blogUpdate === true) {
                  try {
                    checkDuplicate.innerHTML = liEle.innerHTML;
                    if (outerEle.children[1] != null
                        && outerEle.children[1] != undefined) {
                      // outerEle.children[1].removeAttribute('class',
                      // 'firstList');
                      dojo.removeClass(outerEle.children[1], "firstList");
                    }
                  } catch (err) {
                    console.log("Error while updating edited blog : " + err);
                  }
                }

                return;

              }// End blog's Ajax call.

              try {
                dojo
                    .xhrGet( {
                      url : '/public/page/NA_WSJ_PUB:0_0_WG_Live_Market_News-'
                          + sbNum + '.html',
                      preventCache : true,
                      load : function(data, xhr) {
                        data = data.replace('<div class="fullwide">', '');
                        data = data.replace('</div>', '');

                        var start = data.indexOf("<!--");
                        while (start > 0) {
                          var stringObj = data;
                          var end = data.indexOf("-->");
                          data = data.substring(0, start);
                          stringObj = stringObj.substring(end + 3);
                          data = data + stringObj;
                          start = data.indexOf("<!--");
                        }// While

                        var jsonObj = null;
                        try {
                          jsonObj = dojo.fromJson(data);
                        } catch (jsonExp) {
                          console.log("{liveUpdateView }error parsing JSON: "
                              + jsonExp);
                          jsonObj = null;
                          return;
                        }

                        if (jsonObj !== null
                            && jsonObj.Summary.article !== 'notFound') {

                          var ulEle2 = document.createElement('ul');
                          // ulEle2.setAttribute('class', 'marketTickerSymbol');
                          dojo.addClass(ulEle2, "marketTickerSymbol");

                          try {

                            if ((initialLoad === null || initialLoad === undefined)
                                && (null === checkDuplicate || typeof checkDuplicate === 'undefined')) {

                              if (outerEle.children.length == 0) {
                                outerEle.appendChild(liEle);
                              } else {
                                for ( var dateCount = 0; dateCount < that.DEFAULT_CONFIG.latestDateArray.length; dateCount++) {
                                  if (outerId === that.DEFAULT_CONFIG.latestDateArray[dateCount][0]) {
                                    lPublishDate = that.DEFAULT_CONFIG.latestDateArray[dateCount][1];
                                    break;
                                  }
                                }

                                checkDuplicate = dojo.byId(outerId
                                    + "_liveArticle_" + sbNum);
                                if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                                  try {
                                    checkDuplicate.innerHTML = liEle.innerHTML;
                                    if (outerEle.children[1] != null
                                        && outerEle.children[1] != undefined) {
                                      // outerEle.children[1].removeAttribute('class',
                                      // 'firstList');
                                      dojo.removeClass(outerEle.children[1],
                                          "firstList");
                                    }
                                  } catch (err) {
                                    console
                                        .log("Error while updating edited story in inner block: "
                                            + err);
                                  }
                                } else if ((lPublishDate == null || lPublishDate == "")
                                    || (lPublishDate.getTime() <= publishDate
                                        .getTime())) {
                                  if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                                    outerEle
                                        .removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                                  }

                                  if (outerEle.children.length == 0) {
                                    outerEle.appendChild(liEle);
                                  } else {
                                    outerEle.insertBefore(liEle,
                                        outerEle.children[0]);
                                    // outerEle.children[1].removeAttribute('class',
                                    // 'firstList');
                                    dojo.removeClass(outerEle.children[1],
                                        "firstList");
                                    /**** remove 20th element *******/
                                    try {
                                    	dojo.destroy(outerEle.children[20])
                                    }
                                    catch (err){
                                    	console.log("List has less than 20 elements");
                                    }
                                    /***** end****/
                                  }
                                } else {
                                  console.log("Old article");
                                  return;
                                }

                              }
                            }

                          } catch (err) {
                            console.log("Error Parsing jsonObj: " + err);
                          }

                          if (jsonObj.Summary.image != undefined
                              && jsonObj.Summary.image != "") {

                            var wrapperDiv = document.createElement('div');
                            if(that.DEFAULT_CONFIG.wrapperImgClass != null && that.DEFAULT_CONFIG.wrapperImgClass != undefined) {
                            	wrapperDiv.setAttribute('class', that.DEFAULT_CONFIG.wrapperImgClass);
                            } else {
                            	wrapperDiv.setAttribute('class', 'newsImage newsImage-A');
                            }

                            var imgEle = document.createElement('img');
                            imgEle.setAttribute('alt', 'image');
                            imgEle.setAttribute('src',
                                'http://si.wsj.net/public/resources/images/'
                                    + jsonObj.Summary.image);
                            aEle.setAttribute('href', dj.context.core.urlPrefix
                                + '/article/' + sbNum + '.html?mod='
                                + that.DEFAULT_CONFIG.modMarkets);

                            wrapperDiv.appendChild(imgEle);
                            aEle.appendChild(wrapperDiv);

                          }

                          for ( var count = 0; count < jsonObj.Summary.tickers.length; count++) {
                            if (jsonObj.Summary.tickers[count].name != undefined) {
                              var liEle2 = document.createElement('li');
                              liEle2.setAttribute('id', 'live_market_stocks');
                              // liEle2.setAttribute('class',
                              // 'bluegrass_channel');
                              dojo.addClass(liEle2, "bluegrass_channel");
                              liEle2.setAttribute('data-bluegrass-channel',
                                  jsonObj.Summary.tickers[count].bgChannel);
                              channelsArr
                                  .push(jsonObj.Summary.tickers[count].bgChannel);

                              var spanEle = document.createElement('span');
                              // spanEle.setAttribute('class', 'info_sym');
                              dojo.addClass(spanEle, "info_sym");
                              var spanEle2 = document.createElement('span');
                              // spanEle2.setAttribute('class', 'info_sym_com');
                              dojo.addClass(spanEle2, "info_sym_com");

                              var aTic = document.createElement('a');
                              var tickerSymbol = jsonObj.Summary.tickers[count].name;
                              var countryCode = jsonObj.Summary.tickers[count].company;
                              if (countryCode !== undefined
                                  && countryCode !== "") {
                                tickerSymbol = countryCode + "/" + tickerSymbol;
                              }
                              aTic.setAttribute('href',
                                  dj.context.core.urlPrefix
                                      + '/public/quotes/main.html?symbol='
                                      + tickerSymbol);
                              spanEle2.appendChild(aTic);

                              var spanEle3 = document.createElement('span');
                              // spanEle3.setAttribute('class',
                              // 'info_sym_exchange');
                              dojo.addClass(spanEle3, "info_sym_exchange");

                              var aTictext = document
                                  .createTextNode(jsonObj.Summary.tickers[count].name);
                              aTic.appendChild(aTictext);
                              var spantext2 = document.createTextNode(' ('
                                  + jsonObj.Summary.tickers[count].exchange
                                  + ')');
                              spanEle3.appendChild(spantext2);

                              spanEle.appendChild(spanEle2);
                              spanEle.appendChild(spanEle3);

                              var spanEle4 = document.createElement('span');
                              // spanEle4.setAttribute('class',
                              // 'info_valueContainer');
                              dojo.addClass(spanEle4, "info_valueContainer");

                              var spanEle5 = document.createElement('span');
                              // spanEle5.setAttribute('class', 'info_price');
                              dojo.addClass(spanEle5, "info_price");
                              var supEle = document.createElement('sup');
                              // supEle.setAttribute('class', 'cursym');
                              dojo.addClass(supEle, "cursym");
                              var currency = null;
                              try {
                                currency = jsonObj.Summary.tickers[count].iso;
                                if (currency === undefined || currency === null
                                    || currency === "") {
                                  currency = '$';
                                }
                              } catch (currErr) {
                                currency = '$';
                                console.log("Couldn't find the currency");
                              }
                              /*
                               * var cursymtext = document.createTextNode("
                               * "+currency); supEle.appendChild(cursymtext);
                               */
                              supEle.innerHTML = " " + currency;
                              spanEle5.appendChild(supEle);

                              var spanEle6 = document.createElement('span');
                              // spanEle6.setAttribute('class', 'int');
                              dojo.addClass(spanEle6, "int");
                              var spantext6 = document
                                  .createTextNode(jsonObj.Summary.tickers[count].price
                                      + ' ');
                              spanEle6.appendChild(spantext6);
                              spanEle5.appendChild(spanEle6);
                              spanEle4.appendChild(spanEle5);

                              var spanEle7 = document.createElement('span');
                              var netChange = jsonObj.Summary.tickers[count].netChange;
                              var deltaClass = 'deltaType-positive';
                              var sign = '+';
                              if (netChange < 0) {
                                deltaClass = 'deltaType-negative';
                                sign = '';
                              }
                              // spanEle7.setAttribute('class', 'marketDelta
                              // '+deltaClass);
                              dojo.addClass(spanEle7, 'marketDelta '
                                  + deltaClass);
                              var spanEle7text = document.createTextNode(sign + netChange + ' (' + sign + jsonObj.Summary.tickers[count].changePercent + '%) ');
                              spanEle7.appendChild(spanEle7text);
                              spanEle4.appendChild(spanEle7);

                              liEle2.appendChild(spanEle);
                              liEle2.appendChild(spanEle4);

                              ulEle2.appendChild(liEle2);
                            }
                          }

                          liEle.appendChild(ulEle2);

                          if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                            try {
                              checkDuplicate.innerHTML = liEle.innerHTML;
                              if (outerEle.children[1] != null
                                  && outerEle.children[1] != undefined) {
                                // outerEle.children[1].removeAttribute('class',
                                // 'firstList');
                                dojo.removeClass(outerEle.children[1],
                                    "firstList");
                              }
                            } catch (err) {
                              console
                                  .log("Error while updating rest of edited story: "
                                      + err);
                            }
                          }

                        } // jsonObj If
                        else {
                          console.error('Article not found: ' + sbNum);
                          return;
                        }
                        that.DEFAULT_CONFIG.context
                            .bluegrassSubscribeChannel(channelsArr);
                      }

                    });

              } catch (error) {
                console.log("Error: " + error);
              }
            }// If Tag

          }

        });
dojo.provide("dj.widget.livenews.view.liveUpdateChartsView");
dojo.require("dj.widget.livenews.view.baseLiveUpdateView");
dojo.require("dj.util.Region");
dojo.require("dj.module.marketdata.chart");
dojo.require("dj.util.excanvas");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");

dojo.declare("dj.widget.livenews.view.liveUpdateChartsView", dj.widget.livenews.view.baseLiveUpdateView,
{
  constructor : function(cfg) {
    this.DEFAULT_CONFIG = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
    this.SmartQuotesChartStyle = {
        background : "#ffffff",
        border : "#C4C4C4",
        closelineStyle : "rgba(196,196,196,0.5)",
        horizontalGridLineStyle : "rgba(196,196,196,0.5)",
        highIndicatorStyle : "rgba(196,196,196,0.5)",
        highlowLineStyle : "rgba(196,196,196,0.5)",
        lowIndicatorStyle : "rgba(196,196,196,0.5)",
        mainLineStyle : "#4B4B4B",
        mainPriceLineFill : "#FFFFFF",
        mainPriceLineWidth : 2,
        yAxisLabelPadding : -174,
        maxPriceLines : 4,
        verticalGridLineStyle : "rgba(196,196,196,0.5)",
        verticalGridLineStyle_Opaque : "rgba(196,196,196,1.0)",
        vPadding : 12,
        YAxisLabelStyle : 1, //High Low Price Close = 1
        YAxisLabelHeight : 12,
        showDecimals : 1,
        regionStyles : {
          0 : '#cde2e0', // Premarket
          1 : '#cde2e0', //Postmarket
          2 : 'rgba(51,51,51,0.06)'//Intersession
        },
        comparelineStyles : {
          0 : '#cc3333', //Strong red:
          1 : '#3b8dad', //Strong blue:
          2 : '#c9932e', //Strong yellow
          3 : '#b78383', //Weak red:
          4 : '#8eb3bc', //Weak blue:
          5 : '#dbb782' //Weak yellow:
        }
      };
    if(dojo.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                   '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                   '#default#VML');
      }
    }
  },

  render : function(response, pos) {
    if (response !== undefined && response !== null) {
      if (response.length !== undefined) {
    	  console.log(response.length);
    	  for(var i = response.length-1; i > -1; i--) {
          var position = 0;
          if(pos !== undefined && pos[i] !== undefined) {
        	  position = pos[i];
          }
          this.populateCharts(response[i], position );
        }
      } else {
        this.populateCharts(response);
      }
    }
  },

  populateCharts : function(data, position) {
    var that = this;
    var pos = position;
    var content = null;
    var channelName = null;
    var action = null;
    var item = null;
    var checkDuplicate = null;

    if(pos !== undefined && pos !== null){
    	content = data.a;
        channelName = that.DEFAULT_CONFIG.chartMultiArray[0][0];
        action = 1;
        item = data.a.ID;
    }else {
    	content = data.b.r.a;
        channelName = data.h.t;
        action = (data.b.r.o) ? data.b.r.o : 1;
        item = (data.b.r.p) ? data.b.r.p : 0;
    }

    var chartTimeDelay = 1800000;
    try{
    	chartTimeDelay = that.DEFAULT_CONFIG.chartTimeDelay;
    } catch(e) {
    	console.error("chartTimeDelay is undefined" + e);
    }

    if (null === content || typeof content === 'undefined') {
      console.error("{liveUpdateChartsView} - Error receiving data from Bluegrass[Blogs]");
      return;
    }

    try {
      if(typeof content != 'object') {
        content = dojo.fromJson(content);
      }
    } catch (e) {
      console.error("{liveUpdateChartsView} - Error parsing jsonObject : " + content);
    }
    var itemID = (item === 0) ? content.ID : item;
    itemID = "liveChart_" + itemID;

    var ticker = content.postmeta.article_quote;
    var tickerCountry = "";
    var tickerArray = null;
    try {
	    tickerArray = ticker.split(':');
	    if(tickerArray.length > 1) {
	      tickerCountry = tickerArray[0];
	      ticker = tickerArray[1];
	      ticker = ticker.toUpperCase();
	      tickerCountry = tickerCountry.toUpperCase();
	    } else {
	    	ticker = ticker.toUpperCase();
	    }

    } catch(exp){
    	ticker = ticker.toUpperCase();
    	console.log("Error while parsing ticker" + exp);
    }

    var deltaClass = "deltaType-noChange";
    var outerEle = null;
    var selectedId = null;

    for ( var ch = 0; ch < that.DEFAULT_CONFIG.chartMultiArray.length; ch++) {
      if (channelName === that.DEFAULT_CONFIG.chartMultiArray[ch][0]) {
        outerEle = dojo.query(that.DEFAULT_CONFIG.chartMultiArray[ch][1])[0];
        break;
      }
    }

    if (action == that.actions.DELETE) {
		try{
	      dojo.destroy(itemID);
	      if (outerEle !== null && outerEle !== undefined) {
		      var nextItem = outerEle.children[0];
		      if(nextItem !== null && nextItem !== undefined){
		      	dojo.addClass(nextItem, "firstList");
		      }
	      }
		}catch(err){
			console.log("Error while deleting: "+err);
		}
		return;
    }

    if (action == that.actions.INSERT) {
		try{
		  checkDuplicate =  dojo.byId(itemID);
		  if(!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
			  return;
		  }
		}catch(err){
			console.log("Error while checking Duplicate blogs: "+err);
		}
    }

    if (outerEle !== null && outerEle !== undefined) {
      var main = "";
      try {
        dojo.xhrGet({
          url : '/public/page/NA_WSJ_PUB:0_0_WG_Live_Charts-' + ticker + '-'+tickerCountry+ '.html',
          preventCache: true,
          load : function(loadData, xhr){

            var region = dj.util.Region.getViewByRegion();
            var start = loadData.indexOf("<!--");
            while (start > 0) {
              var stringObj = loadData;
              var end = loadData.indexOf("-->");
              loadData = loadData.substring(0, start);
              stringObj = stringObj.substring(end + 3);
              loadData = loadData + stringObj;
              start = loadData.indexOf("<!--");
            }// While

            var indexVal = loadData.indexOf('BGInfo');
            var channelsArr = [];
            var articleData = "";

            if(indexVal > 0)
            {
            	channelsArr.push(loadData.substring(0, indexVal));
            	articleData = loadData.substring(indexVal + 6);
            } else {
            	articleData = loadData.trim();
            }

            var dateVal = "";
        	 if(typeof content.post_date_gmt != 'undefined') {
        		 try{
        			 var pubDate = content.post_date_gmt;
        			 var displayDate = new Date();
        			 var fullDateParts = pubDate.split("+");
        			 if(fullDateParts.length == 2) {
        			   var dateParts = fullDateParts[0].split("-");
        			   var timeParts = fullDateParts[1].split(":");
        			   if(dateParts.length == 3 && timeParts.length == 3) {
        			     var utcDate = Date.UTC(dateParts[0],parseInt(dateParts[1])-1,dateParts[2],timeParts[0],timeParts[1],timeParts[2]);
        			     displayDate = new Date(utcDate);
        			   }
        			 }

	        		 dateVal = dojo.date.locale.format(displayDate, {selector:"time", timePattern:"h:mm a"});

	        		 if(dateVal != null && dateVal !== "") {
	        		    var today = new Date();
	        		    var todayTime = today.getTime();
	        		    var displayTime = displayDate.getTime();
	     		        if(todayTime - displayTime  > chartTimeDelay){
	     		        	 return;
	     		        }
	        		 }
        		 }catch(dateErr){
        			 console.log("Date Parsing Error: "+dateErr);
        		 }
           }

            var main = '<h5 class="timestamp">' + dateVal + '</h5><h2>'
                + content.post_title.replace(/\+/g, " ")
                + '</h2><p>'
                + content.post_content.replace(/\+/g, " ") + '</p>';
            if (articleData !== null) {
              var chartContainer = "liveUpdateChart_" + ticker;
              articleData = main + '<div class="marketCharts">' + articleData;
              articleData += "<div class='chart_overview' id='"+ chartContainer +"'></div>";

              if(pos != null && pos != undefined)
        	  {
            	  if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                      outerEle.removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                   }

            	  var newClass = 'superDeco';
            	  if(pos == 0) {
            		  newClass = 'superDeco firstList';
            	  }
            	  var newItem = dojo.create("li", {
                      "class" : newClass,
                      "id" : itemID,
                      innerHTML : articleData
                    });

            	   if(dojo.isIE && pos > 0) {
            		   pos = pos -1;
            	   }
                   dojo.place(newItem, outerEle, pos);

                   if(pos == 0) {
	                   var nextItem = newItem.parentNode.children[1];
	                    if(nextItem !== null && nextItem !== undefined){
	                    	dojo.removeClass(nextItem, "firstList");
	                   }
                   }
        	  } else if ( action == that.actions.INSERT) {

    		    checkDuplicate =  dojo.byId(itemID);
    		    if(null === checkDuplicate || typeof checkDuplicate === 'undefined') {
    		    	console.log("inserting...");
	                if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
	                  outerEle.removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
	                }

	                var newItem = dojo.create("li", {
	                  "class" : "superDeco firstList",
	                  "id" : itemID,
	                  innerHTML : articleData
	                }, outerEle, "first");

	                var nextItem = newItem.parentNode.children[1];
	                if(nextItem !== null && nextItem !== undefined){
	                	dojo.removeClass(nextItem, "firstList");
	                }
    		    }

              } else if (action == that.actions.UPDATE) {
                var updatedPost = dojo.byId(itemID);
                if (null !== updatedPost
                    && typeof updatedPost !== 'undefined') {
                  updatedPost.innerHTML = articleData;
                } else {
                  if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                    outerEle.removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                  }

                  var newItem = dojo.create("li", {
                    "class" : "superDeco firstList",
                    "id" : itemID,
                    innerHTML : articleData
                  }, outerEle, "first");

                  var nextItem = newItem.parentNode.children[1];
                  if(nextItem !== null && nextItem !== undefined){
                  	dojo.removeClass(nextItem, "firstList");
                  }
                }
              }

              if(channelsArr.length > 0) {
                that.DEFAULT_CONFIG.context.bluegrassSubscribeChannel(channelsArr);
              }
            } else {
              console.error('Article not found: ' + sbNum);
            }

            //Rendering chart
            that.renderChart(chartContainer, tickerCountry, ticker, that.SmartQuotesChartStyle);
          },

          error : function(error, ioArgs) {
            console.log("error while reteriving ticker info: " + error);
          }
        });
      } catch (error) {
        console.log("Error: " + error);
      }

    }

  },

  renderChart: function(chartContainer, tickerCountry, ticker, smartQuotesChartStyle) {
	var that = this;
	var tickerCountry = tickerCountry;
	var ticker = ticker;
	var smartQuotesChartStyle = smartQuotesChartStyle;

    try {
      dojo.xhrPost({
        url : '/thunderball/HistoricChartData.aspx',
        handleAs : 'json',
        load : function(response, xhr){
          var chartData = response;

          var stockchartChart = new EmbeddedChart(chartContainer, smartQuotesChartStyle,
              176, 51,"5dy", "5mi", null, null, chartData, tickerCountry+":"+ticker, '');

          var chartExists = stockchartChart.ShowChart();
        },
        content : {
          Symbol : tickerCountry + ":" + ticker,
          Width : 176,
          freq : "5mi",
          time : "5dy"
        },
        error : function(error, ioArgs) {
          console.error("Error on loading charts");
          console.log(error);
          console.log(ioArgs);
        }
      });
    } catch(e) {
      console.error("{liveUpdateChartsView - Error loading chart.");
    }
  }

});
dojo.provide("dj.module.liveupdate.liveUpdates");
dojo.require("dj.module.stockinnews.mrktProvider");
dojo.require("dj.widget.livenews.view.liveUpdateView");
dojo.require("dj.widget.livenews.view.liveUpdateChartsView");
dojo.require("dj.widget.livenews.view.mrktView");
dojo.require("dj.util.bluegrass");

dj.module.liveupdate.liveUpdates = {
	liveUpdateView : null,
	liveUpdateChartsView : null,
	marketView : null,
	multiArray : null,
	latestDateArray : null,
	chartMultiArray : null,
	channels: [],
	chartChannels: [],
	feedURL: [],
	blogsFeedURL:'',
	subscribedList: [],
	updateCount: 10,
//	nohCount: 0,
//	nosCount: 10,
	chartPosition: [1,4],
	calledFlag: false,
	channelJSON: {},
	modMarkets: 'WSJ_markets_liveupdate',
	chartTimeDelay: 1800000,

	init: function (_scope){
		var that = this;

		var channelCount = _scope.channelJSON.length;
		var chartChannelCount = _scope.chartContainerArr.length;

		that.channelJSON = _scope.channelJSON;
		that.chartChannels = _scope.chartChannelArr;
		that.feedURL.push(that.channelJSON[0].blogsFeedURL);

		that.multiArray=new Array(channelCount);
		that.latestDateArray=new Array(channelCount);
		for (var i=0; i < channelCount ; i++) {
			that.multiArray[i]=new Array(2);
			that.latestDateArray[i]=new Array(2);
			that.channels.push(that.channelJSON[i].channelName);
			that.multiArray [i][0] = that.channelJSON[i].channelName;
			that.multiArray [i][1] = that.channelJSON[i].container;
			that.latestDateArray [i][0] = that.channelJSON[i].container;
			that.latestDateArray [i][1] = "";
		}

		that.chartMultiArray=new Array(chartChannelCount);
		for (var J=0; J < chartChannelCount ; J++) {
			that.chartMultiArray[J]=new Array(2);
			that.chartMultiArray [J][0] = that.chartChannels[J];
			that.chartMultiArray [J][1] = _scope.chartContainerArr[J];
		}

		if(_scope.updateCount !== undefined) {
			that.updateCount = _scope.updateCount;
		}

	    /*if(_scope.nohCount !== undefined) {
	      that.nohCount = _scope.nohCount;
	    }

	    if(_scope.nosCount !== undefined) {
	      that.nosCount = _scope.nosCount;
	    }*/


		that.blogsFeedURL = _scope.blogsFeedURL;
		if(_scope.chartPosition !== undefined) {
			that.chartPosition = _scope.chartPosition;
		}

		if(_scope.modMarkets !== undefined) {
			that.modMarkets = _scope.modMarkets;
		}
		if(_scope.chartTimeDelay !== undefined) {
			that.chartTimeDelay = _scope.chartTimeDelay;
		}

		if(!dj.context.marketdata.bluegrassProvider){
			dj.context.marketdata.bluegrassProvider = new dj.module.stockinnews.mrktProvider({});
		}

		that.liveUpdateChartsView = new dj.widget.livenews.view.liveUpdateChartsView({chartMultiArray: that.chartMultiArray, updateCount : that.updateCount, chartTimeDelay: that.chartTimeDelay, context: that});

//		that.liveUpdateView = new dj.widget.livenews.view.liveUpdateView({multiArray: that.multiArray, updateCount : that.updateCount, nohCount : that.nohCount, nosCount : that.nosCount, context: that, modMarkets: that.modMarkets, latestDateArray: that.latestDateArray});
		that.liveUpdateView = new dj.widget.livenews.view.liveUpdateView({multiArray: that.multiArray, updateCount : that.updateCount, context: that, modMarkets: that.modMarkets, latestDateArray: that.latestDateArray});

		that.marketView = new dj.widget.livenews.view.mrktView({});

		var connection = dj.util.bluegrass.Runtime.getConnection();
	    if (connection === null || connection === undefined) {
	    	dj.context.marketdata.bluegrassProvider.connect();
	    }
		that.populateModules();

	},

	bluegrassSubscribeChannel: function(tickerChannels, viewComp){
		try{
			var that = this;
			var dynamicChannels = [];
			var channelView = null;

			if(viewComp !== null && viewComp !== undefined) {
				channelView = viewComp;
			} else {
				channelView = that.marketView;
			}

			dojo.forEach(tickerChannels, function(tChannel) {
				if(dojo.indexOf(that.subscribedList, tChannel)  === -1) {
					dynamicChannels.push({
				          channelName : tChannel,
				          view : channelView
			        });
					that.subscribedList.push(tChannel);
				}
			});

			if(dynamicChannels.length > 0) {
				dj.context.marketdata.bluegrassProvider.dynamicSubscribeChannel(dynamicChannels, channelView, tickerChannels);
			}

		}catch(e){
			console.log("Error: " + e);

		}
	},

	populateModules: function(feedINFO){
		var that = this;

		var feed_url = that.feedURL;
		if(feedINFO !== null && feedINFO !== undefined && feedINFO !== ""){
			feed_url = feedINFO;
		}
		dojo.forEach(feed_url, function(feedUrl) {
			dojo.xhrGet({
				 url: feedUrl,
				 handleAs: "json",
			     load: function(data, xhr){
					that.liveUpdateView.render(data, "initialLoad");
					if(that.calledFlag == false){
						that.calledFlag = true;
						that.populateBlogs();
					}
		     	 },
		     	 error: function(error, ioArgs) {
		     		if(that.calledFlag == false){
		     			that.calledFlag = true;
		     			that.populateBlogs();
		     		}
		             console.log(error);
		         }

			});

		});

	},

	populateBlogs: function(){
		var that = this;
			dojo.xhrGet({
				 url: that.blogsFeedURL,
				 handleAs: "text",
			     load: function(response, xhr){
					try{
						var cleanData = response.substring(response.indexOf("<return>") + 8);
				        cleanData = cleanData.substring(0, cleanData.indexOf("</return>"));
				        cleanData = cleanData.replace(/&lt;/g,"<");
				        cleanData = cleanData.replace(/&amp;#/g,"&#");
				        var blogsData = dojo.fromJson(cleanData);
						that.liveUpdateChartsView.render(blogsData, that.chartPosition);
					} catch(err) {
						console.log("populateBlogs: "+err);
					}
					that.bluegrassSubscribeChannel(that.channels, that.liveUpdateView);
					that.bluegrassSubscribeChannel(that.chartChannels, that.liveUpdateChartsView);
		     	 },
		     	 error: function(error, ioArgs) {
		             console.error("{populateBlogs}: "+error);
		             that.bluegrassSubscribeChannel(that.channels, that.liveUpdateView);
		     		 that.bluegrassSubscribeChannel(that.chartChannels, that.liveUpdateChartsView);
		         }

			});

	},

	populateInitialLoad: function(objId) {
		that = this;
		var feedurl = [];
		if(objId  !== null && objId  !== undefined) {
			for (var i=0; i < that.channelJSON.length ; i++) {
				if("#"+objId === that.channelJSON[i].container) {
					var container = dojo.query("#"+objId)[0];
					if(dojo.hasClass(container, 'notInitiallized'))
					{
						dojo.removeClass(container, "notInitiallized");
						feedurl.push(that.channelJSON[i].blogsFeedURL);
						that.populateModules(feedurl);
					}
					break;
				}
			}
		}
	 }

};

dojo.provide("dj.widget.entitlements.ClickTrack");dojo.declare("dj.widget.entitlements.ClickTrack",null,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._duc=dj.util.Cookie;},DEFAULT_CONFIG:{djCookieName:"DJCOOKIE",djSubCookieCountName:"GC",djSubCookieExpiryName:"GX",djCcookieGroupExpirationDays:90,referringDomain:["google.",".wsj.com/mobileConfig"],expirationInterval:"1d+",testReferrerMode:false},checkEntitlements:function(){var articleTrial=this.getTrialState();var articleFree=this.getFreeState();if(articleTrial&&!articleFree){if(this.isReferrerEntitled()||this._cfg.testReferrerMode){this.updateCountInformation();}}},getTrialState:function(){if(typeof isTrial=="undefined"){return false;}else{return isTrial===true||isTrial.toLowerCase()=="true";}},getFreeState:function(){if(typeof isReferrerArticleFree=="undefined"){if(typeof ArticleType=="undefined"){return true;}else{return ArticleType;}}else{return isReferrerArticleFree;}},updateCountInformation:function(){var expireCookieValue=this.getExpiryFromCookie();var now=new Date();if(expireCookieValue){var expireDate=new Date(expireCookieValue);if((expireDate-now)>0){this.updateCountCookie();}else{this.resetCountCookie();this.setExpiryCookie();}}else{this.resetCountCookie();this.setExpiryCookie();}},isReferrerEntitled:function(){if(this._cfg.testReferrerMode){return true;}
if(document.referrer){for(var ref=0;ref<this._cfg.referringDomain.length;ref++){if((document.referrer.indexOf(this._cfg.referringDomain[ref])>-1)){return true;}}}
return this._cfg.testReferrerMode;},getCountFromCookie:function(){var cookieCountValue=this._duc.getGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieCountName);if(typeof cookieCountValue=="undefined"){return 0;}else{try{return parseInt(cookieCountValue,10);}catch(e){return 0;}}},getExpiryFromCookie:function(){return this._duc.getGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieExpiryName);},updateCountCookie:function(){var count=1+this.getCountFromCookie();this._duc.setGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieCountName,count,this._cfg.djCcookieGroupExpirationDays);},resetCountCookie:function(){this._duc.setGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieCountName,1,this._cfg.djCcookieGroupExpirationDays);},setExpiryCookie:function(){var expiryDate=this._calcDate(this._cfg.expirationInterval);this._duc.setGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieExpiryName,expiryDate,this._cfg.djCcookieGroupExpirationDays);},_calcDate:function(D){var MS=this._calcMilliseconds(D),dO=new Date();dO.setTime((D.substring(D.length-1,D.length)=="+")?dO.getTime()+MS:dO.getTime()-MS);return dO.toGMTString();},_calcMilliseconds:function(D){var TD=D.substring(0,D.length-2),TC=D.substring(D.length-2,D.length-1).toLowerCase(),MS=0;MS=(TC=="m")?TD*((24*60*60*1000)*30):MS;MS=(TC=="d")?TD*(24*60*60*1000):MS;MS=(TC=="s")?TD*1000:MS;return MS;}});dojo.provide("dj.module.entitlements.googleClickTrack");dojo.require("dj.widget.entitlements.ClickTrack");dj.module.entitlements.googleClickTrack={init:function(cfg){this.widget=new dj.widget.entitlements.ClickTrack(cfg);this.widget.checkEntitlements();}};
dojo.provide("dj.module.mostPopular.newsReel")
dojo.require("dj.util.Region");dojo.require("dj.lang");dj.module.mostPopular.newsReel={init:function(args){this.defaultArgs={iframeDivId:"",iframeHeight:"103",mapping:{"na,us":"/public/page/NA_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html","asia":"/public/page/ASIA_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html","asia,india":"/public/page/ASIA_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html","europe":"/public/page/EUROPE_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html"}};try{dj.lang.deepMixin(this.defaultArgs,args);if(typeof this.defaultArgs.iframeDivId!='undefined'&&this.defaultArgs.iframeDivId!=""){var module=dojo.byId(this.defaultArgs.iframeDivId);var moduleIsVisible=!((module.style.display=="none")||(module.style.display==""));if(moduleIsVisible){this.render(this.defaultArgs.iframeDivId);}}}catch(error){console.log(error);}},render:function(iframeDivId){var wsjRegion=dj.util.Region.getViewByRegion();var srcURL="";if(typeof this.defaultArgs.mapping[wsjRegion]!='undefined'){srcURL=this.defaultArgs.mapping[wsjRegion];}
if(srcURL!=""){var ele1=document.getElementById(iframeDivId);if(ele1){ele1.src=srcURL;ele1.height=this.defaultArgs.iframeHeight;}}}};
dojo.provide("dj.module.subscribeBar");dojo.require("dj.util.User");dojo.require("dj.lang");dj.module.subscribeBar={init:function(userConfiguration){dojo.mixin(this.getConfiguration(),userConfiguration);this.subbarContainerObject=this.subbarContainerObject||dojo.byId(this.configuration.barId);this.subBarCloseObject=this.subBarCloseObject||dojo.byId(this.configuration.subBarCloseId);this.subBarToggleObject=this.subBarToggleObject||dojo.byId(this.configuration.subBarToggleId);if(this.shouldDisplay()){if(this.configuration.isMboxSession){this.addMboxSession();}
this.showBar();this.saveNewDisplayCount();this.addUiEvent();var me=this;if(this.configuration.autoClose){setTimeout(function(){me.closeBarWithAnimation();},me.configuration.autoCloseTime+me.configuration.animationDuration);}}},getConfiguration:function(){if(!this.configuration){this.configuration={userTypes:[],barId:"subscribeNowSmallBar",subBarCloseId:"subscribeNowMediumClose",subBarToggleId:"subscribeNowMediumToggle",subBarLinkClass:".js_subscribeNowMediumShopAndBuyLink",animationDuration:1200,useAnimation:true,animateClose:true,barOpenBottom:0,barCloseBottom:-32,barCloseSize:34,isMboxSession:false,closedStateClass:"state-closed",openStateClass:"state-open",sessionDisplayCount:1,cookieName:"subscribeNowSmallBarCookie",autoClose:false,autoCloseTime:8000};}
return this.configuration;},addUiEvent:function(){var me=this;if(this.subBarCloseObject){dojo.connect(this.subBarCloseObject,"click",null,function(ev){dojo.stopEvent(ev);me.closeBar();});}
if(this.subBarToggleObject){dojo.connect(this.subBarToggleObject,"click",null,function(ev){dojo.stopEvent(ev);me.toggleState();});}},addMbox:function(){console.log(this);if('undefined'!==typeof USER_TYPE){if(this.configuration.isArticlePage){mboxCreate(this.configuration.mboxLocation,"subscriberType="+USER_TYPE,"siteSection="+ARTICLE_SECTION,"articlePubDate="+PUB_DATE,"freeArticle="+FREE_ARTICLE,"articleType="+AT_VARS.articleType);}
else{mboxCreate(this.configuration.mboxLocation,"subscriberType="+USER_TYPE);}}
else{console.log("USER_TYPE is not defined, mbox for this location cannot be created:"+this.configuration.mboxLocation);}},addMboxSession:function(){var anchorNodes=dojo.query('a#'+this.configuration.subBarLinkClass);var sessionId=mboxFactoryDefault.getSessionId().getId();console.log("anchor nodes");console.log(anchorNodes);dojo.forEach(anchorNodes,function(anchorNode){var currentLink=dojo.attr(anchorNode,"href");if(currentLink){var parameterSeparator="?";if(currentLink.indexOf("?")>=0){parameterSeparator="&";}
var newLink=dojo.attr(anchorNode,"href")+parameterSeparator+"mboxSession="+sessionId;console.log(newLink);dojo.attr(anchorNode,"href",newLink);}});},showBar:function(){if(this.configuration.useAnimation){this.showBarWithAnimation();}
else{this.subbarContainerObject.style.bottom=this.configuration.barOpenBottom+'px';}},showBarWithAnimation:function(){this.setPreOpenState();var me=this;dojo.animateProperty({node:me.subbarContainerObject,duration:me.configuration.animationDuration,properties:{bottom:{end:0}}}).play();},closeBar:function(){if(this.configuration.useAnimation){this.closeBarWithAnimation();}
else{this.setClosedState();}},closeBarWithAnimation:function(){var me=this;dojo.animateProperty({node:me.subbarContainerObject,duration:me.configuration.animationDuration,properties:{bottom:{end:me.configuration.barCloseBottom+me.configuration.barCloseSize}}}).play();setTimeout(function(){me.setClosedState();},me.configuration.animationDuration);},setClosedState:function(){if(this.subbarContainerObject.style.bottom==((this.configuration.barCloseBottom+this.configuration.barCloseSize)+'px')){this.subbarContainerObject.style.bottom=this.configuration.barOpenBottom+'px';dojo.removeClass(this.subbarContainerObject,this.configuration.openStateClass);dojo.addClass(this.subbarContainerObject,this.configuration.closedStateClass);}
else{var me=this;setTimeout(function(){me.setClosedState();},10);}},setPreOpenState:function(){console.log(this.subbarContainerObject.style.bottom);if(this.subbarContainerObject.style.bottom!=(this.configuration.barCloseBottom+'px')){this.subbarContainerObject.style.bottom=(this.configuration.barCloseBottom+this.configuration.barCloseSize)+'px';}
dojo.removeClass(this.subbarContainerObject,this.configuration.closedStateClass);dojo.addClass(this.subbarContainerObject,this.configuration.openStateClass);},toggleState:function(){if(dojo.hasClass(this.subbarContainerObject,this.configuration.openStateClass)){this.closeBar();}
else{this.showBar();}},mboxInit:function(userConfiguration){dojo.mixin(this.getConfiguration(),userConfiguration);if(this.shouldDisplay()){if('function'!==typeof mboxCreate){console.log("loading mbox js");var d=dojo;d.require("dj.util.mbox");}
this.addMbox();}},shouldDisplay:function(){var displayBar=false;var displayForUser=false;var subscriptionTypeArray=dj.util.User.getSubscriptionType().results;console.log("Display for user types:"+this.configuration.userTypes.toString());console.log("User Subscription type:"+subscriptionTypeArray.toString());if(this.configuration.userTypes.length>0){for(var i=0;i<subscriptionTypeArray.length&&!displayForUser;i++){var subscriptionType=subscriptionTypeArray[i];if(subscriptionType){displayForUser=(dojo.indexOf(this.configuration.userTypes,subscriptionType.toUpperCase())>=0);}}}
else{displayForUser=true;}
displayBar=(displayForUser&&this.getNewDisplayCount()<=this.configuration.sessionDisplayCount);console.log("Display Bar:");console.log(displayBar);return displayBar;},saveNewDisplayCount:function(){document.cookie=this.configuration.cookieName+"="+this.getNewDisplayCount();},getNewDisplayCount:function(){if(!this.newDisplayCount){this.newDisplayCount=this.getCookie(this.configuration.cookieName);if(!this.newDisplayCount){this.newDisplayCount=1;}
else{this.newDisplayCount=parseInt(this.newDisplayCount,10)+1;}}
return this.newDisplayCount;},getCookie:function(Name){var search=Name+"=";var returnvalue="";if(document.cookie.length>0){offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.length;}
returnvalue=unescape(document.cookie.substring(offset,end));}}
return returnvalue;}};
dojo.provide("dj.module.article.snippet");dj.module.article.snippet={copyAndMove:function(userConfiguration){this.configuration={articleParagraphSelector:"div.article p",articleAdSelector:"#snippet_big_ad",startHTML:"",endHTML:"<p></p>",articleParagraphThreshold:4,underThreshold:1,overThreshold:2,articleAdPosition:"after",timeout:1000,modValues:["WSJiPhone_article_snippet","WSJiPad_article_snippet"],adZone:"WSJ_iOS_Snippet"};dojo.mixin(this.configuration,userConfiguration);var modValue=dj.util.Page.getQueryParam("mod");var articleFree=false;var articleTrial=false;if(typeof isFree!='undefined'){articleFree=isFree;}
if(typeof isTrial!='undefined'){articleTrial=isTrial;}
if(dojo.indexOf(this.configuration.modValues,modValue)!=-1&&(articleFree=="true"||articleTrial=="true")){var that=this;try{setTimeout(function(){that.doMove();},this.configuration.timeout);}catch(e){console.error(e);}}},doMove:function(){var ad=dojo.query(this.configuration.articleAdSelector)[0];var paragraphs=dojo.query(this.configuration.articleParagraphSelector);var adPosition=(paragraphs.length<this.configuration.articleParagraphThreshold)?this.configuration.underThreshold:this.configuration.overThreshold;var adHTML=ad.innerHTML;var indexOfZone=adHTML.indexOf("interactive.wsj.com/")+20;var html=adHTML.substring(0,indexOfZone)+this.configuration.adZone+adHTML.substring(adHTML.indexOf(";"));dojo.place(this.configuration.startHTML+html+this.configuration.endHTML,paragraphs[adPosition],this.configuration.articleAdPosition);}};
dojo.provide("dj.util.referralFinance");dojo.require("dj.util.Page");dj.util.referralFinance={getReferrar:function(args){this.defaultArgs={enginesMapping:"",tickerMapping:""};try{dj.lang.deepMixin(this.defaultArgs,args);var referrar_local="";if(document.referrer!==undefined&&document.referrer!==null&&document.referrer!==""){referrar_local=document.referrer;}
else
{var fixedTicker=dj.util.Page.getQueryParam("fixedTicker");if(fixedTicker!==""){return{engine:"DUMMY",ticker:fixedTicker};}}
if(referrar_local!=='')
{var searchEnginePattern=this.defaultArgs.enginesMapping;var queryEngine=referrar_local.match(searchEnginePattern);var queryArr=referrar_local.match(this.defaultArgs.tickerMapping[queryEngine]);var ticker=queryArr[1];var qEndIndex=queryArr[1].indexOf('&',0);if(qEndIndex!=-1)
{ticker=queryArr[1].substring(0,qEndIndex);}
if(ticker!==undefined&&ticker!==null){return{engine:queryEngine,ticker:ticker};}else if(queryEngine!==null&&queryEngine!==undefined&&(ticker===null||ticker===undefined)){return{engine:queryEngine,ticker:""};}}
else
{return{engine:"DUMMY",ticker:""};}}catch(error){console.log("{referralFinance} "+error);}}};dojo.provide("dj.util.renderChart");dojo.require("dj.module.marketdata.chart");dojo.require("dj.util.excanvas");dojo.require("dj.lang");dojo.require("dj.util.Element");var _djl=dj.lang;dojo.declare("dj.util.renderChart",null,{constructor:function(){this.SmartQuotesChartStyle={background:"#ffffff",border:"#C4C4C4",closelineStyle:"rgba(196,196,196,0.5)",horizontalGridLineStyle:"rgba(196,196,196,0.5)",highIndicatorStyle:"rgba(196,196,196,0.5)",highlowLineStyle:"rgba(196,196,196,0.5)",lowIndicatorStyle:"rgba(196,196,196,0.5)",mainLineStyle:"#4B4B4B",mainPriceLineFill:"#FFFFFF",mainPriceLineWidth:2,yAxisLabelPadding:-218,maxPriceLines:4,verticalGridLineStyle:"rgba(196,196,196,0.5)",verticalGridLineStyle_Opaque:"rgba(196,196,196,1.0)",vPadding:14,YAxisLabelStyle:1,YAxisLabelHeight:12,showDecimals:1,regionStyles:{0:'#cde2e0',1:'#cde2e0',2:'rgba(51,51,51,0.06)'},comparelineStyles:{0:'#cc3333',1:'#3b8dad',2:'#c9932e',3:'#b78383',4:'#8eb3bc',5:'#dbb782'}};if(dojo.isIE){if(!document.namespaces.g_vml_){document.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!document.namespaces.g_o_){document.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}}},populateCharts:function(containerId,widthChart,heightChart){var that=this;var tickerCountry="US";var tickerObj=dojo.query("#tickerBasedModule");var tickerSymbol=dj.util.Element.getData(tickerObj[0],"ticker");var tickerArray=tickerSymbol.split(':');if(tickerArray.length>1){tickerCountry=tickerArray[0];tickerSymbol=tickerArray[1];}
else{tickerArray=tickerSymbol.split('/');if(tickerArray.length>1){tickerCountry=tickerArray[0];tickerSymbol=tickerArray[1];}}
tickerSymbol=tickerSymbol.toUpperCase();tickerCountry=tickerCountry.toUpperCase();try
{that.render(containerId,tickerCountry,tickerSymbol,that.SmartQuotesChartStyle,widthChart,heightChart);}
catch(error)
{console.log("{renderChart} error rendering the ticker-Chart");}},render:function(chartContainer,vTickerCountry,vTicker,vSmartQuotesChartStyle,width,height){var that=this;var containerId=chartContainer;var tickerCountry=vTickerCountry;var ticker=vTicker;var smartQuotesChartStyle=vSmartQuotesChartStyle;try{dojo.xhrPost({url:'/thunderball/HistoricChartData.aspx',handleAs:'json',load:function(response,xhr){var chartData=response;var stockchartChart=new EmbeddedChart(containerId,smartQuotesChartStyle,width,height,"5dy","5mi",null,null,chartData,tickerCountry+":"+ticker,'');var chartExists=stockchartChart.ShowChart();},content:{Symbol:tickerCountry+":"+ticker,Width:width,freq:"5mi",time:"5dy"},error:function(error,ioArgs){console.error("{renderChart} Error on loading charts");console.log(error);console.log(ioArgs);}});}catch(e){console.error("{renderChart} - Error loading chart.");}}});dojo.provide("dj.module.article.tickerBasedArticleModule");dojo.require("dj.util.referralFinance");dojo.require("dj.util.renderChart");dojo.require("dj.util.Element");dj.module.article.tickerBasedArticleModule={init:function(args){try{this.defaultArgs={targetId:"TestingVar",recipeAttributeName:"recipe",enginesMapping:"finance.yahoo|money.msn|marketwatch|barrons|smartmoney",tickerMapping:{"finance.yahoo":/.*s=(\w*)/i,"money.msn":/.*symbol=(\w*)/i,"marketwatch":/.*stock\/(\w*)/i,"barrons":/.*com\/(\w*)/i,"smartmoney":/.*quote\/(\w*)/i},moduleType:"",moduleClass:"",placeholderPositon:0,articleId:"",renderChart:false,chartDivId:"",moduleBasePrefix:"Module-",moduleChartPrefix:"Chart_Module-",moduleNoChartPrefix:"NoChart_Module-",moduleSearchBasedUrlPrefix:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_TickerSearch_",moduleFirstTickerUrlPrefix:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_TickerFirst_",moduleStocksInNewsFirstTickerUrlPrefix:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_StocksInNews_",moduleArticleTickersURL:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_Tickers_Module-",renderNews:false,widthChart:219,tickerHiddenId:"ticker_value",heightChart:111};dojo.mixin(this.defaultArgs,args);var recipe=this.getRecipe().toLowerCase();if(recipe=='a'||recipe=='b'){if(recipe=='a'){this.defaultArgs.renderChart=true;}
else{this.defaultArgs.renderChart=false;}
this.post_init();}}catch(error){console.log("{tickerBasedArticleModule} "+error);}},post_init:function(args){try{var tickerChart=null;var referralArgs={enginesMapping:this.defaultArgs.enginesMapping,tickerMapping:this.defaultArgs.tickerMapping};if(typeof this.defaultArgs.moduleType!=='undefined'&&this.defaultArgs.moduleType!=="")
{var tickerHiddenDivId=dojo.byId(this.defaultArgs.tickerHiddenId);if(tickerHiddenDivId===undefined||tickerHiddenDivId===null){this.getTicker(referralArgs,this.defaultArgs.tickerHiddenId);}
var tickerObj=dojo.query("#"+this.defaultArgs.tickerHiddenId);var ticker=dj.util.Element.getData(tickerObj[0],"ticker");var searchEngine=dj.util.Element.getData(tickerObj[0],"engine");if(ticker!==''||searchEngine!=='')
{var result="";if(this.defaultArgs.renderNews===false)
{result=this.getInsetPlaceholder(this.defaultArgs.moduleType,this.defaultArgs.moduleClass,this.defaultArgs.placeholderPositon);}
else
{result="renderNews";}
if(result=="success"||result=="renderNews")
{if(this.defaultArgs.renderChart===true){tickerChartInstance=new dj.util.renderChart();}else{tickerChartInstance=null;}
var module=dojo.byId(this.defaultArgs.moduleType);var moduleIsVisible=!((dojo.hasClass(module,"hidden"))&&((module.style.display=="none")||(module.style.display==="")));if(moduleIsVisible)
{if(searchEngine!==''&&ticker===''){if(this.defaultArgs.renderNews===false)
{this.render(module,"",this.defaultArgs.articleId,this.defaultArgs.renderChart,tickerChartInstance,this.defaultArgs.chartDivId,this.defaultArgs.widthChart,this.defaultArgs.heightChart,this.defaultArgs.moduleFirstTickerUrlPrefix);}
else
{this.renderNews(module,"",this.defaultArgs.moduleFirstTickerUrl,this.defaultArgs.articleId);}
console.log("{tickerBasedArticleModule} Displayed the Ticker Based Module");}else if(searchEngine!==''){if(ticker&&ticker!==''){if(this.defaultArgs.renderNews===false)
{this.render(module,ticker,this.defaultArgs.articleId,this.defaultArgs.renderChart,tickerChartInstance,this.defaultArgs.chartDivId,this.defaultArgs.widthChart,this.defaultArgs.heightChart,this.defaultArgs.moduleSearchBasedUrlPrefix);}
else
{this.renderNews(module,ticker,this.defaultArgs.moduleSearchBasedUrlPrefix,this.defaultArgs.articleId);}}
else{this.render(module,"","",this.defaultArgs.renderChart,tickerChartInstance,this.defaultArgs.chartDivId,this.defaultArgs.widthChart,this.defaultArgs.heightChart,this.defaultArgs.moduleStocksInNewsFirstTickerUrlPrefix);}
console.log("{tickerBasedArticleModule} Displayed the Ticker Based Module");}}}}}}catch(error){console.log("{tickerBasedArticleModule} "+error);}},getRecipe:function(){try{this.targetObject=dojo.byId(this.defaultArgs.targetId);var recipe=dojo.attr(this.targetObject,this.defaultArgs.recipeAttributeName);return recipe;}catch(error){console.log("{tickerBasedArticleModule}Error in creating the placeholder for CR inset ");return"failure";}},getInsetPlaceholder:function(moduleType,moduleClass,position){try{dojo.create("div",{"id":moduleType,"class":moduleClass},dojo.query(".articlePage>p")[position],"after");void(0);return"success";}catch(error){console.log("{tickerBasedArticleModule}Error in creating the placeholder for CR inset ");return"failure";}},render:function(module,ticker,articleId,renderchart,tickerchartinstance,chartcontainer,widthChart,heightChart,URL){var urlChips='';var tickerSlashIndex=-1;var tickerDotIndex=-1;if(typeof ticker!=='undefined'&&ticker!==''){tickerSlashIndex=ticker.indexOf("/");if(tickerSlashIndex>-1){var tickerParts=ticker.split("/");var countryCode=tickerParts[0];var tickerSymbol=tickerParts[1];urlChips=urlChips+countryCode+"-"+tickerSymbol+"-"+articleId;}
else{tickerDotIndex=ticker.indexOf(".");if(tickerDotIndex>-1){var tickerParts=ticker.split(".");var countryCode=tickerParts[1];var tickerSymbol=tickerParts[0];urlChips=urlChips+countryCode+"-"+tickerSymbol+"-"+articleId;}
else{urlChips=urlChips+ticker+"-"+articleId+"-"+renderchart;}}}
else{if(typeof articleId!=='undefined'&&articleId!==''){urlChips=urlChips+articleId+"-"+renderchart;}
else{urlChips=urlChips+renderchart;}}
if(urlChips!=''){var coUrl='';var urlPrefix='';if(tickerSlashIndex==-1&&tickerDotIndex==-1){urlPrefix=this.defaultArgs.moduleBasePrefix;}
else{if(renderchart===true){urlPrefix=this.defaultArgs.moduleChartPrefix;}
else{urlPrefix=this.defaultArgs.moduleNoChartPrefix;}}
coUrl=URL+urlPrefix+urlChips+".html";dj.lang.xhrGet({url:coUrl,preventCache:true,handleAs:"text",load:function(response){module.innerHTML=response;console.log(" load response");if(renderchart===true&&tickerchartinstance!==null){try{tickerchartinstance.populateCharts(chartcontainer,widthChart,heightChart);}catch(error){console.log("{"+URL+"} Error in Populate Charts");}}},error:function(response){console.log("{"+URL+"} error response");module.innerHTML="";}});}},renderNews:function(module,ticker,URL,articleId){var urlChips='';if(typeof ticker!=='undefined'&&ticker!==''){urlChips=urlChips+ticker;}
else if(typeof ticker=='undefined'||ticker===''){urlChips=articleId+"-"+"renderNews";}
if(urlChips!=''){var urlPrefix=this.defaultArgs.moduleNoChartPrefix;coUrl=URL+urlPrefix+urlChips+".html";dj.lang.xhrGet({url:coUrl,preventCache:true,handleAs:"text",load:function(response){module.innerHTML=response;console.log("{"+URL+"} load response");},error:function(response){console.log("{"+URL+"} error response");module.innerHTML="";}});}},getArticleTickersFor:function(docId){var me=this;dojo.xhrGet({url:me.defaultArgs.moduleArticleTickersURL+docId+".html",sync:true,handleAs:'text',load:function(response,xhr){me.setArticleTickers(response);},headers:{'Content-Type':'text/html; charset=UTF-8'},error:function(error,ioArgs){me.setArticleTickers('[]');console.log(error);console.log(ioArgs);}});},setArticleTickers:function(tickersResponse){var commentIndex=tickersResponse.indexOf('<!-- fast');if(commentIndex>-1){this.articleTickers=dojo.fromJson(tickersResponse.substr(0,commentIndex));}
else{this.articleTickers=dojo.fromJson(tickersResponse);}},getTicker:function(referralArgs,tickerId)
{var queryObject=dj.util.referralFinance.getReferrar(referralArgs);try{if(typeof queryObject!='undefined'&&queryObject.engine!==''&&queryObject.ticker!=='')
{dojo.create("div",{"id":tickerId,"data-ticker":queryObject.ticker,"data-engine":queryObject.engine},dojo.query(".articlePage>p")[0],"after");}
else{this.getArticleTickersFor(this.defaultArgs.articleId)
if(this.articleTickers.length>=1){dojo.create("div",{"id":tickerId,"data-ticker":this.articleTickers[0].t,"data-engine":"DUMMY"},dojo.query(".articlePage>p")[0],"after");}
else{dojo.create("div",{"id":tickerId,"data-engine":"DUMMY"},dojo.query(".articlePage>p")[0],"after");}}
void(0);}
catch(e)
{console.log("{get ticker}error");}}};
dojo.provide("dj.module.mst.preview.decorator");dojo.require("dijit.Menu");dojo.require("dijit.MenuItem");dojo.require("dijit.form.DropDownButton");dojo.require("dijit.form.ToggleButton");dj.module.mst.preview.decorator={override:false,showMasks:true,init:function(){var hn=document.location.hostname;var domain=hn.substring(hn.substring(0,hn.lastIndexOf(".")).lastIndexOf(".")+1,hn.length);if(domain==="dowjones.net"){this.injectCSS("http://ajax.googleapis.com/ajax/libs/dojo/1.6/dijit/themes/tundra/tundra.css");dojo.addClass(dojo.body()," tundra ");if(window.parent!==window.self||this.override){var self=this;dojo.query("div[data-module-id]").forEach(function(node,index,arr){if(dojo.query("div[data-module-id]",node).length===0){dojo.connect(node,"onmouseenter",function(ev){self.placeMask(node);});}});dojo.query(".filteredNode").forEach(function(node,index,arr){dojo.style(node,"border","2px dashed black");dojo.style(node,"height","30px");dojo.style(node,"margin","5px 0px 5px 0px");dojo.style(node,"backgroundColor","#DCDCDC");dojo.style(node,"display","none");node.innerHTML="Name: "+node.getAttribute("data-module-name")+", Rank: "+node.getAttribute("data-module-rank")||"???";});var microPageToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:false,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:5px;",onChange:dojo.hitch(this,function(val){this.toggleMicroPageIncludes();}),label:"Show MicroPageIncludes"});var moduleToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:false,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:200px;",onChange:dojo.hitch(this,function(val){this.toggleFilteredNodes();}),label:"Show Hidden Modules"});var maskToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:true,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:380px;",onChange:dojo.hitch(this,function(val){this.toggleMask();}),label:"Show Module Highlight"});document.body.appendChild(microPageToggleButton.domNode);document.body.appendChild(moduleToggleButton.domNode);document.body.appendChild(maskToggleButton.domNode);}else{var button=new dijit.form.Button({label:"Edit in MST",id:"mstButton",style:"position:absolute;z-index:2000000;top:5px;left:5px;",onClick:function(){document.location.href="/CDSTools/MST/#!"+pID;}});document.body.appendChild(button.domNode);}}},toggleMicroPageIncludes:function(){dojo.query("div[data-module-name=MicroPageInclude]").forEach(function(node,index,arr){dojo.style(node,"border",dojo.style(node,"border")==="2px solid blue"?"0px":"2px solid blue");dojo.style(node,"padding",dojo.style(node,"padding")===2?"0px":"2px");});},toggleFilteredNodes:function(){dojo.query(".filteredNode").forEach(function(node,index,arr){dojo.style(node,"display",dojo.style(node,"display")==="none"?"":"none");});},injectCSS:function(url){var e=document.createElement("link");e.href=url;e.type="text/css";e.rel="stylesheet";e.media="screen";document.getElementsByTagName("head")[0].appendChild(e);},createDrop:function(){this.ele=dojo.create("div",{id:"mask",style:"background-image:url('/static_html_files/mstTool/mask.png');z-index:1000050;position:absolute;"},dojo.body(),"first");var menu=new dijit.Menu({id:"previewMenu",style:"display: none;z-index:1000100"});dojo.connect(menu,"onOpen",menu,function(){this._popupWrapper.style.zIndex="1000100";dojo.style("previewMenu","z-index","1000100");});var menuItem1=new dijit.MenuItem({label:"Edit",id:"previewMaskEdit",maskedElementId:"M565903",onClick:function(){window.parent.dj.util.mst.toolApi.jumpToNode(this.maskedElementId);}});menu.addChild(menuItem1);var menuItem2=new dijit.MenuItem({label:"Copy",onClick:function(){}});var menuItem3=new dijit.MenuItem({label:"Hide/Disable",onClick:function(){}});var button=new dijit.form.DropDownButton({label:"Options",dropDown:menu,id:"optionsButton"});this.ele.appendChild(button.domNode);dojo.create("p",{id:"maskText",style:"color:white;float:right;font-size:1.5em"},this.ele,"last");},placeMask:function(node){if(!this.showMasks){return true;}
var button=dijit.byId("optionsButton");if(!node&&this.ele){if(button){button.closeDropDown();}
dojo.style(this.ele,"display","none");return;}
var targetPos=dojo.position(node,true);if(!this.ele){this.createDrop();dojo.connect(this.ele,"onmouseleave",dojo.hitch(this,function(ev){if(ev.relatedTarget&&(ev.relatedTarget.id.indexOf("Menu")>-1||ev.relatedTarget.id.indexOf("previewMaskEdit")>-1)){return;}else{this.placeMask();}}));}
if(!dojo.hasClass(node,"filteredNode")){dojo.byId("maskText").innerHTML="Name: "+node.getAttribute("data-module-name")+", Rank: "+node.getAttribute("data-module-rank")||"???";}else{dojo.byId("maskText").innerHTML="";}
if(button){button.closeDropDown();}
dijit.byId("previewMaskEdit").maskedElementId="M"+dojo.attr(node,"data-module-id");dojo.style(this.ele,"display","");dojo.style(this.ele,"top",targetPos.y+"px");dojo.style(this.ele,"left",targetPos.x+"px");dojo.style(this.ele,"width",targetPos.w+"px");dojo.style(this.ele,"height",targetPos.h+"px");},toggleMask:function(){this.showMasks=this.showMasks?false:true;}};dojo.provide("dj.widget.geotargeting.moduleShow");
dojo.require("dj.util.Cookie");

dojo.declare("dj.widget.geotargeting.moduleShow", [], {
  constructor: function (conf) {
    // Default cfx
    this.cfx = {
    //   at : Austria, de: Germany, ch: Switzerland
      countries : ["at", "de", "ch"],
      country : "",
      moduleIds : ["gmHeadlines", "gmSingleHeadline"]
    };

    this.findCountry();
    this.moduleVisibleMaker();    
  },

  findCountry : function() {
    this.cfx.country = dj.util.Cookie.getGroupCookie('DJSESSION','country');
  },

  isInTargetCountries : function() {
    var countries = this.cfx.countries;
    for (var i=0; i<countries.length; i++)
    {
      if(countries[i] == this.cfx.country) {
        return true;
      }
    }
    return false;
  },

  moduleVisibleMaker : function() {
   
    var moduleIds = this.cfx.moduleIds;
    if (this.isInTargetCountries()){
      for (var i=0; i<moduleIds.length; i++)
      {
        if(dojo.query(moduleIds[i])) {
          classname = '.' + moduleIds[i];
          dojo.query(classname).forEach(function(node, index, arr){
            dojo.style(node, "display", "");
            dojo.style(node, "cursor", "pointer");
            dojo.connect(node, "onclick", function() {
              window.location.href = "http://www.wallstreetjournal.de";
             });
          });
        }
      }
    }
  }
  
});
dojo.provide("dj.module.geotargeting.germanyScrim");
dojo.require("dj.lang");
dojo.require("dj.util.Cookie");

dj.module.geotargeting.germanyScrim = {

  init : function(conf) {

    this.cfx = {
      countries : [ "at", "de", "ch" ],
      country : "",
      firstVisitTime : 0,
      lastVisitTime : 0,
      isVisitedOnce : "false",
      isClickedWSJDE : "false",
      isFirstTimeVisit : "false"
    };
    dj.lang.mixin(this.cfx, conf);
    this.findCountry();
    this.isInTargetCountries();
    if (dj.util.Cookie.getGroupCookie('DJSESSION', 'isClickedWSJDE')) {
      this.cfx.isClickedWSJDE = "true";
    }
    if ((this.isInTargetCountries() == "true") && (this.cfx.isClickedWSJDE == "false")) {
      if (!dj.util.Cookie.getGroupCookie('DJSESSION', 'isVisitedOnce')) { 
        this.setCookieDataForFirstVisit();
      }
      this.getCookieData();
      this.onLoadHomePage();
      this.onWSJDEClick();
      this.onNoThanksClick();
      this.onCloseButtonClick();
    }
  },

  findCountry : function() {
    this.cfx.country = dj.util.Cookie.getGroupCookie('DJSESSION', 'country');
  },

  isInTargetCountries : function() {
    var countries = this.cfx.countries;
    for ( var i = 0; i < countries.length; i++) {
      if (countries[i] == this.cfx.country) {
        return "true";
      }
    }
    return "false";
  },

  setCookieDataForFirstVisit : function() {
    currentVisit = new Date();
    visitTime = currentVisit.getTime();
    dj.util.Cookie.setGroupCookie('DJSESSION', 'isVisitedOnce', "true", 730);
    dj.util.Cookie.setGroupCookie('DJSESSION', 'firstVisitTime', visitTime, 28);
    dj.util.Cookie.setGroupCookie('DJSESSION', 'lastVisitTime', visitTime, 28);
    this.cfx.isFirstTimeVisit = "true";
  },

  getCookieData : function() {
    this.cfx.isVisitedOnce = dj.util.Cookie.getGroupCookie('DJSESSION',
        'isVisitedOnce');
    this.cfx.firstVisitTime = dj.util.Cookie.getGroupCookie('DJSESSION',
        'firstVisitTime');
    this.cfx.lastVisitTime = dj.util.Cookie.getGroupCookie('DJSESSION',
        'lastVisitTime');
  },

  onLoadHomePage : function() {
    if (this.cfx.isFirstTimeVisit == "true") {
      this.showScrim();
      this.cfx.isFirstTimeVisit = "false";
    } else {
      this.onRepeatedVisit();
    }
  },

  showScrim : function() {
    dojo.query(".scrimWSJ_overlay").forEach(function(node, index, arr) {
      dojo.style(node, "display", "");
    });
  },

  onRepeatedVisit : function() {
    dayMiliSecs = 24 * 60 * 60 * 1000;
    weekMiliSecs = 7 * dayMiliSecs;
    marketingPeriodMiliSecs = 4 * weekMiliSecs;

    newVisit = new Date();
    newVisitTime = newVisit.getTime();
    sinceFirstVisitTime = newVisitTime - this.cfx.firstVisitTime;
    sinceLastVisitTime = newVisitTime - this.cfx.lastVisitTime;

    if (sinceLastVisitTime > weekMiliSecs
        && sinceFirstVisitTime < marketingPeriodMiliSecs) {
      this.showScrim();
    }
    dj.util.Cookie.setGroupCookie('DJSESSION', 'lastVisitTime', newVisitTime);
  },

  onWSJDEClick : function() {
    dojo.query(".gmDeviceScrimBtn").forEach(function(node, index, arr) {
      dojo.connect(node, "onclick", function(evt) {
        window.location.href = "http://www.wallstreetjournal.de";
        this.cfx.isClickedWSJDE = dj.util.Cookie.setGroupCookie('DJSESSION',
            'isClickedWSJDE', "true", 730);
      });
    });
  },

  onNoThanksClick : function() {
    var that = this;
    dojo.query(".gmDeviceScrimReadMore").forEach(function(node, index, arr) {
      dojo.connect(node, "onclick", function(evt) {
        that.hideScrim();
      });
    });
  },
  
  onCloseButtonClick : function() {
	    var that = this;
	    dojo.query(".gmDeviceScrimCloseBtn").forEach(function(node, index, arr) {
	      dojo.connect(node, "onclick", function(evt) {
	        that.hideScrim();
	      });
	    });
	},

  hideScrim : function() {
    dojo.query(".scrimWSJ_overlay").forEach(function(node, index, arr) {
      dojo.style(node, "display", "none");
    });
  }

};
dojo.provide("dj.module.geotargeting.moduleShow");
dojo.require("dj.widget.geotargeting.moduleShow");

dj.module.geotargeting.moduleShow = {
  init: function() {
    this.moduleShow = new dj.widget.geotargeting.moduleShow();     
  }
};
dojo.provide("dj.util.vlttools.Article");
dj.util.vlttools.Article={getParentByNodeName:function(a,b){if(a.nodeName.toLowerCase()==b||a.parentNode===null)return a;return dj.util.Article.getParentByNodeName(a.parentNode,b)},isFloat:function(a){return/\d+\.\d+/.test(a)},CopyrightPopUp:function(){var a=AT_VARS,b=[];b.push("PublisherName="+escape(a.publicationName));b.push("ContentID="+escape(a.baseDocId+a.baseDocExtension));b.push("orderReset=true");b.push("Title="+escape(a.articleHeadline));b.push("Author="+escape(a.authors));b.push("CreditLine="+
escape(a.byLine||""));b.push("PublicationDate="+escape(a.publicationDate));b.push("ArticleType="+escape(a.articleType));b.push("DJType="+escape(a.djType));b.push("orderSource=wsj.com");dj.util.Url.openWin("https://s100.copyright.com/Clients/wsj_com/FairUse.jsp?"+b.join("&"),"reprints",515,440,"scroll,resizable",true)}};
dojo.provide("dj.widget.vlttools.NetworkTools");dojo.require("hogan");dojo.require("dj.lang");dojo.require("dj.util.Element");
dojo.declare("dj.widget.vlttools.NetworkTools",null,{expanded:false,constructor:function(a){dojo.safeMixin(this,a);this.container=dojo.query(this.valetToolsLeftContainer)[0];this.placeholders=dojo.byId("placeholderContainer");this.actuals=dojo.byId("thirdPartyContainer");this.topOverlayDivs=dojo.query(this.valetToolsTopContainer+" div.vlt_overlay");this.bottomOverlayDivs=dojo.query(this.valetToolsBottomContainer+" div.vlt_overlay");this.topSocialLiElements=dojo.query(this.valetToolsTopContainer+" ul.vltSocialLinks li");
this.bottomSocialLiElements=dojo.query(this.valetToolsBottomContainer+" ul.vltSocialLinks li");this.allSocialLiElements=this.topSocialLiElements.concat(this.bottomSocialLiElements);this.templateData={url:this.getOgTag("url"),image:this.getOgTag("image"),description:this.getOgTag("description"),title:this.getOgTag("title"),fbLocale:this.fbLocale,twitterLocale:this.twitterLocale,shortUrl:this.getShortUrl()};this.loadSocialScripts(this.socialNetworksJS);this.loadLeftSocialHtml(this.leftSocialTemplates);
this.loadSocialTopBottomHtml(this.topSocialTemplates,this.topOverlayDivs);this.loadSocialTopBottomHtml(this.bottomSocialTemplates,this.bottomOverlayDivs);a=dojo.query(".mixi-check-button",this.container);if(a[0])if(a=a.parent())a[0].className="stList-s vltTool-mix";this.isIpad()||this.isKindleFire()?this.addTouchEvents():this.addEvents()},getShortUrl:function(){var a=dojo.query(this.twitterShortUrlNode)[0];return a?dojo.attr(a,"data-shortURL"):this.getOgTag("url")},addTouchEvents:function(){var a=
this;dj.lang.addLiveEvent(".vltanchor","click",function(b){dojo.stopEvent(b);dojo.attr((b.target||b.srcElement).parentNode,"data-current-node","true");dojo.forEach(a.allSocialLiElements,function(c){var d=dojo.attr(c,"data-current-node");if(d=="true")if(dojo.hasClass(c,"overlay_open")){dojo.removeClass(c,"overlay_open");dojo.attr(c,"data-current-node","false")}else dojo.addClass(c,"overlay_open");else if(d=="false"||d===null){dojo.attr(c,"data-current-node","false");dojo.removeClass(c,"overlay_open")}})});
dojo.connect(document,"onclick",function(){dojo.forEach(a.allSocialLiElements,function(b){if(dojo.hasClass(b,"overlay_open")){dojo.removeClass(b,"overlay_open");dojo.attr(b,"data-current-node","false")}})})},expandAndSwap:function(a){if(!a){dojo.style(this.placeholders,"display","none");dojo.style(this.actuals,"display","");dojo.removeClass(this.container,"compact");dojo.addClass(this.container,"medium");this.expanded=true}},shrinkAndSwap:function(a){if(!a){dojo.style(this.placeholders,"display",
"");dojo.style(this.actuals,"display","none");dojo.addClass(this.container,"compact");dojo.removeClass(this.container,"medium");this.expanded=false}},addEvents:function(){var a=this;dj.lang.addLiveEvent(".vltSocialLinks","mouseout",function(b){dojo.stopEvent(b);if((b.target||b.srcElement).parentNode.className=="vltTools horizontal"){dojo.query(".vltSocialLinks");dojo.forEach(a.allSocialLiElements,function(c){dojo.removeClass(c,"overlay_open")})}});dj.lang.addLiveEvent(".vltanchor","mouseover",function(b){dojo.stopEvent(b);
dj.module.currContainer=(b.target||b.srcElement).parentNode;dj.module.prevContainer&&dojo.removeClass(dj.module.prevContainer,"overlay_open");dojo.addClass(dj.module.currContainer,"overlay_open");dj.module.prevContainer=dj.module.currContainer});dj.lang.addLiveEvent(".vlt_overlay","mouseout",function(b){dojo.stopEvent(b);var c=b.target||b.srcElement,d=c.parentNode;c=c.previousSibling;var e=dojo.query("span.fb_edge_comment_widget")[0],f=dojo.query(".gc-bubbleDefault")[0];e||f||c&&dj.util.Element.contains(c,
b.clientX,b.clientY)===false&&dojo.removeClass(d,"overlay_open")});dj.lang.addLiveEvent(this.valetToolsLeftContainer,"click",function(){a.expanded?a.shrinkAndSwap(false):a.expandAndSwap(false)});dj.lang.addLiveEvent(this.valetToolsLeftContainer,"mouseover",function(b){dojo.stopEvent(b);dj.module.valetIgnoreMouseOver=false;dj.module.valetIgnoreMouseOut=true;a._timeoutOver!==null&&clearTimeout(a._timeoutOver);a._timeoutOver=setTimeout(function(){a.expandAndSwap(dj.module.valetIgnoreMouseOver)},300)});
dj.lang.addLiveEvent(this.valetToolsLeftContainer,"mouseout",function(b){dojo.stopEvent(b);dj.module.valetIgnoreMouseOver=true;dj.module.valetIgnoreMouseOut=false;a._timeout!==null&&clearTimeout(a._timeout);b=dojo.query("span.fb_edge_comment_widget")[0];var c=dojo.query(".gc-bubbleDefault")[0],d=dojo.query(a.leftSaveToContainer)[0];if(d)var e=dojo.hasClass(d,"ddState-expanded");if(!b)if(c){if(dojo.style(c,"visibility")!="visible")a._timeout=setTimeout(function(){a.shrinkAndSwap(dj.module.valetIgnoreMouseOut)},
500)}else if(!e)a._timeout=setTimeout(function(){a.shrinkAndSwap(dj.module.valetIgnoreMouseOut)},300)});this.SaveToAnchors&&dj.lang.addLiveEvent(this.SaveToAnchors,"mouseover",function(b){dojo.stopEvent(b);b=dojo.query(b.target||b.srcElement).closest(".dropdownTree");b[0]&&dojo.addClass(b[0],"ddState-hover")});this.SaveToAnchors&&dj.lang.addLiveEvent(this.SaveToAnchors,"mouseout",function(b){dojo.stopEvent(b);b=dojo.query(b.target||b.srcElement).closest(".dropdownTree");b[0]&&dojo.removeClass(b[0],
"ddState-hover")})},isIpad:function(){return navigator.userAgent.match(/iPad/i)!==null},isKindleFire:function(){return navigator.userAgent.match(/Kindle Fire/i)!==null},loadLeftSocialHtml:function(a){var b,c,d=dj.util.Region.getViewByRegion();for(c=0;c<a.length;c++){b=hogan.compile(a[c].template).render(this.templateData);if(b.indexOf("<script")!==-1&&b.indexOf("<\/script>")!==-1){var e=document.createElement("script");if(a[c].templatetype)e.type=a[c].templatetype;e.setAttribute("data-url",this.templateData.url);
e.setAttribute("data-counter","right");d!==null&&d!==undefined&&d.toLowerCase()==="germany"&&e.setAttribute("data-lang","de");b=dojo.create("li");b.appendChild(e)}else b=a[c].templateid?dojo.create("li",{innerHTML:b,id:a[c].templateid}):dojo.create("li",{innerHTML:b});dojo.place(b,this.actuals,"last")}},loadSocialTopBottomHtml:function(a,b){var c,d,e=dj.util.Region.getViewByRegion();for(d=0;d<a.length;d++){c=hogan.compile(a[d].template).render(this.templateData);if(c.indexOf("<script")!==-1&&c.indexOf("<\/script>")!==
-1){c=document.createElement("script");if(a[d].templatetype)c.type=a[d].templatetype;c.setAttribute("data-url",this.templateData.url);c.setAttribute("data-counter","right");e!==null&&e!==undefined&&e.toLowerCase()==="germany"&&c.setAttribute("data-lang","de");b[d].appendChild(c)}else b[d].innerHTML=c}},loadSocialScripts:function(a){var b,c,d,e,f;for(f=0;f<a.length;f++)if(dojo.query("script[src=http:"+a[f].jsurl+"]").length===0){b=a[f].jsurl;c=a[f].jsid;e=dojo.query("script")[0];d=dojo.create("script");
d.id=c;d.async=true;d.src=b;dojo.place(d,e,"before")}},getOgTag:function(a){var b;if(typeof AT_VARS!=="undefined"&&typeof AT_VARS.articleUrl!=="undefined"&&a=="url"){b=AT_VARS.articleUrl;if(dj.context.core.urlPrefix)if(dj.context.core.urlPrefix.match(/jp(.f.dev|.s.dev|).wsj.com/))b=b.replace(/online./,"jp.")}else{a=dojo.query("meta[property=og:"+a+"]");if(a.length>0)b=a[0].content}if(b)return b.indexOf("s.dev.")!==-1?b.replace(/s.dev./,""):b.indexOf("f.dev.")!==-1?b.replace(/f.dev./,""):b}});
dojo.provide("dj.widget.vlttools.Button");dojo.require("dj.util.vlttools.Article");
dojo.declare("dj.widget.vlttools.Button",null,{constructor:function(a,b,c){this.id=a;if(this.clickHandler=b)this.clickHandler=dojo.hitch(this,this.clickHandler);this.isLink=c;return this},init:function(){if(this.isLink)this.clickHandler();else{var a=dojo.byId(this.id);a&&this.clickHandler&&dojo.connect(a,"onclick",this,this.clickHandler)}dojo.connect(document,"onclick",this,function(b){this.handleDocClick(b)});return this},handleDocClick:function(a){dj.util.vlttools.Article.getParentByNodeName(a.target,
"a").id===this.id&&!this.isLink&&dojo.stopEvent(a)}});
dojo.provide("dj.widget.vlttools.ArticleTools");dojo.require("dj.widget.vlttools.Button");dojo.require("dj.widget.article.tools.TextBuddy");dojo.require("dj.util.vlttools.Article");dojo.require("clickability.w-button");
dojo.declare("dj.widget.vlttools.ArticleTools",null,{constructor:function(a){dojo.safeMixin(this,a);var b=this;(new dj.widget.vlttools.Button("atl.at.emailthis",function(){ET("wsj_valetleft_email")},false)).init();(new dj.widget.vlttools.Button("atl.at.print",function(){var c="".concat(document.location),d=c.indexOf("#");if(d!==-1)c=c.substring(0,d);dj.util.Url.openWin(c+b.printMode,"printFriendly",800,600,"",true)},false)).init();(new dj.widget.vlttools.Button("atl.at.reprint",function(){dj.util.vlttools.Article.CopyrightPopUp()},
false)).init();(new dj.widget.vlttools.Button("atb.at.reprint",function(){dj.util.vlttools.Article.CopyrightPopUp()},false)).init();(new dj.widget.vlttools.Button("att.at.emailthis",function(){ET("wsj_valettop_email")},false)).init();(new dj.widget.vlttools.Button("att.at.print",function(){var c="".concat(document.location),d=c.indexOf("#");if(d!==-1)c=c.substring(0,d);dj.util.Url.openWin(c+b.printMode,"printFriendly",800,600,"",true)},false)).init();(new dj.widget.vlttools.Button("atb.at.emailthis",
function(){ET("wsj_valetbottom_email")},false)).init();(new dj.widget.vlttools.Button("atb.at.print",function(){var c="".concat(document.location),d=c.indexOf("#");if(d!==-1)c=c.substring(0,d);dj.util.Url.openWin(c+b.printMode,"printFriendly",800,600,"",true)},false)).init();(new dj.widget.article.tools.TextBuddy("att.at.tbl","att.at.tbs","att.at.tbm")).init(true);(new dj.widget.article.tools.TextBuddy("atbody.at.tbl","atbody.at.tbs","atbody.at.tbm")).init(true)}});
dojo.provide("dj.module.vlttools.animations");dojo.require("dj.widget.vlttools.NetworkTools");dojo.require("dj.widget.vlttools.ArticleTools");dojo.require("dj.util.Region");
dj.module.vlttools.animations={init:function(a){this.configuration={viewportState:"WIDE",valetToolsLeftContainer:"#valetTools-left",valetToolsTopContainer:"#valetTools-top",valetToolsBottomContainer:"#valetTools-bottom",leftSaveToContainer:"",SaveToAnchors:"",articleResizeContainer:"",headlineNode:".articleHeadlineBox h1",pageFooterContainer:"#footerWrapper",topToolsPlacementContainer:"#article_story",bottomToolsPlacementContainer:"#morein",printMode:"#printMode",twitterShortUrlNode:"#valetToolsTwitterShortURL",
fbLocale:"en_US",twitterLocale:"en",socialNetworksJS:[{name:"twitter",jsurl:"//platform.twitter.com/widgets.js",jsid:"twitter-wsj"},{name:"gplus",jsurl:"https://apis.google.com/js/plusone.js",jsid:"google-jssdk"},{name:"linkedin",jsurl:"//platform.linkedin.com/in.js",jsid:"linkedin-jssdk"}],leftSocialTemplates:[{template:'<fb:like href="{{url}}" send="false" layout="button_count" width="500" show_faces="false" action="recommend"></fb:like>'},{template:'<a href="https://twitter.com/share"  data-counturl="{{url}}" data-url="{{shortUrl}}" class="twitter-share-button" data-via="WSJ" data-lang="{{twitterLocale}}">Tweet</a>'},
{template:'<div class="g-plusone" data-href="{{url}}" data-size="medium"></div>'},{template:'<script type="IN/Share" data-url="{{url}}" data-counter="right"><\/script>',templatetype:"IN/Share"}],topSocialTemplates:[{template:'<fb:like href="{{url}}" send="false" layout="button_count" width="500" show_faces="false" action="recommend"></fb:like>'},{template:'<a href="https://twitter.com/share" data-counturl="{{url}}" data-url="{{shortUrl}}" class="twitter-share-button" data-via="WSJ" data-lang="en">Tweet</a>'},
{template:'<div class="g-plusone" data-href="{{url}}" data-size="medium"></div>'},{template:'<script type="IN/Share" data-url="{{url}}" data-counter="right"><\/script>',templatetype:"IN/Share"}],bottomSocialTemplates:[{template:'<fb:like href="{{url}}" send="false" layout="button_count" width="500" show_faces="false" action="recommend"></fb:like>'},{template:'<a href="https://twitter.com/share" data-counturl="{{url}}" data-url="{{shortUrl}}" class="twitter-share-button" data-via="WSJ" data-lang="en">Tweet</a>'},
{template:'<div class="g-plusone" data-href="{{url}}" data-size="medium"></div>'},{template:'<script type="IN/Share" data-url="{{url}}" data-counter="right"><\/script>',templatetype:"IN/Share"}]};a&&dojo.safeMixin(this.configuration,a);this.configuration.fbLocale=this.getFacebookLocale();this.configuration.twitterLocale=this.getTwitterLocale();var b=dojo.query(this.configuration.valetToolsTopContainer)[0],c=dojo.query(this.configuration.valetToolsLeftContainer)[0],d=dojo.query(this.configuration.valetToolsBottomContainer)[0];
if(this.configuration.articleResizeContainer!=="")var e=dojo.query(this.configuration.articleResizeContainer)[0];var f=dojo.query(this.configuration.headlineNode)[0];a=dojo.position(f).y;var h=dojo.query(this.configuration.pageFooterContainer)[0];this.placeVerticalNode(c,h,"first");dojo.style(c,"top",a+"px");a=dojo.query(this.configuration.topToolsPlacementContainer)[0];this.placeHorizontalNode(b,a,"first");a=dojo.query(this.configuration.bottomToolsPlacementContainer)[0];this.placeHorizontalNode(d,
a,"after");if(c!==null&&dojo.window.getBox().w>1038){this.viewportState="WIDE";e&&dojo.style(e,"display","block")}if(b!==null&&dojo.window.getBox().w<=1038){this.viewportState="NARROW";e&&dojo.style(e,"display","none");this.customCrossFadeOut(c);this.customCrossFadeIn(b)}if(d!==null&&dojo.window.getBox().w<=1038){this.viewportState="NARROW";e&&dojo.style(e,"display","none");this.customCrossFadeOut(c);this.customCrossFadeIn(d)}dojo.connect(window,"scroll",this,function(){var i=dojo.window.getBox().t,
g=dojo.position(f).y;if(i-g>312){dojo.style(c,"position","fixed");dojo.style(c,"top","20px")}else{dojo.style(c,"position","fixed");dojo.style(c,"top",g+"px")}});dojo.connect(window,"resize",this,function(){if(dojo.window.getBox().w>1038&&this.viewportState==="NARROW"){this.viewportState="WIDE";e&&dojo.style(e,"display","block");this.customCrossFadeIn(c);this.customCrossFadeOut(b);this.customCrossFadeOut(d)}else if(dojo.window.getBox().w<=1038&&this.viewportState==="WIDE"){this.viewportState="NARROW";
e&&dojo.style(e,"display","none");this.customCrossFadeOut(c);this.customCrossFadeIn(b);this.customCrossFadeIn(d)}});dj.widget.valetNetworkTools=new dj.widget.vlttools.NetworkTools(this.configuration);dj.widget.valetArticleTools=new dj.widget.vlttools.ArticleTools(this.configuration)},placeHorizontalNode:function(a,b,c){dojo.style(a,"display","none");dojo.place(a,b,c)},placeVerticalNode:function(a,b,c){dojo.place(a,b,c)},customCrossFadeIn:function(a){dojo.style(a,"display","block")},customCrossFadeOut:function(a){dojo.style(a,
"display","none")},getFacebookLocale:function(){var a=dj.util.Region.getViewByRegion(),b={"na,us":"en_US","asia,indo":"id_ID","asia,kr":"ko_KR","asia,jp":"ja_JP",germany:"de_DE","sa,br":"pt_BR"};a=typeof a!=="undefined"&&a?b[a]:"en_US";return typeof a!=="undefined"&&a?a:"en_US"},getTwitterLocale:function(){var a=dj.util.Region.getViewByRegion(),b={"na,us":"en","asia,indo":"id","asia,kr":"ko","asia,jp":"ja",germany:"de","sa,br":"pt"};a=typeof a!=="undefined"&&a?b[a]:"en";return typeof a!=="undefined"&&
a?a:"en"}};
/*global console,dj,dojo,Error,TypeError,parseInt */
dojo.provide("dj.widget.autocomplete.AutoCompleteView");

dojo.require("dj.lang");
dojo.require("dj.widget.autocomplete.SuggestDisplayModel");
dojo.require("dj.widget.autocomplete.autoCompleteViewTemplate");


(dj.widget.autocomplete.AutoCompleteView = function(cfg, options, suggestDisplayModel) {
  this._cfg = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
  this._options = dj.lang.cloneMixin(this.OPTIONS_CONFIG, options);
  this._suggestionsContainer = null;
  this._suggestionsContentNode = null;
  this._currentHighlightedItem = null;
  this._content = null;
  this._suggestionBlocks = [];
  this._suggestFooterNode = null;
  this._showAllSymbolsAnchorNode = null;
  this._categoryDisplayDataPointsIndex = [];
  if (typeof suggestDisplayModel === "undefined") {
    this._suggestDisplayModel = new dj.widget.autocomplete.SuggestDisplayModel();
  } else {
    this._suggestDisplayModel = suggestDisplayModel;
  }
}).prototype = {
  DEFAULT_CONFIG : {},
  OPTIONS_CONFIG : {},
  setViewContainer : function(suggestionsContainer) {
    this._suggestionsContainer = suggestionsContainer;
  },
  getViewContainer : function() {
    return this._suggestionsContainer;
  },
  fetchViewTemplate : function() {
    var that = this;
    dj.widget.autocomplete.autoCompleteViewTemplate.getTemplate(function(response) {
      that.handleViewTemplateLoad(response);
    });
  },
  handleViewTemplateLoad : function(response) {
    var autoCompleteContent = dojo.query("div.yui-ac-content", this.getViewContainer())[0];
    autoCompleteContent.innerHTML = response;
    this._buildCategoryDisplay();
    this.indexDataPoints();
  },
  highlightSuggestion : function(suggestionElement) {
    if (this._currentHighlightedItem !== null) {
      dojo.removeClass(this._currentHighlightedItem, "yui-ac-highlight");
    }
    this._currentHighlightedItem = suggestionElement;
    dojo.addClass(suggestionElement, "yui-ac-highlight");
  },
  highlightSuggestionAt : function(categoryIndex, categoryLineItemIndex) {
    //todo : validate indices
    var lineItemElement = this._categoryDisplayDataPointsIndex[categoryIndex].listNodes[categoryLineItemIndex];
    this.highlightSuggestion(lineItemElement);
  },
  _buildCategoryDisplay : function() {
    var ctgCount = this._suggestDisplayModel.getNumberOfCategories();
    var suggestionBlockContainer = dojo.query("div.suggestionblockcontainer", this.getViewContainer())[0];
    for ( var ctgIndex = 0; ctgIndex < ctgCount; ctgIndex++) {
      var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(ctgIndex);
      var templateNode = null;
      if (noOfColumnsInCategoryDisplay === 2) {
        templateNode = dojo.query("div[class~='suggestionblock'][templateType='C2']", this.getViewContainer())[0];
      } else if (noOfColumnsInCategoryDisplay === 1) {
        templateNode = dojo.query("div[class~='suggestionblock'][templateType='C1']", this.getViewContainer())[0];
      } else {
        throw new Error("View not supported for more than 2 columns");
      }
      var templateInstance = templateNode.cloneNode(true);
      //build line items
      var maxNoOfSuggestionsToDisplay = this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(ctgIndex);
      var lineItemTemplate = dojo.query("li", templateInstance)[0];
      lineItemTemplate.setAttribute("categoryIndex", ctgIndex);
      lineItemTemplate.setAttribute("categoryItemIndex", 0);
      var lineItemContainer = dojo.query("ul", templateInstance)[0];
      for ( var lineItemCount = 1; lineItemCount < maxNoOfSuggestionsToDisplay; lineItemCount++) {
        //adding one less, there's always one
        var lineItemClone = lineItemTemplate.cloneNode(true);
        lineItemClone.setAttribute("categoryItemIndex", lineItemCount);
        lineItemContainer.appendChild(lineItemClone);
      }
      templateInstance.removeAttribute("templateType");
      dojo.addClass(templateInstance, "concrete");
      templateInstance.setAttribute("categoryIndex", ctgIndex);
      var subHeadingNode = dojo.query("div.subHeading1", templateInstance)[0];
      if (noOfColumnsInCategoryDisplay === 2) {
        var subHeading2Node = dojo.query("div.subHeading2", templateInstance)[0];
        subHeading2Node.setAttribute("categoryIndex", ctgIndex);
        subHeading2Node.innerHTML = this._suggestDisplayModel.getCategorySubHeading2(ctgIndex);
        if (this._suggestDisplayModel.isCategorySubHeading2Visible(ctgIndex)) {
          dojo.removeClass(subHeading2Node, "hidden");
        }
      }
      subHeadingNode.innerHTML = this._suggestDisplayModel.getCategorySubHeading1(ctgIndex);
      if (this._suggestDisplayModel.isCategorySubHeading1Visible(ctgIndex)) {
        dojo.removeClass(subHeadingNode, "hidden");
      }
      suggestionBlockContainer.appendChild(templateInstance);
    }
    var headerBlock = dojo.query("div.yui-ac-hd", this.getViewContainer())[0];
    if (this._suggestDisplayModel.isHeaderVisible()) {
      dojo.removeClass(headerBlock, "hidden");
    }
    var footerBlock = dojo.query("div.yui-ac-ft", this.getViewContainer())[0];
    if (this._suggestDisplayModel.isFooterVisible()) {
      dojo.removeClass(footerBlock, "hidden");
      var footerNode = dojo.query("div.footer", footerBlock)[0];
      footerNode.innerHTML = this._suggestDisplayModel.getFooterText();
    }
  },
  indexDataPoints : function() {
    this._content = dojo.query("div[class~='yui-ac-content']", this.getViewContainer())[0];
    this._suggestionBlocks = dojo.query("div.suggestionblock.concrete", this.getViewContainer());
    var ctgCount = this._suggestDisplayModel.getNumberOfCategories();
    /*
     * ASSUMPTION: dojo.query() fetches the suggestionblocks in the order in which they are in dom tree, which is the
     * order in which they were added
     */
    for ( var ctgIndex = 0; ctgIndex < ctgCount; ctgIndex++) {
      var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(ctgIndex);

      var listNodes = dojo.query("li", this._suggestionBlocks[ctgIndex]);
      var col1Nodes = null;
      if (noOfColumnsInCategoryDisplay === 1) {
        col1Nodes = dojo.query("span.keywordResult", this._suggestionBlocks[ctgIndex]);
        this._categoryDisplayDataPointsIndex.push( {
          "listNodes" : listNodes,
          "col1Nodes" : col1Nodes
        });
      } else if (noOfColumnsInCategoryDisplay === 2) {
        col1Nodes = dojo.query("td.symbolCompleteCol1", this._suggestionBlocks[ctgIndex]);
        var col2Nodes = dojo.query("td.symbolCompleteCol2", this._suggestionBlocks[ctgIndex]);
        var subHeading2Node = dojo.query("div.subHeading2", this._suggestionBlocks[ctgIndex])[0];
        this._categoryDisplayDataPointsIndex.push( {
          "listNodes" : listNodes,
          "col1Nodes" : col1Nodes,
          "col2Nodes" : col2Nodes,
          "subHeading2" : subHeading2Node
        });
      } else {
        throw new Error("Data point indexing supported for 1 and 2 columns only");
      }
    }

    this._suggestFooterNode = dojo.query("div.footer", this.getViewContainer())[0];

  },
  populateCategoryDisplayMetaData : function(ctgIndex, suggestionContext, suggestionObjArray) {
    var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(ctgIndex);
    if (noOfColumnsInCategoryDisplay === 2) {
      //todo hardcoded, take a functoid from client to do this, could be part of SuggestCategoryDisplayModel
      this._categoryDisplayDataPointsIndex[ctgIndex].subHeading2.innerHTML = this._getCategorySubHeading2(ctgIndex,
          suggestionContext, suggestionObjArray);
    }
  },
  populateCategoryData : function(suggestionContext, categoryDataArray, categoryIndex) {
    var noOfColumnsInCategoryDisplay = this._suggestDisplayModel.getNumberOfColumnsInCategory(categoryIndex);
    this.populateCategoryDisplayMetaData(categoryIndex, suggestionContext, categoryDataArray);
    if (noOfColumnsInCategoryDisplay === 1) {
      this.populateSingleColumnSuggestions(categoryIndex, suggestionContext, categoryDataArray);
    } else if (noOfColumnsInCategoryDisplay === 2) {
      this.populateTwoColumnSuggestions(categoryIndex, suggestionContext, categoryDataArray);
    } else {
      throw new Error("View is not supported for more than 2 columns");
    }
  },
  populateTwoColumnSuggestions : function(ctgIndex, suggestionContext, suggestionsObjArray) {
    var maxNoOfSuggestionsToDisplay = this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(ctgIndex);
    var column1Accessor = this._suggestDisplayModel.getCategoryColumnValueAccessor(ctgIndex, 0);
    var column2Accessor = this._suggestDisplayModel.getCategoryColumnValueAccessor(ctgIndex, 1);
    if (suggestionsObjArray.length === 0) {
      dojo.addClass(this._suggestionBlocks[ctgIndex], "hidden");
      return;
    } else {
      dojo.removeClass(this._suggestionBlocks[ctgIndex], "hidden");
    }
    for ( var count = 0; count < maxNoOfSuggestionsToDisplay; count++) {
      var suggest = suggestionsObjArray[count];
      if (typeof suggest == "undefined") {
        dojo.addClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
      } else {
        dojo.removeClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
        var firstColValue = suggest[column1Accessor];
        if (typeof firstColValue == "undefined") {
          firstColValue = "-";
        } /* to do: externalize this so that custom defaults can be used */
        this._categoryDisplayDataPointsIndex[ctgIndex].col1Nodes[count].innerHTML = this._getHighlightedSearchTerm(
            firstColValue, suggestionContext);
        this._categoryDisplayDataPointsIndex[ctgIndex].col2Nodes[count].innerHTML = this._getHighlightedSearchTerm(
            suggest[column2Accessor], suggestionContext);
      }
    }
  },
  _getHighlightedSearchTerm : function(value, suggestionContext) {
    var searchText = suggestionContext.searchText;
    var valueString = "" + value;
    var regex = new RegExp("(" + searchText + ")", "i");
    return valueString.replace(regex, "<span class=\"scResultTerm\">$1</span>");
  },
  populateSingleColumnSuggestions : function(ctgIndex, suggestionContext, suggestionsObjArray) {
    var maxNoOfSuggestionsToDisplay = this._suggestDisplayModel.getMaxNoOfSuggestionsToDisplay(ctgIndex);
    var column1Accessor = this._suggestDisplayModel.getCategoryColumnValueAccessor(ctgIndex, 0);
    if (suggestionsObjArray.length === 0) {
      dojo.addClass(this._suggestionBlocks[ctgIndex], "hidden");
      return;
    } else {
      dojo.removeClass(this._suggestionBlocks[ctgIndex], "hidden");
    }
    for ( var count = 0; count < maxNoOfSuggestionsToDisplay; count++) {
      var suggest = suggestionsObjArray[count];
      if (typeof suggest == "undefined") {
        dojo.addClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
      } else {
        dojo.removeClass(this._categoryDisplayDataPointsIndex[ctgIndex].listNodes[count], "hidden");
        this._categoryDisplayDataPointsIndex[ctgIndex].col1Nodes[count].innerHTML = this._getHighlightedSearchTerm(
            suggest[column1Accessor], suggestionContext);
      }
    }
  },
  _getCategorySubHeading2 : function(ctgIndex, suggestionContext, suggestionObjArray) {
    return this._suggestDisplayModel.getCategorySubHeading2(ctgIndex) + "\"" + suggestionContext.searchText + "\"";
  },
  show : function() {
    dojo.removeClass(this.getViewContainer(), "hidden");
  },
  hide : function() {
    dojo.addClass(this.getViewContainer(), "hidden");
  },
  isHidden:function(){
    return dojo.hasClass(this.getViewContainer(), "hidden");
  },
  clearSelection : function() {
    if (this._currentHighlightedItem !== null) {
      dojo.removeClass(this._currentHighlightedItem, "yui-ac-highlight");
      this._currentHighlightedItem = null;
    }
  },
  detach : function(){
    var autoCompleteContent = dojo.query("div.yui-ac-content", this.getViewContainer())[0];
    this._suggestionsContentNode = dojo.query("div:first-child",autoCompleteContent).orphan()[0];
  },
  attach : function(){
    var autoCompleteContent = dojo.query("div.yui-ac-content", this.getViewContainer())[0];
    autoCompleteContent.appendChild( this._suggestionsContentNode);
  }
};
dojo.provide("dj.widget.networkHat.AutoComplete");

dojo.require("dj.widget.networkHat.infocomplete");
dojo.require("dj.lang");

dojo.getObject("dj.context.networkHat", true);

/* global dj, dojo */

/*
 * networkHat object...loads scripts needed for autocomplete only when user interacts with the search box. Traps
 * mouseover and focus events, and then loads and initializes the infocomplete for the
 */

(function() {

  var _dwn = dj.widget.networkHat;  

  (_dwn.AutoComplete = function() {

    this.d = document;
    this.cdnDomain = dj.context.core.cdnPrefix;

    this.uP = "";
    if (typeof uP != 'undefined') {
      this.uP = uP;
    }

    var dt = new Date();
    var dtStamp = "" + dt.getFullYear() + dt.getMonth() + dt.getDay();

    if (this.d.location.host.indexOf('s.dev') != -1 || this.d.location.host.indexOf('idev') != -1) {
      //  A hack until cdnDomain for SAT/IDEV actually wil serve up /djscript URLs
      this.jScript = this.uP + "/djscript/j_networkHat-" + dtStamp + ".js";
    } else {
      this.jScript = this.cdnDomain + "/djscript/j_networkHat-" + dtStamp + ".js";
    }

    // Set the required globals
    var fw = this.d.getElementsByTagName("div")[0];
    var loggedIn = (fw.className.indexOf("subType-subscribed") !== -1);

    //loggedIn = (typeof loggedIn !== "undefined") ? loggedIn : false;
    var searchBoxID = 'hat_input_auto';
    this.inputDefaultText="News, Quotes, Companies, Videos";
    if(dj.autocompletesearch!==undefined && dj.autocompletesearch.inputDefaultText!==undefined){
      this.inputDefaultText=dj.autocompletesearch.inputDefaultText;
    }
    

//  this.inputDefaultText = "";

    // Retrieve the needed dom-elements
    var oHat = dojo.byId("hat_div");
    this.oHatInput = dojo.byId("hat_input_auto");
    var oHatSelect = dojo.query(".hat_select", oHat);
    
    // Set default style
    if (dojo.isIE && (this.d.domain.indexOf('ds.sat.wsj.com') != -1 || this.d.domain.indexOf('ds.wsj.com') != -1)) {
      dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");
    }
    
    this.onfocusLoad = dojo.connect(this.oHatInput, "onfocus", this, this.onHatLoad);
    this.onmouseoverLoad = dojo.connect(this.oHatInput, "onmouseover", this, this.onHatLoad);
    this.onclickClear = dojo.connect(this.oHatInput, "onclick", this, this.clearField);
    this.onkeydownClear = dojo.connect(this.oHatInput, "onkeydown", this, this.clearField);

    if (this.oHatInput.value !== "" && this.oHatInput.value != this.inputDefaultText || 
        dj.context.networkHat.jnetworkHatJsLoaded) {
      //if text already in field, initialize hat.  User got focus or clicked before the hanlder was attached
      this.onHatLoad();
    }
    this.setFieldDefault();

  }).prototype = {
    setFieldDefault: function() {
      /* Add "prompt" text to oHatInput if it's blank, if user has not typed */
      if (this.oHatInput.value === "") {
       this.oHatInput.value=this.inputDefaultText;
      dojo.addClass(this.oHatInput, "unUsed");
    }

  },

  clearField: function() {
    this.stopObservingClick();
    var unUsed = dojo.hasClass(this.oHatInput, "unUsed");
    if (unUsed) {
      this.oHatInput.value = "";
    }
    dojo.removeClass(this.oHatInput, "unUsed");
  },
  stopObservingClick: function() {
    // use dojo.disconnect?
    dojo.disconnect(this.onclickClear);
    dojo.disconnect(this.onkeydownClear);
  },
  onHatLoad: function() {

    dojo.disconnect(this.onfocusLoad);
    dojo.disconnect(this.onmouseoverLoad);

    // if j_networkHat.js already loaded, skip to init
    if (dj.context.networkHat.jnetworkHatJsLoaded) {
      this.initInfoComplete();
      return;
    }

    //load j_networkhat.js
    var hds = this.d.getElementsByTagName('head');
    var hd;
    if (!hds) {
      hd = new Element('head');
      this.d.getElementsByTagName('body')[0].appendChild(hd);
    } else {
      hd = hds[0];
    }
    this.jsNode = this.loadAutoCompleteScript(this.jScript);

  },
  loadAutoCompleteScript: function(jScript) {
    var jsNode = this.d.createElement("script");
    jsNode.type = "text/javascript";
    jsNode.src = jScript;

    if (this.d.getElementsByTagName("head").length === 0) {
      var headNode = this.d.createElement("head");
      this.d.getElementsByTagName("html")[0].appendChild(headNode);
    }

    this.d.getElementsByTagName("head")[0].appendChild(jsNode);
    return jsNode;
  },
  initInfoComplete: function() {

    // Set default style
    if (dojo.isIE && (this.d.domain.indexOf('ds.sat.wsj.com') != -1 || this.d.domain.indexOf('ds.wsj.com') != -1)) {
      dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");
    }

    if(typeof dj.header != "undefined"  && typeof dj.header.autocomplete != "undefined" && dj.header.autocomplete == "NEW"){
      initInfoCompleteNew();
    }else{
      initInfoComplete();
    }
    this.stopObservingClick();

    // Set-up event listeners
    dojo.connect(this.oHatInput, "onfocus", null, function(ev) {

      this.style.backgroundImage = "url('http://s.wsj.net/img/b.gif')";

      searchFieldOnFocus(this);
      setFocused(this);
    });

    dojo.connect(this.oHatInput, "onkeypress", null, function() {
      showHideCRDrpdwn('hide');
    });
    dojo.connect(this.oHatInput, "onblur", null, function() {
      showHideCRDrpdwn('show');
    });

    var textValue = this.oHatInput.value;
    if(InfoComplete.autoComplete.dataSources && InfoComplete.autoComplete.dataSources.length >=2 ){
      InfoComplete.autoComplete.dataSources[1].scriptQueryParam = 'query';
    }
    if (textValue && textValue != this.inputDefaultText) {      
      InfoComplete.autoComplete.sendQuery(textValue);
    }
  }
  };

}());

dojo.provide("dj.module.olympics.tabDataRenderer");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.util.Page");if(typeof dj.module==="undefined"){dj.module={};}
if(typeof dj.module.olympics.tabDataRenderer==="undefined"){dj.module.olympics.tabDataRenderer={};}
var _djl=dj.lang;var _djp=dj.util.Page;dj.module.olympics.tabDataRenderer={init:function(conf){if(_djl.isIE){if(!document.namespaces.g_vml_){document.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!document.namespaces.g_o_){document.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}}
this.configuration={moduleName:"tabDataModule",defaultTab:1,refreshModule:false,refreshRate:60,moduleContainer:"tabDataContainer",tabs:["medals","schedule","liveCoverage"],dataContainer:"tabDataTable_",showMytabs:true};_djl.mixin(this.configuration,conf);this.timer="";this.panelData=[];this.panels=this.createPanels(this.configuration.moduleContainer);if(this.configuration.refreshModule){_djp.enableModuleRefresh(this.configuration.moduleName);}},showHideTip:function(objId){var toolTipDiv=dojo.byId(objId);var indexVal=toolTipDiv.className.indexOf("hidden");if((toolTipDiv.className).indexOf("hidden")==-1)
{dojo.addClass(toolTipDiv,"hidden");}
else
{dojo.removeClass(toolTipDiv,"hidden");}},setRefresh:function(refreshRate){var that=this;that.timer=setInterval(function(){if(_djp.isModuleRefreshEnabled(that.configuration.moduleName)){}},refreshRate*1000);},createPanels:function(container){var that=this;return dj.widget.panels.PanelsFactory.create(container,{core:{panelPrefix:"olTab_",panels:that.configuration.tabs,enableHistory:false,activePanel:that.configuration.defaultTab},tabs:{tabPrefix:"moduleTab_",tabOnStyle:"selected",tabOffStyle:""}});}};dojo.provide("dj.util.offstream.dateUtility");dojo.require("dj.util.Element");dojo.require("dojo.date");dojo.require("dojo.date.locale");dj.util.offstream.dateUtility={scan:function(){var du=dj.util.offstream.dateUtility;du.calculateDate();setTimeout(dj.util.offstream.dateUtility.scan,60000,null);},scanWithinContainer:function(container,widgetName){this.calculateDate(container);},calculateDate:function(container){var du=dj.util.offstream.dateUtility;var browserDate=new Date();var query="[data-widget='dj.offstreamtimestamp']";var queryString=(typeof container==='undefined'||container==null)?query:container+" "+query;dojo.query(queryString).forEach(function(object,index){var ts=dj.util.Element.getData(object,"major-ts");if(ts!=null&&typeof ts!="undefined"){var outputDate=du.getTimeDifference(ts);object.innerHTML=outputDate;}});},getTimeDifference:function(timestamp_second_utc){timestamp_second_utc=this.parseInteger(timestamp_second_utc);timestamp_second_utc=this.getInMiliseconds(timestamp_second_utc);var now=new Date();var gmtHours=-1*1000*60*60*5;var then=new Date(timestamp_second_utc+gmtHours);var then_stamp=then.getTime();var now_stamp=now.getTime();var sec_diff=Math.ceil((now_stamp-then_stamp)/1000)-1;return this.getSecondDifference(sec_diff,then);},getSecondDifference:function(sec_diff,date){if(typeof date=='undefined'){date=new Date();}
if(sec_diff<60){return this.getTimeDifferenceStr(0,'MIN');}else if(sec_diff<3600){return this.getTimeDifferenceStr(Math.floor(sec_diff/60),'MIN');}else if(sec_diff<86400){return this.getTimeDifferenceStr(Math.floor(sec_diff/60/60),'HR');}else if(sec_diff<259200){return this.getTimeDifferenceStr(Math.floor(sec_diff/60/60/24),'DAY');}else{return dojo.date.locale.format(date,{selector:"date",datePattern:'MMM d, yyyy'});}},getTimeDifferenceStr:function(number,unit){var str;switch(number){case 0:return'now';case 1:str=number+' '+unit;break;default:str=number+' '+unit+'S';}
return str;},getInMiliseconds:function(timestamp){return timestamp*1000;},setTimeUnit:function(min,hour,day,sValue){this.min=min;this.hour=hour;this.day=day;this.sValue=sValue;},parseInteger:function(num){num=parseInt(num,10);return(isNaN(num)?0:num);}};dojo.provide("dj.module.olympics.olympicsSubHeader");dojo.require("dj.lang");dojo.require("dj.util.User");dojo.require("dj.util.Cookie");dojo.require("dj.util.Element");dj.module.olympics.olympicsSubHeader={init:function(customConfig){this._cfg={olympicsSportsDropdown:"#olympicsSportsDropdown",popTrigger:"#olympicsSportsDropdown .popTrigger",toolBarFaceBookIframe:"facebook_iframe",socialtoolBar:"#olympicsSocialBar",toolBarFBShareCount:"olympicsFbCount",toolBarTwtShareCount:"olympicsTwCount",toolBarTwtIframe:"twt_iframe",toolBarEmailOverlay:"emailOverlay",olympicsMainPage:"0_0_WP_8100",flagsRefreshTimer:330000};if(customConfig){this._cfg=dojo.mixin(this._cfg,customConfig);}
this.getCountriesData();this.addEvents();},getCountriesData:function(){setTimeout(dojo.hitch(this,this.getCountriesData),this._cfg.flagsRefreshTimer,null);var country=this.getLocalCountry();var urlVal="/public/page/0_0_WG_HeaderOne_Olympics_countryFlags.html";if(country){urlVal="/public/page/0_0_WG_HeaderOne_Olympics_countryFlags"+"-"+country+".html"}
var that=this;dojo.xhrGet({url:urlVal,preventCache:true,load:function(data,xhr){that.renderCountries(data);},error:function(error,ioArgs){console.log(error);}});},getLocalCountry:function(){var cookie=dj.util.Cookie.getCookie("DJSESSION");if(typeof cookie!="undefined"&&cookie!=null){var countryIndex=cookie.search("country");if(countryIndex>0){var counValPair=cookie.substring(countryIndex,(cookie.indexOf("||")+countryIndex-2));var countSplit=counValPair.split("=");if(countSplit.length>1){var counVal=countSplit[1];if(counVal){if(counVal=="reserved"){var countryCodeVal=dj.util.queryParam.getQueryStrParam("countryCode");if(countryCodeVal){var splitArr=countryCodeVal.split('#');if(splitArr.length>0){counVal=splitArr[0];}}}
return counVal.toUpperCase();}}}}
return"";},renderCountries:function(data){dojo.byId("olympicsCountrySpan").innerHTML=data;},addEvents:function(){var that=this;dojo.connect(dojo.query("#olympicsSocialBar .popTrigger")[0],"click",function(event){dojo.stopEvent(event);var socialBar=dojo.query(that._cfg.socialtoolBar)[0];if(dojo.hasClass(socialBar,"popOpen")){dojo.removeClass(socialBar,"popOpen");return;}else{dojo.addClass(socialBar,"popOpen");dojo.hitch(that,that.hideSportsDropdown());var slimHeaderDropdown=dojo.query(".sectionsDDPopUpContainer")[0];if(dojo.hasClass(slimHeaderDropdown,"popOpen")){dojo.removeClass(slimHeaderDropdown,"popOpen");}}
that.initializeFBLike(that);that.initializeTwBtn(that);that.initializeNewsletter(that);});dojo.connect(dojo.query("#olympicsSportsDropdown .popTrigger")[0],"click",function(event){dojo.stopEvent(event);var sportsDropdown=dojo.query(that._cfg.olympicsSportsDropdown)[0];if(dojo.hasClass(sportsDropdown,"popOpen")){dojo.removeClass(sportsDropdown,"popOpen");}else{dojo.addClass(sportsDropdown,"popOpen");dojo.hitch(that,that.hideSharetoolDropdown());var slimHeaderDropdown=dojo.query(".sectionsDDPopUpContainer")[0];if(dojo.hasClass(slimHeaderDropdown,"popOpen")){dojo.removeClass(slimHeaderDropdown,"popOpen");}}});dojo.connect(document,"onclick",this,function(event){var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#sportsDropDown")[0],event.clientX,event.clientY);var sportsDropdown=dojo.query(that._cfg.olympicsSportsDropdown)[0];if(!isPointerinModalContainer&&dojo.hasClass(sportsDropdown,"popOpen")){dojo.removeClass(sportsDropdown,"popOpen");}
var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#socialBarDropdown")[0],event.clientX,event.clientY);var socialDropdown=dojo.query(that._cfg.socialtoolBar)[0];if(!isPointerinModalContainer&&dojo.hasClass(socialDropdown,"popOpen")){dojo.removeClass(socialDropdown,"popOpen");}});dojo.connect(dojo.query("#slimHeader")[0],"mouseover",function(event){dojo.hitch(that,that.hideSharetoolDropdown());dojo.hitch(that,that.hideSportsDropdown());});},hideSportsDropdown:function(){var sportsDropdown=dojo.query(this._cfg.olympicsSportsDropdown)[0];if(dojo.hasClass(sportsDropdown,"popOpen")){dojo.removeClass(sportsDropdown,"popOpen");}},hideSharetoolDropdown:function(){var socialBar=dojo.query(this._cfg.socialtoolBar)[0];if(dojo.hasClass(socialBar,"popOpen")){dojo.removeClass(socialBar,"popOpen");}},initializeFBLike:function(that){var overlay=dojo.byId(that._cfg.toolBarFBShareCount);if(!window.frames[that._cfg.toolBarFaceBookIframe]){that.createIFRAME(that._cfg.toolBarFaceBookIframe,"http://www.facebook.com/plugins/like.php?href=http://online.wsj.com/public/page/"+this._cfg.olympicsMainPage+".html&action=recommend&title=Like this content on Facebook&layout=button_count&send=false&show_faces=false&width=90",overlay,"400px");}},initializeTwBtn:function(that){var overlay=dojo.byId(that._cfg.toolBarTwtShareCount);if(!window.frames[that._cfg.toolBarTwtIframe]){that.createIFRAME(that._cfg.toolBarTwtIframe,"http://platform.twitter.com/widgets/follow_button.html?screen_name=WSJSports&amp;show_count=true&amp;show_screen_name=true",overlay,"230px");}},initializeNewsletter:function(that){dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){dojo.removeClass(dojo.byId(that._cfg.toolBarEmailOverlay),"hidden");dojo.removeClass(dojo.query(".newsletter",that._cfg.toolBarEmailOverlay)[0],"hidden");dojo.addClass(dojo.query(".login_msg_ul",that._cfg.toolBarEmailOverlay)[0],"hidden");});}else{dojo.removeClass(dojo.byId(that._cfg.toolBarEmailOverlay),"hidden");var loginLi=dojo.query(".login_msg_li",that._cfg.toolBarEmailOverlay)[0];dojo.removeClass(dojo.query(".login_msg_ul",that._cfg.toolBarEmailOverlay)[0],"hidden");if(dojo.byId("emMsg")==null||typeof dojo.byId("emMsg")=="undefined"){var loginPage="https://id.wsj.com/content/public/page/login.html?url="+window.location.href;var caption=dojo.create("p",{"class":"emMsg",id:"emMsg",innerHTML:"Please <a href='"+loginPage+"'>LOGIN</a> or <a href='https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aaaibmyv'>SUBSCRIBE</a> to sign up for WSJ Olympics newsletters."});loginLi.appendChild(caption);}
dojo.addClass(dojo.query(".newsletter",that._cfg.toolBarEmailOverlay)[0],"hidden");}});},createIFRAME:function(name,src,overlay,width){var ifrm=dojo.create('iframe',{"id":name,"src":src,"name":name,"height":"20px","width":width,"scrolling":"no","frameBorder":"0","allowtransparency":"true"});overlay.appendChild(ifrm);}};dojo.provide("dj.widget.olympics.view.schedulerView");dojo.require("dj.lang");dojo.require("dojo.date");dojo.require("dojo.date.locale");dojo.require("dj.util.Element");dojo.declare("dj.widget.olympics.view.schedulerView",null,{constructor:function(userConfiguration){this.configuration={name:"schedulerView",scheduleContainerId:"olympicsScheduler",medalClass:"hidden colMedal",dateOrder:"dateOrder",sportCount:7,sportOrder:"sportOrder"};this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.dateJson=null;dojo.mixin(this.configuration,userConfiguration);this.viewCreated=false;},render:function(schedulerObj,scheduleContainerId){this.dateJson=schedulerObj;this.sportsNameCode={};this.sportsNameCode['football']='SOC';try{if(typeof this.dateJson!='object'){this.dateJson=dojo.fromJson(schedulerObj);}}catch(e){console.error("{schedulerView} - Error parsing jsonObject : "+this.dateJson);}
this.currentTitleJson=this.dateJson;try{this.dateJson.sort(dojo.hitch(this,function(a,b){return this.dateComparer(a["time_start"],b["time_start"]);}));}catch(exp){}
this.currentDateJson=new Array();this.currentTitleJson=new Array();scheduleContainerId=scheduleContainerId||this.configuration.scheduleContainerId;var scheduleContainer=dojo.byId(scheduleContainerId);var scheduleHTML='';var schedule=null;var dateMonth="";var scheduleCount=0;var changeDate="";var sportFlag=true;var eventLink='<a href="/public/page/olympics-london-sports.html">';for(var i=0;i<this.dateJson.length;i++){schedule=this.dateJson[i];var pubdate=schedule.time_start;var dateTimeParts=pubdate.split(" ");pubdate=dateTimeParts[0];var timeParts=dateTimeParts[1];var dateParts=pubdate.split("-");var timeParts=timeParts.split(":");var myDate=new Date(dateParts[0],dateParts[1]-1,dateParts[2],timeParts[0],timeParts[1]);var uldateVal=dateParts[2]+" "+dateParts[1];var utcDate=Date.UTC(dateParts[0],dateParts[1]-1,dateParts[2],timeParts[0],timeParts[1]);var displayDate=new Date(utcDate);if(scheduleCount>=this.configuration.sportCount&&!this.configuration.viewAll){sportFlag=false;}
if(sportFlag){var currentDate=new Date();var todayDate=new Date(currentDate.getUTCMonth()+1+"/"+currentDate.getUTCDate()+"/"+currentDate.getUTCFullYear());var publishedDate=new Date(dateParts[0],dateParts[1]-1,dateParts[2]);if(todayDate.getTime()<=publishedDate.getTime()){dateMonth=this.monthNames[myDate.getUTCMonth()]+" "+dateParts[2];this.currentDateJson[scheduleCount]=schedule;this.currentTitleJson[scheduleCount]=schedule;if(scheduleCount===0&&!this.configuration.viewAll){changeDate=uldateVal;}
scheduleCount++;}else{continue;}}else{break;}
var hours=displayDate.getHours();var min=displayDate.getMinutes();if(hours<10){hours="0"+hours;}
if(min<10){min="0"+min;}
var timeAmPm=this.getTime(hours+":"+min);var eventName='<td class="'+this.configuration.medalClass+'">&nbsp;</td>';var medalName=schedule.name;var showMedal=false;try{if(medalName.indexOf(this.configuration.medalFlags[0])!=-1||medalName.indexOf(this.configuration.medalFlags[1])!=-1||medalName.indexOf(this.configuration.medalFlags[2])!=-1){showMedal=true;}}catch(exp){}
if(showMedal){eventName='<td class="'+this.configuration.medalClass+'"><img src="http://ux.dowjones.net/svn/trunk/dev/build/img/medal_gold.png" alt="yes"></td>';}
var queryVal="";var sportName=schedule.subtitle;var sportsName=sportName.replace(/ /g,"");eventLink='<a title="'+schedule.name+'" href="/public/page/olympics-london-sports.html">';var code=this.sportsNameCode[sportsName.toLowerCase()];if(code&&typeof code!==undefined){eventLink='<a title="'+schedule.name+'" href="/public/page/olympics-london-sports-'+sportName+'-'+code+'.html?u='+code+'">';}else{var sportEle=dojo.byId(sportsName);if(sportEle){sportsName=sportsName.toLowerCase();var sportCode=dj.util.Element.getData(sportEle,"sports-"+sportsName);this.sportsNameCode[sportsName]=sportCode;eventLink='<a title="'+schedule.name+'" href="/public/page/olympics-london-sports-'+sportName+'-'+sportCode+'.html?u='+sportCode+'">';}}
var sportN=schedule.subtitle;sportN=sportN.replace("Football","Soccer");scheduleHTML=scheduleHTML+'<tr><td class="colDate">'+dateMonth+'</td><td class="colTime">'+timeAmPm+'</td><td class="colSport">'+eventLink+sportN+'</a></td>'+eventName+'</tr>';}
if(navigator&&navigator.userAgent.match(/MSIE/i)){var temp=document.createElement('div');this.MSIEsetTBodyInnerHTML(temp,scheduleContainer,scheduleHTML);}else{scheduleContainer.innerHTML=scheduleHTML;}
this.addEvents(this.currentDateJson);this.currentTitleJson.sort(this.sportCompare);},MSIEsetTBodyInnerHTML:function(temp,tbody,html){temp.innerHTML='<table><tbody id="'+this.configuration.scheduleContainerId+'">'+html+'</tbody></table>';tbody.parentNode.replaceChild(temp.firstChild.firstChild,tbody);},addEvents:function(data){this.dateOrder=this.dateOrder||dojo.byId(this.configuration.dateOrder);this.sportOrder=this.sportOrder||dojo.byId(this.configuration.sportOrder);dj.lang.addLiveEvent("#dateOrder, .colDateEvent","click",dojo.hitch(this,function(ev){dojo.stopEvent(ev);try{var scheduleContainer=scheduleContainer||dojo.byId(this.configuration.scheduleContainerId);if(dojo.hasClass(this.dateOrder,'currSortDesc')){dojo.removeClass(this.dateOrder,'sortDesc');dojo.removeClass(this.dateOrder,'currSortDesc');dojo.addClass(this.dateOrder,'currSortAsc');dojo.addClass(this.dateOrder,'sortAsc');}else{if(dojo.hasClass(this.sportOrder,'currSortAsc')){dojo.removeClass(this.dateOrder,'sortAsc');dojo.removeClass(this.dateOrder,'currSortAsc');}
dojo.addClass(this.dateOrder,'currSortDesc');dojo.addClass(this.dateOrder,'sortDesc');}
if(dojo.hasClass(this.sportOrder,'sortAsc')){dojo.removeClass(this.sportOrder,'sortAsc');}
if(dojo.hasClass(this.sportOrder,'sortDesc')){dojo.removeClass(this.sportOrder,'sortDesc');}
var orderedJosn=this.currentDateJson;this.currentDateJson=new Array();this.currentDateJson=this.populateData(this,orderedJosn,this.currentDateJson,scheduleContainer);}catch(exp){}}));dj.lang.addLiveEvent("#sportOrder, .colSportEvent","click",dojo.hitch(this,function(ev){dojo.stopEvent(ev);try{var scheduleContainer=scheduleContainer||dojo.byId(this.configuration.scheduleContainerId);if(dojo.hasClass(this.sportOrder,'currSortDesc')){dojo.removeClass(this.sportOrder,'currSortDesc');dojo.removeClass(this.sportOrder,'sortDesc');dojo.addClass(this.sportOrder,'currSortAsc');dojo.addClass(this.sportOrder,'sortAsc');}else{dojo.addClass(this.sportOrder,'sortDesc');dojo.addClass(this.sportOrder,'currSortDesc');if(dojo.hasClass(this.sportOrder,'currSortAsc')){dojo.removeClass(this.sportOrder,'sortAsc');dojo.removeClass(this.sportOrder,'currSortAsc');}}
if(dojo.hasClass(this.dateOrder,'sortAsc')){dojo.removeClass(this.dateOrder,'sortAsc');}
if(dojo.hasClass(this.dateOrder,'sortDesc')){dojo.removeClass(this.dateOrder,'sortDesc');}
var orderedJosn=this.currentTitleJson;this.currentTitleJson=new Array();this.currentTitleJson=this.populateData(this,orderedJosn,this.currentTitleJson,scheduleContainer);}catch(exp){}}));},populateData:function(that,orderedJosn,currentJson,scheduleContainer){var count=0;var scheduleHTML="";var displayDate="";for(var i=orderedJosn.length-1;i>=0;i--){var schedule=orderedJosn[i];var pubdate=schedule.time_start;var dateTimeParts=pubdate.split(" ");pubdate=dateTimeParts[0];var timeParts=dateTimeParts[1];var dateParts=pubdate.split("-");var timeParts=timeParts.split(":");var myDate=new Date(dateParts[0],dateParts[1]-1,dateParts[2],timeParts[0],timeParts[1]);var dateMonth=that.monthNames[myDate.getUTCMonth()]+" "+dateParts[2];var utcDate=Date.UTC(dateParts[0],dateParts[1]-1,dateParts[2],timeParts[0],timeParts[1]);displayDate=new Date(utcDate);var hours=displayDate.getHours();var min=displayDate.getMinutes();if(hours<10){hours="0"+hours;}
if(min<10){min="0"+min;}
var timeAmPm=that.getTime(hours+":"+min);var eventName='<td class="'+that.configuration.medalClass+'">&nbsp;</td>';var medalName=schedule.name;var showMedal=false;try{if(medalName.indexOf(this.configuration.medalFlags[0])!=-1||medalName.indexOf(this.configuration.medalFlags[1])!=-1||medalName.indexOf(this.configuration.medalFlags[2])!=-1){showMedal=true;}}catch(exp){}
if(showMedal){eventName='<td class="'+that.configuration.medalClass+'"><img src="http://ux.dowjones.net/svn/trunk/dev/build/img/medal_gold.png" alt="yes"></td>';}
var sportName=schedule.subtitle;var sportsName=sportName.replace(/ /g,"");var eventLink='<a title="'+schedule.name+'" href="/public/page/olympics-london-sports.html">';var code=that.sportsNameCode[sportsName.toLowerCase()];if(code&&typeof code!==undefined){eventLink='<a title="'+schedule.name+'" href="/public/page/olympics-london-sports-'+sportName+'-'+code+'.html?u='+code+'">';}else{var sportEle=dojo.byId(sportsName);if(sportEle){sportsName=sportsName.toLowerCase();var sportCode=dj.util.Element.getData(sportEle,"sports-"+sportsName);that.sportsNameCode[sportsName]=sportCode;eventLink='<a title="'+schedule.name+'" href="/public/page/olympics-london-sports-'+sportName+'-'+sportCode+'.html?u='+sportCode+'">';}}
var sportN=schedule.subtitle;sportN=sportN.replace("Football","Soccer");scheduleHTML=scheduleHTML+'<tr><td class="colDate">'+dateMonth+'</td><td class="colTime">'+timeAmPm+'</td><td class="colSport">'+eventLink+sportN+'</a></td>'+eventName+'</tr>';currentJson[count]=schedule;count++;}
if(navigator&&navigator.userAgent.match(/MSIE/i)){var temp=document.createElement('div');this.MSIEsetTBodyInnerHTML(temp,scheduleContainer,scheduleHTML);}else{scheduleContainer.innerHTML=scheduleHTML;}
return currentJson;},dateComparer:function(aBD,bBD){try{if(aBD==null)
return bBD==null?0:-1;if(bBD==null)
return 1;var dateTimesplit=aBD.split(" ");var date1=dateTimesplit[0];date1=date1.split("-");var year=date1[0];var month=date1[1];var day=date1[2];var time=dateTimesplit[1].split(":");var hours=time[0];var minutes=time[1];var dateTimesplit2=bBD.split(" ");var date2=dateTimesplit2[0];date2=date2.split("-");var year2=date2[0];var month2=date2[1];var day2=date2[2];var time2=dateTimesplit2[1].split(":");var hours2=time2[0];var minutes2=time2[1];var first=""+year+month+day;var sec=""+year2+month2+day2;if(first!==sec)
{return first===sec?0:(first>sec?1:-1);}else{var utcDate=Date.UTC(year,month,day,hours,minutes);var d1=new Date(utcDate);var utcDate2=Date.UTC(year2,month2,day2,hours2,minutes2);var d2=new Date(utcDate2);return d1===d2?0:(d1>d2?1:-1);}}catch(exp){}},sportCompare:function(a,b){if(b.subtitle<a.subtitle)
return-1;if(b.subtitle>a.subtitle)
return 1;return 0;},getTime:function(time){var that=this;var sAve=0;var ez1="";var ml3="00";var pw3=parseFloat(that.CleanBad(time));var pm4=that.CleanBad(time);var pm5=that.CleanBad(time);var len=pm4.length;if(len!=4){return time;}
else if(pw3>2401){return time;}
else if(pw3>1259){pw3=pw3-1200;var pm4=String(pw3);var len=pm4.length;if(len<4){pm4="0"+pm4;}
if(pm4.substring(0,1)=="0"){var hours=pm4.substring(1,2);}else{var hours=pm4.substring(0,2);}
var mins=pm4.substring(2,4);ez1=" p.m.";if(hours=="12")ez1=" a.m.";if(mins>"59")mins="???";return hours+":"+mins+ez1;}else{if(pm4.substring(0,1)=="0"){var hours=pm4.substring(1,2);}else{var hours=pm4.substring(0,2);}
var mins=pm4.substring(2,4);ez1=" a.m.";if(hours=="12"){ez1=" p.m.";}
if(pm5.substring(0,2)=="00"){hours="12";}
if(mins>"59")
mins="???";return hours+":"+mins+ez1;}},CleanBad:function(string){for(var i=0,output='',valid="eE-0123456789.";i<string.length;i++)
if(valid.indexOf(string.charAt(i))!=-1)
output+=string.charAt(i)
return output;}});dojo.provide("dj.module.olympics.scheduler");dojo.require("dj.widget.olympics.view.schedulerView");(function(){dj.module.olympics.scheduler={init:function(userConfiguration){this.configuration={schedulerView:null,defaultModuleID:"olympicsScheduler",medalClass:"hidden colMedal",dateOrder:"dateOrder",sportOrder:"sportOrder",medalFlags:[" Finals"," Final"," Medal"],sportCount:7,domainPrefix:"",domainSuffix:"/static_html_files/video/schedulerFeed.json",viewAll:false};var that=this;dojo.deepMixin(this.configuration,userConfiguration);this.configuration.schedulerView=new dj.widget.olympics.view.schedulerView({"dateOrder":this.configuration.dateOrder,"sportOrder":this.configuration.sportOrder,"medalFlags":this.configuration.medalFlags,"sportCount":this.configuration.sportCount,"scheduleContainerId":this.configuration.defaultModuleID,"viewAll":this.configuration.viewAll,"medalClass":this.configuration.medalClass});this.getFeedContent();},getFeedContent:function(){var that=this;var domainPrefix=dj.context.core.FeedSchedulerUrlPrefix;if(typeof domainPrefix=="undefined"){domainPrefix=that.configuration.domainPrefix;}
var domainSuffix=dj.context.core.FeedSchedulerUrlSuffix;if(typeof domainSuffix=="undefined"){domainSuffix=that.configuration.domainSuffix;}
var feedUrl=domainPrefix+domainSuffix;dojo.xhrGet({url:feedUrl,preventCache:true,load:function(loadData,xhr){try{loadData=loadData.replace(/Football/g,"Soccer");loadData=loadData.replace(/Athletics/g,"Track & Field");that.populateModules(loadData,that.configuration.defaultModuleID);}catch(exp)
{console.log("error while parsing Scheduler info: "+error);}},error:function(error,ioArgs){console.log("error while reteriving Scheduler info: "+error);}});},populateModules:function(scheduleJson,moduleId){var that=this;that.moduleId=moduleId;that.configuration.schedulerView.render(scheduleJson,that.moduleId);}};}());dojo.provide("dj.widget.offstream.view.offstreamModuleView");dojo.require("dj.util.offstream.dateUtility");dojo.require("dj.util.Element");dojo.require("dj.util.User");dojo.declare("dj.widget.offstream.view.offstreamModuleView",[],{constructor:function(cfg){this.contentTypesArr=["stream","tweet","photo","article","text","slideshow","video","liveblog"];this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this.columnSize=this._cfg.columnSize;this.numOfRecordsToLoad=cfg.numOfRecordsToLoad;this.initialize();this.dut=dj.util.offstream.dateUtility;this.dut.setTimeUnit("min","hr","day","S");},DEFAULT_CONFIG:{},initialize:function(){var ulNodeId="offstreamUL_"+this.columnSize;if(typeof this._cfg.tabUlId!="undefined"){ulNodeId=this._cfg.tabUlId;}
this._contentType={"stream":dojo.hitch(this,this.renderStream),"tweet":dojo.hitch(this,this.renderTweet),"photo":dojo.hitch(this,this.renderPhoto),"article":dojo.hitch(this,this.renderArticle),"text":dojo.hitch(this,this.renderText),"slideshow":dojo.hitch(this,this.renderSlideshow),"video":dojo.hitch(this,this.renderVideo),"liveblog":dojo.hitch(this,this.renderLiveBlog)};this._nodes={ulNode:ulNodeId};this.ulNodeContainer=dojo.byId(this._nodes.ulNode);},render:function(response,loadType){if(typeof response!="undefined"&&response!=null){if(typeof loadType!="undefined"&&loadType!=null){if(loadType=="initialLoad"){this.respLength=response.length;for(var index=0;index<this.respLength;index++){this.dataObj=response[index];if(this.ulNodeContainer.children.length<this.numOfRecordsToLoad){this.renderResponse(loadType);}}
this.dut.scan("[data-widget='dj.offstreamtimestamp']");this.setViewportHeight();}}else{this.getContentByContentId(response);this.dut.scanWithinContainer('#'+this._nodes.ulNode,"[data-widget='dj.offstreamtimestamp']");if(this.ulNodeContainer.children.length>this.numOfRecordsToLoad){this.deleteExtraRecord();}}}},renderResponse:function(loadType){try{var contentType=this.dataObj.content_type;if(this._contentType[contentType]){this._contentType[contentType](loadType);}}catch(e){console.log("error is "+e);}},renderArticle:function(loadType){var contentType=this.dataObj.content_type;var cite='';if(this.dataObj.article_source.indexOf('Blogs')!=-1){if(this.dataObj.article_type.lastIndexOf('Blog')>-1)
cite=this.dataObj.article_type.substr(0,this.dataObj.article_type.lastIndexOf('Blog'));else
cite=this.dataObj.article_type;}
if(typeof cite=="undefined"||cite==='')
{if(this.dataObj.content_section!=='')
{cite=this.dataObj.content_section||'U.S.';}
else
{cite='U.S.';}}
var contentInfo={"liClass":"ostri osType-txt osSubType-article","cite":cite,"title":contentType+"_title","summaryInfo":{"summaryVar":contentType+"_summary","isSummary":true}};this.generateHTML(contentType,contentInfo,loadType);},renderStream:function(loadType){var streamTitle=this.dataObj.stream_title;var streamSummary=this.dataObj.stream_summary;var streamUrl=this.dataObj.stream_url;var streamShortUrl=this.dataObj.stream_shorturl;var streamInfo={"streamTitle":streamTitle,"streamSummary":streamSummary,"streamUrl":streamUrl,"streamShortUrl":streamShortUrl};if(this.columnSize==6){this.streamInfo=streamInfo;this.initializeSocialToolBar();}},renderTweet:function(loadType){var contentType=this.dataObj.content_type;var contentInfo={"liClass":"ostri osType-tweet","cite":"Twitter","tweetName":this.dataObj.tweet_fullname,"tweetHandle":this.dataObj.tweet_username,"content":this.dataObj.tweet_content};this.generateHTML(contentType,contentInfo,loadType);},renderPhoto:function(loadType){var contentType=this.dataObj.content_type;var cite="Photo";var contentInfo={"liClass":"ostri osType-media osSubType-photo","cite":cite,"title":this.dataObj.content_type+"_title"};this.generateHTML(contentType,contentInfo,loadType);},renderText:function(loadType){var contentType=this.dataObj.content_type;var contentInfo={"liClass":"ostri osType-txt osSubType-editor","cite":"Update","title":contentType+"_title","summaryInfo":{"summaryVar":contentType+"_content","isSummary":true}};this.generateHTML(contentType,contentInfo,loadType);},renderSlideshow:function(loadType){var contentType=this.dataObj.content_type;var slideshowPhotoArr=this.dataObj.slideshow_photos;var cite="Photo Gallery";if(typeof slideshowPhotoArr!="undefined"&&slideshowPhotoArr.length>0){cite=cite+" - "+slideshowPhotoArr.length+" photos";}
var slideshowImagesArr=this.dataObj.slideshow_images;var imageSrc="";var imageSize="A";if(typeof slideshowImagesArr!="undefined"){if(this.columnSize==2){if(typeof slideshowImagesArr.C!="undefined"){imageSrc=slideshowImagesArr.C;}
imageSize="C";}else{if(typeof slideshowImagesArr.A!="undefined"){imageSrc=slideshowImagesArr.A;}}}
var contentInfo={"liClass":"ostri osType-media osSubType-slide","cite":cite,"title":this.dataObj.content_type+"_title","summaryInfo":{"summaryVar":"slideshow_description","isSummary":true},"imageInfo":{"size":imageSize,"imageSrc":imageSrc,isImage:true}};this.generateHTML(contentType,contentInfo,loadType);},renderVideo:function(loadType){var contentType=this.dataObj.content_type;var contentInfo={"liClass":"ostri osType-media osSubType-video","cite":"Video","title":this.dataObj.content_type+"_title","summaryInfo":{"summaryVar":"video_description","isSummary":true}};this.generateHTML(contentType,contentInfo,loadType);},renderLiveBlog:function(loadType){var contentType=this.dataObj.content_type;var cite="Live Blog";var title=this.dataObj.liveblog_title;var url=this.dataObj.liveblog_url;if(title!=null&&title.length>0&&url!=null){cite="Live Blog | "+"<a target=\"_blank\" href=\""+url+"\" class=\"src-detail\" >"+title+"</a>";}
var contentInfo={"liClass":"ostri osType-txt osSubType-liveblog","cite":cite,"title":contentType+"_title","summaryInfo":{"summaryVar":contentType+"_content","summaryClass":"ostri-full","isSummary":true}};this.generateHTML(contentType,contentInfo,loadType);},generateHTML:function(contentType,contentInfo,loadType){var contentId=this.dataObj.content_id;var existingLi=dojo.query(dojo.byId("li_"+contentId),this.ulNodeContainer);if(existingLi.length>0){var existingContentType=dj.util.Element.getData(existingLi[0],"content-type");var timeDiv=dojo.query(".ostri-time",existingLi[0]);var existingTS=dj.util.Element.getData(timeDiv[0],"major-ts");var isCandidateForUpdate=false;if(this.dataObj.content_date_gmt<=existingTS){isCandidateForUpdate=true;}
if(existingContentType&&existingContentType!="tweet"&&existingContentType!="liveblog"){if(isCandidateForUpdate){this.updateExistingRecord(contentType,contentInfo,existingLi[0]);return;}else{this.renderRecordHTML(contentType,contentInfo,loadType);dojo.destroy(existingLi[0]);}}}else if(this.isSuitableForRendering(loadType)){this.renderRecordHTML(contentType,contentInfo,null,loadType);}},updateExistingRecord:function(contentType,contentInfo,existingLi,loadType){this.renderRecordHTML(contentType,contentInfo,existingLi,loadType);},renderRecordHTML:function(contentType,contentInfo,existingLi,loadType){var contentId=this.dataObj.content_id;var liEle="";if(!existingLi){var position="first";if(typeof loadType!="undefined"&&loadType=="initialLoad"){position="last";}
liEle=dojo.create("li",{"id":"li_"+contentId,"class":contentInfo.liClass,"data-content-type":this.dataObj.content_type},this.ulNodeContainer,position);}else{liEle=existingLi;}
var that=this;dj.util.User.isSubLoggedIn(function(loggedIn){if(!loggedIn){var accessType=dj.util.offstream.dateUtility.parseInteger(that.dataObj[contentType+'_privilege']);var isArticlePaid=(accessType>0?true:false);if(isArticlePaid){dojo.addClass(liEle,"subPrev");}else{dojo.removeClass(liEle,"subPrev");}}});this.renderLiContents(contentType,contentInfo,liEle);},renderLiContents:function(contentType,contentInfo,liEle){var contentId=this.dataObj.content_id;var divEle=dojo.create("div",{"id":"div_"+contentId,"class":"ostri-inner"},liEle,"last");var divEle1=dojo.create("div",{"class":"ostri-meta"},divEle,"last");var spanEle1=dojo.create("span",{"class":"ostri-time","data-widget":"dj.offstreamtimestamp","data-major-ts":this.dataObj.content_date_gmt},divEle1,"last");var dateVal=dj.util.offstream.dateUtility.getTimeDifference((this.dataObj.content_date_gmt));spanEle1.innerHTML=dateVal;console.log("time w/o scan "+dateVal);var spanEle2=dojo.create("span",{"class":"ostri-src"},divEle1,"last");spanEle2.innerHTML="<cite>"+contentInfo.cite+"</cite>";if(contentType=="tweet"){this.generateTweetHTML(contentInfo,divEle);}else{if(typeof contentInfo.imageInfo!="undefined"&&contentInfo.imageInfo.isImage==true){if(contentType=="video"){this.generateVideoImageHTML();}else{var divImageEle=dojo.create("div",{"class":"ostri-media ostri-photo ostri-mediaFormat-"+contentInfo.imageInfo.size},divEle,"last");var imageEle=dojo.create("img",{"src":contentInfo.imageInfo.imageSrc,"class":"imageFormat-"+contentInfo.imageInfo.size},divImageEle,"last");}}
var h2Ele2=dojo.create("h2",{"class":"ostri-title ostri-title-out"},divEle,"last");if(contentType=="liveblog"){var h2="";h2Ele2.innerHTML=h2;}else{h2Ele2.innerHTML=this.dataObj[contentInfo.title];}
if(typeof contentInfo.summaryInfo!="undefined"&&contentInfo.summaryInfo.isSummary){var summaryClass="ostri-snippet";if(typeof contentInfo.summaryInfo.summaryClass!="undefined"){summaryClass=contentInfo.summaryInfo.summaryClass;}
var divEle3=dojo.create("div",{"class":summaryClass},divEle,"last");divEle3.innerHTML="<p>"+this.dataObj[contentInfo.summaryInfo.summaryVar]+"</p>";}}
var url=this.dataObj.content_url;if(this._cfg.mod!=null&&this._cfg.mod.length>0){url=url+"?mod="+this._cfg.mod;}
var divEle4=dojo.create("div",{"class":"ostri-more"},divEle,"last");var aEle4=dojo.create("a",{"href":url,"class":"ostri-viewSec"},divEle,"last");aEle4.innerHTML='<span class="ostri-secLbl">Open in Stream &raquo;</span>';},generateVideoImageHTML:function(contentInfo,divEle){var divImageEle=dojo.create("div",{"class":"ostri-media ostri-video ostri-mediaFormat-"+contentInfo.imageInfo.size},divEle,"last");var spanImageEle=dojo.create("span",{"class":"vid_thumb"},divImageEle,"last");var imageEle=dojo.create("img",{"src":contentInfo.imageInfo.imageSrc,"class":"imageFormat-"+contentInfo.imageInfo.size},spanImageEle,"last");var spanImageEle=dojo.create("span",{"class":"videoHint"},imageEle,"last");},generateTweetHTML:function(contentInfo,divEle){var divEle1=dojo.create("div",{"class":"ostri-tweet"},divEle,"last");var h2Ele=dojo.create("h2",{"class":"ostri-twMeta"},divEle1,"last");var spanEle=dojo.create("span",{"class":"ostri-tweetName"},h2Ele,"last");spanEle.innerHTML=contentInfo.tweetName+" ";var aEle=dojo.create("a",{"href":"#","class":"ostri-tweetHandle"},h2Ele,"last");aEle.innerHTML=contentInfo.tweetHandle;var pEle=dojo.create("p",{"class":"ostri-twContent"},divEle1,"last");pEle.innerHTML=contentInfo.content;},setViewportHeight:function(){var height=dojo.position(dojo.byId(this._nodes.ulNode)).h;dojo.style(dojo.byId(this._nodes.ulNode),{"height":height+"px","overflow":"hidden"});},getContentByContentId:function(response){if(typeof response.b==='undefined'||typeof response.b.a==='undefined'){return;}
message=dojo.fromJson(response.b.a);var contentId=message.content_id;this.getContentFromAPI(contentId);},getContentFromAPI:function(contentId){var that=this;var domainPrefix=dj.context.core.streamUrlPrefix;if(typeof dj.context.core.streamUrlPrefix=="undefined"){domainPrefix="http://stream.wsj.com";}
var time=new Date().getTime();var cache_bust_time=Math.floor(time/1000/60);var feedUrl=domainPrefix+"/services/content/"+contentId+"/?cbt="+cache_bust_time;var jsonArgs={url:feedUrl,handleAs:"json",callbackParamName:"callback",preventCache:false,load:function(data,xhr){that.dataObj=data;that.renderResponse();},error:function(error,ioArgs){console.log(error);}}
dojo.io.script.get(jsonArgs);},deleteExtraRecord:function(){if(this.ulNodeContainer.children.length>0){var lastLi=this.ulNodeContainer.children[this.ulNodeContainer.children.length-1];dojo.destroy(lastLi);}},isSuitableForRendering:function(loadType){if(this.ulNodeContainer.children.length>0){if(typeof loadType!="undefined"&&loadType=="initialLoad"){var lastLi=this.ulNodeContainer.children[this.ulNodeContainer.children.length-1];var lastTimeDiv=dojo.query(".ostri-time",lastLi);var lastTS=dj.util.Element.getData(lastTimeDiv[0],"major-ts");var newTS=this.dataObj.content_date_gmt;if(newTS>lastTS){console.log("Article skipped with TS  "+new Date(newTS*1000));console.log("content id  "+this.dataObj.content_id);return false;}}else{var firstLi=this.ulNodeContainer.children[0];var timeDiv=dojo.query(".ostri-time",firstLi);var ts=dj.util.Element.getData(timeDiv[0],"major-ts");var newTS=this.dataObj.content_date_gmt;if(newTS<ts){console.log("Article skipped with TS  "+new Date(newTS*1000));console.log("content id  "+this.dataObj.content_id);return false;}}}
return true;},initializeSocialToolBar:function(){var fbLi=dojo.query("#offstreamFB",this._cfg.headerContainerId);var twLi=dojo.query("#offstreamTW",this._cfg.headerContainerId);this.makeFBConnection(fbLi);this.makeTWConnection(twLi);},makeFBConnection:function(fbLi){if(fbLi.length>0){dojo.connect(fbLi[0],"click",this,this.openFBShare);}},makeTWConnection:function(twLi){if(twLi.length>0){dojo.connect(twLi[0],"click",this,this.openTwitterShare);}},openFBShare:function(e){var caption="online.wsj.com";var socialType="facebook";var data={};data.app_id='368513495882';data.link=this.attachMod(this.streamInfo.streamUrl,socialType);data.redirect_uri='http://online.wsj.com/static_html_files/facebook_share.html';data.name=this.streamInfo.streamTitle;data.caption=caption;data.description=this.streamInfo.streamSummary;var url=this.buildFacebookFeedUrl(data);if(!url){return;}
this.popUp(url,'share','toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1');},attachMod:function(permalink,share){gcDomain=permalink;var domain='wsj';if(gcDomain.indexOf('barrons')!=-1){domain='bol';}
else if(gcDomain.indexOf('wsj')!=-1){domain='wsj';}
else if(gcDomain.indexOf('marketwatch')!=-1){domain='mw';}
return encodeURIComponent(decodeURIComponent(permalink)+'?mod='+domain+'_share_'+share);},popUp:function(url,name,features){var win=window.open(url,name,features);if(win){win.focus();}},buildFacebookFeedUrl:function(content){if(!content.app_id||!content.redirect_uri){return null;}
var url='';url+=(content.app_id?'app_id='+content.app_id:'');url+=(content.redirect_uri?'&redirect_uri='+content.redirect_uri:'');url+=(content.link?'&link='+content.link:'');url+=(content.picture?'&picture='+content.picture:'');url+=(content.name?'&name='+encodeURIComponent(content.name):'');url+=(content.caption?'&caption='+encodeURIComponent(content.caption):'');url+=(content.description?'&description='+encodeURIComponent(content.description):'');url='https://www.facebook.com/dialog/feed?'+decodeURIComponent(encodeURIComponent(url));return url;},openTwitterShare:function(e){var twitter_title=this.streamInfo.streamTitle;var longUrl=this.streamInfo.streamShortUrl;this.popUp('http://twitter.com/intent/tweet?text='+encodeURIComponent(twitter_title)+' '+encodeURIComponent(longUrl),'share','toolbar=0,status=0,width=770,height=450,resizable=1,scrollbars=1');}});dojo.provide("dj.widget.offstream.offstreamModule");dojo.require("dj.widget.offstream.view.offstreamModuleView");dojo.require("dj.module.stockinnews.mrktProvider")
dojo.require("dj.util.bluegrass");dojo.require("dojo.io.script");dojo.declare("dj.widget.offstream.offstreamModule",[],{constructor:function(customConfig){this._cfg=dojo.mixin(this.CONFIG,customConfig);},init:function(customConfig){this.calledFlag=false;this.subscribedList=[];if(!dj.context.marketdata.bluegrassProvider){dj.context.marketdata.bluegrassProvider=new dj.module.stockinnews.mrktProvider({});}
var connection=dj.util.bluegrass.Runtime.getConnection();if(connection===null||typeof connection==="undefined"){dj.context.marketdata.bluegrassProvider.connect();}
var domainPrefix=dj.context.core.streamUrlPrefix;if(typeof dj.context.core.streamUrlPrefix=="undefined"){domainPrefix="http://stream.wsj.com";}
var time=new Date().getTime();var cache_bust_time=Math.floor(time/1000/60);var streamUrl=domainPrefix+"/services/stream/"+this._cfg.streamId+"/0/DESC/?cbt="+cache_bust_time+"&count="+this._cfg.numOfRecordsToLoad;if(typeof this._cfg.streamUrl!="undefined"&&dojo.trim(this._cfg.streamUrl)!=""){streamUrl=this._cfg.streamUrl;}
this.offstreamModuleView=new dj.widget.offstream.view.offstreamModuleView(this._cfg);this.populateData(streamUrl,this._cfg.columnSize,"initialLoad");},CONFIG:{streamId:"SS-2-4",numOfRecordsToLoad:10,columnSize:4,headerContainerId:"ostreamHeaderId",streamUrl:"",mod:"",title:""},populateData:function(feedUrl,columnSize,loadType){var that=this;this.columnSize=columnSize;this.loadType=loadType;var jsonArgs={url:feedUrl,handleAs:"json",callbackParamName:"callback",preventCache:false,load:function(data,xhr){that.offstreamModuleView.render(data,that.loadType);if(that.calledFlag==false){that.calledFlag=true;that.bluegrassSubscribeChannel(["/wsj/blogs/"+that._cfg.streamId],that.offstreamModuleView);}
that.loading_content=false;},error:function(error,ioArgs){if(that.calledFlag==false){that.calledFlag=true;that.bluegrassSubscribeChannel(["/wsj/blogs/"+that._cfg.streamId],that.offstreamModuleView);}
that.loading_content=false;console.log(error);}}
dojo.io.script.get(jsonArgs);},bluegrassSubscribeChannel:function(channels,viewComp){try{var that=this;var dynamicChannels=[];var channelView=null;channelView=viewComp;dojo.forEach(channels,function(fChannel){if(dojo.indexOf(that.subscribedList,fChannel)===-1){dynamicChannels.push({channelName:fChannel,view:channelView});that.subscribedList.push(fChannel);}});try{if(dynamicChannels.length>0){dj.context.marketdata.bluegrassProvider.dynamicSubscribeChannel(dynamicChannels,channelView,channels);}}catch(e){console.log("Error while making blueegrass connection "+e);}}catch(e){console.log("Error: "+e);}}});dojo.provide("dj.module.offstream.offstreamTabModule");dojo.require("dj.widget.offstream.offstreamModule");dj.module.offstream.offstreamTabModule={initOffStreamTab:function(tabUlId,streamId,numOfRecordsToLoad){customConfig={"tabUlId":tabUlId,"streamId":streamId};if(typeof numOfRecordsToLoad!="undefined"&&numOfRecordsToLoad!=""){customConfig.numOfRecordsToLoad=numOfRecordsToLoad;}
if(customConfig.tabUlId!==null&&typeof customConfig.tabUlId!=="undefined"){var container=dojo.query("#"+customConfig.tabUlId)[0];if(dojo.hasClass(container,'notInitiallized')){dojo.removeClass(container,"notInitiallized");new dj.widget.offstream.offstreamModule(customConfig).init();}}}};dojo.provide("dj.module.header2012.autocomplete");

dj.module.header2012.autocomplete = {
  searchExec : function(){
    
    
    var cfgObj = {          
        autocompleteSuggestProvider : 'MWatchWSJHatSearchProvider', 
        autocompleteInputField : 'globalHeaderSearchInput'
    
    };
    var autoCompleteViewCfg = {
      "categoryTypeArr" : ["FEATURES","COMPANIES","PRIVATE_COMPANIES","TOPICS","KEYWORDS"],
      "CategoryDisplayConfigs": [
        {
          "subHeading1": "",
          "subHeading2": "",
          "noOfColumns": 1,
          "columnToObjMap": ["term","url"],
          "subHeading1DisplayFlag": false,
          "name": "suggestedTerms",
          "maxNoOfSuggestionsToDisplay" : 3,
          "subHeading1Class":"",
          "noOfColumnsToObjMap": 2
        },{
          "subHeading1": "COMPANIES & QUOTES",
          "subHeading2": "See all symbol results for ",
          "noOfColumns": 6,
          "columnToObjMap": ["ticker","company","country","exchange","exchangeIsoCode","type"],
          "subHeading1DisplayFlag": true,
          "subHeading2DisplayFlag": false,
          "name": "companies",
          "maxNoOfSuggestionsToDisplay" : 5,
          "subHeading1Class":"hdrSearchListComp",
          "noOfColumnsToObjMap": 6
        },{ 
          "subHeading1": "Private Companies", 
          "subHeading2": "",
          "noOfColumns": 1,
          "columnToObjMap": ["name"],
          "subHeading1DisplayFlag":true,
          "name": "privateCompanies",
          "maxNoOfSuggestionsToDisplay" : 5,
          "subHeading1Class":"hdrSearchListComp hdrSearchListCompPrivate",
          "noOfColumnsToObjMap": 1 
        },{
          "subHeading1": "Topics and People In The News",
          "subHeading2": "",      
          "noOfColumns": 1,
          "columnToObjMap": ["name","code","type"],
          "subHeading1DisplayFlag":true,
          "name": "topics",
          "maxNoOfSuggestionsToDisplay" : 5,
          "subHeading1Class":"hdrSearchListTopicPpl",
          "noOfColumnsToObjMap": 3
        },{
          "subHeading1": "Recent Searches",
          "subHeading2": "",
          "noOfColumns": 1,
          "columnToObjMap": ["keyword"],
          "subHeading1DisplayFlag": true,
          "name": "keywords",
          "maxNoOfSuggestionsToDisplay" : 3,
          "subHeading1Class":"hdrSearchListRecent",
          "noOfColumnsToObjMap": 1
        }
      ]
    };   
   
    var autoComplete = new dj.module.ep.globalheader.wsjAutocomplete(cfgObj.autocompleteInputField, { suggestProvider : cfgObj.autocompleteSuggestProvider, companyResearchBaseUrl : dj.context.core.quotesUrlPrefix }, autoCompleteViewCfg);
    
    
  }
};
/*global document, dj, dojo, dojox, dijit, window, console, unescape, escape*/

dojo.provide("dj.module.header2012.editionSwitcher");

/* Documentation Describing code
 * Make sure this always passes jsHint!
 * Call edition switcher with param override like this:
 * dj.module.initionSwitcher.init({"initial":"and not useful"})
 */

(function() {
  dj.module.header2012.editionSwitcher = {
    init: function(cfg) {

      var defaultConfig = {
        editionTriggerId : "editionPopTrigger",
        editionDDId      : "editionDDTrigger",
        regionCodeToEdition :
            { "na,us"      : "usEdition", 
              "asia"       : "AsiaEdition", 
              "asia,indo"  : "indonesiaEdition", 
              "asia,cn"    : "simChiEdition",
              // "asia,cn"    : "tradChiEdition",  // TODO: fix datamodel issue here
              "asia,kr"    : "koreaEdition",
              "asia,india" : "indiaEdition",
              "europe"     : "europeEdition",
              //"europe,de"  : "germanyEdition",
              "germany"  : "germanyEdition",
              "na,lat"     : "latinEdition",
              "na,br"      : "brasilEdition"
            }
      };

      this.dropdownCollapsed = true;
      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      this._load();
    },

    _load: function() {
      var ddTrigger   = dojo.byId(this.config.editionTriggerId),
          ddContainer = dojo.byId(this.config.editionDDId);

      this.addClickEvents(ddTrigger, ddContainer);
      this.highlightEditionName();
    },

    /**
     * Retrieves weather XHTML for ajax requests
     *
     * @param {String}
     *          aParam, an important param
     */
    addClickEvents: function(ddTrigger, ddContainer) {
      var self = this;

      // hides/shows region dropdown
      dojo.connect(ddTrigger, "click", this, function(ev) {
        dojo.stopEvent(ev);

        if (dojo.hasClass(ddContainer, "popOpen")) {
          dojo.removeClass(ddContainer, "popOpen");
          dojo.addClass(ddContainer, "popClosed");
          self.dropdownCollapsed = true;
        } else {
          dojo.addClass(ddContainer, "popOpen");
          dojo.removeClass(ddContainer, "popClosed");
          self.dropdownCollapsed = false;
        }
      });

      // close the dropdown when a click happens outside of it
      dojo.connect(document, "onclick", function(event) {
        if (self.dropdownCollapsed === false) {
          var isClickInContainer = dj.util.Element.contains(ddContainer, event.clientX, event.clientY);

          if (isClickInContainer === false) {
            dojo.removeClass(ddContainer, "popOpen");
            dojo.addClass(ddContainer, "popClosed");
            self.dropdownCollapsed = true;
          }
        }
      });
    },

    highlightEditionName: function() {
      var region        = dj.util.Region.getViewByRegion(),
          mappedRegion  = "#" + this.config.regionCodeToEdition[region] + " a",
          regionEl      = dojo.query(mappedRegion)[0];
      dojo.addClass(regionEl, "selected");
    }
  };
}());
/*global document, dj, dojo, dojox, dijit, window, console, unescape, escape*/

dojo.provide("dj.module.header2012.messageCenter");

/* Documentation Describing code
 * Passes jsHint!
 * Call edition switcher with param override like this:
 */

(function () {
  dj.module.header2012.messageCenter = {
    init: function (cfg) {
      var defaultConfig = {
        messageSvcUrl : "/community/integration/userinfo.html"
      };

      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      this._load();
    },

    _load: function () {
      var count = dj.util.Cookie.getCookie("msgCount");

      if (count=== null) {
        this.getMessages(this.config.messageSvcUrl, "processMessages");
      } else {
        this.displayMessageCount(count);
      }
    },

    processMessages: function (messages) {
      var count = messages.MessagesCount;

      this.setMessageCookie("msgCount", count);
      this.displayMessageCount(count);
    },

    getMessages: function (url, functionName) {
      var self = this;

      return dojo.xhrGet({
        url      : self.config.messageSvcUrl,
        handleAs : "json",
        load     : function (response, ioArgs) {
                     self.processMessages(response);
        },
        error    : function (response, ioArgs) {
          console.error("HTTP status code: ", ioArgs.xhr.status);
          return response;
        }
      });
    },

    setMessageCookie: function (key, value) {
      dj.util.Cookie.setCookie(key, value, (5 / 24 / 60));
    },

    displayMessageCount: function (count) {
      if (count > 0) {
        var messages = dojo.byId("messageCount");
        dojo.removeClass(dojo.byId("showMessages"), "hidden");
        messages.innerHTML = "(" + count + ")";
      }
    }
  };
}());
/*global document, dj, dojo, FB, console */

dojo.provide("dj.module.header2012.userDetails");
dojo.require("dj.module.facebook.connect");

/*
 * Enables login info in Header
 * Make sure this always passes jsHint!
 */

(function() {
  dj.module.header2012.userDetails = {
    init: function(cfg) {

      var defaultConfig = {
        loginDetailsTriggerId   : "userName",
        loginDetailsContainerId : "loginDetailsDDContainer",
        myJournalTriggerId      : "myJournalTrigger",
        myJournalContainerId    : "myJournalContainer",
        avatarId                : "communityAvatar",
        avatarUrl               : "http://cs.wsj.net/community/content/images/misc/members/defaultuser.50x50.png",
        enableFacebookConnect   : true,
        fbConnectAsId           : "facebookConnectedAs",
        fbConnectAsPopup        : "facebookConnectPopup"
      };

      this.loginDropdownCollapsed     = true;
      this.myjournalDropdownCollapsed = true;

      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      var self = this;

      // only load user info if logged in
      dj.util.User.isLoggedIn(function (isLoggedIn) {
        if (isLoggedIn) {
          self._load();
        }
      });
    },

    /**
     * Initial lookups and basic logic goes here
     */
    _load: function() {
      var loginDetailsTrigger   = dojo.byId(this.config.loginDetailsTriggerId),
          loginDetailsContainer = dojo.byId(this.config.loginDetailsContainerId),
          myJournalTrigger      = dojo.byId(this.config.myJournalTriggerId),
          myJournalContainer    = dojo.byId(this.config.myJournalContainerId);

      this.addClickEvents(loginDetailsTrigger, loginDetailsContainer, this.loginDropdownCollapsed);
      this.addClickEvents(myJournalTrigger, myJournalContainer, this.myjournalDropdownCollapsed);

      this.showUserName();
    },

    /**
     * Retrieves weather XHTML for ajax requests
     *
     */
    addClickEvents: function(ddTrigger, ddContainer, collapsed) {
      var self = this;

      dojo.connect(ddTrigger, "click", this, function(ev) {
        dojo.stopEvent(ev);

        if (dojo.hasClass(ddContainer, "popOpen")) {
          dojo.removeClass(ddContainer, "popOpen");
          dojo.addClass(ddContainer, "popClosed");
          collapsed = true;
        } else {
          dojo.addClass(ddContainer, "popOpen");
          dojo.removeClass(ddContainer, "popClosed");
          collapsed = false;

          self.setCommunityAvatar();  // lazyload community avatar

          if (self.config.enableFacebookConnect) {
            self.getFacebookStatus();
          }
        }
      });

      // close the dropdown when a click happens outside of it
      dojo.connect(document, "onclick", function(event) {
        if (collapsed === false) {
          var isClickInContainer = dj.util.Element.contains(ddContainer, event.clientX, event.clientY);

          if (isClickInContainer === false) {
            dojo.removeClass(ddContainer, "popOpen");
            dojo.addClass(ddContainer, "popClosed");
            self.collapsed = true;
          }
        }
      });
    },

    setCommunityAvatar: function() {
      var el = dojo.byId(this.config.avatarId);

      if (el.src.length > 0) {
        el.src = this.config.avatarUrl;
      }
    },

    getFacebookStatus: function () {
      if (FB.getUserID() === 0) {
        this.loginFacebookConnect();
      } else {
        this.showFacebookConnectedAs();
      }
    },

    loginFacebookConnect: function () {
      var el = dojo.byId(this.config.fbConnectAsPopup);
      dojo.removeClass(el, "hidden");

      dojo.connect(el, "onclick", function() {
        var self = this;

        FB.login(function(response) {
          if (response.authResponse) {
            dojo.addClass(el, "hidden");
            self.showFaceBookConnectedAs();
          } else {
            console.log('User login not completed.');
          }
        });
      });
    },

    showFacebookConnectedAs: function () {
      var el = dojo.byId(this.config.fbConnectAsId);
      dojo.removeClass(el, "hidden");

      FB.api('/me', function(response) {
        el.innerHTML = "<small>Connected as</small>" + response.name;
      });
    },

    showUserName: function () {
      dojo.removeClass(dojo.query(".uNav")[0], "hidden");
      dj.util.User.renderCallsign("userName");
      dojo.place("<span class='sym'></span>", dojo.byId("userName"));
    }
  };
}());
/*global document, dj, dojo, dojox, dijit, window, console, unescape, escape*/

dojo.provide("dj.module.header2012.sectionMenu");
dojo.require("dj.widget.panel.LiveModalPanel");
dojo.require("dj.util.Element");
dojo.require("dj.lang");
dojo.require("dj.widget.panel.SelectDropdownPanel");

(function () {
  dj.module.header2012.sectionMenu = {
    init: function () {
      var isInitDone = false;
      this.delayedMouseOver("._exp", function (el) {
        if (!isInitDone) {
          this.initializeHeaderPanels();
          this.setEvents();
          isInitDone = true;
        }
        this.initShowData(el);
      }, 250);

      this.fadeInArrows();
    },

    /**
     * Initialize Panels object for menu dropdown
     *
     */
    initializeHeaderPanels: function () {
      var headerMenu = new dj.widget.panel.LiveModalPanel(
      {
        container : ".linklist_dropdown .wsjmn_dropdown_container",
        containerInd : ".linklist_dropdown .wsjmn_dropdown_container .mnExpand",
        dropdownContent : ".wsjmn_dropdownContent",
        actionEvent : "click",
        stateContainer : ".wsjmn_dropdownTree",
        stateCollapsed : "wsjmn_ddState-collapsed",
        stateExpanded : "wsjmn_ddState-expanded",
        navContainer : ".pmMainNav",
        stateHover : "mndd_ddState-hover",
        queryUpClass : "wsjmn_dropdownTree",
        addMouseEvents : false
      });
    },

    initShowData: function (el) {
      var svcUrl = this.getDropdownIndex(el);
      var ddi = dj.util.Element.getDataset(el).dropdownindex;
      var ddiEl = dojo.byId(ddi+"_content");

      this.showData(svcUrl, ddiEl, el);
    },

    showData: function (svcUrl, ddiEl, dataEl) {
      var that = this;
      var initDelay = false;

      initDelay = setTimeout(function () {
        // multiple requests aren't initiated by the click and mouseover events
        if ((dojo.hasClassName(dataEl, "_data") === false)) {
          dojo.addClass(dataEl, '_data');
          that.getHTML(svcUrl, ddiEl, dataEl);  // replaces spinner html with menu content
        }
      });
    },

    getDropdownIndex: function (el) {
      var sEl = dj.util.Element.getDataset(el);
      var svcEl = dj.util.Element.getDataset(dojo.byId(sEl.dropdownindex));
      return svcEl.panelServiceUri;
    },

    setIframeShimHeights: function (el) {
      var elData = dj.util.Element.getDataset(el).dropdownindex;
      var elNum = elData.match(/(\d.*)/)[0];
      var iFrameId = "wsjmn_dropdown_iframe"+elNum;
      var dropdownId = "wsjmn_dropdown"+elNum+"_content";
      var content = dojo.byId(dropdownId);
      var iFrameEl = dojo.byId(iFrameId);

      for (var i=0;i<=content.length - 1;i++) {
        try {
          iFrameEl.offsetHeight = dojo.byId("wsjmn_dropdown_content"+elNum).offsetHeight;
        }
          catch(err) {}
        }

      try {
        iFrameEl.offsetHeight = dojo.byId("wsjmn_dropdown_content"+elNum).offsetHeight;
      }
        catch(e) {}
    },	

    setEvents: function () {
      var that = this;

      dj.lang.addLiveEvent("._exp", "mousedown", function (ev) {
        var el = (ev.target || ev.srcElement);
        that.initShowData(el);
      });

      dj.lang.addLiveEvent(".subExpand", "mousedown", function (ev) {
        var el = (ev.target || ev.srcElement);
        that.subFlyoutToggle("1-3");
      });
    },

    delayedMouseOver: function (containerClass, func, time) {
      var doInit = false, initDelay;
      var that = this;

      var outEvent = dj.lang.addLiveEvent(containerClass, "mouseout", function () { doInit = false; });
      var overEvent = dj.lang.addLiveEvent(containerClass, "mouseover", function (ev) {
      if (initDelay) { clearTimeout(initDelay); }
        doInit = true;
        var el = this;
        initDelay = setTimeout(function () {
          if (!doInit) { 
            return; 
          }

          func.call(that, el);
        }, time);
      });
    },

    getHTML: function (location, el, dataEl) {
      var that = this;

      dojo.xhrGet( {
         url: location,
         headers: {
           Accept: 'application/html'
         },
         handleAs: "text",
         load: function (response, ioArgs) {
           var requestStatus = ioArgs.xhr.getResponseHeader('Status');
           el.innerHTML = response;
           // when the comment below is matched in the request a special panel is initialized 
           if (response.match(/<!--BusinessDropdown-->/)) {
             var panel = new dj.widget.panel.SelectDropdownPanel('subIndDropdown');
           }
         },
         error: function (response, ioArgs) {
           console.error("HTTP status code: ", ioArgs.xhr.status);
           return response;
         }
      });
    },

    subFlyoutToggle: function (n) {
      // Get the dropdown
      var el = dojo.byId("wsjsub_flyout" + n);

      if (el === null) {
        return false;
      }

      var currentClass = el.className;
      // Toggle between the classes mn_ddState-collapsed and mn_ddState-expanded
      if(currentClass.indexOf("wsjsub_ddState-collapsed") !== -1) {
        el.className = currentClass.replace( /wsjsub_ddState-collapsed/, "wsjsub_ddState-expanded");
      } 
      else {
        el.className = currentClass.replace(/wsjsub_ddState-expanded/, "wsjsub_ddState-collapsed");
      }
      return false;	
    },

    fadeInArrows: function () {
      var arrowNodes = dojo.query(".mnExpand._exp");

      for (var i=0;i<=arrowNodes.length - 1;i++) {
        dojo.fadeIn({
          node: arrowNodes[i],
          duration: (1.0 * 1000)
        }).play();
      }
    }
  };
}());

